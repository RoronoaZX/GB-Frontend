import{r as q,o as m,e as R,w as a,f as t,Q as Y,I as b,a3 as S,bc as V,a1 as te,aJ as J,ae,M as Q,be as le,a2 as W,O as G,R as X,J as d,K as oe,c as I,$ as k,a0 as y,a4 as E,a5 as _e,N as M,z as ve,L as se}from"./index.52ab8d70.js";import{Q as ye}from"./QChip.4e773081.js";import{Q as K,a as he}from"./QTable.d6183752.js";import{Q as ne}from"./QBadge.a969df9d.js";import{Q as be}from"./QPagination.65d6bd87.js";import{q as re}from"./date.4a0dcc7b.js";import{u as ie}from"./use-quasar.6240bc3a.js";import{u as ce}from"./baker-report.e820ca6c.js";import{u as ue}from"./stock-delivery.0a3fcc02.js";import{a as T}from"./QSelect.b0340989.js";import{a as ee,b as L}from"./QMenu.20e2321f.js";import{Q as De}from"./QList.dcb373d6.js";import{C as de}from"./ClosePopup.55f32f22.js";import{u as me}from"./use-dialog-plugin-component.9a2cdbf8.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.c2de0c65.js";import"./use-virtual-scroll.2086accb.js";import"./rtl.276c3f1b.js";import"./selection.ffce7ada.js";import"./axios.6451a077.js";import"./position-engine.cd109933.js";const pe=s=>(G("data-v-318678d0"),s=s(),X(),s),ke=pe(()=>d("div",{class:"text-h5 q-mb-xs"},"Confirm Report",-1)),Ce={key:0},we=pe(()=>d("div",{class:"text-positive text-subtitle1"}," Please confirm again to finalize this report. ",-1)),xe={__name:"ConfirmDialog",setup(s){const{dialogRef:C,onDialogHide:D,onDialogOK:w,onDialogCancel:h}=me(),i=q(!1),c=()=>{i.value?w():i.value=!0};return(p,u)=>(m(),R(W,{ref_key:"dialogRef",ref:C,onHide:le(D)},{default:a(()=>[t(Y,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:a(()=>[t(b,{class:"q-pt-none q-pb-sm"},{default:a(()=>[ke,i.value?V("",!0):(m(),S("p",Ce," Are you sure you wanat to confirm this report? "))]),_:1}),i.value?(m(),R(b,{key:0},{default:a(()=>[we]),_:1})):V("",!0),t(te,{class:"q-mb-sm"}),t(b,null,{default:a(()=>[t(J,{align:"right",class:"q-pt-none"},{default:a(()=>[ae(t(Q,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),t(Q,{dense:"",label:i.value?"Confirm":"Yes! Confirm",color:"positive",class:"q-btn-rounded q-px-lg",onClick:c},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var qe=Z(xe,[["__scopeId","data-v-318678d0"]]);const Se=s=>(G("data-v-5a3e7851"),s=s(),X(),s),Qe=Se(()=>d("div",{class:"text-h5 q-mb-xs"},"Decline Report",-1)),Re={key:0},$e={__name:"DeclinedDialog",setup(s){const{dialogRef:C,onDialogHide:D,onDialogOK:w,onDialogCancel:h}=me(),i=q(!1),c=q(""),p=q(null),u=q(!1),g=async()=>{i.value?(u.value=!0,p.value.validate()&&w({remarks:c.value})):i.value=!0};return(N,$)=>(m(),R(W,{ref_key:"dialogRef",ref:C,onHide:le(D),persistent:""},{default:a(()=>[t(Y,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:a(()=>[t(b,{class:"q-pt-none q-pb-sm"},{default:a(()=>[Qe,i.value?V("",!0):(m(),S("p",Re,"Are you sure you want to decline this report?"))]),_:1}),i.value?(m(),R(b,{key:0},{default:a(()=>[t(oe,{modelValue:c.value,"onUpdate:modelValue":$[0]||($[0]=x=>c.value=x),type:" textarea",label:"Reason  for declining",filled:"",autogrow:"",dense:"",ref_key:"remarksInput",ref:p,rules:[x=>!!x||"Remarks are required"]},null,8,["modelValue","rules"])]),_:1})):V("",!0),t(te,{class:"q-mb-md"}),t(b,null,{default:a(()=>[t(J,{align:"right",class:"q-pt-none"},{default:a(()=>[ae(t(Q,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),t(Q,{dense:"",label:i.value?"Submit Decline":"Yes! Decline",color:"negative",class:"q-btn-rounded q-px-lg",onClick:g},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Ie=Z($e,[["__scopeId","data-v-5a3e7851"]]);const Ve=s=>(G("data-v-63ad10d8"),s=s(),X(),s),Ne={class:"row justify-between"},Ae={class:"text-h6"},Me={key:0},Te={class:"q-mt-md"},Le=Ve(()=>d("span",{class:"text-grey-7 text-caption"},"Items: ",-1)),Fe={key:1,class:"text-caption text-grey-6 q-mt-md"},Be={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["fetchAgain"],setup(s,{emit:C}){var B,F;const D=ce(),w=I(()=>D.user);console.log("userData in RawMaterialsTable:",w.value);const h=((F=(B=w.value)==null?void 0:B.data)==null?void 0:F.employee_id)||"";console.log("employeeIdsssssssssssssss:",h);const i=ue();I(()=>i.loading),I(()=>i.declinedStocks);const c=s;console.log("props in Transaction view:",c.report);const p=C,u=q(!1),g=ie(),N=()=>{u.value=!0},$=n=>n?n.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"",x=n=>re.formatDate(n,"MMMM D, YYYY - hh:mm A"),P=n=>n==null?"No Quantity":parseFloat(n),A=()=>{g.dialog({component:qe}).onOk(()=>{console.log("Data from child:",c.report),z(c.report)}).onCancel(()=>{console.log("Cancelled")})},U=()=>{g.dialog({component:Ie}).onOk(n=>{console.log("Decliene remark from child:",n),H(c.report.id,n)}).onCancel(()=>{console.log("Cancelled")})},z=async n=>{var e,l,r,v;console.log("Confirming report",n);try{g.loading.show();const _=n.items.map(j=>{const fe=parseFloat(j.quantity)||0,ge=parseFloat(j.gram)||0;return{...j,total_grams:fe*ge}});console.log("Per Item Totals:",_);const f={...n,employee_id:h||"0",status:"confirmed",items:_};console.log("Confirm Datasss:",f);const o=await i.confirmDeliveryStocks(f);console.log("responsesssssss",o),(o==null?void 0:o.data)||((e=o==null?void 0:o.data)==null?void 0:e.message)==="Delivery confirmed."?(M.create({type:"positive",message:o.data.message||"Delivery Confirmed Successfully"}),(o==null?void 0:o.status)===200&&(u.value=!1,p("fetchAgain"))):M.create({type:"negative",message:((l=o==null?void 0:o.data)==null?void 0:l.message)||"Failed to Confirm Delivery"}),console.log("responsesss",o)}catch(_){console.log(_),M.create({type:"negative",message:((v=(r=_==null?void 0:_.response)==null?void 0:r.data)==null?void 0:v.message)||"Failed to Confirm Delivery"})}finally{g.loading.hide()}},H=async(n,e)=>{var l,r,v,_;try{g.loading.show(),console.log("declining report",n,"with remarks:",e);const f={id:n,employee_id:h||"0",status:"declined",remarks:e.remarks};console.log("declineData",f);const o=await i.declineDeliveryStocks(f);(o==null?void 0:o.data)||((l=o==null?void 0:o.data)==null?void 0:l.message)==="Delivery declined successfully."?(M.create({type:"positive",message:o.data.message||"Delivery Declined Successfully"}),(o==null?void 0:o.status)===200&&(u.value=!1,p("fetchAgain"))):M.create({type:"negative",message:((r=o==null?void 0:o.data)==null?void 0:r.message)||"Failed to decline delivery"}),console.log("responsesssss",o)}catch(f){console.log(f),M.create({type:"negative",message:((_=(v=f==null?void 0:f.response)==null?void 0:v.data)==null?void 0:_.message)||"Failed to decline delivery. Please try again."})}finally{g.loading.hide()}},O=n=>{switch((n||"").toLowerCase()){case"pending":return"orange-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(n,e)=>(m(),S(E,null,[t(Q,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:N}),t(W,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=l=>u.value=l)},{default:a(()=>[t(Y,{style:{width:"700px","max-width":"80vw"}},{default:a(()=>[t(b,null,{default:a(()=>[d("div",Ne,[d("div",Ae,k($(s.report.from_name)),1),t(Q,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:e[0]||(e[0]=l=>u.value=!1)})])]),_:1}),t(b,null,{default:a(()=>[d("div",null,[d("span",null,"Date: "+k(x(s.report.created_at)),1)]),d("div",null,[d("span",null,[y(" Status: "),t(ne,{color:O(s.report.status)},{default:a(()=>[y(k($(s.report.status)),1)]),_:1},8,["color"])])]),s.report.status==="declined"?(m(),S("div",Me,[d("span",null,"Remarks: "+k(s.report.remarks||"No Remarks"),1)])):V("",!0),d("div",Te,[Le,s.report.items&&s.report.items.length?(m(),R(De,{key:0,dense:"",separator:"",class:"box"},{default:a(()=>[t(ee,{class:"bg-grey-1 text-weight-bold"},{default:a(()=>[t(L,null,{default:a(()=>[t(T,null,{default:a(()=>[y(" Raw Materials Code ")]),_:1})]),_:1}),t(L,null,{default:a(()=>[t(T,null,{default:a(()=>[y("Stocks Category")]),_:1})]),_:1}),t(L,{side:""},{default:a(()=>[t(T,null,{default:a(()=>[y(" Quantity ")]),_:1})]),_:1})]),_:1}),(m(!0),S(E,null,_e(s.report.items,(l,r)=>(m(),R(ee,{key:r},{default:a(()=>[t(L,null,{default:a(()=>[t(T,null,{default:a(()=>{var v;return[y(k(((v=l.raw_material)==null?void 0:v.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),t(L,null,{default:a(()=>[t(T,null,{default:a(()=>[y(k(l.category||"No Category"),1)]),_:2},1024)]),_:2},1024),t(L,{side:""},{default:a(()=>[t(T,null,{default:a(()=>[y(k(P(l.quantity||"No Quantity")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(m(),S("div",Fe," No items in this delivery "))])]),_:1}),s.report.status==="pending"?(m(),R(J,{key:0,class:"report-actions q-ma-sm q-gutter-sm",align:"right"},{default:a(()=>[t(Q,{color:"negative",label:"Decline",class:"action-btn",onClick:U}),t(Q,{color:"positive",label:"Confirm",class:"action-btn",onClick:A})]),_:1})):V("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Ye=Z(Be,[["__scopeId","data-v-63ad10d8"]]);const Pe={class:"q-mb-md row items-center justify-between"},Ue={key:0,class:"q-pt-md flex flex-center"},ze={__name:"RawMaterialsDeliveryTable",setup(s){var F,n;const C=ce(),D=I(()=>C.user);console.log("userData in RawMaterialsTable:",D.value);const w=((n=(F=D.value)==null?void 0:F.device)==null?void 0:n.reference_id)||"",h=ue(),i=ie(),c=I(()=>h.deliveryStocks.data.data);I(()=>h.loading);const p=I(()=>{var e;return((e=h.deliveryStocks)==null?void 0:e.pagination)||{current_page:1,last_page:1,per_page:5}}),u=q(null),g=q("");let N=null;const $=e=>e?e.toLowerCase().split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "):"",x=e=>{const l=f=>f?f.charAt(0).toUpperCase()+f.slice(1).toLowerCase():"",r=e.firstname?l(e.firstname):"Null",v=e.middlename?l(e.middlename).charAt(0)+".":"Null",_=e.lastname?l(e.lastname):"Null";return`${r} ${v} ${_}`},P=()=>{N&&clearTimeout(N),N=setTimeout(()=>{A(1)},500)},A=async(e=1)=>{i.loading.show();try{await h.fetchDeliveryStocksBranch(w,e,p.value.per_page,g.value),!c.value.length&&u.value&&(u.value=null),u.value&&!c.value.some(l=>l.id===u.value.id)&&(u.value=null),!u.value&&c.value,length>0&&(u.value=c.value[0]),console.log("deliveryListsss",c.value),console.log("pagination",p.value)}catch(l){console.log("Error fetching delivery stocks in component:",l)}finally{i.loading.hide()}};ve(()=>{A(p.value.current_page)});const U=e=>{A(e)},z=[{name:"created_at",label:"Date",align:"left",field:"created_at",format:e=>H(e),sortable:!0},{name:"process_by",label:"Process By",align:"left",field:e=>x((e==null?void 0:e.employee)||"undefined"),sortable:!0},{name:"approved_by",label:"Approved By",align:"left",field:e=>e.status==="pending"?"N/A":x((e==null?void 0:e.approved_by)||"N/A"),sortable:!0},{name:"from",label:"From",align:"left",field:e=>e.from_designation==="Supplier"?"Supplier":$(e.from_name),sortable:!0},{name:"items",label:"Items",field:"items",align:"center",sortable:!0},{name:"status",label:"Status",align:"left",field:"status"},{name:"view",align:"right",label:"View",field:"view",sortable:!0}],H=e=>re.formatDate(e,"MMMM D, YYYY - hh:mm A"),O=e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase(),B=e=>{switch((e||"").toLowerCase()){case"pending":return"orange-7";case"in progress":return"blue-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(e,l)=>(m(),S(E,null,[d("div",Pe,[t(oe,{outlined:"",dense:"",placeholder:"Search delivery",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:g.value,"onUpdate:modelValue":[l[0]||(l[0]=r=>g.value=r),P]},{append:a(()=>[t(se,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]),t(he,{flat:"",columns:z,rows:c.value||[],"row-key":"id",bordered:"",dense:""},{"body-cell-items":a(r=>[t(K,{props:r},{default:a(()=>[t(ye,{outlined:"",color:"primary text-white",dense:""},{default:a(()=>[y(k(r.row.items.length),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":a(r=>[t(K,{props:r},{default:a(()=>[t(ne,{outlined:"",color:B(r.row.status)},{default:a(()=>[y(k(O(r.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":a(r=>[t(K,{props:r},{default:a(()=>[d("div",null,[t(Ye,{report:r.row,onFetchAgain:l[1]||(l[1]=v=>A(p.value.current_page))},null,8,["report"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),p.value.last_page>1?(m(),S("div",Ue,[t(be,{modelValue:p.value.current_page,"onUpdate:modelValue":[l[2]||(l[2]=r=>p.value.current_page=r),U],max:p.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):V("",!0)],64))}},He={class:"text-h6 text-white"},mt={__name:"RawMaterialsDelivery",setup(s){return(C,D)=>(m(),R(Y,{flat:""},{default:a(()=>[t(b,{style:{"background-color":"#ef4444"}},{default:a(()=>[d("div",He,[t(se,{name:"local_shipping"}),y(" Raw Materials Delivery ")])]),_:1}),t(b,{class:"q-gutter-y-md"},{default:a(()=>[d("div",null,[t(ze)])]),_:1})]),_:1}))}};export{mt as default};
