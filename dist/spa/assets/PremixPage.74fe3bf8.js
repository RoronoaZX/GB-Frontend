import{c as Q,r as w,o as _,a3 as R,J as o,f as e,M as T,w as t,Q as X,I,$ as x,a0 as u,a4 as G,a5 as Z,bf as me,e as j,bd as ee,a2 as ue,z as pe,bG as _e,u as ve,bc as fe,d as ge,P as ne,N as te,t as ye,ae as xe,K as W,L as de,aJ as he,O as be,R as we}from"./index.4d4f3ecb.js";import{Q as ce}from"./QBadge.e03c5b09.js";import{Q as ie,a as Pe}from"./QTable.369eb731.js";import{Q as qe}from"./QPagination.b8d19912.js";import{Q as ke}from"./QBanner.610b46a4.js";import{u as le}from"./baker-report.de32f762.js";import{u as oe}from"./premix.b7cf0096.js";import{q as Qe}from"./date.81fc4cd9.js";import{a as f}from"./QItemLabel.8a37f99f.js";import{Q as U,a as g}from"./QItem.8d77583a.js";import{Q as ae}from"./QList.e416c58d.js";import{Q as Se,a as Ve}from"./QStepper.ef25bdd2.js";import{u as Ce}from"./use-quasar.7fcf3eeb.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Re}from"./QSpace.0c1431bb.js";import{C as Ie}from"./ClosePopup.b07fe58c.js";import{api as $e}from"./axios.80bae863.js";import"./QVirtualScroll.c9bd7b6e.js";import"./use-virtual-scroll.c1f0c884.js";import"./QSelect.680051d8.js";import"./QChip.fb33ffda.js";import"./QMenu.0a85cb0a.js";import"./position-engine.4770ad56.js";import"./selection.0b6f0b1a.js";import"./QSlideTransition.536b1c09.js";import"./use-panel.a710c2c0.js";import"./touch.9135741d.js";import"./use-render-cache.3aae9b27.js";const Ne={class:"row justify-between"},Te={class:"text-h6"},Be=o("div",{class:"text-h6",align:"center"},"Premix",-1),De=o("div",{class:"text-h6",align:"center"},"Ingredients List",-1),Le={class:"text-grey-7 q-mt-xs"},Ue=o("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1),Fe={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(c,{emit:S}){var b,m,z,A,d,v,p;const $=le(),k=Q(()=>$.user);console.log("userData in RawMaterialsTable:",k.value);const y=((m=(b=k.value)==null?void 0:b.data)==null?void 0:m.employee_id)||"",B=((A=(z=k.value)==null?void 0:z.device)==null?void 0:A.reference_id)||"";console.log("employeeId in PremixPage:",y),console.log("branchId in PremixPage:",B);const V=oe();Ce();const C=w(!1),N=w(!1),i=c;console.log("props in TransactionView:",i.report);const P=()=>{C.value=!0},h=a=>{const r=l=>l?l.charAt(0).toUpperCase()+l.slice(1).toLowerCase():"";return`${r(a.firstname||"No Firstname")} ${a.middlename?r(a.middlename).charAt(0)+".":""} ${r(a.lastname||"No Lastname")}`},F=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],q=Q(()=>{var a;return(a=i.report.history)!=null&&a.length?F.filter(r=>i.report.history.some(l=>l.status===r.value)):[]}),Y=a=>{const r=i.report.history.find(l=>l.status===a);return r?a==="received"?`Received by: ${h(r.employee)}`:a==="pending"?`Requested by: ${h(r.employee)}`:`Handled by: ${h(r.employee)}`:"No handler"},J=a=>{const r=Number(a);return isNaN(r)?"":(r%1===0,r.toString())},H=(a,r)=>{if(r==="Pcs")return`${a} pcs`;if(r==="Grams"){if(a>=1e3){let l=a/1e3;return`${l%1===0?l.toString():l.toString().replace(/^0+/,"")} kgs`}return`${a} g`}return`${a} ${r}`},E=((p=(v=(d=i.report)==null?void 0:d.branch_premix)==null?void 0:v.branch_recipe)==null?void 0:p.ingredient_groups)||"Undefined";console.log("ingrdientsData",E);const K=Q(()=>E.map(a=>{const r=parseFloat(a.quantity)*parseFloat(i.report.quantity);return{...a,totalQuantity:r,formattedQuantity:H(r,a.ingredient.unit)}}));console.log("report to proceed",i.report);const s=Q(()=>{var a,r;return((r=(a=i.report.history)==null?void 0:a[i.report.history.length-1])==null?void 0:r.status)||null});console.log("lastStatus",s.value);const M=Q(()=>q.value.findIndex(a=>a.value===s.value)+1),D=a=>{var r;return(r=i.report.history)==null?void 0:r.some(l=>l.status===a)},L=a=>({pending:"warning",declined:"red-6",confirmed:"green",process:"primary",completed:"dark","to deliver":"brown-9","to receive":"amber-10",received:"secondary"})[a]||"grey",n=async()=>{const a={request_premix_id:i.report.id,branch_premix_id:i.report.branch_premix_id,branch_id:i.report.branch_premix.branch_id,employee_id:y,status:"received",notes:"Received Premix",quantity:i.report.quantity,warehouse_id:i.report.warehouse_id,ingredients:K.value.map(r=>({ingredients_id:r.ingredient.id,total_quantity:r.totalQuantity,unit:r.ingredient.unit}))};console.log("payload",a),await V.receivePremix(a),await fetchRequestBranchEmployeePremix(B,y),C.value=!1};return(a,r)=>(_(),R(G,null,[o("div",null,[e(T,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:P})]),e(ue,{modelValue:C.value,"onUpdate:modelValue":r[2]||(r[2]=l=>C.value=l)},{default:t(()=>[e(X,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(I,null,{default:t(()=>[o("div",Ne,[o("div",Te,x(c.report.name),1),e(T,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:r[0]||(r[0]=l=>C.value=!1)})])]),_:1}),u(" "+x(c.report.id)+" ",1),e(I,null,{default:t(()=>[o("div",null,"Baker: "+x(h(c.report.employee)),1),o("div",null," Branch: "+x(c.report.branch_premix.branch_recipe.branch.name),1),o("div",null,[u(" Status: "),e(ce,{color:L(c.report.status),outlined:""},{default:t(()=>[u(x(c.report.status),1)]),_:1},8,["color"])])]),_:1}),e(I,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[Be,e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Premix Name")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(U,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[u(x(c.report.name),1)]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[u(x(J(c.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",null,[De,e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u(" Code")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Quantity")]),_:1})]),_:1})]),_:1}),(_(!0),R(G,null,Z(me(E),(l,O)=>(_(),j(U,{key:O},{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[u(x(l.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[u(x(H(l.quantity*c.report.quantity,l.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(Se,{modelValue:M.value,"onUpdate:modelValue":r[1]||(r[1]=l=>M.value=l),animated:"",class:"q-pa-lg"},{default:t(()=>[(_(!0),R(G,null,Z(q.value,(l,O)=>(_(),j(Ve,{key:O,name:O+1,title:l.label,color:L(l.value),done:D(l.value),icon:D(l.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[o("div",Le,x(Y(l.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),s.value==="to receive"?(_(),j(I,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[Ue,e(T,{color:"amber-10",label:"Yes",icon:"check",onClick:n,loading:N.value},null,8,["loading"])]),_:1})):ee("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};const Ee={class:"q-pa-lg flex flex-center"},Me={key:0,class:"loading-overlay row justify-center items-center"},ze={key:1,class:"q-pa-md q-gutter-md row justify-center"},Ae={__name:"PremixTable",setup(c){var s,M,D,L;const S=le(),$=Q(()=>S.user);console.log("userData in RawMaterialsTable:",$.value);const k=((M=(s=$.value)==null?void 0:s.device)==null?void 0:M.reference_id)||"";console.log("branchId in PremixPage:",k);const y=oe(),B=Q(()=>y.branchEmployeePremix),V=((L=(D=$.value)==null?void 0:D.data)==null?void 0:L.employee_id)||"";console.log("employeeId in PremixPagess:",V);const C=w(""),N=w(!0),i=w(!0),P=w(!1),h=w([]),F=w(1),q=w({page:1,rowsPerPage:10,rowsNumber:10,sortBy:"id",descending:!1});pe(async()=>{V&&await Y(),console.log("premixdatas",B.value)});const Y=async()=>{i.value=!0;try{const{page:n,rowsNumber:b,rowsPerPage:m,sortBy:z,descending:A}=q.value,d=await y.fetchRequestBranchEmployeePremix(k,V,n,b,m,z,A);h.value=d.data,F.value=d.last_page,q.value.rowsPerPage=d.per_page||10,P.value=h.value.length===0}catch(n){console.error("Error fetching premix report:",n)}i.value=!1};_e(()=>{V&&Y()}),ve(C,()=>{N.value=!0,setTimeout(()=>{N.value=!1})});const J=n=>Qe.formatDate(n,"MMMM D, YYYY - hh:mm A"),H=n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),E=n=>{switch(n){case"pending":return"warning";case"declined":return"red-6";case"confirmed":return"green";case"process":return"primary";case"completed":return"dark";case"to deliver":return"brown-9";case"to receive":return"amber-10";case"received":return"secondary";default:return"grey"}},K=[{name:"name",label:"Transactions Name",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:n=>J(n),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(n,b)=>(_(),R("div",null,[e(Pe,{flat:"",columns:K,rows:h.value,"row-key":"id",bordered:"",dense:"",modelValue:q.value,"onUpdate:modelValue":b[0]||(b[0]=m=>q.value=m),pagination:q.value.rowsPerPage,"rows-per-page-options":[10]},{"body-cell-status":t(m=>[e(ie,{props:m},{default:t(()=>[e(ce,{outlined:"",color:E(m.row.status)},{default:t(()=>[u(x(H(m.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(m=>[e(ie,{props:m},{default:t(()=>[o("div",null,[e(Fe,{report:m.row,onUpdateHistory:n.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["rows","modelValue","pagination"]),o("div",Ee,[e(qe,{modelValue:q.value.page,"onUpdate:modelValue":[b[1]||(b[1]=m=>q.value.page=m),b[2]||(b[2]=m=>n.reloadTableData(n.userId))],color:"purple",max:F.value,"max-pages":F.value,"boundary-numbers":""},null,8,["modelValue","max","max-pages"])]),i.value?(_(),R("div",Me,[e(fe,{size:"50px"})])):ee("",!0),P.value?(_(),R("div",ze,[e(ke,{class:"bg-grey-1",dense:""},{default:t(()=>[u(" No data available ")]),_:1})])):ee("",!0)]))}};var je=se(Ae,[["__scopeId","data-v-259883f0"]]);const Ye=ge("request-premix",()=>{const c=w(null),S=w([]);return{requestPremix:c,requestPremixes:S,saveRequestPremix:async k=>{console.log("data request oremix",k),ne.show();try{const y=await $e.post("/api/request-premix",{requests:k});console.log("response",y.data),te.create({type:"positive",message:"Request Premix successfully"})}catch(y){console.error(y),te.create({type:"negative",message:"Request Premix Error"})}finally{ne.hide()}}}});const re=c=>(be("data-v-de78a87a"),c=c(),we(),c),He={align:"right"},Ke=re(()=>o("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),Ge={class:"q-ma-md"},Je={key:0,class:"custom-list z-top"},Oe={class:"q-mb-sm"},We=re(()=>o("div",null,"Premix Name",-1)),Xe={class:"q-mb-lg"},Ze=re(()=>o("div",null,"Category",-1)),et=re(()=>o("div",null,"Quantity",-1)),tt={align:"right"},at={__name:"RequestPremix",setup(c){var D,L,n,b,m,z,A;const S=w(!1),$=()=>{S.value=!0},k=le(),y=Q(()=>k.user);console.log("userData in RawMaterialsTable:",y.value);const B=((L=(D=y.value)==null?void 0:D.device)==null?void 0:L.reference_id)||"";console.log("branchId in PremixPage:",B);const V=((m=(b=(n=y.value)==null?void 0:n.device)==null?void 0:b.reference)==null?void 0:m.warehouse_id)||"";console.log("warehouseId in PremixPage:",V);const C=((A=(z=y.value)==null?void 0:z.data)==null?void 0:A.employee_id)||"";console.log("warehouseId in PremixPage:",V);const N=oe(),i=Q(()=>N.premixes);Q(()=>N.branchEmployeePremix),console.log("premixdatas",i.value),Ye();const P=w([]),h=w(""),F=async()=>{await N.searchPremix(h.value,B)},q=d=>{console.log("data",d),s.branch_premix_id=d.id,s.name=d.name,s.category=d.category,h.value=""},Y=d=>d?d.split(" ").map(v=>v.charAt(0).toUpperCase()+v.slice(1).toLowerCase()).join(" "):"",J=Q(()=>P.value!==0),H=()=>{const d=P.value.push({branch_premix_id:s.branch_premix_id,warehouse_id:s.warehouse_id,employee_id:s.employee_id,name:s.name,category:s.category,quantity:s.quantity,status:s.status});console.log("premix",d),K()},E=d=>{P.value.splice(d,1)},K=()=>{s.branch_premix_id=0,s.name="",s.category="",s.quantity=0},s=ye({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:V,employee_id:C,status:"pending"}),M=async()=>{try{console.log("Data sent for premix request:",P.value),await N.saveRequestPremix(P.value,B,C),te.create({type:"positive",message:"Premix request saved successfully!"}),K(),P.value=[],S.value=!1}catch(d){console.error("Failed to save premix request:",d),te.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(d,v)=>(_(),R(G,null,[o("div",He,[e(T,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:$})]),e(ue,{modelValue:S.value,"onUpdate:modelValue":v[4]||(v[4]=p=>S.value=p),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(X,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(I,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[Ke,e(Re),xe(e(T,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Ie]])]),_:1}),o("div",Ge,[e(W,{modelValue:h.value,"onUpdate:modelValue":[v[0]||(v[0]=p=>h.value=p),F],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[o("div",null,[e(de,{name:"search"})])]),default:t(()=>[h.value?(_(),R("div",Je,[e(X,null,{default:t(()=>[e(ae,{separator:""},{default:t(()=>{var p;return[(p=i.value)!=null&&p.length?(_(!0),R(G,{key:1},Z(i.value,a=>(_(),j(U,{key:a.id,onClick:r=>q(a),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(f,null,{default:t(()=>[u(x(Y(a==null?void 0:a.name)),1)]),_:2},1024)]),_:2},1024),e(g,null,{default:t(()=>[e(f,{side:""},{default:t(()=>[u(x(a==null?void 0:a.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(_(),j(U,{key:0},{default:t(()=>[u(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):ee("",!0)]),_:1},8,["modelValue"])]),e(I,null,{default:t(()=>[o("div",Oe,[We,e(W,{modelValue:s.name,"onUpdate:modelValue":v[1]||(v[1]=p=>s.name=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Xe,[Ze,e(W,{modelValue:s.category,"onUpdate:modelValue":v[2]||(v[2]=p=>s.category=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(I,{class:"q-gutter-sm"},{default:t(()=>[o("div",null,[et,e(W,{modelValue:s.quantity,"onUpdate:modelValue":v[3]||(v[3]=p=>s.quantity=p),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),o("div",tt,[e(T,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:H})])]),_:1}),e(I,null,{default:t(()=>[e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(" Premix Name ")]),_:1})]),_:1}),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(" Quantity ")]),_:1})]),_:1}),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[u(" Action")]),_:1})]),_:1})]),_:1}),(_(!0),R(G,null,Z(P.value,(p,a)=>(_(),j(U,{key:a},{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(x(p.name),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(x(p.quantity),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[e(T,{onClick:r=>E(a),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(he,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(T,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(T,{class:"glossy",color:"teal",label:"Create",onClick:M,disable:!J.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var rt=se(at,[["__scopeId","data-v-de78a87a"]]);const lt={class:"text-h6 text-white"},ot={__name:"PremixPage",setup(c){return(S,$)=>(_(),j(X,{flat:""},{default:t(()=>[e(I,{style:{"background-color":"#ef4444"}},{default:t(()=>[o("div",lt,[e(de,{name:"scale"}),u(" Premix ")])]),_:1}),e(I,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[e(rt)]),o("div",null,[e(je)])]),_:1})]),_:1}))}};var Tt=se(ot,[["__scopeId","data-v-626e0eca"]]);export{Tt as default};
