import{c as R,r as T,o as _,a3 as F,J as a,f as e,M as H,w as t,Q as te,I as U,bg as we,aK as h,$ as b,a0 as u,a4 as O,a5 as ae,e as Y,be as ne,a2 as ge,O as ye,R as xe,u as qe,z as ke,L as ie,K as Z,d as Se,P as ve,N as le,t as Qe,ae as Ve,aJ as Re}from"./index.eb4f300f.js";import{Q as he}from"./QBadge.8124d379.js";import{Q as fe,a as Ie}from"./QTable.fdc4a007.js";import{Q as Ce}from"./QPagination.94aa843e.js";import{u as ue}from"./baker-report.f85b7b2f.js";import{u as de}from"./premix.3f63889c.js";import{a as f}from"./QSelect.3b40ae5d.js";import{a as M,b as g}from"./QMenu.bcc901ec.js";import{Q as oe}from"./QList.ed048353.js";import{Q as Te,a as $e}from"./QStepper.78a771ab.js";import{u as be}from"./use-quasar.101c5f2d.js";import{t as ce}from"./typography-format.2b1c1c09.js";import{b as Pe}from"./badge-color.f568cd69.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Be}from"./QSpace.60a7902c.js";import{C as Le}from"./ClosePopup.82aaa884.js";import{api as Ne}from"./axios.700d89a2.js";import"./QVirtualScroll.161c03a9.js";import"./use-virtual-scroll.7d67df79.js";import"./rtl.276c3f1b.js";import"./selection.0cd99d5a.js";import"./QChip.030ab730.js";import"./position-engine.e09c586f.js";import"./QSlideTransition.97b5ff22.js";import"./use-panel.22b5e51d.js";import"./touch.9135741d.js";import"./use-render-cache.3aae9b27.js";import"./date.683de555.js";const me=l=>(ye("data-v-0502121a"),l=l(),xe(),l),Fe={class:"row justify-between"},Ue={class:"text-h6"},De=me(()=>a("div",{class:"text-h6",align:"center"},"Premix",-1)),Ee=me(()=>a("div",{class:"text-h6",align:"center"},"Ingredients List",-1)),ze={class:"text-grey-7 q-mt-xs"},He=me(()=>a("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1)),Me={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(l,{emit:q}){var X,P,V,m,w,ee,pe;const{capitalizeFirstLetter:p,formatTimestamp:k,formatFullname:y,formatRequestQuantity:I,formatQuantity:S}=ce(),{getHeaderClass:$,getPremixBadgeStatusColor:B}=Pe(),D=ue(),L=R(()=>D.user);console.log("userData in RawMaterialsTable:",L.value);const c=((P=(X=L.value)==null?void 0:X.data)==null?void 0:P.employee_id)||"",v=((m=(V=L.value)==null?void 0:V.device)==null?void 0:m.reference_id)||"";console.log("employeeId in PremixPage:",c),console.log("branchId in PremixPage:",v);const C=de();be();const N=T(!1),j=T(!1),d=l;console.log("props in TransactionViewss:",d.report);const A=()=>{N.value=!0},G=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],s=R(()=>{var i;return(i=d.report.history)!=null&&i.length?G.filter(r=>d.report.history.some(n=>n.status===r.value)):[]}),W=i=>{const r=d.report.history.find(n=>n.status===i);return r?i==="received"?`Received by: ${y(r.employee)}`:i==="pending"?`Requested by: ${y(r.employee)}`:`Handled by: ${y(r.employee)}`:"No handler"},E=((pe=(ee=(w=d.report)==null?void 0:w.branch_premix)==null?void 0:ee.branch_recipe)==null?void 0:pe.ingredient_groups)||"Undefined";console.log("ingrdientsData",E);const J=R(()=>E.map(i=>{const r=parseFloat(i.quantity)*parseFloat(d.report.quantity);return{...i,totalQuantity:r,formattedQuantity:S(r,i.ingredient.unit)}}));console.log("report to proceed",d.report);const z=R(()=>{var i,r;return((r=(i=d.report.history)==null?void 0:i[d.report.history.length-1])==null?void 0:r.status)||null});console.log("lastStatus",z.value);const o=R(()=>s.value.findIndex(i=>i.value===z.value)+1),x=i=>{var r;return(r=d.report.history)==null?void 0:r.some(n=>n.status===i)},Q=async()=>{const i={request_premix_id:d.report.id,branch_premix_id:d.report.branch_premix_id,branch_id:d.report.branch_premix.branch_id,employee_id:c,status:"received",notes:"Received Premix",quantity:d.report.quantity,warehouse_id:d.report.warehouse_id,ingredients:J.value.map(r=>({ingredients_id:r.ingredient.id,total_quantity:r.totalQuantity,unit:r.ingredient.unit}))};console.log("payload",i),await C.receivePremix(i),await fetchRequestBranchEmployeePremix(v,c),N.value=!1};return(i,r)=>(_(),F(O,null,[a("div",null,[e(H,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:A})]),e(ge,{modelValue:N.value,"onUpdate:modelValue":r[2]||(r[2]=n=>N.value=n)},{default:t(()=>[e(te,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(U,{class:we(h($)(l.report.status))},{default:t(()=>[a("div",Fe,[a("div",Ue,b(h(p)(l.report.name)||"-"),1),e(H,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:r[0]||(r[0]=n=>N.value=!1)})])]),_:1},8,["class"]),e(U,null,{default:t(()=>{var n,K,_e;return[a("div",null,"Date: "+b(h(k)(l.report.created_at)||"-"),1),a("div",null,"Baker: "+b(h(y)(l.report.employee)||"-"),1),a("div",null," Branch: "+b(h(p)((_e=(K=(n=l.report)==null?void 0:n.branch_premix)==null?void 0:K.branch_recipe)==null?void 0:_e.branch.name)||"-"),1),a("div",null,[u(" Status: "),e(he,{color:h(B)(l.report.status),outlined:""},{default:t(()=>[u(b(h(p)(l.report.status)||"-"),1)]),_:1},8,["color"])])]}),_:1}),e(U,{class:"q-gutter-y-md"},{default:t(()=>[a("div",null,[De,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(M,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Premix Name")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(M,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[u(b(h(p)(l.report.name)||"-"),1)]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[u(b(h(I)(l.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",null,[Ee,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(M,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u(" Code")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Quantity")]),_:1})]),_:1})]),_:1}),(_(!0),F(O,null,ae(h(E),(n,K)=>(_(),Y(M,{key:K},{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[u(b(n.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[u(b(h(S)(n.quantity*l.report.quantity,n.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(Te,{modelValue:o.value,"onUpdate:modelValue":r[1]||(r[1]=n=>o.value=n),animated:"",class:"q-pa-lg"},{default:t(()=>[(_(!0),F(O,null,ae(s.value,(n,K)=>(_(),Y($e,{key:K,name:K+1,title:n.label,color:h(B)(n.value),done:x(n.value),icon:x(n.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[a("div",ze,b(W(n.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),z.value==="to receive"?(_(),Y(U,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[He,e(H,{color:"amber-10",label:"Yes",icon:"check",onClick:Q,loading:j.value},null,8,["loading"])]),_:1})):ne("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var je=re(Me,[["__scopeId","data-v-0502121a"]]);const Ae={key:0,class:"q-pt-md flex flex-center"},Je={__name:"PremixTable",props:{searchText:{type:String,default:""}},setup(l){var W,E,J,z;const{capitalizeFirstLetter:q,formatTimestamp:p}=ce(),{getPremixBadgeStatusColor:k}=Pe(),y=l;qe(()=>y.searchText,o=>{N.value=o,d()});const I=ue(),S=R(()=>I.user);console.log("userData in RawMaterialsTable:",S.value);const $=((E=(W=S.value)==null?void 0:W.device)==null?void 0:E.reference_id)||"";console.log("branchId in PremixPage:",$);const B=de();R(()=>B.branchEmployeePremix);const D=((z=(J=S.value)==null?void 0:J.data)==null?void 0:z.employee_id)||"";console.log("employeeId in PremixPagess:",D);const L=be(),c=R(()=>{var o,x;return((x=(o=B.branchEmployeePremix)==null?void 0:o.data)==null?void 0:x.data)||[]}),v=R(()=>{var o;return((o=B.branchEmployeePremix)==null?void 0:o.pagination)||{current_page:1,last_page:1,per_page:5}}),C=T(null),N=T("");let j=null;const d=()=>{j&&clearTimeout(j),j=setTimeout(()=>{A(1)},500)},A=async(o=1)=>{L.loading.show();try{await B.fetchRequestBranchEmployeePremix($,D,o,v.value.per_page||5,N.value),!c.value.length&&C.value&&(C.value=null),C.value.length&&!c.value.some(x=>x.id===C.value.id)&&(C.value=null),!C.value&&c.value,length>0&&(C.value=c.value[0]),console.log("premixList",c.value),console.log("pagination",v.value)}catch(x){console.error("Error fetching premix report:",x)}finally{L.loading.hide()}};ke(async()=>{A(v.value.current_page)});const G=o=>{A(o)},s=[{name:"name",label:"Transactions Name",align:"left",field:o=>o.name?q(o.name):"N/A",format:o=>`${o}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:o=>p(o),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(o,x)=>(_(),F(O,null,[e(Ie,{flat:"",columns:s,rows:c.value||[],"rows-per-page-options":[5],"row-key":"id",bordered:"",dense:""},{"body-cell-status":t(Q=>[e(fe,{props:Q},{default:t(()=>[e(he,{outlined:"",color:h(k)(Q.row.status)},{default:t(()=>[u(b(h(q)(Q.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(Q=>[e(fe,{props:Q},{default:t(()=>[a("div",null,[e(je,{report:Q.row,onUpdateHistory:o.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),v.value.last_page>1?(_(),F("div",Ae,[e(Ce,{modelValue:v.value.current_page,"onUpdate:modelValue":[x[0]||(x[0]=Q=>v.value.current_page=Q),G],max:v.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):ne("",!0)],64))}};var Ke=re(Je,[["__scopeId","data-v-2577d061"]]);const Oe={class:"q-mb-md row items-center justify-between"},Ye={__name:"SearchPremix",emits:["search"],setup(l,{emit:q}){const p=T(""),k=q,y=I=>k("search",I);return(I,S)=>(_(),F("div",Oe,[e(Z,{outlined:"",dense:"",placeholder:"Search Premix Name",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:p.value,"onUpdate:modelValue":[S[0]||(S[0]=$=>p.value=$),y]},{append:t(()=>[e(ie,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]))}},Ge=Se("request-premix",()=>{const l=T(null),q=T([]);return{requestPremix:l,requestPremixes:q,saveRequestPremix:async k=>{console.log("data request oremix",k),ve.show();try{const y=await Ne.post("/api/request-premix",{requests:k});console.log("response",y.data),le.create({type:"positive",message:"Request Premix successfully"})}catch(y){console.error(y),le.create({type:"negative",message:"Request Premix Error"})}finally{ve.hide()}}}});const se=l=>(ye("data-v-96dc7c26"),l=l(),xe(),l),We={align:"right"},Xe=se(()=>a("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),Ze={class:"q-ma-md"},et={key:0,class:"custom-list z-top"},tt={class:"q-mb-sm"},at=se(()=>a("div",null,"Premix Name",-1)),lt={class:"q-mb-lg"},ot=se(()=>a("div",null,"Category",-1)),rt=se(()=>a("div",null,"Quantity",-1)),st={align:"right"},nt={__name:"RequestPremix",setup(l){var E,J,z,o,x,Q,X;const{capitalizeFirstLetter:q}=ce(),p=T(!1),k=()=>{p.value=!0},y=ue(),I=R(()=>y.user);console.log("userData in RawMaterialsTable:",I.value);const S=((J=(E=I.value)==null?void 0:E.device)==null?void 0:J.reference_id)||"";console.log("branchId in PremixPage:",S);const $=((x=(o=(z=I.value)==null?void 0:z.device)==null?void 0:o.reference)==null?void 0:x.warehouse_id)||"";console.log("warehouseId in PremixPage:",$);const B=((X=(Q=I.value)==null?void 0:Q.data)==null?void 0:X.employee_id)||"";console.log("warehouseId in PremixPage:",$);const D=de(),L=R(()=>D.premixes);R(()=>D.branchEmployeePremix),console.log("premixdatas",L.value),Ge();const c=T([]),v=T(""),C=async()=>{await D.searchPremix(v.value,S)},N=P=>{console.log("data",P),s.branch_premix_id=P.id,s.name=q(P.name),s.category=P.category,v.value=""},j=R(()=>c.value!==0),d=()=>{const P=c.value.push({branch_premix_id:s.branch_premix_id,warehouse_id:s.warehouse_id,employee_id:s.employee_id,name:s.name,category:s.category,quantity:s.quantity,status:s.status});console.log("premix",P),G()},A=P=>{c.value.splice(P,1)},G=()=>{s.branch_premix_id=0,s.name="",s.category="",s.quantity=0},s=Qe({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:$,employee_id:B,status:"pending"}),W=async()=>{try{console.log("Data sent for premix request:",c.value),await D.saveRequestPremix(c.value,S,B),le.create({type:"positive",message:"Premix request saved successfully!"}),G(),c.value=[],p.value=!1}catch(P){console.error("Failed to save premix request:",P),le.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(P,V)=>(_(),F(O,null,[a("div",We,[e(H,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:k})]),e(ge,{modelValue:p.value,"onUpdate:modelValue":V[4]||(V[4]=m=>p.value=m),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(te,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(U,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[Xe,e(Be),Ve(e(H,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Le]])]),_:1}),a("div",Ze,[e(Z,{modelValue:v.value,"onUpdate:modelValue":[V[0]||(V[0]=m=>v.value=m),C],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[a("div",null,[e(ie,{name:"search"})])]),default:t(()=>[v.value?(_(),F("div",et,[e(te,null,{default:t(()=>[e(oe,{separator:""},{default:t(()=>{var m;return[(m=L.value)!=null&&m.length?(_(!0),F(O,{key:1},ae(L.value,w=>(_(),Y(M,{key:w.id,onClick:ee=>N(w),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(f,null,{default:t(()=>[u(b(h(q)(w==null?void 0:w.name)),1)]),_:2},1024)]),_:2},1024),e(g,null,{default:t(()=>[e(f,{side:""},{default:t(()=>[u(b(w==null?void 0:w.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(_(),Y(M,{key:0},{default:t(()=>[u(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):ne("",!0)]),_:1},8,["modelValue"])]),e(U,null,{default:t(()=>[a("div",tt,[at,e(Z,{modelValue:s.name,"onUpdate:modelValue":V[1]||(V[1]=m=>s.name=m),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),a("div",lt,[ot,e(Z,{modelValue:s.category,"onUpdate:modelValue":V[2]||(V[2]=m=>s.category=m),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(U,{class:"q-gutter-sm"},{default:t(()=>[a("div",null,[rt,e(Z,{modelValue:s.quantity,"onUpdate:modelValue":V[3]||(V[3]=m=>s.quantity=m),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),a("div",st,[e(H,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:d})])]),_:1}),e(U,null,{default:t(()=>[e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(M,null,{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(" Premix Name ")]),_:1})]),_:1}),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(" Quantity ")]),_:1})]),_:1}),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[u(" Action")]),_:1})]),_:1})]),_:1}),(_(!0),F(O,null,ae(c.value,(m,w)=>(_(),Y(M,{key:w},{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(b(m.name),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(b(m.quantity),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[e(H,{onClick:ee=>A(w),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(Re,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(H,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(H,{class:"glossy",color:"teal",label:"Create",onClick:W,disable:!j.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var it=re(nt,[["__scopeId","data-v-96dc7c26"]]);const ut={class:"text-h6 text-white"},dt={class:"row justify-between"},ct={__name:"PremixPage",setup(l){const q=T(""),p=k=>{q.value=k};return(k,y)=>(_(),Y(te,{flat:""},{default:t(()=>[e(U,{style:{"background-color":"#ef4444"}},{default:t(()=>[a("div",ut,[e(ie,{name:"scale"}),u(" Premix ")])]),_:1}),e(U,{class:"q-gutter-y-md"},{default:t(()=>[a("div",dt,[a("div",null,[e(Ye,{onSearch:p})]),a("div",null,[e(it)])]),a("div",null,[e(Ke,{searchText:q.value},null,8,["searchText"])])]),_:1})]),_:1}))}};var Et=re(ct,[["__scopeId","data-v-66c1b51a"]]);export{Et as default};
