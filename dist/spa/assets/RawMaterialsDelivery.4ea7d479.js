import{r as S,o as u,e as I,w as t,f as e,Q as z,I as k,a3 as Q,bc as N,a1 as le,aJ as G,ae as oe,M as R,be as $,a2 as X,O as Z,R as ee,J as n,K as se,c as T,$ as D,a0 as _,a4 as W,a5 as ve,N as B,z as ye,L as re}from"./index.f0b587f6.js";import{Q as he}from"./QChip.a801c9cd.js";import{Q as Y,a as be}from"./QTable.8698278d.js";import{Q as ne}from"./QBadge.b638a16f.js";import{Q as De}from"./QPagination.05ee4b47.js";import{u as ie}from"./use-quasar.2d1b7dab.js";import{u as ce}from"./baker-report.9eee8ba5.js";import{u as ue}from"./stock-delivery.6d0b21dc.js";import{a as L}from"./QSelect.7c3647d7.js";import{a as ae,b as A}from"./QMenu.4dd3c36f.js";import{Q as ke}from"./QList.e25924cf.js";import{C as de}from"./ClosePopup.15928e06.js";import{u as me}from"./use-dialog-plugin-component.292c008e.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import{t as pe}from"./typography-format.7a1c9fe2.js";import"./QVirtualScroll.5c475be3.js";import"./use-virtual-scroll.1f8f400d.js";import"./rtl.276c3f1b.js";import"./selection.573f2854.js";import"./axios.7628f569.js";import"./position-engine.d0b9025f.js";import"./date.78fab153.js";const fe=l=>(Z("data-v-318678d0"),l=l(),ee(),l),we=fe(()=>n("div",{class:"text-h5 q-mb-xs"},"Confirm Report",-1)),Ce={key:0},xe=fe(()=>n("div",{class:"text-positive text-subtitle1"}," Please confirm again to finalize this report. ",-1)),qe={__name:"ConfirmDialog",setup(l){const{dialogRef:w,onDialogHide:C,onDialogOK:x,onDialogCancel:P}=me(),c=S(!1),v=()=>{c.value?x():c.value=!0};return(f,y)=>(u(),I(X,{ref_key:"dialogRef",ref:w,onHide:$(C)},{default:t(()=>[e(z,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(k,{class:"q-pt-none q-pb-sm"},{default:t(()=>[we,c.value?N("",!0):(u(),Q("p",Ce," Are you sure you wanat to confirm this report? "))]),_:1}),c.value?(u(),I(k,{key:0},{default:t(()=>[xe]),_:1})):N("",!0),e(le,{class:"q-mb-sm"}),e(k,null,{default:t(()=>[e(G,{align:"right",class:"q-pt-none"},{default:t(()=>[oe(e(R,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),e(R,{dense:"",label:c.value?"Confirm":"Yes! Confirm",color:"positive",class:"q-btn-rounded q-px-lg",onClick:v},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Se=te(qe,[["__scopeId","data-v-318678d0"]]);const Qe=l=>(Z("data-v-5a3e7851"),l=l(),ee(),l),Re=Qe(()=>n("div",{class:"text-h5 q-mb-xs"},"Decline Report",-1)),Ie={key:0},Ve={__name:"DeclinedDialog",setup(l){const{dialogRef:w,onDialogHide:C,onDialogOK:x,onDialogCancel:P}=me(),c=S(!1),v=S(""),f=S(null),y=S(!1),m=async()=>{c.value?(y.value=!0,f.value.validate()&&x({remarks:v.value})):c.value=!0};return(g,i)=>(u(),I(X,{ref_key:"dialogRef",ref:w,onHide:$(C),persistent:""},{default:t(()=>[e(z,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(k,{class:"q-pt-none q-pb-sm"},{default:t(()=>[Re,c.value?N("",!0):(u(),Q("p",Ie,"Are you sure you want to decline this report?"))]),_:1}),c.value?(u(),I(k,{key:0},{default:t(()=>[e(se,{modelValue:v.value,"onUpdate:modelValue":i[0]||(i[0]=d=>v.value=d),type:" textarea",label:"Reason  for declining",filled:"",autogrow:"",dense:"",ref_key:"remarksInput",ref:f,rules:[d=>!!d||"Remarks are required"]},null,8,["modelValue","rules"])]),_:1})):N("",!0),e(le,{class:"q-mb-md"}),e(k,null,{default:t(()=>[e(G,{align:"right",class:"q-pt-none"},{default:t(()=>[oe(e(R,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),e(R,{dense:"",label:c.value?"Submit Decline":"Yes! Decline",color:"negative",class:"q-btn-rounded q-px-lg",onClick:m},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var $e=te(Ve,[["__scopeId","data-v-5a3e7851"]]);const Te=l=>(Z("data-v-396087c4"),l=l(),ee(),l),Ne={class:"row justify-between"},Fe={class:"text-h6"},Be={key:0},Le={class:"q-mt-md"},Ae=Te(()=>n("span",{class:"text-grey-7 text-caption"},"Items: ",-1)),Pe={key:1,class:"text-caption text-grey-6 q-mt-md"},Me={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["fetchAgain"],setup(l,{emit:w}){var H,o;const{capitalizeFirstLetter:C,formatTimestamp:x,formatFullname:P}=pe(),c=ce(),v=T(()=>c.user);console.log("userData in RawMaterialsTable:",v.value);const f=((o=(H=v.value)==null?void 0:H.data)==null?void 0:o.employee_id)||"";console.log("employeeIdsssssssssssssss:",f);const y=ue();T(()=>y.loading),T(()=>y.declinedStocks);const m=l;console.log("props in Transaction view:",m.report);const g=w,i=S(!1),d=ie(),M=()=>{i.value=!0},U=s=>s==null?"No Quantity":parseFloat(s),F=()=>{d.dialog({component:Se}).onOk(()=>{console.log("Data from child:",m.report),K(m.report)}).onCancel(()=>{console.log("Cancelled")})},j=()=>{d.dialog({component:$e}).onOk(s=>{console.log("Decliene remark from child:",s),E(m.report.id,s)}).onCancel(()=>{console.log("Cancelled")})},K=async s=>{var r,p,V,q;console.log("Confirming report",s);try{d.loading.show();const h=s.items.map(J=>{const ge=parseFloat(J.quantity)||0,_e=parseFloat(J.gram)||0;return{...J,total_grams:ge*_e}});console.log("Per Item Totals:",h);const b={...s,employee_id:f||"0",status:"confirmed",items:h};console.log("Confirm Datasss:",b);const a=await y.confirmDeliveryStocks(b);console.log("responsesssssss",a),(a==null?void 0:a.data)||((r=a==null?void 0:a.data)==null?void 0:r.message)==="Delivery confirmed."?(B.create({type:"positive",message:a.data.message||"Delivery Confirmed Successfully"}),(a==null?void 0:a.status)===200&&(i.value=!1,g("fetchAgain"))):B.create({type:"negative",message:((p=a==null?void 0:a.data)==null?void 0:p.message)||"Failed to Confirm Delivery"}),console.log("responsesss",a)}catch(h){console.log(h),B.create({type:"negative",message:((q=(V=h==null?void 0:h.response)==null?void 0:V.data)==null?void 0:q.message)||"Failed to Confirm Delivery"})}finally{d.loading.hide()}},E=async(s,r)=>{var p,V,q,h;try{d.loading.show(),console.log("declining report",s,"with remarks:",r);const b={id:s,employee_id:f||"0",status:"declined",remarks:r.remarks};console.log("declineData",b);const a=await y.declineDeliveryStocks(b);(a==null?void 0:a.data)||((p=a==null?void 0:a.data)==null?void 0:p.message)==="Delivery declined successfully."?(B.create({type:"positive",message:a.data.message||"Delivery Declined Successfully"}),(a==null?void 0:a.status)===200&&(i.value=!1,g("fetchAgain"))):B.create({type:"negative",message:((V=a==null?void 0:a.data)==null?void 0:V.message)||"Failed to decline delivery"}),console.log("responsesssss",a)}catch(b){console.log(b),B.create({type:"negative",message:((h=(q=b==null?void 0:b.response)==null?void 0:q.data)==null?void 0:h.message)||"Failed to decline delivery. Please try again."})}finally{d.loading.hide()}},O=s=>{switch((s||"").toLowerCase()){case"pending":return"orange-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(s,r)=>(u(),Q(W,null,[e(R,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:M}),e(X,{modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=p=>i.value=p)},{default:t(()=>[e(z,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(k,null,{default:t(()=>[n("div",Ne,[n("div",Fe,D($(C)(l.report.from_name)||"-"),1),e(R,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:r[0]||(r[0]=p=>i.value=!1)})])]),_:1}),e(k,null,{default:t(()=>[n("div",null,[n("span",null,"Date: "+D($(x)(l.report.created_at)||"-"),1)]),n("div",null,[n("span",null,"Created By: "+D($(P)(l.report.employee)||"-"),1)]),n("div",null,[n("span",null,[_(" Status: "),e(ne,{color:O(l.report.status)},{default:t(()=>[_(D($(C)(l.report.status)||"-"),1)]),_:1},8,["color"])])]),l.report.status==="declined"?(u(),Q("div",Be,[n("span",null,"Remarks: "+D(l.report.remarks||"No Remarks"),1)])):N("",!0),n("div",Le,[Ae,l.report.items&&l.report.items.length?(u(),I(ke,{key:0,dense:"",separator:"",class:"box"},{default:t(()=>[e(ae,{class:"bg-grey-1 text-weight-bold"},{default:t(()=>[e(A,null,{default:t(()=>[e(L,null,{default:t(()=>[_(" Raw Materials Code ")]),_:1})]),_:1}),e(A,null,{default:t(()=>[e(L,null,{default:t(()=>[_("Stocks Category")]),_:1})]),_:1}),e(A,{side:""},{default:t(()=>[e(L,null,{default:t(()=>[_(" Quantity ")]),_:1})]),_:1})]),_:1}),(u(!0),Q(W,null,ve(l.report.items,(p,V)=>(u(),I(ae,{key:V},{default:t(()=>[e(A,null,{default:t(()=>[e(L,null,{default:t(()=>{var q;return[_(D(((q=p.raw_material)==null?void 0:q.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),e(A,null,{default:t(()=>[e(L,null,{default:t(()=>[_(D(p.category||"No Category"),1)]),_:2},1024)]),_:2},1024),e(A,{side:""},{default:t(()=>[e(L,null,{default:t(()=>[_(D(U(p.quantity||"No Quantity")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(u(),Q("div",Pe," No items in this delivery "))])]),_:1}),l.report.status==="pending"?(u(),I(G,{key:0,class:"report-actions q-ma-sm q-gutter-sm",align:"right"},{default:t(()=>[e(R,{color:"negative",label:"Decline",class:"action-btn",onClick:j}),e(R,{color:"positive",label:"Confirm",class:"action-btn",onClick:F})]),_:1})):N("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var He=te(Me,[["__scopeId","data-v-396087c4"]]);const Oe={class:"q-mb-md row items-center justify-between"},ze={key:0,class:"q-pt-md flex flex-center"},Ue={__name:"RawMaterialsDeliveryTable",setup(l){var O,H;const{capitalizeFirstLetter:w,formatTimestamp:C,formatFullname:x}=pe(),P=ce(),c=T(()=>P.user);console.log("userData in RawMaterialsTable:",c.value);const v=((H=(O=c.value)==null?void 0:O.device)==null?void 0:H.reference_id)||"",f=ue(),y=ie(),m=T(()=>f.deliveryStocks.data.data);T(()=>f.loading);const g=T(()=>{var o;return((o=f.deliveryStocks)==null?void 0:o.pagination)||{current_page:1,last_page:1,per_page:5}}),i=S(null),d=S("");let M=null;const U=()=>{M&&clearTimeout(M),M=setTimeout(()=>{F(1)},500)},F=async(o=1)=>{y.loading.show();try{await f.fetchDeliveryStocksBranch(v,o,g.value.per_page,d.value),!m.value.length&&i.value&&(i.value=null),i.value&&!m.value.some(s=>s.id===i.value.id)&&(i.value=null),!i.value&&m.value,length>0&&(i.value=m.value[0]),console.log("deliveryListsss",m.value),console.log("pagination",g.value)}catch(s){console.log("Error fetching delivery stocks in component:",s)}finally{y.loading.hide()}};ye(()=>{F(g.value.current_page)});const j=o=>{F(o)},K=[{name:"created_at",label:"Date",align:"left",field:"created_at",format:o=>C(o),sortable:!0},{name:"process_by",label:"Process By",align:"left",field:o=>x((o==null?void 0:o.employee)||"undefined"),sortable:!0},{name:"approved_by",label:"Approved By",align:"left",field:o=>o.status==="pending"?"N/A":x((o==null?void 0:o.approved_by)||"N/A"),sortable:!0},{name:"from",label:"From",align:"left",field:o=>o.from_designation==="Supplier"?"Supplier":w(o.from_name),sortable:!0},{name:"items",label:"Items",field:"items",align:"center",sortable:!0},{name:"status",label:"Status",align:"left",field:"status"},{name:"view",align:"right",label:"View",field:"view",sortable:!0}],E=o=>{switch((o||"").toLowerCase()){case"pending":return"orange-7";case"in progress":return"blue-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(o,s)=>(u(),Q(W,null,[n("div",Oe,[e(se,{outlined:"",dense:"",placeholder:"Search delivery",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:d.value,"onUpdate:modelValue":[s[0]||(s[0]=r=>d.value=r),U]},{append:t(()=>[e(re,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]),e(be,{flat:"",columns:K,rows:m.value||[],"row-key":"id",bordered:"",dense:""},{"body-cell-items":t(r=>[e(Y,{props:r},{default:t(()=>[e(he,{outlined:"",color:"primary text-white",dense:""},{default:t(()=>[_(D(r.row.items.length),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":t(r=>[e(Y,{props:r},{default:t(()=>[e(ne,{outlined:"",color:E(r.row.status)},{default:t(()=>[_(D($(w)(r.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(r=>[e(Y,{props:r},{default:t(()=>[n("div",null,[e(He,{report:r.row,onFetchAgain:s[1]||(s[1]=p=>F(g.value.current_page))},null,8,["report"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),g.value.last_page>1?(u(),Q("div",ze,[e(De,{modelValue:g.value.current_page,"onUpdate:modelValue":[s[2]||(s[2]=r=>g.value.current_page=r),j],max:g.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):N("",!0)],64))}},je={class:"text-h6 text-white"},ft={__name:"RawMaterialsDelivery",setup(l){return(w,C)=>(u(),I(z,{flat:""},{default:t(()=>[e(k,{style:{"background-color":"#ef4444"}},{default:t(()=>[n("div",je,[e(re,{name:"local_shipping"}),_(" Raw Materials Delivery ")])]),_:1}),e(k,{class:"q-gutter-y-md"},{default:t(()=>[n("div",null,[e(Ue)])]),_:1})]),_:1}))}};export{ft as default};
