import{bd as re,c as T,r as _,t as H,o as k,a2 as K,f as e,M,w as l,Q as ae,I,ad as X,a0 as $,J as r,K as U,$ as b,a3 as j,a4 as ie,e as F,_ as A,ba as ue,aH as de,aI as ce,a1 as me,O as pe,R as fe,u as _e,z as ve,L as Y,aJ as ye}from"./index.aabbdd34.js";import{Q as he}from"./QSpace.6b96f861.js";import{b as W}from"./use-virtual-scroll.4e64cf7c.js";import{Q as ge,a as B,b as w}from"./QList.d5682dd8.js";import{Q as Z}from"./QSelect.4017a3f4.js";import{C as ee}from"./ClosePopup.b5cb243d.js";import{u as te}from"./warehouse-rawMaterials.46df5ecb.js";import{_ as we}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as be}from"./QChip.4ccf96a9.js";import{Q as ke,a as xe}from"./QTable.1faf5ad0.js";import"./QMenu.833636dc.js";import"./selection.e32f3e53.js";import"./axios.566f1742.js";import"./raw-material.a5648950.js";import"./QVirtualScroll.49ef76d1.js";const S=x=>(pe("data-v-7b488589"),x=x(),fe(),x),qe=S(()=>r("div",{class:"text-h6"},"Add Supply",-1)),Qe=S(()=>r("div",{class:"q-my-sm"},"Supplier's Company Name",-1)),Me=S(()=>r("div",{class:"q-my-sm"},"Supplier's Name",-1)),Ie={class:"q-mt-md q-gutter-y-sm"},Se={class:"q-my-md"},Re=S(()=>r("div",{class:"q-my-sm"},"Raw Materials Name",-1)),Ce={class:"row q-gutter-x-sm q-gutter-y-lg"},Ve=S(()=>r("div",{class:"q-my-sm",align:"center"},"Amount",-1)),Ne=S(()=>r("div",{class:"q-my-sm",align:"center"},"Unit",-1)),De=["onKeyup"],We={class:"q-mt-sm"},$e={__name:"WarehouseIngredientsCreateSupply",setup(x){var z,E,G,J;re();const p=te(),R=T(()=>p.user);console.log("userData",R.value);const f=((E=(z=R.value)==null?void 0:z.employee)==null?void 0:E.warehouse_id)||"";console.log("warehouseId",f);const y=((J=(G=R.value)==null?void 0:G.employee)==null?void 0:J.employee_id)||"";console.log("employeeId",y);const h=_(!1),q=T(()=>p.warehouseRawMaterials),C=()=>{h.value=!0},D=_(!1),v=_([]),g=_([]),u=H({name:"",quantity:"",unit:""}),L=[{label:"Sack (25 kg each)",value:"sack"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],Q=_(g.value);(async()=>{try{const n=f;console.log("warehouse_id",n);const a=await p.fetchWarehouseRawMaterials(n);D.value=!1,g.value=p.warehouseRawMaterials.map(t=>({label:t.raw_materials.name,value:t.raw_materials.id,suffix:t.raw_materials.unit})),console.log("rawMaterialsOptions",g.value)}catch(n){console.error("Error fetching warehouse raw materials:",n)}})();const s=()=>{u.name="",u.quantity="",u.unit=""},o=(n,a)=>{a(()=>{if(n==="")Q.value=g.value;else{const t=n.toLowerCase();Q.value=g.value.filter(N=>N.label.toLowerCase().includes(t)>-1)}})},i=()=>{console.log("clickckck");const n=v.value;function a(P,oe){return P.find(ne=>ne.raw_material_id==oe)}const t=u.name.value;a(n,t)||(v.value=[...n,{raw_material_id:u.name.value,label:u.name.label,quantity:u.quantity,unit:u.unit}],s())},d=n=>{v.value.splice(n,1)},m=n=>n?n.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"",c=H({companyName:"",supplierName:""}),V=()=>{c.companyName="",c.supplierName="",v.value=[]},le=n=>n.map(a=>{let t=a.quantity;return a.unit.value==="sack"?t=a.quantity*25e3:a.unit.value==="kilo"?t=a.quantity*1e3:a.unit.value==="gram"&&(t=a.quantity),{...a,convertedQuantity:t,unit:{...a.unit,value:"gram"}}}),se=async()=>{const n=le(v.value),a={employee_id:y,warehouse_id:f,supplier_company_name:c.companyName,supplier_name:c.supplierName,raw_materials:n.map(t=>({raw_material_id:t.raw_material_id,quantity:t.convertedQuantity,unit:t.unit.value}))};await p.warehouseAddSupply(a),q.value=await p.fetchWarehouseRawMaterials(f),s(),V(),h.value=!1};return(n,a)=>(k(),K(j,null,[e(M,{class:"q-pa-sm",color:"red",dense:"",elevated:"",icon:"add_circle",label:"Add Supply",onClick:C}),e(me,{modelValue:h.value,"onUpdate:modelValue":a[5]||(a[5]=t=>h.value=t)},{default:l(()=>[e(ae,{class:"my-card",style:{width:"900px"}},{default:l(()=>[e(I,{class:"row items-center"},{default:l(()=>[qe,e(he),X(e(M,{icon:"close",flat:"",dense:"",round:""},null,512),[[ee]])]),_:1}),e($),e(I,{class:"q-my-md q-mx-sm q-gutter-y-sm"},{default:l(()=>[r("div",null,[Qe,e(U,{modelValue:c.companyName,"onUpdate:modelValue":a[0]||(a[0]=t=>c.companyName=t),outlined:"",dense:""},null,8,["modelValue"])]),r("div",null,[Me,e(U,{modelValue:c.supplierName,"onUpdate:modelValue":a[1]||(a[1]=t=>c.supplierName=t),outlined:"",dense:""},null,8,["modelValue"])])]),_:1}),e($),e(I,null,{default:l(()=>[r("div",Ie,[r("div",null,[e(ge,{dense:"",separator:"",class:"box"},{default:l(()=>[e(B,null,{default:l(()=>[e(w,null,{default:l(()=>[e(W,{class:"text-overline"},{default:l(()=>[b("Raw Materials Name")]),_:1})]),_:1}),e(w,null,{default:l(()=>[e(W,{class:"text-overline"},{default:l(()=>[b("Quantity")]),_:1})]),_:1}),e(w,{side:""})]),_:1}),(k(!0),K(j,null,ie(v.value,(t,N)=>(k(),F(B,{key:N},{default:l(()=>[e(w,null,{default:l(()=>[e(W,{class:"text-caption"},{default:l(()=>[b(A(m(t.label)),1)]),_:2},1024)]),_:2},1024),e(w,null,{default:l(()=>[e(W,{class:"text-caption justify-between"},{default:l(()=>[b(A(t.quantity)+" "+A(t.unit.value),1)]),_:2},1024)]),_:2},1024),e(w,{side:""},{default:l(()=>[e(M,{onClick:P=>d(N),color:"grey-10",icon:"backspace",dense:"",flat:"",round:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1}),e(I,null,{default:l(()=>[r("div",Se,[Re,e(Z,{modelValue:u.name,"onUpdate:modelValue":a[2]||(a[2]=t=>u.name=t),debounce:"3000",outlined:"","chips-color":"primary",options:Q.value,dense:"",label:"Raw Materials",behavior:"menu","use-input":"",suffix:u.suffix,"hide-dropdown-icon":"",onFilter:o},{"no-option":l(()=>[e(B,null,{default:l(()=>[e(w,{class:"text-grey"},{default:l(()=>[b(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","suffix"])]),r("div",Ce,[r("div",null,[Ve,e(U,{modelValue:u.quantity,"onUpdate:modelValue":a[3]||(a[3]=t=>u.quantity=t),type:"number",outlined:"",dense:"",style:{width:"300px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])]),r("div",null,[Ne,e(Z,{modelValue:u.unit,"onUpdate:modelValue":a[4]||(a[4]=t=>u.unit=t),options:L,outlined:"",behavior:"menu",dense:"",style:{width:"300px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])])]),r("form",{onKeyup:ue(de(i,["prevent"]),["enter"])},[r("div",We,[e(M,{size:"sm",outline:"",dense:"",icon:"add",color:"purple",onClick:i})])],40,De)]),_:1}),e($),e(ce,{class:"row q-ma-md",align:"right"},{default:l(()=>[X(e(M,{class:"glossy",color:"grey-9",label:"Cancel"},null,512),[[ee]]),e(M,{class:"glossy",color:"teal",label:"Create",onClick:se})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var Ue=we($e,[["__scopeId","data-v-7b488589"]]);const Ae={__name:"WarehouseIngredientsTable",setup(x){var Q,O;const p=te(),f=((O=(Q=T(()=>p.user).value)==null?void 0:Q.employee)==null?void 0:O.warehouse_id)||"",y=T(()=>p.warehouseRawMaterials),h=_(!0);console.log("warehouse id",f);const q=_(""),C=_(!1),D=_(!1);_e(q,()=>{C.value=!0,setTimeout(()=>{C.value=!1})}),ve(async()=>{console.log("props.warehouseId in onMounted:",f),f&&await v(f)});const v=async s=>{console.log("Fetching raw materials for warehouse ID:",s);try{h.value=!0;const o=await p.fetchWarehouseRawMaterials(s);y.value=o,y.value.length||(D.value=!0),console.log("Warehouse Raw Materialsss",y.value)}catch(o){console.log("Error fetching warehouse product:",o),D.value=!0}finally{h.value=!1}},g=s=>{var m,c;const o=((m=s==null?void 0:s.total_quantity)==null?void 0:m.value)||0;(c=s==null?void 0:s.raw_materials)!=null&&c.unit;let i="grams",d=o;if(o>=1e3){const V=o/1e3;V>=25?(i="sacks",d=V/25):(i="kilos",d=V)}return i==="grams"?o<1e3?"bg-red":"bg-warning":i==="kilos"?d<5?d<=2?"bg-red":"bg-warning":"bg-positive":i==="sacks"?d<=2?"bg-grey-10":d<5?"bg-warning":"bg-grey-10":"bg-neutral"},u=s=>{const o=(s==null?void 0:s.total_quantity)||0,i=(s==null?void 0:s.unit)||"units";console.log("totalQuantity:",o),console.log("unit:",i);const d=m=>Number.isInteger(m)?m:parseFloat(m.toFixed(2));if(o>1e3){const m=o/1e3;if(m>=25){const c=m/25;return`${d(c)} sacks`}return`${d(m)} kilos`}else return o>1?`${d(o)} ${i}`:`${d(o)} ${i}`},L=[{name:"name",label:"Ingredients Name",align:"center",field:s=>{var o;return((o=s==null?void 0:s.raw_materials)==null?void 0:o.name)||"N/A"},format:s=>`${s}`,sortable:!0},{name:"availableStocks",align:"center",label:"Available Stocks",field:"total_quantity",sortable:!0}];return(s,o)=>(k(),K(j,null,[r("div",null,[e(U,{rounded:"",outlined:"",dense:"",debounce:"300",modelValue:q.value,"onUpdate:modelValue":o[0]||(o[0]=i=>q.value=i),placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:l(()=>[C.value?(k(),F(Y,{key:1,thickness:2,color:"teal",size:"1em"})):(k(),F(Y,{key:0,name:"search"}))]),_:1},8,["modelValue"])]),r("div",null,[e(xe,{filter:q.value,flat:"",columns:L,rows:y.value,"row-key":"name","virtual-scroll":""},{"body-cell-availableStocks":l(i=>[e(ke,{props:i},{default:l(()=>[e(be,{square:"",class:ye(["text-white",g(i.row)])},{default:l(()=>[b(A(u(i.row)),1)]),_:2},1032,["class"])]),_:2},1032,["props"])]),_:1},8,["filter","rows"])])],64))}},Te={align:"right"},ea={__name:"WarehouseIngredients",setup(x){return(p,R)=>(k(),F(ae,{flat:""},{default:l(()=>[e(I,{class:"text-h6"},{default:l(()=>[b(" Ingredients ")]),_:1}),e($),e(I,{class:"q-gutter-md"},{default:l(()=>[r("div",Te,[e(Ue)]),r("div",null,[e(Ae)])]),_:1})]),_:1}))}};export{ea as default};
