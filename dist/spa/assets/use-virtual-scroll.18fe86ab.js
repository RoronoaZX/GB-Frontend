import{g as me,aM as pe,aN as we,aU as he,aP as ze,B as ge,r as F,c as $,u as ae,b8 as ye,b0 as Me,S as be,T as Ae,A as Ee,G as Ve,j as E,l as qe}from"./index.757c26ea.js";import{r as Z}from"./rtl.a729d129.js";var Be=me({name:"QField",inheritAttrs:!1,props:{...pe,tag:{type:String,default:"label"}},emits:we,setup(){return he(ze({tagProp:!0}))}});const M=1e3,xe=["start","center","end","start-force","center-force","end-force"],ne=Array.prototype.filter,Fe=window.getComputedStyle(document.body).overflowAnchor===void 0?ge:function(t,c){t!==null&&(t._qOverflowAnimationFrame!==void 0&&cancelAnimationFrame(t._qOverflowAnimationFrame),t._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(t===null)return;t._qOverflowAnimationFrame=void 0;const S=t.children||[];ne.call(S,g=>g.dataset&&g.dataset.qVsAnchor!==void 0).forEach(g=>{delete g.dataset.qVsAnchor});const u=S[c];u&&u.dataset&&(u.dataset.qVsAnchor="")}))};function H(t,c){return t+c}function K(t,c,S,u,g,n,V,b){const h=t===window?document.scrollingElement||document.documentElement:t,y=g===!0?"offsetWidth":"offsetHeight",o={scrollStart:0,scrollViewSize:-V-b,scrollMaxSize:0,offsetStart:-V,offsetEnd:-b};if(g===!0?(t===window?(o.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,o.scrollViewSize+=document.documentElement.clientWidth):(o.scrollStart=h.scrollLeft,o.scrollViewSize+=h.clientWidth),o.scrollMaxSize=h.scrollWidth,n===!0&&(o.scrollStart=(Z===!0?o.scrollMaxSize-o.scrollViewSize:0)-o.scrollStart)):(t===window?(o.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,o.scrollViewSize+=document.documentElement.clientHeight):(o.scrollStart=h.scrollTop,o.scrollViewSize+=h.clientHeight),o.scrollMaxSize=h.scrollHeight),S!==null)for(let v=S.previousElementSibling;v!==null;v=v.previousElementSibling)v.classList.contains("q-virtual-scroll--skip")===!1&&(o.offsetStart+=v[y]);if(u!==null)for(let v=u.nextElementSibling;v!==null;v=v.nextElementSibling)v.classList.contains("q-virtual-scroll--skip")===!1&&(o.offsetEnd+=v[y]);if(c!==t){const v=h.getBoundingClientRect(),p=c.getBoundingClientRect();g===!0?(o.offsetStart+=p.left-v.left,o.offsetEnd-=p.width):(o.offsetStart+=p.top-v.top,o.offsetEnd-=p.height),t!==window&&(o.offsetStart+=o.scrollStart),o.offsetEnd+=o.scrollMaxSize-o.offsetStart}return o}function se(t,c,S,u){c==="end"&&(c=(t===window?document.body:t)[S===!0?"scrollWidth":"scrollHeight"]),t===window?S===!0?(u===!0&&(c=(Z===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-c),window.scrollTo(c,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,c):S===!0?(u===!0&&(c=(Z===!0?t.scrollWidth-t.offsetWidth:0)-c),t.scrollLeft=c):t.scrollTop=c}function P(t,c,S,u){if(S>=u)return 0;const g=c.length,n=Math.floor(S/M),V=Math.floor((u-1)/M)+1;let b=t.slice(n,V).reduce(H,0);return S%M!==0&&(b-=c.slice(n*M,S).reduce(H,0)),u%M!==0&&u!==g&&(b-=c.slice(u,V*M).reduce(H,0)),b}const ce={virtualScrollSliceSize:{type:[Number,String],default:10},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},He=Object.keys(ce),Oe={virtualScrollHorizontal:Boolean,onVirtualScroll:Function,...ce};function Te({virtualScrollLength:t,getVirtualScrollTarget:c,getVirtualScrollEl:S,virtualScrollItemSizeComputed:u}){const g=qe(),{props:n,emit:V,proxy:b}=g,{$q:h}=b;let y,o,v,p=[],f;const q=F(0),R=F(0),O=F({}),T=F(null),_=F(null),k=F(null),m=F({from:0,to:0}),D=$(()=>n.tableColspan!==void 0?n.tableColspan:100);u===void 0&&(u=$(()=>n.virtualScrollItemSize));const I=$(()=>u.value+";"+n.virtualScrollHorizontal),ue=$(()=>I.value+";"+n.virtualScrollSliceRatioBefore+";"+n.virtualScrollSliceRatioAfter);ae(ue,()=>{B()}),ae(I,X);function X(){Q(o,!0)}function ee(e){Q(e===void 0?o:e)}function W(e,l){const r=c();if(r==null||r.nodeType===8)return;const d=K(r,S(),T.value,_.value,n.virtualScrollHorizontal,h.lang.rtl,n.virtualScrollStickySizeStart,n.virtualScrollStickySizeEnd);v!==d.scrollViewSize&&B(d.scrollViewSize),N(r,d,Math.min(t.value-1,Math.max(0,parseInt(e,10)||0)),0,xe.indexOf(l)!==-1?l:o!==-1&&e>o?"end":"start")}function fe(){const e=c();if(e==null||e.nodeType===8)return;const l=K(e,S(),T.value,_.value,n.virtualScrollHorizontal,h.lang.rtl,n.virtualScrollStickySizeStart,n.virtualScrollStickySizeEnd),r=t.value-1,d=l.scrollMaxSize-l.offsetStart-l.offsetEnd-R.value;if(y===l.scrollStart)return;if(l.scrollMaxSize<=0){N(e,l,0,0);return}v!==l.scrollViewSize&&B(l.scrollViewSize),Y(m.value.from);const w=Math.floor(l.scrollMaxSize-Math.max(l.scrollViewSize,l.offsetEnd)-Math.min(f[r],l.scrollViewSize/2));if(w>0&&Math.ceil(l.scrollStart)>=w){N(e,l,r,l.scrollMaxSize-l.offsetEnd-p.reduce(H,0));return}let s=0,a=l.scrollStart-l.offsetStart,z=a;if(a<=d&&a+l.scrollViewSize>=q.value)a-=q.value,s=m.value.from,z=a;else for(let i=0;a>=p[i]&&s<r;i++)a-=p[i],s+=M;for(;a>0&&s<r;)a-=f[s],a>-l.scrollViewSize?(s++,z=a):z=f[s]+a;N(e,l,s,z)}function N(e,l,r,d,w){const s=typeof w=="string"&&w.indexOf("-force")!==-1,a=s===!0?w.replace("-force",""):w,z=a!==void 0?a:"start";let i=Math.max(0,r-O.value[z]),A=i+O.value.total;A>t.value&&(A=t.value,i=Math.max(0,A-O.value.total)),y=l.scrollStart;const C=i!==m.value.from||A!==m.value.to;if(C===!1&&a===void 0){te(r);return}const{activeElement:re}=document,x=k.value;C===!0&&x!==null&&x!==re&&x.contains(re)===!0&&(x.addEventListener("focusout",le),setTimeout(()=>{x!==null&&x.removeEventListener("focusout",le)})),Fe(x,r-i);const Se=a!==void 0?f.slice(i,r).reduce(H,0):0;if(C===!0){const j=A>=m.value.from&&i<=m.value.to?m.value.to:A;m.value={from:i,to:j},q.value=P(p,f,0,i),R.value=P(p,f,A,t.value),requestAnimationFrame(()=>{m.value.to!==A&&y===l.scrollStart&&(m.value={from:m.value.from,to:A},R.value=P(p,f,A,t.value))})}requestAnimationFrame(()=>{if(y!==l.scrollStart)return;C===!0&&Y(i);const j=f.slice(i,r).reduce(H,0),L=j+l.offsetStart+q.value,ie=L+f[r];let G=L+d;if(a!==void 0){const ve=j-Se,J=l.scrollStart+ve;G=s!==!0&&J<L&&ie<J+l.scrollViewSize?J:a==="end"?ie-l.scrollViewSize:L-(a==="start"?0:Math.round((l.scrollViewSize-f[r])/2))}y=G,se(e,G,n.virtualScrollHorizontal,h.lang.rtl),te(r)})}function Y(e){const l=k.value;if(l){const r=ne.call(l.children,i=>i.classList&&i.classList.contains("q-virtual-scroll--skip")===!1),d=r.length,w=n.virtualScrollHorizontal===!0?i=>i.getBoundingClientRect().width:i=>i.offsetHeight;let s=e,a,z;for(let i=0;i<d;){for(a=w(r[i]),i++;i<d&&r[i].classList.contains("q-virtual-scroll--with-prev")===!0;)a+=w(r[i]),i++;z=a-f[s],z!==0&&(f[s]+=z,p[Math.floor(s/M)]+=z),s++}}}function le(){k.value!==null&&k.value!==void 0&&k.value.focus()}function Q(e,l){const r=1*u.value;(l===!0||Array.isArray(f)===!1)&&(f=[]);const d=f.length;f.length=t.value;for(let s=t.value-1;s>=d;s--)f[s]=r;const w=Math.floor((t.value-1)/M);p=[];for(let s=0;s<=w;s++){let a=0;const z=Math.min((s+1)*M,t.value);for(let i=s*M;i<z;i++)a+=f[i];p.push(a)}o=-1,y=void 0,q.value=P(p,f,0,m.value.from),R.value=P(p,f,m.value.to,t.value),e>=0?(Y(m.value.from),Ve(()=>{W(e)})):U()}function B(e){if(e===void 0&&typeof window!="undefined"){const a=c();a!=null&&a.nodeType!==8&&(e=K(a,S(),T.value,_.value,n.virtualScrollHorizontal,h.lang.rtl,n.virtualScrollStickySizeStart,n.virtualScrollStickySizeEnd).scrollViewSize)}v=e;const l=parseFloat(n.virtualScrollSliceRatioBefore)||0,r=parseFloat(n.virtualScrollSliceRatioAfter)||0,d=1+l+r,w=e===void 0||e<=0?1:Math.ceil(e/u.value),s=Math.max(1,w,Math.ceil((n.virtualScrollSliceSize>0?n.virtualScrollSliceSize:10)/d));O.value={total:Math.ceil(s*d),start:Math.ceil(s*l),center:Math.ceil(s*(.5+l)),end:Math.ceil(s*(1+l)),view:w}}function de(e,l){const r=n.virtualScrollHorizontal===!0?"width":"height",d={["--q-virtual-scroll-item-"+r]:u.value+"px"};return[e==="tbody"?E(e,{class:"q-virtual-scroll__padding",key:"before",ref:T},[E("tr",[E("td",{style:{[r]:`${q.value}px`,...d},colspan:D.value})])]):E(e,{class:"q-virtual-scroll__padding",key:"before",ref:T,style:{[r]:`${q.value}px`,...d}}),E(e,{class:"q-virtual-scroll__content",key:"content",ref:k,tabindex:-1},l.flat()),e==="tbody"?E(e,{class:"q-virtual-scroll__padding",key:"after",ref:_},[E("tr",[E("td",{style:{[r]:`${R.value}px`,...d},colspan:D.value})])]):E(e,{class:"q-virtual-scroll__padding",key:"after",ref:_,style:{[r]:`${R.value}px`,...d}})]}function te(e){o!==e&&(n.onVirtualScroll!==void 0&&V("virtualScroll",{index:e,from:m.value.from,to:m.value.to-1,direction:e<o?"decrease":"increase",ref:b}),o=e)}B();const U=ye(fe,h.platform.is.ios===!0?120:35);Me(()=>{B()});let oe=!1;return be(()=>{oe=!0}),Ae(()=>{if(oe!==!0)return;const e=c();y!==void 0&&e!==void 0&&e!==null&&e.nodeType!==8?se(e,y,n.virtualScrollHorizontal,h.lang.rtl):W(o)}),Ee(()=>{U.cancel()}),Object.assign(b,{scrollTo:W,reset:X,refresh:ee}),{virtualScrollSliceRange:m,virtualScrollSliceSizeComputed:O,setVirtualScrollSize:B,onVirtualScrollEvt:U,localResetVirtualScroll:Q,padVirtualScroll:de,scrollTo:W,reset:X,refresh:ee}}export{Be as Q,Te as a,He as c,Oe as u};
