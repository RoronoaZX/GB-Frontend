import{c as I,r as T,o as _,a3 as F,J as a,f as e,M as j,w as t,Q as te,I as D,bg as qe,aK as h,$ as b,a0 as u,a4 as Y,a5 as ae,e as G,be as ne,a2 as ye,O as xe,R as he,u as ke,z as Se,L as ie,K as Z,d as Qe,P as fe,N as le,t as Ve,ae as Ie,aJ as Re}from"./index.2fb0bbd3.js";import{Q as be}from"./QBadge.734683c0.js";import{Q as ge,a as Ce}from"./QTable.8d36a27b.js";import{Q as Te}from"./QPagination.163af61d.js";import{u as ue}from"./baker-report.dd2440f1.js";import{u as de}from"./premix.6044e96b.js";import{a as f}from"./QSelect.452bfb90.js";import{a as H,b as g}from"./QMenu.36ea939f.js";import{Q as oe}from"./QList.830e7fea.js";import{Q as $e,a as Be}from"./QStepper.f1bb1ccc.js";import{u as Pe}from"./use-quasar.4ced19fe.js";import{t as ce}from"./typography-format.210817b7.js";import{b as we}from"./badge-color.f568cd69.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Le}from"./QSpace.a91c4d1f.js";import{C as Ne}from"./ClosePopup.69f39389.js";import{api as Fe}from"./axios.cb23f86d.js";import"./QVirtualScroll.b853a454.js";import"./use-virtual-scroll.8002ad9f.js";import"./rtl.276c3f1b.js";import"./selection.68b798b3.js";import"./QChip.9b02a469.js";import"./position-engine.8f82bec8.js";import"./QSlideTransition.1233a596.js";import"./use-panel.e0f5585e.js";import"./touch.9135741d.js";import"./use-render-cache.3aae9b27.js";import"./date.6d3cf000.js";const me=l=>(xe("data-v-2e480b95"),l=l(),he(),l),De={class:"row justify-between"},Ue={class:"text-h6"},Ee=me(()=>a("div",{class:"text-h6",align:"center"},"Premix",-1)),ze=me(()=>a("div",{class:"text-h6",align:"center"},"Ingredients List",-1)),Me={class:"text-grey-7 q-mt-xs"},je=me(()=>a("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1)),He={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(l,{emit:P}){var w,V,c,q,ee,pe,_e;const{capitalizeFirstLetter:m,formatTimestamp:k,formatFullname:y,formatRequestQuantity:R,formatQuantity:S}=ce(),{getHeaderClass:$,getPremixBadgeStatusColor:B}=we(),U=ue(),L=I(()=>U.user);console.log("userData in RawMaterialsTable:",L.value);const p=((V=(w=L.value)==null?void 0:w.data)==null?void 0:V.employee_id)||"",v=((q=(c=L.value)==null?void 0:c.device)==null?void 0:q.reference_id)||"";console.log("employeeId in PremixPage:",p),console.log("branchId in PremixPage:",v);const C=de();Pe();const N=T(!1),A=T(!1),d=l;console.log("props in TransactionViewss:",d.report);const X=P,E=()=>{N.value=!0},s=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],W=I(()=>{var i;return(i=d.report.history)!=null&&i.length?s.filter(o=>d.report.history.some(n=>n.status===o.value)):[]}),J=i=>{const o=d.report.history.find(n=>n.status===i);return o?i==="received"?`Received by: ${y(o.employee)}`:i==="pending"?`Requested by: ${y(o.employee)}`:`Handled by: ${y(o.employee)}`:"No handler"},z=((_e=(pe=(ee=d.report)==null?void 0:ee.branch_premix)==null?void 0:pe.branch_recipe)==null?void 0:_e.ingredient_groups)||"Undefined";console.log("ingrdientsData",z);const K=I(()=>z.map(i=>{const o=parseFloat(i.quantity)*parseFloat(d.report.quantity);return{...i,totalQuantity:o,formattedQuantity:S(o,i.ingredient.unit)}}));console.log("report to proceed",d.report);const M=I(()=>{var i,o;return((o=(i=d.report.history)==null?void 0:i[d.report.history.length-1])==null?void 0:o.status)||null});console.log("lastStatus",M.value);const r=I(()=>W.value.findIndex(i=>i.value===M.value)+1),x=i=>{var o;return(o=d.report.history)==null?void 0:o.some(n=>n.status===i)},Q=async()=>{const i={request_premix_id:d.report.id,branch_premix_id:d.report.branch_premix.id,branch_id:d.report.branch_premix.branch_id,employee_id:p,status:"received",notes:"Received Premix",quantity:d.report.quantity,warehouse_id:d.report.warehouse.id,ingredients:K.value.map(o=>({ingredients_id:o.ingredient.id,total_quantity:o.totalQuantity,unit:o.ingredient.unit}))};console.log("payload",i),await C.receivePremix(i),X("update-history"),N.value=!1};return(i,o)=>(_(),F(Y,null,[a("div",null,[e(j,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:E})]),e(ye,{modelValue:N.value,"onUpdate:modelValue":o[2]||(o[2]=n=>N.value=n)},{default:t(()=>[e(te,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(D,{class:qe(h($)(l.report.status))},{default:t(()=>[a("div",De,[a("div",Ue,b(h(m)(l.report.name)||"-"),1),e(j,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:o[0]||(o[0]=n=>N.value=!1)})])]),_:1},8,["class"]),e(D,null,{default:t(()=>{var n,O,ve;return[a("div",null,"Date: "+b(h(k)(l.report.created_at)||"-"),1),a("div",null,"Baker: "+b(h(y)(l.report.employee)||"-"),1),a("div",null," Branch: "+b(h(m)((ve=(O=(n=l.report)==null?void 0:n.branch_premix)==null?void 0:O.branch_recipe)==null?void 0:ve.branch.name)||"-"),1),a("div",null,[u(" Status: "),e(be,{color:h(B)(l.report.status),outlined:""},{default:t(()=>[u(b(h(m)(l.report.status)||"-"),1)]),_:1},8,["color"])])]}),_:1}),e(D,{class:"q-gutter-y-md"},{default:t(()=>[a("div",null,[Ee,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Premix Name")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[u(b(h(m)(l.report.name)||"-"),1)]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[u(b(h(R)(l.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",null,[ze,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u(" Code")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[u("Quantity")]),_:1})]),_:1})]),_:1}),(_(!0),F(Y,null,ae(h(z),(n,O)=>(_(),G(H,{key:O},{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[u(b(n.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[u(b(h(S)(n.quantity*l.report.quantity,n.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e($e,{modelValue:r.value,"onUpdate:modelValue":o[1]||(o[1]=n=>r.value=n),animated:"",class:"q-pa-lg"},{default:t(()=>[(_(!0),F(Y,null,ae(W.value,(n,O)=>(_(),G(Be,{key:O,name:O+1,title:n.label,color:h(B)(n.value),done:x(n.value),icon:x(n.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[a("div",Me,b(J(n.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),M.value==="to receive"?(_(),G(D,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[je,e(j,{color:"amber-10",label:"Yes",icon:"check",onClick:Q,loading:A.value},null,8,["loading"])]),_:1})):ne("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Ae=re(He,[["__scopeId","data-v-2e480b95"]]);const Je={key:0,class:"q-pt-md flex flex-center"},Ke={__name:"PremixTable",props:{searchText:{type:String,default:""}},setup(l){var J,z,K,M;const{capitalizeFirstLetter:P,formatTimestamp:m}=ce(),{getPremixBadgeStatusColor:k}=we(),y=l;ke(()=>y.searchText,r=>{N.value=r,X()});const R=ue(),S=I(()=>R.user);console.log("userData in RawMaterialsTable:",S.value);const $=((z=(J=S.value)==null?void 0:J.device)==null?void 0:z.reference_id)||"";console.log("branchId in PremixPage:",$);const B=de();I(()=>B.branchEmployeePremix);const U=((M=(K=S.value)==null?void 0:K.data)==null?void 0:M.employee_id)||"";console.log("employeeId in PremixPagess:",U);const L=Pe(),p=I(()=>{var r,x;return((x=(r=B.branchEmployeePremix)==null?void 0:r.data)==null?void 0:x.data)||[]}),v=I(()=>{var r;return((r=B.branchEmployeePremix)==null?void 0:r.pagination)||{current_page:1,last_page:1,per_page:5}}),C=T(null),N=T("");let A=null;const d=()=>{E(v.value.current_page)},X=()=>{A&&clearTimeout(A),A=setTimeout(()=>{E(1)},500)},E=async(r=1)=>{L.loading.show();try{await B.fetchRequestBranchEmployeePremix($,U,r,v.value.per_page||5,N.value),!p.value.length&&C.value&&(C.value=null),C.value.length&&!p.value.some(x=>x.id===C.value.id)&&(C.value=null),!C.value&&p.value,length>0&&(C.value=p.value[0]),console.log("premixList",p.value),console.log("pagination",v.value)}catch(x){console.error("Error fetching premix report:",x)}finally{L.loading.hide()}};Se(async()=>{E(v.value.current_page)});const s=r=>{E(r)},W=[{name:"name",label:"Transactions Name",align:"left",field:r=>r.name?P(r.name):"N/A",format:r=>`${r}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:r=>m(r),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(r,x)=>(_(),F(Y,null,[e(Ce,{flat:"",columns:W,rows:p.value||[],"rows-per-page-options":[5],"row-key":"id",bordered:"",dense:""},{"body-cell-status":t(Q=>[e(ge,{props:Q},{default:t(()=>[e(be,{outlined:"",color:h(k)(Q.row.status)},{default:t(()=>[u(b(h(P)(Q.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(Q=>[e(ge,{props:Q},{default:t(()=>[a("div",null,[e(Ae,{report:Q.row,onUpdateHistory:d},null,8,["report"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),v.value.last_page>1?(_(),F("div",Je,[e(Te,{modelValue:v.value.current_page,"onUpdate:modelValue":[x[0]||(x[0]=Q=>v.value.current_page=Q),s],max:v.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):ne("",!0)],64))}};var Oe=re(Ke,[["__scopeId","data-v-5c970cea"]]);const Ye={class:"q-mb-md row items-center justify-between"},Ge={__name:"SearchPremix",emits:["search"],setup(l,{emit:P}){const m=T(""),k=P,y=R=>k("search",R);return(R,S)=>(_(),F("div",Ye,[e(Z,{outlined:"",dense:"",placeholder:"Search Premix Name",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:m.value,"onUpdate:modelValue":[S[0]||(S[0]=$=>m.value=$),y]},{append:t(()=>[e(ie,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]))}},We=Qe("request-premix",()=>{const l=T(null),P=T([]);return{requestPremix:l,requestPremixes:P,saveRequestPremix:async k=>{console.log("data request oremix",k),fe.show();try{const y=await Fe.post("/api/request-premix",{requests:k});console.log("response",y.data),le.create({type:"positive",message:"Request Premix successfully"})}catch(y){console.error(y),le.create({type:"negative",message:"Request Premix Error"})}finally{fe.hide()}}}});const se=l=>(xe("data-v-96dc7c26"),l=l(),he(),l),Xe={align:"right"},Ze=se(()=>a("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),et={class:"q-ma-md"},tt={key:0,class:"custom-list z-top"},at={class:"q-mb-sm"},lt=se(()=>a("div",null,"Premix Name",-1)),ot={class:"q-mb-lg"},rt=se(()=>a("div",null,"Category",-1)),st=se(()=>a("div",null,"Quantity",-1)),nt={align:"right"},it={__name:"RequestPremix",setup(l){var J,z,K,M,r,x,Q;const{capitalizeFirstLetter:P}=ce(),m=T(!1),k=()=>{m.value=!0},y=ue(),R=I(()=>y.user);console.log("userData in RawMaterialsTable:",R.value);const S=((z=(J=R.value)==null?void 0:J.device)==null?void 0:z.reference_id)||"";console.log("branchId in PremixPage:",S);const $=((r=(M=(K=R.value)==null?void 0:K.device)==null?void 0:M.reference)==null?void 0:r.warehouse_id)||"";console.log("warehouseId in PremixPage:",$);const B=((Q=(x=R.value)==null?void 0:x.data)==null?void 0:Q.employee_id)||"";console.log("warehouseId in PremixPage:",$);const U=de(),L=I(()=>U.premixes);I(()=>U.branchEmployeePremix),console.log("premixdatas",L.value),We();const p=T([]),v=T(""),C=async()=>{await U.searchPremix(v.value,S)},N=w=>{console.log("data",w),s.branch_premix_id=w.id,s.name=P(w.name),s.category=w.category,v.value=""},A=I(()=>p.value!==0),d=()=>{const w=p.value.push({branch_premix_id:s.branch_premix_id,warehouse_id:s.warehouse_id,employee_id:s.employee_id,name:s.name,category:s.category,quantity:s.quantity,status:s.status});console.log("premix",w),E()},X=w=>{p.value.splice(w,1)},E=()=>{s.branch_premix_id=0,s.name="",s.category="",s.quantity=0},s=Ve({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:$,employee_id:B,status:"pending"}),W=async()=>{try{console.log("Data sent for premix request:",p.value),await U.saveRequestPremix(p.value,S,B),le.create({type:"positive",message:"Premix request saved successfully!"}),E(),p.value=[],m.value=!1}catch(w){console.error("Failed to save premix request:",w),le.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(w,V)=>(_(),F(Y,null,[a("div",Xe,[e(j,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:k})]),e(ye,{modelValue:m.value,"onUpdate:modelValue":V[4]||(V[4]=c=>m.value=c),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(te,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(D,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[Ze,e(Le),Ie(e(j,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Ne]])]),_:1}),a("div",et,[e(Z,{modelValue:v.value,"onUpdate:modelValue":[V[0]||(V[0]=c=>v.value=c),C],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[a("div",null,[e(ie,{name:"search"})])]),default:t(()=>[v.value?(_(),F("div",tt,[e(te,null,{default:t(()=>[e(oe,{separator:""},{default:t(()=>{var c;return[(c=L.value)!=null&&c.length?(_(!0),F(Y,{key:1},ae(L.value,q=>(_(),G(H,{key:q.id,onClick:ee=>N(q),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(f,null,{default:t(()=>[u(b(h(P)(q==null?void 0:q.name)),1)]),_:2},1024)]),_:2},1024),e(g,null,{default:t(()=>[e(f,{side:""},{default:t(()=>[u(b(q==null?void 0:q.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(_(),G(H,{key:0},{default:t(()=>[u(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):ne("",!0)]),_:1},8,["modelValue"])]),e(D,null,{default:t(()=>[a("div",at,[lt,e(Z,{modelValue:s.name,"onUpdate:modelValue":V[1]||(V[1]=c=>s.name=c),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),a("div",ot,[rt,e(Z,{modelValue:s.category,"onUpdate:modelValue":V[2]||(V[2]=c=>s.category=c),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(D,{class:"q-gutter-sm"},{default:t(()=>[a("div",null,[st,e(Z,{modelValue:s.quantity,"onUpdate:modelValue":V[3]||(V[3]=c=>s.quantity=c),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),a("div",nt,[e(j,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:d})])]),_:1}),e(D,null,{default:t(()=>[e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(H,null,{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(" Premix Name ")]),_:1})]),_:1}),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(" Quantity ")]),_:1})]),_:1}),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[u(" Action")]),_:1})]),_:1})]),_:1}),(_(!0),F(Y,null,ae(p.value,(c,q)=>(_(),G(H,{key:q},{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(b(c.name),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[u(b(c.quantity),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[e(j,{onClick:ee=>X(q),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(Re,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(j,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(j,{class:"glossy",color:"teal",label:"Create",onClick:W,disable:!A.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var ut=re(it,[["__scopeId","data-v-96dc7c26"]]);const dt={class:"text-h6 text-white"},ct={class:"row justify-between"},mt={__name:"PremixPage",setup(l){const P=T(""),m=k=>{P.value=k};return(k,y)=>(_(),G(te,{flat:""},{default:t(()=>[e(D,{style:{"background-color":"#ef4444"}},{default:t(()=>[a("div",dt,[e(ie,{name:"scale"}),u(" Premix ")])]),_:1}),e(D,{class:"q-gutter-y-md"},{default:t(()=>[a("div",ct,[a("div",null,[e(Ge,{onSearch:m})]),a("div",null,[e(ut)])]),a("div",null,[e(Oe,{searchText:P.value},null,8,["searchText"])])]),_:1})]),_:1}))}};var zt=re(mt,[["__scopeId","data-v-66c1b51a"]]);export{zt as default};
