import{r as k,o as d,e as q,w as t,f as e,Q as Y,I as D,a3 as V,bc as A,a1 as W,aJ as H,ae as G,M as x,be as X,a2 as O,O as j,R as K,J as u,K as Z,c as T,$ as C,a0 as _,a4 as z,a5 as ue,N as M,z as de,L as ee}from"./index.574b640c.js";import{Q as me}from"./QChip.52514aeb.js";import{Q as U,a as fe}from"./QTable.d8326620.js";import{Q as te}from"./QBadge.289eceea.js";import{Q as pe}from"./QPagination.319b230c.js";import{q as ae}from"./date.4d926daa.js";import{u as le}from"./use-quasar.0c860af1.js";import{u as ge}from"./baker-report.231b8431.js";import{u as oe}from"./stock-delivery.3cec9822.js";import{a as L}from"./QSelect.70581aa3.js";import{a as J,b as N}from"./QMenu.c9c9d030.js";import{Q as _e}from"./QList.48a1d414.js";import{C as se}from"./ClosePopup.85388ba5.js";import{u as re}from"./use-dialog-plugin-component.4924d527.js";import{_ as E}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.de0c5d92.js";import"./use-virtual-scroll.6c81ca1c.js";import"./rtl.276c3f1b.js";import"./selection.02898c61.js";import"./axios.fe305231.js";import"./position-engine.fe30721f.js";const ne=o=>(j("data-v-318678d0"),o=o(),K(),o),ve=ne(()=>u("div",{class:"text-h5 q-mb-xs"},"Confirm Report",-1)),ye={key:0},he=ne(()=>u("div",{class:"text-positive text-subtitle1"}," Please confirm again to finalize this report. ",-1)),De={__name:"ConfirmDialog",setup(o){const{dialogRef:w,onDialogHide:v,onDialogOK:y,onDialogCancel:b}=re(),n=k(!1),i=()=>{n.value?y():n.value=!0};return(m,p)=>(d(),q(O,{ref_key:"dialogRef",ref:w,onHide:X(v)},{default:t(()=>[e(Y,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(D,{class:"q-pt-none q-pb-sm"},{default:t(()=>[ve,n.value?A("",!0):(d(),V("p",ye," Are you sure you wanat to confirm this report? "))]),_:1}),n.value?(d(),q(D,{key:0},{default:t(()=>[he]),_:1})):A("",!0),e(W,{class:"q-mb-sm"}),e(D,null,{default:t(()=>[e(H,{align:"right",class:"q-pt-none"},{default:t(()=>[G(e(x,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[se]]),e(x,{dense:"",label:n.value?"Confirm":"Yes! Confirm",color:"positive",class:"q-btn-rounded q-px-lg",onClick:i},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var be=E(De,[["__scopeId","data-v-318678d0"]]);const we=o=>(j("data-v-5a3e7851"),o=o(),K(),o),Ce=we(()=>u("div",{class:"text-h5 q-mb-xs"},"Decline Report",-1)),ke={key:0},xe={__name:"DeclinedDialog",setup(o){const{dialogRef:w,onDialogHide:v,onDialogOK:y,onDialogCancel:b}=re(),n=k(!1),i=k(""),m=k(null),p=k(!1),S=async()=>{n.value?(p.value=!0,m.value.validate()&&y({remarks:i.value})):n.value=!0};return(I,$)=>(d(),q(O,{ref_key:"dialogRef",ref:w,onHide:X(v),persistent:""},{default:t(()=>[e(Y,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(D,{class:"q-pt-none q-pb-sm"},{default:t(()=>[Ce,n.value?A("",!0):(d(),V("p",ke,"Are you sure you want to decline this report?"))]),_:1}),n.value?(d(),q(D,{key:0},{default:t(()=>[e(Z,{modelValue:i.value,"onUpdate:modelValue":$[0]||($[0]=Q=>i.value=Q),type:" textarea",label:"Reason  for declining",filled:"",autogrow:"",dense:"",ref_key:"remarksInput",ref:m,rules:[Q=>!!Q||"Remarks are required"]},null,8,["modelValue","rules"])]),_:1})):A("",!0),e(W,{class:"q-mb-md"}),e(D,null,{default:t(()=>[e(H,{align:"right",class:"q-pt-none"},{default:t(()=>[G(e(x,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[se]]),e(x,{dense:"",label:n.value?"Submit Decline":"Yes! Decline",color:"negative",class:"q-btn-rounded q-px-lg",onClick:S},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var qe=E(xe,[["__scopeId","data-v-5a3e7851"]]);const Se=o=>(j("data-v-081666a2"),o=o(),K(),o),Qe={class:"row justify-between"},Ve={class:"text-h6"},Ie={class:"q-mt-md"},$e=Se(()=>u("span",{class:"text-grey-7 text-caption"},"Items: ",-1)),Re={key:1,class:"text-caption text-grey-6 q-mt-md"},Me={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["fetchAgain"],setup(o,{emit:w}){const v=oe();T(()=>v.loading),T(()=>v.declinedStocks);const y=o;console.log("props in Transaction view:",y.report);const b=w,n=k(!1),i=le(),m=()=>{n.value=!0},p=r=>r?r.toLowerCase().split(" ").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" "):"",S=r=>ae.formatDate(r,"MMMM D, YYYY - hh:mm A"),I=r=>r==null?"No Quantity":parseFloat(r),$=()=>{i.dialog({component:be}).onOk(()=>{console.log("Data from child:",y.report),R(y.report)}).onCancel(()=>{console.log("Cancelled")})},Q=()=>{i.dialog({component:qe}).onOk(r=>{console.log("Decliene remark from child:",r),B(y.report.id,r)}).onCancel(()=>{console.log("Cancelled")})},R=async r=>{var c,f,h,g;console.log("Confirming report",r);try{i.loading.show();const l=r.items.map(F=>{const ie=parseFloat(F.quantity)||0,ce=parseFloat(F.gram)||0;return{...F,total_grams:ie*ce}});console.log("Per Item Totals:",l);const s={...r,status:"confirmed",items:l};console.log("Confirm Datasss:",s);const a=await v.confirmDeliveryStocks(s);console.log("responsesssssss",a),(a==null?void 0:a.data)||((c=a==null?void 0:a.data)==null?void 0:c.message)==="Delivery confirmed."?(M.create({type:"positive",message:a.data.message||"Delivery Confirmed Successfully"}),(a==null?void 0:a.status)===200&&(n.value=!1,b("fetchAgain"))):M.create({type:"negative",message:((f=a==null?void 0:a.data)==null?void 0:f.message)||"Failed to Confirm Delivery"}),console.log("responsesss",a)}catch(l){console.log(l),M.create({type:"negative",message:((g=(h=l==null?void 0:l.response)==null?void 0:h.data)==null?void 0:g.message)||"Failed to Confirm Delivery"})}finally{i.loading.hide()}},B=async(r,c)=>{var f,h,g,l;try{i.loading.show(),console.log("declining report",r,"with remarks:",c);const s={id:r,status:"declined",remarks:c.remarks};console.log("declineData",s);const a=await v.declineDeliveryStocks(s);(a==null?void 0:a.data)||((f=a==null?void 0:a.data)==null?void 0:f.message)==="Delivery declined successfully."?(M.create({type:"positive",message:a.data.message||"Delivery Declined Successfully"}),(a==null?void 0:a.status)===200&&(n.value=!1,b("fetchAgain"))):M.create({type:"negative",message:((h=a==null?void 0:a.data)==null?void 0:h.message)||"Failed to decline delivery"}),console.log("responsesssss",a)}catch(s){console.log(s),M.create({type:"negative",message:((l=(g=s==null?void 0:s.response)==null?void 0:g.data)==null?void 0:l.message)||"Failed to decline delivery. Please try again."})}finally{i.loading.hide()}},P=r=>{switch((r||"").toLowerCase()){case"pending":return"orange-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(r,c)=>(d(),V(z,null,[e(x,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:m}),e(O,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=f=>n.value=f)},{default:t(()=>[e(Y,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(D,null,{default:t(()=>[u("div",Qe,[u("div",Ve,C(p(o.report.from_name)),1),e(x,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:c[0]||(c[0]=f=>n.value=!1)})])]),_:1}),e(D,null,{default:t(()=>[u("div",null,[u("span",null,"Date: "+C(S(o.report.created_at)),1)]),u("div",null,[u("span",null,[_(" Status: "),e(te,{color:P(o.report.status)},{default:t(()=>[_(C(p(o.report.status)),1)]),_:1},8,["color"])])]),u("div",Ie,[$e,o.report.items&&o.report.items.length?(d(),q(_e,{key:0,dense:"",separator:"",class:"box"},{default:t(()=>[e(J,{class:"bg-grey-1 text-weight-bold"},{default:t(()=>[e(N,null,{default:t(()=>[e(L,null,{default:t(()=>[_(" Raw Materials Code ")]),_:1})]),_:1}),e(N,null,{default:t(()=>[e(L,null,{default:t(()=>[_("Stocks Category")]),_:1})]),_:1}),e(N,{side:""},{default:t(()=>[e(L,null,{default:t(()=>[_(" Quantity ")]),_:1})]),_:1})]),_:1}),(d(!0),V(z,null,ue(o.report.items,(f,h)=>(d(),q(J,{key:h},{default:t(()=>[e(N,null,{default:t(()=>[e(L,null,{default:t(()=>{var g;return[_(C(((g=f.raw_material)==null?void 0:g.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),e(N,null,{default:t(()=>[e(L,null,{default:t(()=>[_(C(f.category||"No Category"),1)]),_:2},1024)]),_:2},1024),e(N,{side:""},{default:t(()=>[e(L,null,{default:t(()=>[_(C(I(f.quantity||"No Quantity")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(d(),V("div",Re," No items in this delivery "))])]),_:1}),o.report.status==="pending"?(d(),q(H,{key:0,class:"report-actions q-ma-sm q-gutter-sm",align:"right"},{default:t(()=>[e(x,{color:"negative",label:"Decline",class:"action-btn",onClick:Q}),e(x,{color:"positive",label:"Confirm",class:"action-btn",onClick:$})]),_:1})):A("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Le=E(Me,[["__scopeId","data-v-081666a2"]]);const Ne={class:"q-mb-md row items-center justify-between"},Te={key:0,class:"q-pt-md flex flex-center"},Ae={__name:"RawMaterialsDeliveryTable",setup(o){var h,g;const w=ge(),y=((g=(h=T(()=>w.user).value)==null?void 0:h.device)==null?void 0:g.reference_id)||"",b=oe(),n=le(),i=T(()=>b.deliveryStocks.data.data);T(()=>b.loading);const m=T(()=>{var l;return((l=b.deliveryStocks)==null?void 0:l.pagination)||{current_page:1,last_page:1,per_page:5}}),p=k(null),S=k("");let I=null;const $=l=>l?l.toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "):"",Q=()=>{I&&clearTimeout(I),I=setTimeout(()=>{R(1)},500)},R=async(l=1)=>{n.loading.show();try{await b.fetchDeliveryStocksBranch(y,l,m.value.per_page,S.value),!i.value.length&&p.value&&(p.value=null),p.value&&!i.value.some(s=>s.id===p.value.id)&&(p.value=null),!p.value&&i.value,length>0&&(p.value=i.value[0]),console.log("deliveryListsss",i.value),console.log("pagination",m.value)}catch(s){console.log("Error fetching delivery stocks in component:",s)}finally{n.loading.hide()}};de(()=>{R(m.value.current_page)});const B=l=>{R(l)},P=[{name:"created_at",label:"Date",align:"left",field:"created_at",format:l=>r(l),sortable:!0},{name:"from",label:"From",align:"left",field:l=>$(l.from_name),sortable:!0},{name:"items",label:"Items",field:"items",align:"center",sortable:!0},{name:"status",label:"Status",align:"left",field:"status"},{name:"view",align:"right",label:"View",field:"view",sortable:!0}],r=l=>ae.formatDate(l,"MMMM D, YYYY - hh:mm A"),c=l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase(),f=l=>{switch((l||"").toLowerCase()){case"pending":return"orange-7";case"in progress":return"blue-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(l,s)=>(d(),V(z,null,[u("div",Ne,[e(Z,{outlined:"",dense:"",placeholder:"Search delivery",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:S.value,"onUpdate:modelValue":[s[0]||(s[0]=a=>S.value=a),Q]},{append:t(()=>[e(ee,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]),e(fe,{flat:"",columns:P,rows:i.value||[],"row-key":"id",bordered:"",dense:""},{"body-cell-items":t(a=>[e(U,{props:a},{default:t(()=>[e(me,{outlined:"",color:"primary text-white",dense:""},{default:t(()=>[_(C(a.row.items.length),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":t(a=>[e(U,{props:a},{default:t(()=>[e(te,{outlined:"",color:f(a.row.status)},{default:t(()=>[_(C(c(a.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(a=>[e(U,{props:a},{default:t(()=>[u("div",null,[e(Le,{report:a.row,onFetchAgain:s[1]||(s[1]=F=>R(m.value.current_page))},null,8,["report"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),m.value.last_page>1?(d(),V("div",Te,[e(pe,{modelValue:m.value.current_page,"onUpdate:modelValue":[s[2]||(s[2]=a=>m.value.current_page=a),B],max:m.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):A("",!0)],64))}},Fe={class:"text-h6 text-white"},rt={__name:"RawMaterialsDelivery",setup(o){return(w,v)=>(d(),q(Y,{flat:""},{default:t(()=>[e(D,{style:{"background-color":"#ef4444"}},{default:t(()=>[u("div",Fe,[e(ee,{name:"local_shipping"}),_(" Raw Materials Delivery ")])]),_:1}),e(D,{class:"q-gutter-y-md"},{default:t(()=>[u("div",null,[e(Ae)])]),_:1})]),_:1}))}};export{rt as default};
