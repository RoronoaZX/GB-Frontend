import{g as se,aP as le,c as T,bH as re,j as te,M as W,x as ie,bC as de,o as p,e as U,w as j,J as n,$ as w,a3 as L,a4 as H,a5 as G,bf as ae,bg as ce,f as E,a0 as ue,be as me,Q as ge,O as fe,R as ve,bp as _e,r as Y,u as he,z as ye,L as pe}from"./index.86555a02.js";import{Q as be}from"./QBtnGroup.04508386.js";import{Q as De}from"./QSpinnerDots.1ed5c270.js";import{Q as ke}from"./QPage.d95bb598.js";import{q as A}from"./date.e8db5187.js";import{u as we}from"./dtr.67aa89fd.js";import{Q as xe}from"./QTooltip.d7878e40.js";import{_ as Se}from"./plugin-vue_export-helper.21dcd24c.js";import"./selection.9de241bc.js";import"./axios.b83de87b.js";import"./position-engine.d27e24be.js";var Be=se({name:"QBtnToggle",props:{...le,modelValue:{required:!0},options:{type:Array,required:!0,validator:t=>t.every(x=>("label"in x||"icon"in x||"slot"in x)&&"value"in x)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(t,{slots:x,emit:b}){const C=T(()=>t.options.find(g=>g.value===t.modelValue)!==void 0),c=T(()=>({type:"hidden",name:t.name,value:t.modelValue})),u=de(c),i=T(()=>re(t)),D=T(()=>({rounded:t.rounded,dense:t.dense,...i.value})),s=T(()=>t.options.map((g,v)=>{const{attrs:P,value:O,slot:R,...f}=g;return{slot:R,props:{key:v,"aria-pressed":O===t.modelValue?"true":"false",...P,...f,...D.value,disable:t.disable===!0||f.disable===!0,color:O===t.modelValue?m(f,"toggleColor"):m(f,"color"),textColor:O===t.modelValue?m(f,"toggleTextColor"):m(f,"textColor"),noCaps:m(f,"noCaps")===!0,noWrap:m(f,"noWrap")===!0,size:m(f,"size"),padding:m(f,"padding"),ripple:m(f,"ripple"),stack:m(f,"stack")===!0,stretch:m(f,"stretch")===!0,onClick(z){_(O,g,z)}}}}));function _(g,v,P){t.readonly!==!0&&(t.modelValue===g?t.clearable===!0&&(b("update:modelValue",null,null),b("clear")):b("update:modelValue",g,v),b("click",P))}function m(g,v){return g[v]===void 0?t[v]:g[v]}function F(){const g=s.value.map(v=>te(W,v.props,v.slot!==void 0?x[v.slot]:void 0));return t.name!==void 0&&t.disable!==!0&&C.value===!0&&u(g,"push"),ie(x.default,g)}return()=>te(be,{class:"q-btn-toggle",...i.value,rounded:t.rounded,stretch:t.stretch,glossy:t.glossy,spread:t.spread},F)}});const J=t=>(fe("data-v-3f95a2ea"),t=t(),ve(),t),Te={class:"row items-center no-wrap"},Le={class:"col-auto"},Ce={class:"text-weight-bold"},Pe=J(()=>n("div",{class:"text-grey-7 text-caption"},"Clock-in",-1)),Me={class:"text-subtitle1 text-weight-regular"},Oe={class:"col q-px-xl"},$e={class:"timeline-container"},Ie={class:"timeline-bar"},Ve={key:0,class:"activity-label"},qe={class:"col-auto"},Ae={class:"row items-center no-wrap q-gutter-x-lg"},Ee={class:"text-right"},Qe={class:"text-weight-bold"},Ye=J(()=>n("div",{class:"text-grey-7 text-caption"},"Clock-out",-1)),Fe={class:"text-subtitle1 text-weight-regular"},Re={class:"text-right"},ze=J(()=>n("div",{class:"text-grey-7 text-caption"},"Duration",-1)),Ne={class:"text-subtitle1 text-weight-regular"},We={__name:"DailyAttendanceLog",props:{log:{type:Object,required:!0,default:()=>({dayLabelIn:"10 Tuesday",clockIn:"04:08 PM",dayLabelOut:"11 Wednesday",clockOut:"08:25 AM",duration:"16h 17m",activities:[{type:"working",label:"Working time",start:"16:08",end:"24:00"},{type:"working",label:"Working time",start:"00:00",end:"08:25"},{type:"break",label:"",start:"03:30",end:"04:00"}],otStatus:"approved"})}},setup(t){const x=t;T(()=>{switch(x.log.otStatus){case"approved":return{label:"Approved",color:"positive",icon:"check_circle"};case"declined":return{label:"Declined",color:"negative",icon:"cancel"};case"pending":return{label:"Pending",color:"orange",icon:"hourglass_empty"};default:return{label:"Unknown",color:"grey",icon:"help"}}});const b=["02","04","06","08","10","12","14","16","18","20","22","24"],C=i=>{if(!i)return 0;const[D,s]=i.split(":").map(Number),_=D*60+s,m=24*60;return _/m*100},c=i=>{if(!i.start||!i.end)return{};const D=C(i.start);let _=C(i.end)-D;return _<0&&(_=100+_),{left:`${D}%`,width:`${_}%`}},u=i=>{if(!i.label)return"activity-marker";switch(i.type){case"working":return"bg-primary";case"break":return"bg-orange-4";case"overtime":return"bg-deep-orange";case"day_off":return"bg-amber";default:return"bg-grey-5"}};return(i,D)=>(p(),U(ge,{flat:"",class:"log-card q-mb-sm"},{default:j(()=>[n("div",Te,[n("div",Le,[n("div",Ce,w(t.log.dayLabelIn),1),Pe,n("div",Me,w(t.log.clockIn),1)]),n("div",Oe,[n("div",$e,[(p(),L(H,null,G(b,s=>n("div",{key:s,class:"time-marker",style:ae({left:C(`${s}:00`)+"%"})},w(s)+":00 ",5)),64)),n("div",Ie,[(p(!0),L(H,null,G(t.log.activities,(s,_)=>(p(),L("div",{key:_,class:ce(["activity-block",u(s)]),style:ae(c(s))},[E(xe,{anchor:"top middle",self:"bottom middle"},{default:j(()=>[ue(w(s.label)+": "+w(s.start)+" - "+w(s.end),1)]),_:2},1024),s.label?(p(),L("span",Ve,w(s.label),1)):me("",!0)],6))),128))])])]),n("div",qe,[n("div",Ae,[n("div",Ee,[n("div",Qe,w(t.log.dayLabelOut),1),Ye,n("div",Fe,w(t.log.clockOut),1)]),n("div",Re,[ze,n("div",Ne,w(t.log.duration),1)])])])])]),_:1}))}};var Ue=Se(We,[["__scopeId","data-v-3f95a2ea"]]);const je={key:0},He={class:"row items-center justify-between q-mb-md"},Ge={class:"row items-center q-gutter-x-sm"},Je={class:"text-h6 text-weight-medium"},Ke=n("span",null,null,-1),Xe={key:0,class:"q-mt-md"},Ze={key:1,class:"text-center q-pa-xl text-grey-7"},et=n("div",{class:"text-h6 q-mt-md"},"No Attendance Records",-1),tt=n("p",null," There is no attendance data for this employee in the selected period. ",-1),at={key:1,class:"text-center q-pa-xl"},ft={__name:"TimeManagementDashboard",setup(t){const b=_e().params.employee_id;console.log("Time Management Employee ID :",b);const C=we(),c=Y(""),u=Y(""),i=Y("attendance"),D=Y(!0),s=Y([]),_=T(()=>{switch(i.value){case"overtime":return s.value.filter(l=>l.otStatus);case"time_off":return s.value.filter(l=>l.isDayOff);case"attendance":default:return s.value}}),m=l=>{if(!l||l.length===0)return[];const r=e=>{if(!e)return"-";const a=new Date(e),d=new Date,h=new Date;h.setDate(h.getDate()-1);let y=a.toLocaleDateString("en-US",{weekday:"long",day:"numeric"});return A.isSameDate(a,d,"day")&&(y="Today"),A.isSameDate(a,h,"day")&&(y="Yesterday"),y};return l.map(e=>{const a=e.time_in?new Date(e.time_in):null,d=e.time_out?new Date(e.time_out):null,h=r(a||e.created_at),y=r(d||a||e.created_at),k=!a&&e.ot_status==="approved",S=e.break_start?new Date(e.break_start):null,B=e.break_end?new Date(e.break_end):null,M=e.lunch_break_start?new Date(e.lunch_break_start):null,I=e.lunch_break_end?new Date(e.lunch_break_end):null,Q=e.overtime_start?new Date(e.overtime_start):null,N=e.overtime_end?new Date(e.overtime_end):null,$=[];if(a){let o=a;const V=S||M;V&&V>o&&($.push({type:"working",label:"Working time",start:o,end:V}),o=V),S&&B&&B>o&&($.push({type:"break",label:"Break",start:S,end:B}),o=B),M&&I&&I>o&&($.push({type:"break",label:"Break",start:M,end:I}),o=I);const q=Q||d;q&&q>o&&($.push({type:"working",label:"Working time",start:o,end:q}),o=q),Q&&N&&N>o&&$.push({type:"overtime",label:"Over time",start:Q,end:N})}else k&&$.push({type:"day_off",label:"Requested day off",start:null,end:null});const X=o=>o?o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"-",Z=o=>o?o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):null,ne=a||new Date(e.created_at||Date.now());let oe=r(ne),ee="-";if(a&&d){const o=d-a,V=Math.floor(o/36e5),q=Math.round(o%36e5/6e4);ee=`${V}h ${q}m`}return{dayLabel:oe,dayLabelIn:h,dayLabelOut:y,clockIn:X(a),clockOut:X(d),duration:ee,otStatus:e.ot_status,isDayOff:k,activities:$.map(o=>({...o,start:Z(o.start),end:Z(o.end)}))}})},F=async()=>{if(!(!c.value||!u.value||!b)){D.value=!0;try{await C.fetchEmployeeDTRRange({employee_id:b,start_date:c.value,end_date:u.value}),s.value=m(C.dtrCutOffData)}catch(l){console.error("Error fetching or transforming attendance data:",l),s.value=[]}finally{D.value=!1}}},g=(l,r)=>{if(!l||!r)return"Loading...";const e=new Date(l),a=new Date(r),d={day:"2-digit",month:"short"},h={day:"2-digit",month:"short",year:"numeric"},y=e.toLocaleDateString("en-US",d).replace(",",""),k=a.toLocaleDateString("en-US",h).replace(",","");return`${y} - ${k}`},v=T(()=>g(c.value,u.value)),P=l=>{const r=new Date(l),e=r.getDate(),a=r.getFullYear();let d=r.getMonth()+1,h,y,k,S,B,M;e>=11&&e<=25?(h=11,y=25,k=d,S=d,B=a,M=a):e>=26?(h=26,y=10,k=d,S=d+1,B=a,M=d===12?a+1:a):(h=26,y=10,k=d-1,S=d,B=d===1?a-1:a,M=a),k===0&&(k=12),S===13&&(S=1);const I=A.formatDate(new Date(B,k-1,h),"YYYY-MM-DD"),Q=A.formatDate(new Date(M,S-1,y),"YYYY-MM-DD");return{startDate:I,endDate:Q}},O=T(()=>{if(!c.value||!u.value)return!0;const l=new Date,{startDate:r,endDate:e}=P(l);return new Date(u.value)>=new Date(e)}),R=()=>{const l=new Date(c.value),r=A.subtractFromDate(l,{days:1}),{startDate:e,endDate:a}=P(r);(c.value!==e||u.value!==a)&&(c.value=e,u.value=a)},f=()=>{if(O.value)return;const l=new Date(u.value),r=A.addToDate(l,{days:1}),{startDate:e,endDate:a}=P(r);(c.value!==e||u.value!==a)&&(c.value=e,u.value=a)},z=()=>{const l=new Date,{startDate:r,endDate:e}=P(l);c.value=r,u.value=e};let K;return he([()=>c.value,()=>b],()=>{clearTimeout(K),K=setTimeout(()=>{F()},200)},{immediate:!0}),ye(()=>{z()}),(l,r)=>(p(),U(ke,{class:"q-py-md"},{default:j(()=>[D.value?(p(),L("div",at,[E(De,{color:"primary",size:"2em"})])):(p(),L("div",je,[n("div",He,[n("div",null,[E(Be,{modelValue:i.value,"onUpdate:modelValue":r[0]||(r[0]=e=>i.value=e),"no-caps":"",rounded:"",unelevated:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"Attendance",value:"attendance"},{label:"Time Off",value:"time_off"},{label:"Overtime",value:"overtime"}]},null,8,["modelValue"])]),n("div",Ge,[n("div",Je,w(v.value),1),E(W,{flat:"",dense:"",round:"",icon:"chevron_left",onClick:R}),E(W,{flat:"",dense:"",round:"",icon:"chevron_right",disable:O.value,onClick:f},null,8,["disable"])]),Ke]),s.value.length>0?(p(),L("div",Xe,[(p(!0),L(H,null,G(_.value,(e,a)=>(p(),U(Ue,{key:a,log:e},null,8,["log"]))),128))])):(p(),L("div",Ze,[E(pe,{name:"event_busy",size:"4em"}),et,tt]))]))]),_:1}))}};export{ft as default};
