import{r as S,o as u,e as V,w as t,f as e,Q as U,I as h,a3 as Q,be as T,a1 as le,aJ as G,ae as oe,M as R,aK as I,a2 as X,O as Z,R as ee,J as i,K as se,c as $,$ as y,a0 as p,a4 as W,a5 as ve,N as B,z as ye,L as ne}from"./index.ca72f247.js";import{Q as he}from"./QChip.ead5e565.js";import{Q as Y,a as be}from"./QTable.6ef48ae6.js";import{Q as re}from"./QBadge.2dc625c4.js";import{Q as De}from"./QPagination.b4c646c0.js";import{u as ie}from"./use-quasar.f96041ec.js";import{u as ce}from"./baker-report.e0d40c7c.js";import{u as ue}from"./stock-delivery.3972e1cd.js";import{a as A}from"./QSelect.a1c4ed00.js";import{a as ae,b as L}from"./QMenu.a8d5f7aa.js";import{Q as ke}from"./QList.7330d34c.js";import{C as de}from"./ClosePopup.77864f63.js";import{u as me}from"./use-dialog-plugin-component.48c22021.js";import{_ as te}from"./plugin-vue_export-helper.21dcd24c.js";import{t as pe}from"./typography-format.6bffeec7.js";import{b as Ce}from"./badge-color.f568cd69.js";import"./QVirtualScroll.eb023b79.js";import"./use-virtual-scroll.645c1690.js";import"./rtl.276c3f1b.js";import"./selection.66bddd9a.js";import"./axios.0019c736.js";import"./position-engine.a63ef796.js";import"./date.7612c2b8.js";const fe=o=>(Z("data-v-318678d0"),o=o(),ee(),o),we=fe(()=>i("div",{class:"text-h5 q-mb-xs"},"Confirm Report",-1)),xe={key:0},qe=fe(()=>i("div",{class:"text-positive text-subtitle1"}," Please confirm again to finalize this report. ",-1)),Se={__name:"ConfirmDialog",setup(o){const{dialogRef:b,onDialogHide:D,onDialogOK:w,onDialogCancel:P}=me(),d=S(!1),f=()=>{d.value?w():d.value=!0};return(g,k)=>(u(),V(X,{ref_key:"dialogRef",ref:b,onHide:I(D)},{default:t(()=>[e(U,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(h,{class:"q-pt-none q-pb-sm"},{default:t(()=>[we,d.value?T("",!0):(u(),Q("p",xe," Are you sure you wanat to confirm this report? "))]),_:1}),d.value?(u(),V(h,{key:0},{default:t(()=>[qe]),_:1})):T("",!0),e(le,{class:"q-mb-sm"}),e(h,null,{default:t(()=>[e(G,{align:"right",class:"q-pt-none"},{default:t(()=>[oe(e(R,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),e(R,{dense:"",label:d.value?"Confirm":"Yes! Confirm",color:"positive",class:"q-btn-rounded q-px-lg",onClick:f},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Qe=te(Se,[["__scopeId","data-v-318678d0"]]);const Re=o=>(Z("data-v-5a3e7851"),o=o(),ee(),o),Ie=Re(()=>i("div",{class:"text-h5 q-mb-xs"},"Decline Report",-1)),Ve={key:0},$e={__name:"DeclinedDialog",setup(o){const{dialogRef:b,onDialogHide:D,onDialogOK:w,onDialogCancel:P}=me(),d=S(!1),f=S(""),g=S(null),k=S(!1),m=async()=>{d.value?(k.value=!0,g.value.validate()&&w({remarks:f.value})):d.value=!0};return(N,c)=>(u(),V(X,{ref_key:"dialogRef",ref:b,onHide:I(D),persistent:""},{default:t(()=>[e(U,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(h,{class:"q-pt-none q-pb-sm"},{default:t(()=>[Ie,d.value?T("",!0):(u(),Q("p",Ve,"Are you sure you want to decline this report?"))]),_:1}),d.value?(u(),V(h,{key:0},{default:t(()=>[e(se,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=r=>f.value=r),type:" textarea",label:"Reason  for declining",filled:"",autogrow:"",dense:"",ref_key:"remarksInput",ref:g,rules:[r=>!!r||"Remarks are required"]},null,8,["modelValue","rules"])]),_:1})):T("",!0),e(le,{class:"q-mb-md"}),e(h,null,{default:t(()=>[e(G,{align:"right",class:"q-pt-none"},{default:t(()=>[oe(e(R,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),e(R,{dense:"",label:d.value?"Submit Decline":"Yes! Decline",color:"negative",class:"q-btn-rounded q-px-lg",onClick:m},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Te=te($e,[["__scopeId","data-v-5a3e7851"]]);const Ne=o=>(Z("data-v-396087c4"),o=o(),ee(),o),Fe={class:"row justify-between"},Be={class:"text-h6"},Ae={key:0},Le={class:"q-mt-md"},Pe=Ne(()=>i("span",{class:"text-grey-7 text-caption"},"Items: ",-1)),Me={key:1,class:"text-caption text-grey-6 q-mt-md"},He={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["fetchAgain"],setup(o,{emit:b}){var O,z;const{capitalizeFirstLetter:D,formatTimestamp:w,formatFullname:P}=pe(),d=ce(),f=$(()=>d.user);console.log("userData in RawMaterialsTable:",f.value);const g=((z=(O=f.value)==null?void 0:O.data)==null?void 0:z.employee_id)||"";console.log("employeeIdsssssssssssssss:",g);const k=ue();$(()=>k.loading),$(()=>k.declinedStocks);const m=o;console.log("props in Transaction view:",m.report);const N=b,c=S(!1),r=ie(),C=()=>{c.value=!0},M=a=>a==null?"No Quantity":parseFloat(a),H=()=>{r.dialog({component:Qe}).onOk(()=>{console.log("Data from child:",m.report),F(m.report)}).onCancel(()=>{console.log("Cancelled")})},K=()=>{r.dialog({component:Te}).onOk(a=>{console.log("Decliene remark from child:",a),j(m.report.id,a)}).onCancel(()=>{console.log("Cancelled")})},F=async a=>{var n,s,x,q;console.log("Confirming report",a);try{r.loading.show();const _=a.items.map(J=>{const ge=parseFloat(J.quantity)||0,_e=parseFloat(J.gram)||0;return{...J,total_grams:ge*_e}});console.log("Per Item Totals:",_);const v={...a,employee_id:g||"0",status:"confirmed",items:_};console.log("Confirm Datasss:",v);const l=await k.confirmDeliveryStocks(v);console.log("responsesssssss",l),(l==null?void 0:l.data)||((n=l==null?void 0:l.data)==null?void 0:n.message)==="Delivery confirmed."?(B.create({type:"positive",message:l.data.message||"Delivery Confirmed Successfully"}),(l==null?void 0:l.status)===200&&(c.value=!1,N("fetchAgain"))):B.create({type:"negative",message:((s=l==null?void 0:l.data)==null?void 0:s.message)||"Failed to Confirm Delivery"}),console.log("responsesss",l)}catch(_){console.log(_),B.create({type:"negative",message:((q=(x=_==null?void 0:_.response)==null?void 0:x.data)==null?void 0:q.message)||"Failed to Confirm Delivery"})}finally{r.loading.hide()}},j=async(a,n)=>{var s,x,q,_;try{r.loading.show(),console.log("declining report",a,"with remarks:",n);const v={id:a,employee_id:g||"0",status:"declined",remarks:n.remarks};console.log("declineData",v);const l=await k.declineDeliveryStocks(v);(l==null?void 0:l.data)||((s=l==null?void 0:l.data)==null?void 0:s.message)==="Delivery declined successfully."?(B.create({type:"positive",message:l.data.message||"Delivery Declined Successfully"}),(l==null?void 0:l.status)===200&&(c.value=!1,N("fetchAgain"))):B.create({type:"negative",message:((x=l==null?void 0:l.data)==null?void 0:x.message)||"Failed to decline delivery"}),console.log("responsesssss",l)}catch(v){console.log(v),B.create({type:"negative",message:((_=(q=v==null?void 0:v.response)==null?void 0:q.data)==null?void 0:_.message)||"Failed to decline delivery. Please try again."})}finally{r.loading.hide()}},E=a=>{switch((a||"").toLowerCase()){case"pending":return"orange-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(a,n)=>(u(),Q(W,null,[e(R,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:C}),e(X,{modelValue:c.value,"onUpdate:modelValue":n[1]||(n[1]=s=>c.value=s)},{default:t(()=>[e(U,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(h,null,{default:t(()=>[i("div",Fe,[i("div",Be,y(I(D)(o.report.from_name)||"-"),1),e(R,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:n[0]||(n[0]=s=>c.value=!1)})])]),_:1}),e(h,null,{default:t(()=>[i("div",null,[i("span",null,"Date: "+y(I(w)(o.report.created_at)||"-"),1)]),i("div",null,[i("span",null,"Created By: "+y(I(P)(o.report.employee)||"-"),1)]),i("div",null,[i("span",null,[p(" Status: "),e(re,{color:E(o.report.status)},{default:t(()=>[p(y(I(D)(o.report.status)||"-"),1)]),_:1},8,["color"])])]),o.report.status==="declined"?(u(),Q("div",Ae,[i("span",null,"Remarks: "+y(o.report.remarks||"No Remarks"),1)])):T("",!0),i("div",Le,[Pe,o.report.items&&o.report.items.length?(u(),V(ke,{key:0,dense:"",separator:"",class:"box"},{default:t(()=>[e(ae,{class:"bg-grey-1 text-weight-bold"},{default:t(()=>[e(L,null,{default:t(()=>[e(A,null,{default:t(()=>[p(" Raw Materials Code ")]),_:1})]),_:1}),e(L,null,{default:t(()=>[e(A,null,{default:t(()=>[p("Stocks Category")]),_:1})]),_:1}),e(L,{side:""},{default:t(()=>[e(A,null,{default:t(()=>[p(" Quantity ")]),_:1})]),_:1})]),_:1}),(u(!0),Q(W,null,ve(o.report.items,(s,x)=>(u(),V(ae,{key:x},{default:t(()=>[e(L,null,{default:t(()=>[e(A,null,{default:t(()=>{var q;return[p(y(((q=s.raw_material)==null?void 0:q.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),e(L,null,{default:t(()=>[e(A,null,{default:t(()=>[p(y(s.category||"No Category"),1)]),_:2},1024)]),_:2},1024),e(L,{side:""},{default:t(()=>[e(A,null,{default:t(()=>[p(y(M(s.quantity||"No Quantity")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(u(),Q("div",Me," No items in this delivery "))])]),_:1}),o.report.status==="pending"?(u(),V(G,{key:0,class:"report-actions q-ma-sm q-gutter-sm",align:"right"},{default:t(()=>[e(R,{color:"negative",label:"Decline",class:"action-btn",onClick:K}),e(R,{color:"positive",label:"Confirm",class:"action-btn",onClick:H})]),_:1})):T("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Oe=te(He,[["__scopeId","data-v-396087c4"]]);const ze={class:"q-mb-md row items-center justify-between"},Ue={key:0,class:"q-pt-md flex flex-center"},Ke={__name:"RawMaterialsDeliveryTable",setup(o){var O,z;const{capitalizeFirstLetter:b,formatTimestamp:D,formatFullname:w}=pe(),{getStatusColor:P,getPremixBadgeStatusColor:d}=Ce(),f=ce(),g=$(()=>f.user);console.log("userData in RawMaterialsTable:",g.value);const k=((z=(O=g.value)==null?void 0:O.device)==null?void 0:z.reference_id)||"",m=ue(),N=ie(),c=$(()=>m.deliveryStocks.data.data);$(()=>m.loading);const r=$(()=>{var a;return((a=m.deliveryStocks)==null?void 0:a.pagination)||{current_page:1,last_page:1,per_page:5}}),C=S(null),M=S("");let H=null;const K=()=>{H&&clearTimeout(H),H=setTimeout(()=>{F(1)},500)},F=async(a=1)=>{N.loading.show();try{await m.fetchDeliveryStocksBranch(k,a,r.value.per_page,M.value),!c.value.length&&C.value&&(C.value=null),C.value&&!c.value.some(n=>n.id===C.value.id)&&(C.value=null),!C.value&&c.value,length>0&&(C.value=c.value[0]),console.log("deliveryListsss",c.value),console.log("pagination",r.value)}catch(n){console.log("Error fetching delivery stocks in component:",n)}finally{N.loading.hide()}};ye(()=>{F(r.value.current_page)});const j=a=>{F(a)},E=[{name:"created_at",label:"Date",align:"left",field:"created_at",format:a=>D(a),sortable:!0},{name:"process_by",label:"Process By",align:"left",field:a=>w((a==null?void 0:a.employee)||"undefined"),sortable:!0},{name:"approved_by",label:"Approved By",align:"left",field:a=>a.status==="pending"?"N/A":w((a==null?void 0:a.approved_by)||"N/A"),sortable:!0},{name:"from",label:"From",align:"left",field:a=>a.from_designation==="Supplier"?"Supplier":b(a.from_name),sortable:!0},{name:"items",label:"Items",field:"items",align:"center",sortable:!0},{name:"status",label:"Status",align:"left",field:"status"},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(a,n)=>(u(),Q(W,null,[i("div",ze,[e(se,{outlined:"",dense:"",placeholder:"Search delivery",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:M.value,"onUpdate:modelValue":[n[0]||(n[0]=s=>M.value=s),K]},{append:t(()=>[e(ne,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]),e(be,{flat:"",columns:E,rows:c.value||[],"row-key":"id",bordered:"",dense:""},{"body-cell-items":t(s=>[e(Y,{props:s},{default:t(()=>[e(he,{outlined:"",color:"primary text-white",dense:""},{default:t(()=>[p(y(s.row.items.length),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":t(s=>[e(Y,{props:s},{default:t(()=>[e(re,{outlined:"",color:I(P)(s.row.status)},{default:t(()=>[p(y(I(b)(s.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(s=>[e(Y,{props:s},{default:t(()=>[i("div",null,[e(Oe,{report:s.row,onFetchAgain:n[1]||(n[1]=x=>F(r.value.current_page))},null,8,["report"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),r.value.last_page>1?(u(),Q("div",Ue,[e(De,{modelValue:r.value.current_page,"onUpdate:modelValue":[n[2]||(n[2]=s=>r.value.current_page=s),j],max:r.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):T("",!0)],64))}},je={class:"text-h6 text-white"},_t={__name:"RawMaterialsDelivery",setup(o){return(b,D)=>(u(),V(U,{flat:""},{default:t(()=>[e(h,{style:{"background-color":"#ef4444"}},{default:t(()=>[i("div",je,[e(ne,{name:"local_shipping"}),p(" Raw Materials Delivery ")])]),_:1}),e(h,{class:"q-gutter-y-md"},{default:t(()=>[i("div",null,[e(Ke)])]),_:1})]),_:1}))}};export{_t as default};
