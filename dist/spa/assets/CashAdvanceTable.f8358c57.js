import{b as Z,Q as F,a as ee}from"./QTable.c8349ac7.js";import{Q as ae}from"./QTr.d4a591cc.js";import{Q as R}from"./QTooltip.7d3fbf11.js";import{c as z,r as f,t as te,u as j,o as p,a3 as S,f as l,M as I,w as s,Q as oe,I as k,ae as le,J as r,e as q,a0 as C,bd as T,a4 as J,a5 as M,$ as _,a1 as ne,K as h,aJ as se,a2 as re,O,R as H,z as ie,bb as D,N}from"./index.a77a9bca.js";import{Q as B}from"./QPopupEdit.9eed8aca.js";import{Q as de}from"./QSpinnerIos.689df5a9.js";import{Q as me}from"./QInnerLoading.ea0a8060.js";import{Q as ue}from"./QPage.ee6adeca.js";import{Q as ce}from"./QSpace.d7a78df8.js";import{a as K,b as L}from"./QMenu.48995790.js";import{Q as pe}from"./QList.80cecbf1.js";import{C as _e}from"./ClosePopup.b255fe3d.js";import{u as fe}from"./employee.a2598ffe.js";import{u as G}from"./cash-advance.6fdda4f5.js";import{_ as ye,a as ve}from"./TableFilter.68997b11.js";import{_ as W}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.8f5b7613.js";import"./use-virtual-scroll.41ae299d.js";import"./rtl.276c3f1b.js";import"./QSelect.aebd2263.js";import"./QChip.aea224e0.js";import"./selection.3e1c4973.js";import"./position-engine.56f31403.js";import"./axios.0b8ebdc6.js";const E=u=>(O("data-v-588595f4"),u=u(),H(),u),ge=E(()=>r("div",{class:"text-h5 q-mr-md"},"\u{1F4B2} Add Cash Advance",-1)),be={style:{position:"relative"}},he={key:0,class:"dropdown-list"},we={class:"row q-col-gutter-md q-mt-lg"},xe={class:"col-12 col-sm-6"},Ve=E(()=>r("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"}," Employee Name: ",-1)),Ae={class:"text-body1 text-weight-medium"},Ce={class:"col-12 col-sm-6"},Qe=E(()=>r("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Position:",-1)),Ne={class:"text-body1 text-weight-medium"},Se={class:"q-gutter-y-md"},qe={__name:"CashAdvanceButton",emits:["created"],setup(u,{emit:y}){const P=y,v=fe(),d=z(()=>v.employees),c=G(),i=f(""),w=f(!1),x=f(!1),g=f(!1),b=()=>{g.value=!0},V=async()=>{i.value.trim()&&(x.value=!0,await v.searchEmployee(i.value),x.value=!1)},U=e=>{n.employee_id=e.id,n.employee_name=`${e.firstname} ${e.middlename?e.middlename.charAt(0)+".":""} ${e.lastname}`,n.employee_position=e.position,i.value=""},n=te({employee_id:"",employee_name:"",employee_position:"",amount:0,reason:"",number_of_payments:0,payment_per_payroll:0,remaining_payments:0});j(()=>[n.amount,n.number_of_payments],([e,t])=>{const a=parseFloat(e)||0,o=parseInt(t)||0;n.payment_per_payroll=o>0?(a/o).toFixed(2):0});const Q=()=>{Object.assign(n,{employee_id:"",employee_name:"",employee_position:"",amount:0,reason:"",number_of_payments:0,payment_per_payroll:0,remaining_payments:0})},$=async()=>{n.remaining_payments=parseFloat(n.amount)||0,w.value=!0;try{await c.createCashAdvance(n),P("created"),g.value=!1,Q()}catch(e){console.error(e)}finally{w.value=!1}};return(e,t)=>(p(),S("div",null,[l(I,{padding:"sm md",label:"Cash Advance",icon:"attach_money",size:"md",class:"gradient-btn text-white",onClick:b}),l(re,{modelValue:g.value,"onUpdate:modelValue":t[5]||(t[5]=a=>g.value=a),persistent:"",position:"right","backdrop-filter":"blur(4px) saturate(150%)"},{default:s(()=>[l(oe,{class:"cash-advance-dialog-card"},{default:s(()=>[l(k,{class:"dialog-header row items-center no-wrap"},{default:s(()=>[ge,l(ce),le(l(I,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[_e]])]),_:1}),l(k,{class:"q-px-lg q-pt-md"},{default:s(()=>[r("div",be,[l(ye,{modelValue:i.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>i.value=a),V],"search-loading":x.value},null,8,["modelValue","search-loading"]),i.value?(p(),S("div",he,[l(pe,{separator:""},{default:s(()=>{var a;return[(a=d.value)!=null&&a.length?T("",!0):(p(),q(K,{key:0},{default:s(()=>[l(L,{class:"text-grey-7"},{default:s(()=>[C("No employee record")]),_:1})]),_:1})),(p(!0),S(J,null,M(d.value,o=>(p(),q(K,{key:o.id,clickable:"",onClick:m=>U(o)},{default:s(()=>[l(L,null,{default:s(()=>[C(_(`${o.firstname} ${o.middlename?o.middlename.charAt(0)+".":""} ${o.lastname}`),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})])):T("",!0)]),r("div",we,[r("div",xe,[Ve,r("div",Ae,_(n.employee_name||"----------"),1)]),r("div",Ce,[Qe,r("div",Ne,_(n.employee_position||"----------"),1)])])]),_:1}),l(ne,{inset:"",class:"q-mx-lg q-my-md"}),l(k,null,{default:s(()=>[r("div",Se,[l(h,{dense:"",modelValue:n.amount,"onUpdate:modelValue":t[1]||(t[1]=a=>n.amount=a),type:"number",outlined:"",label:"Amount"},null,8,["modelValue"]),l(h,{dense:"",modelValue:n.number_of_payments,"onUpdate:modelValue":t[2]||(t[2]=a=>n.number_of_payments=a),type:"number",outlined:"",label:"Number of Payments"},null,8,["modelValue"]),l(h,{modelValue:n.payment_per_payroll,"onUpdate:modelValue":t[3]||(t[3]=a=>n.payment_per_payroll=a),outlined:"",dense:"",readonly:"",label:"Per Payroll"},null,8,["modelValue"]),l(h,{dense:"",modelValue:n.reason,"onUpdate:modelValue":t[4]||(t[4]=a=>n.reason=a),filled:"",type:"textarea",outlined:"",label:"Reason"},null,8,["modelValue"])])]),_:1}),l(se,{align:"right",class:"q-px-lg q-pb-lg"},{default:s(()=>[l(I,{size:"md",padding:"xs md",label:"Save","icon-right":"send",class:"gradient-btn text-white",loading:w.value,onClick:$},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var Pe=W(qe,[["__scopeId","data-v-588595f4"]]);const X=u=>(O("data-v-7c43cec0"),u=u(),H(),u),Ue={class:"row justify-between q-mb-md",align:"right"},$e={class:"row q-gutter-md"},Ie=X(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Amount ",-1)),ke={class:"text-subtitle2 q-mb-sm"},Ee=X(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Reason ",-1)),Fe={class:"text-subtitle2 q-mb-sm"},Re={__name:"CashAdvanceTable",setup(u){const y=G(),P=z(()=>y.cashAdvances),v=f([]),d=f({page:1,rowsPerPage:0,rowsNumber:0}),c=f(!0),i=f("");function w(e){if(e==null||e==="")return"";const t=parseFloat(e);return isNaN(t)?"":Number.isInteger(t)?String(parseInt(t)):String(t)}async function x(e,t){c.value=!0;try{await y.updateAmount(e,t),N.create({message:"Amount updated successfully",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),N.create({message:"Failed to update amount",color:"negative",position:"top",timeout:2e3})}finally{c.value=!1}}async function g(e,t){c.value=!0;try{await y.updateReason(e,t),N.create({message:"Cash Advance reason updated successfully!",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),N.create({message:"Cash Advance reasons updated successfully!",color:"negative",position:"top",timeout:2e3})}finally{c.value=!1}}ie(async()=>{await b()});const b=async(e=1,t=7,a="")=>{try{c.value=!0,await y.fetchCashAdvance(e,t,a);const{data:o,current_page:m,per_page:A,total:Y}=P.value;v.value=o,console.log("Cash Advance",v.value),d.value.page=m,d.value.rowsPerPage=A,d.value.rowsNumber=Y}catch(o){console.log("===================================="),console.log(o),console.log("====================================")}finally{c.value=!1}},V=e=>{const t=A=>A?A.charAt(0).toUpperCase()+A.slice(1).toLowerCase():"",a=e.firstname?t(e.firstname):"No Firstname",o=e.middlename?t(e.middlename).charAt(0)+".":"",m=e.lastname?t(e.lastname):"No Lastname";return`${a} ${o} ${m}`.trim()},U=e=>{b(e.pagination.page,e.pagination.rowsPerPage,e.filter)};j(i,async e=>{await b(d.value.page,d.value.rowsPerPage,e)});const n=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(e),Q=e=>{if(!e)return" - - ";const t=new Date(e);return isNaN(t.getTime())?" - - ":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},$=[{name:"date",label:"Date Created",align:"left",field:e=>Q(e.created_at)},{name:"date",label:"Date Updated",align:"left",field:e=>Q(e.updated_at)},{name:"name",label:"Employee Name",align:"left",field:e=>V(e.employee)},{name:"amount",label:"Total Amount",align:"center",field:e=>n(e.amount)},{name:"number_of_payments",label:"Number of Payments",align:"center",field:e=>e.number_of_payments?e.number_of_payments:0},{name:"payment_per_payroll",label:"Payment per Payroll",align:"center",field:e=>n(e.payment_per_payroll)},{name:"remaining_payments",label:"Remaining Payments",align:"center",field:e=>n(e.remaining_payments)},{name:"reason",label:"Reason",align:"center",field:"reason"}];return(e,t)=>(p(),q(ue,{class:"q-my-md"},{default:s(()=>[r("div",Ue,[r("div",$e,[l(Pe,{onCreated:b})]),l(ve,{modelValue:i.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>i.value=a),i.value]},null,8,["modelValue","onUpdate:modelValue"])]),l(ee,{rows:v.value,columns:$,"row-key":"name",pagination:d.value,"onUpdate:pagination":t[1]||(t[1]=a=>d.value=a),"rows-per-page-options":[5,7,10,0],loading:c.value,filter:i.value,onRequest:U},{header:s(a=>[l(ae,{props:a,class:"gradient-header text-white text-weight-bold"},{default:s(()=>[(p(!0),S(J,null,M(a.cols,o=>(p(),q(Z,{key:o.name,props:a,class:"text-center text-subtitle2"},{default:s(()=>[C(_(o.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-amount":s(a=>[l(F,{props:a,class:"cursor-pointer"},{default:s(()=>[r("span",null,_(a.row.amount?n(a.row.amount):" - - - "),1),l(R,{class:"bg-blue-grey-8"},{default:s(()=>[C("Edit Amount")]),_:1}),l(B,{"onUpdate:modelValue":[o=>x(a.row,o),o=>a.row.amount=o],modelValue:a.row.amount,buttons:"","label-set":"Save","label-cancel":"Close"},{default:s(o=>[Ie,r("div",ke," Name: "+_(V(a.row.employee)),1),l(h,{modelValue:o.value,"onUpdate:modelValue":[m=>o.value=m,m=>o.value=m],"model-value":w(o.value),type:"text",autofocus:"",counter:"",onKeyup:D(o.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","model-value","onKeyup"])]),_:2},1032,["onUpdate:modelValue","modelValue"])]),_:2},1032,["props"])]),"body-cell-reason":s(a=>[l(F,{props:a,class:"cursor-pointer"},{default:s(()=>[r("span",null,_(a.row.reason||" - - - "),1),l(R,{class:"bg-blue-grey-8"},{default:s(()=>[C("Edit Reason")]),_:1}),l(B,{modelValue:a.row.reason,"onUpdate:modelValue":[o=>a.row.reason=o,o=>g(a.row,o)],buttons:"","label-set":"Save","label-cancel":"Close"},{default:s(o=>[Ee,r("div",Fe," Name: "+_(V(a.row.employee)),1),l(h,{modelValue:o.value,"onUpdate:modelValue":m=>o.value=m,type:"text",autofocus:"",counter:"",onKeyup:D(o.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),loading:s(()=>[l(me,{showing:""},{default:s(()=>[l(de,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","pagination","loading","filter"])]),_:1}))}};var ia=W(Re,[["__scopeId","data-v-7c43cec0"]]);export{ia as default};
