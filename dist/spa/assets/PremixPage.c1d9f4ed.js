import{c as I,r as w,o as v,a3 as T,J as a,f as e,M as U,w as t,Q as te,I as B,bg as be,$ as x,aK as S,a0 as d,a4 as X,a5 as ae,e as O,be as le,a2 as _e,O as fe,R as ge,z as we,bH as Pe,u as qe,bo as Qe,d as ke,P as pe,N as re,t as Ve,ae as Se,K as ee,L as ye,aJ as Ie}from"./index.ca72f247.js";import{Q as xe}from"./QBadge.2dc625c4.js";import{Q as ve,a as Re}from"./QTable.6ef48ae6.js";import{Q as Ce}from"./QPagination.b4c646c0.js";import{Q as $e}from"./QBanner.40996a01.js";import{u as ie}from"./baker-report.e0d40c7c.js";import{u as ue}from"./premix.947cc303.js";import{a as f}from"./QSelect.a1c4ed00.js";import{a as z,b as g}from"./QMenu.a8d5f7aa.js";import{Q as oe}from"./QList.7330d34c.js";import{Q as Te,a as Be}from"./QStepper.6e27ab83.js";import{u as Ne}from"./use-quasar.f96041ec.js";import{t as he}from"./typography-format.6bffeec7.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{b as De}from"./badge-color.f568cd69.js";import{Q as Le}from"./QSpace.888473d1.js";import{C as Ue}from"./ClosePopup.77864f63.js";import{api as Fe}from"./axios.0019c736.js";import"./QVirtualScroll.eb023b79.js";import"./use-virtual-scroll.645c1690.js";import"./rtl.276c3f1b.js";import"./selection.66bddd9a.js";import"./QChip.ead5e565.js";import"./position-engine.a63ef796.js";import"./QSlideTransition.13c12359.js";import"./use-panel.54489bd1.js";import"./touch.9135741d.js";import"./use-render-cache.3aae9b27.js";import"./date.7612c2b8.js";const de=s=>(fe("data-v-59122551"),s=s(),ge(),s),Ee={class:"row justify-between"},ze={class:"text-h6"},He=de(()=>a("div",{class:"text-h6",align:"center"},"Premix",-1)),Me=de(()=>a("div",{class:"text-h6",align:"center"},"Ingredients List",-1)),je={class:"text-grey-7 q-mt-xs"},Ae=de(()=>a("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1)),Je={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(s,{emit:Q}){var J,u,_,p,b,Z,ce;const{capitalizeFirstLetter:R,formatTimestamp:F,formatFullname:y,formatRequestQuantity:N,formatQuantity:D}=he(),H=ie(),C=I(()=>H.user);console.log("userData in RawMaterialsTable:",C.value);const P=((u=(J=C.value)==null?void 0:J.data)==null?void 0:u.employee_id)||"",q=((p=(_=C.value)==null?void 0:_.device)==null?void 0:p.reference_id)||"";console.log("employeeId in PremixPage:",P),console.log("branchId in PremixPage:",q);const $=ue();Ne();const k=w(!1),Y=w(!1),i=s;console.log("props in TransactionViewss:",i.report);const M=()=>{k.value=!0},V=o=>{switch(o){case"pending":return"pending-header";case"confirmed":return"confirm-header";case"declined":return"decline-header";case"process":return"process-header";case"completed":return"completed-header";case"to deliver":return"to-deliver-header";case"to receive":return"to-receive-header";case"received":return"receive-header";default:return""}},G=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],j=I(()=>{var o;return(o=i.report.history)!=null&&o.length?G.filter(l=>i.report.history.some(n=>n.status===l.value)):[]}),r=o=>{const l=i.report.history.find(n=>n.status===o);return l?o==="received"?`Received by: ${y(l.employee)}`:o==="pending"?`Requested by: ${y(l.employee)}`:`Handled by: ${y(l.employee)}`:"No handler"},E=((ce=(Z=(b=i.report)==null?void 0:b.branch_premix)==null?void 0:Z.branch_recipe)==null?void 0:ce.ingredient_groups)||"Undefined";console.log("ingrdientsData",E);const A=I(()=>E.map(o=>{const l=parseFloat(o.quantity)*parseFloat(i.report.quantity);return{...o,totalQuantity:l,formattedQuantity:D(l,o.ingredient.unit)}}));console.log("report to proceed",i.report);const L=I(()=>{var o,l;return((l=(o=i.report.history)==null?void 0:o[i.report.history.length-1])==null?void 0:l.status)||null});console.log("lastStatus",L.value);const c=I(()=>j.value.findIndex(o=>o.value===L.value)+1),h=o=>{var l;return(l=i.report.history)==null?void 0:l.some(n=>n.status===o)},m=o=>({pending:"warning",declined:"negative",confirmed:"green",process:"primary",completed:"dark","to deliver":"brown-9","to receive":"amber-10",received:"secondary"})[o]||"grey",W=async()=>{const o={request_premix_id:i.report.id,branch_premix_id:i.report.branch_premix_id,branch_id:i.report.branch_premix.branch_id,employee_id:P,status:"received",notes:"Received Premix",quantity:i.report.quantity,warehouse_id:i.report.warehouse_id,ingredients:A.value.map(l=>({ingredients_id:l.ingredient.id,total_quantity:l.totalQuantity,unit:l.ingredient.unit}))};console.log("payload",o),await $.receivePremix(o),await fetchRequestBranchEmployeePremix(q,P),k.value=!1};return(o,l)=>(v(),T(X,null,[a("div",null,[e(U,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:M})]),e(_e,{modelValue:k.value,"onUpdate:modelValue":l[2]||(l[2]=n=>k.value=n)},{default:t(()=>[e(te,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(B,{class:be(V(s.report.status))},{default:t(()=>[a("div",Ee,[a("div",ze,x(S(R)(s.report.name)||"-"),1),e(U,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:l[0]||(l[0]=n=>k.value=!1)})])]),_:1},8,["class"]),e(B,null,{default:t(()=>{var n,K,me;return[a("div",null,"Date: "+x(S(F)(s.report.created_at)||"-"),1),a("div",null,"Baker: "+x(S(y)(s.report.employee)||"-"),1),a("div",null," Branch: "+x(S(R)((me=(K=(n=s.report)==null?void 0:n.branch_premix)==null?void 0:K.branch_recipe)==null?void 0:me.branch.name)||"-"),1),a("div",null,[d(" Status: "),e(xe,{color:m(s.report.status),outlined:""},{default:t(()=>[d(x(S(R)(s.report.status)||"-"),1)]),_:1},8,["color"])])]}),_:1}),e(B,{class:"q-gutter-y-md"},{default:t(()=>[a("div",null,[He,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(z,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[d("Premix Name")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[d("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(z,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[d(x(S(R)(s.report.name)||"-"),1)]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-h6"},{default:t(()=>[d(x(S(N)(s.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",null,[Me,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(z,null,{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[d(" Code")]),_:1})]),_:1}),e(g,{side:""},{default:t(()=>[e(f,{class:"text-overline"},{default:t(()=>[d("Quantity")]),_:1})]),_:1})]),_:1}),(v(!0),T(X,null,ae(S(E),(n,K)=>(v(),O(z,{key:K},{default:t(()=>[e(g,null,{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[d(x(n.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(g,{side:""},{default:t(()=>[e(f,{class:"text-subtitle1"},{default:t(()=>[d(x(S(D)(n.quantity*s.report.quantity,n.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(Te,{modelValue:c.value,"onUpdate:modelValue":l[1]||(l[1]=n=>c.value=n),animated:"",class:"q-pa-lg"},{default:t(()=>[(v(!0),T(X,null,ae(j.value,(n,K)=>(v(),O(Be,{key:K,name:K+1,title:n.label,color:m(n.value),done:h(n.value),icon:h(n.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[a("div",je,x(r(n.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),L.value==="to receive"?(v(),O(B,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[Ae,e(U,{color:"amber-10",label:"Yes",icon:"check",onClick:W,loading:Y.value},null,8,["loading"])]),_:1})):le("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Ke=se(Je,[["__scopeId","data-v-59122551"]]);const Oe={class:"q-pa-lg flex flex-center"},Ye={key:0,class:"loading-overlay row justify-center items-center"},Ge={key:1,class:"q-pa-md q-gutter-md row justify-center"},We={__name:"PremixTable",setup(s){var r,E,A,L;const{capitalizeFirstLetter:Q,formatTimestamp:R}=he(),{getPremixBadgeStatusColor:F}=De(),y=ie(),N=I(()=>y.user);console.log("userData in RawMaterialsTable:",N.value);const D=((E=(r=N.value)==null?void 0:r.device)==null?void 0:E.reference_id)||"";console.log("branchId in PremixPage:",D);const H=ue(),C=I(()=>H.branchEmployeePremix),P=((L=(A=N.value)==null?void 0:A.data)==null?void 0:L.employee_id)||"";console.log("employeeId in PremixPagess:",P);const q=w(""),$=w(!0),k=w(!0),Y=w(!1),i=w([]),M=w(1),V=w({page:1,rowsPerPage:10,rowsNumber:10,sortBy:"id",descending:!1});we(async()=>{P&&await G(),console.log("premixdatas",C.value)});const G=async()=>{k.value=!0;try{const{page:c,rowsNumber:h,rowsPerPage:m,sortBy:W,descending:J}=V.value,u=await H.fetchRequestBranchEmployeePremix(D,P,c,h,m,W,J);i.value=u.data,console.log("rows.value",i.value),M.value=u.last_page,V.value.rowsPerPage=u.per_page||10,Y.value=i.value.length===0}catch(c){console.error("Error fetching premix report:",c)}k.value=!1};Pe(()=>{P&&G()}),qe(q,()=>{$.value=!0,setTimeout(()=>{$.value=!1})});const j=[{name:"name",label:"Transactions Name",align:"left",field:c=>c.name?Q(c.name):"N/A",format:c=>`${c}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:c=>R(c),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(c,h)=>(v(),T("div",null,[e(Re,{flat:"",columns:j,rows:i.value,"row-key":"id",bordered:"",dense:"",modelValue:V.value,"onUpdate:modelValue":h[0]||(h[0]=m=>V.value=m),pagination:V.value.rowsPerPage,"rows-per-page-options":[10]},{"body-cell-status":t(m=>[e(ve,{props:m},{default:t(()=>[e(xe,{outlined:"",color:S(F)(m.row.status)},{default:t(()=>[d(x(S(Q)(m.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(m=>[e(ve,{props:m},{default:t(()=>[a("div",null,[e(Ke,{report:m.row,onUpdateHistory:c.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["rows","modelValue","pagination"]),a("div",Oe,[e(Ce,{modelValue:V.value.page,"onUpdate:modelValue":[h[1]||(h[1]=m=>V.value.page=m),h[2]||(h[2]=m=>c.reloadTableData(c.userId))],color:"purple",max:M.value,"max-pages":M.value,"boundary-numbers":""},null,8,["modelValue","max","max-pages"])]),k.value?(v(),T("div",Ye,[e(Qe,{size:"50px"})])):le("",!0),Y.value?(v(),T("div",Ge,[e($e,{class:"bg-grey-1",dense:""},{default:t(()=>[d(" No data available ")]),_:1})])):le("",!0)]))}};var Xe=se(We,[["__scopeId","data-v-dda380c0"]]);const Ze=ke("request-premix",()=>{const s=w(null),Q=w([]);return{requestPremix:s,requestPremixes:Q,saveRequestPremix:async F=>{console.log("data request oremix",F),pe.show();try{const y=await Fe.post("/api/request-premix",{requests:F});console.log("response",y.data),re.create({type:"positive",message:"Request Premix successfully"})}catch(y){console.error(y),re.create({type:"negative",message:"Request Premix Error"})}finally{pe.hide()}}}});const ne=s=>(fe("data-v-de78a87a"),s=s(),ge(),s),et={align:"right"},tt=ne(()=>a("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),at={class:"q-ma-md"},lt={key:0,class:"custom-list z-top"},rt={class:"q-mb-sm"},ot=ne(()=>a("div",null,"Premix Name",-1)),st={class:"q-mb-lg"},nt=ne(()=>a("div",null,"Category",-1)),it=ne(()=>a("div",null,"Quantity",-1)),ut={align:"right"},dt={__name:"RequestPremix",setup(s){var A,L,c,h,m,W,J;const Q=w(!1),R=()=>{Q.value=!0},F=ie(),y=I(()=>F.user);console.log("userData in RawMaterialsTable:",y.value);const N=((L=(A=y.value)==null?void 0:A.device)==null?void 0:L.reference_id)||"";console.log("branchId in PremixPage:",N);const D=((m=(h=(c=y.value)==null?void 0:c.device)==null?void 0:h.reference)==null?void 0:m.warehouse_id)||"";console.log("warehouseId in PremixPage:",D);const H=((J=(W=y.value)==null?void 0:W.data)==null?void 0:J.employee_id)||"";console.log("warehouseId in PremixPage:",D);const C=ue(),P=I(()=>C.premixes);I(()=>C.branchEmployeePremix),console.log("premixdatas",P.value),Ze();const q=w([]),$=w(""),k=async()=>{await C.searchPremix($.value,N)},Y=u=>{console.log("data",u),r.branch_premix_id=u.id,r.name=u.name,r.category=u.category,$.value=""},i=u=>u?u.split(" ").map(_=>_.charAt(0).toUpperCase()+_.slice(1).toLowerCase()).join(" "):"",M=I(()=>q.value!==0),V=()=>{const u=q.value.push({branch_premix_id:r.branch_premix_id,warehouse_id:r.warehouse_id,employee_id:r.employee_id,name:r.name,category:r.category,quantity:r.quantity,status:r.status});console.log("premix",u),j()},G=u=>{q.value.splice(u,1)},j=()=>{r.branch_premix_id=0,r.name="",r.category="",r.quantity=0},r=Ve({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:D,employee_id:H,status:"pending"}),E=async()=>{try{console.log("Data sent for premix request:",q.value),await C.saveRequestPremix(q.value,N,H),re.create({type:"positive",message:"Premix request saved successfully!"}),j(),q.value=[],Q.value=!1}catch(u){console.error("Failed to save premix request:",u),re.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(u,_)=>(v(),T(X,null,[a("div",et,[e(U,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:R})]),e(_e,{modelValue:Q.value,"onUpdate:modelValue":_[4]||(_[4]=p=>Q.value=p),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(te,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(B,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[tt,e(Le),Se(e(U,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Ue]])]),_:1}),a("div",at,[e(ee,{modelValue:$.value,"onUpdate:modelValue":[_[0]||(_[0]=p=>$.value=p),k],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[a("div",null,[e(ye,{name:"search"})])]),default:t(()=>[$.value?(v(),T("div",lt,[e(te,null,{default:t(()=>[e(oe,{separator:""},{default:t(()=>{var p;return[(p=P.value)!=null&&p.length?(v(!0),T(X,{key:1},ae(P.value,b=>(v(),O(z,{key:b.id,onClick:Z=>Y(b),clickable:""},{default:t(()=>[e(g,null,{default:t(()=>[e(f,null,{default:t(()=>[d(x(i(b==null?void 0:b.name)),1)]),_:2},1024)]),_:2},1024),e(g,null,{default:t(()=>[e(f,{side:""},{default:t(()=>[d(x(b==null?void 0:b.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(v(),O(z,{key:0},{default:t(()=>[d(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):le("",!0)]),_:1},8,["modelValue"])]),e(B,null,{default:t(()=>[a("div",rt,[ot,e(ee,{modelValue:r.name,"onUpdate:modelValue":_[1]||(_[1]=p=>r.name=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),a("div",st,[nt,e(ee,{modelValue:r.category,"onUpdate:modelValue":_[2]||(_[2]=p=>r.category=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(B,{class:"q-gutter-sm"},{default:t(()=>[a("div",null,[it,e(ee,{modelValue:r.quantity,"onUpdate:modelValue":_[3]||(_[3]=p=>r.quantity=p),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),a("div",ut,[e(U,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:V})])]),_:1}),e(B,null,{default:t(()=>[e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(z,null,{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[d(" Premix Name ")]),_:1})]),_:1}),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[d(" Quantity ")]),_:1})]),_:1}),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[d(" Action")]),_:1})]),_:1})]),_:1}),(v(!0),T(X,null,ae(q.value,(p,b)=>(v(),O(z,{key:b},{default:t(()=>[e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[d(x(p.name),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center"},{default:t(()=>[e(f,null,{default:t(()=>[d(x(p.quantity),1)]),_:2},1024)]),_:2},1024),e(g,{align:"center",side:""},{default:t(()=>[e(f,null,{default:t(()=>[e(U,{onClick:Z=>G(b),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(Ie,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(U,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(U,{class:"glossy",color:"teal",label:"Create",onClick:E,disable:!M.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var ct=se(dt,[["__scopeId","data-v-de78a87a"]]);const mt={class:"text-h6 text-white"},pt={__name:"PremixPage",setup(s){return(Q,R)=>(v(),O(te,{flat:""},{default:t(()=>[e(B,{style:{"background-color":"#ef4444"}},{default:t(()=>[a("div",mt,[e(ye,{name:"scale"}),d(" Premix ")])]),_:1}),e(B,{class:"q-gutter-y-md"},{default:t(()=>[a("div",null,[e(ct)]),a("div",null,[e(Xe)])]),_:1})]),_:1}))}};var Mt=se(pt,[["__scopeId","data-v-626e0eca"]]);export{Mt as default};
