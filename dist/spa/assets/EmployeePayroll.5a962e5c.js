import{r as w,u as ue,o as N,e as R,w as s,f as i,J as E,$ as k,a0 as O,c as b,be as Y,z as Z,Q as re,I as V,ae as B,M as W,bf as ne,a2 as ce,L as J,K as me,a3 as K}from"./index.3a3e1599.js";import{Q as L,a as se,b as de}from"./QTable.0e6f65ea.js";import{Q as G,a as X}from"./QItem.519b456c.js";import{Q as pe}from"./QList.c54c0620.js";import{Q as ye}from"./QMenu.691ea12c.js";import{Q as fe}from"./QSpinnerDots.df1ec7cf.js";import{Q as ge}from"./QPage.ed9e78c9.js";import{C as j}from"./ClosePopup.120fb979.js";import"./EmployeePayroll.vue_vue_type_style_index_0_lang.030dc678.js";import{u as ee}from"./employee.a09f40f9.js";import{u as _e}from"./dtr.9466e86a.js";import{u as te}from"./use-quasar.7cd313aa.js";import{Q as ve}from"./QTooltip.f57d05cb.js";import{u as he}from"./use-dialog-plugin-component.ba6e6c0e.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.e0b3f530.js";import"./use-virtual-scroll.7de15ce7.js";import"./QSelect.010d2813.js";import"./QItemLabel.681d6913.js";import"./QChip.13398464.js";import"./selection.0e35061f.js";import"./position-engine.bd1d251b.js";import"./axios.c34fa188.js";const Te={class:"text-overline"},De={__name:"DTRTable",props:["dtrRows","employeeData"],setup($){const h=$,v=w(h.employeeData);ue(()=>h.employeeData,l=>{v.value=l,console.log("EmployeeData updated inDTR Table:",l)},{immediate:!0}),console.log("dtrRows in DTR Table (initial):",h.dtrRows),console.log("employeeData in DTR Table (initial):",h.employeeData);const x=w({rowsPerPage:0}),y=(l,e)=>{if(!l||!e)return null;const r=l.match(/(\d+):(\d+)\s*(AM|PM)?/i);if(!r)return null;let m=parseInt(r[1],10);const g=parseInt(r[2],10),T=r[3]?r[3].toUpperCase():"";T==="PM"&&m<12?m+=12:T==="AM"&&m===12&&(m=0);const _=new Date(e);return _.setHours(m,g,0,0),_},P=[{name:"number_of_days",required:!0,label:"Number Of Days",align:"center"},{name:"time_in",required:!0,label:"Time In",align:"center",field:"time_in"},{name:"time_out",required:!0,label:"Time Out",align:"center",field:"time_out"},{name:"total_working_hours",required:!0,label:"Total Working Hours",align:"center",field:l=>{if(!l.time_in||!l.time_out||!v.value||!v.value.designation)return"N/A";const e=(F,U)=>`${F}h ${U}m`,r=new Date(l.time_in),m=new Date(l.time_out);if(isNaN(r.getTime())||isNaN(m.getTime()))return"Invalid Time";const g=v.value.designation.time_in,T=v.value.designation.time_out,_=y(g,r),H=y(T,m);if(!_||!H)return"Schedule Error";const I=r>_?r:_,u=m<H?m:H;if(u<=I)return e(0,0);const c=u.getTime()-I.getTime()-1e3*60*60;if(c<0)return e(0,0);const C=Math.floor(c/(1e3*60*60)),S=Math.floor(c%(1e3*60*60)/(1e3*60));return e(C,S)}},{name:"undertime_minutes",required:!0,label:"Undertime / Late",align:"center",field:l=>{if(!l.time_in||!l.time_out||!v.value||!v.value.designation)return"N/A";const e=new Date(l.time_in),r=new Date(l.time_out);if(isNaN(e.getTime())||isNaN(r.getTime()))return"Invalid Time";const m=v.value.designation.time_in,g=v.value.designation.time_out,T=y(m,e),_=y(g,r);if(!T||!_)return"Schedule Error";const H=_.getTime()-T.getTime(),I=Math.floor((H-1e3*60*60)/(1e3*60)),u=e>T?e:T,D=r<_?r:_;let c=0;if(D>u){const U=D.getTime()-u.getTime();c=Math.floor((U-1e3*60*60)/(1e3*60))}const C=I-c;if(C<=0)return"\u2014";const S=Math.floor(C/60),F=C%60;return`${S}h ${F}m`}},{name:"over_time",required:!0,label:"Overtime",align:"center",field:l=>{if(l.ot_status==="approved"&&l.overtime_start&&l.overtime_end){const e=new Date(l.overtime_start),r=new Date(l.overtime_end);if(!isNaN(e.getTime())&&!isNaN(r.getTime())&&r){const m=r.getTime()-e.getTime(),g=Math.floor(m/(1e3*60)),T=Math.floor(g/60),_=g%60;return`${T}h ${_}m`}}return"\u2014"}}];return(l,e)=>(N(),R(se,{flat:"",bordered:"",separator:"cell",rows:h.dtrRows,columns:P,"row-key":"entry",class:"full-height-table",pagination:x.value,"onUpdate:pagination":e[0]||(e[0]=r=>x.value=r),"hide-bottom":""},{"body-cell":s(r=>[i(L,{props:r},{default:s(()=>[E("span",Te,k(r.value),1)]),_:2},1032,["props"])]),"body-cell-number_of_days":s(r=>[i(L,{props:r},{default:s(()=>[O(k(r.pageIndex+1),1)]),_:2},1032,["props"])]),_:1},8,["rows","pagination"]))}};var be=le(De,[["__scopeId","data-v-5d935b29"]]);const Me={__name:"SummaryCard",setup($){const h=ee(),v=b(()=>h.employees),x=Y(),y=te(),P=x.params.employee_id||"",l=w(null),e=w(!0);console.log("Summary Card",P);const r=async()=>{e.value=!0;try{await h.fetchCertianEmployeeWithEmploymentTypeAndDesignation(P),l.value=v.value,console.log("employee Designation Data Loaded:",l.value),l.value&&l.value.designation&&l.value.employment_type||(console.log("Employee designation or employment_type is missing from the fetched employee data!"),y.notify({type:"negative",message:"Employee's regular work hours or salary data not found. Calculations might be inaccurate."}))}catch(m){console.log("Error fetching employee details:",m),y.notify({type:"negative",message:"Error fetching employee details. Please try again."})}finally{e.value=!1}};return Z(async()=>{await r()}),(m,g)=>(N(),R(re,{flat:"",bordered:"",class:"summary-card q-pa-md"},{default:s(()=>[O(" This is card ")]),_:1}))}};var Ne=le(Me,[["__scopeId","data-v-5d1c9738"]]);const Ie={class:"col-auto"},Pe={class:"text-h6 text-weight-bold text-primary"},we={class:"text-subtitle1 text-grey-7"},Ee=E("div",{class:"text-h6 q-mb-sm text-grey-8"},"Daily Time Records",-1),xe={__name:"EmployeeDTRDialog",props:["dtrRecord","employeeId"],setup($){const{dialogRef:h,onDialogHide:v}=he(),x=te(),y=$;console.log("dtrRecordss",y.dtrRecord);const P=ee(),l=b(()=>P.employees),e=w(null),m=Y().params.employee_id||"";console.log("empoyee_id",m);const g=y.dtrRecord.records||[],T=w(!0),_=w(!0);b(()=>{var o,a,n;const t=d=>d?d.charAt(0).toUpperCase()+d.slice(1).toLowerCase():"";if(e.value){const d=e.value.first_name?t(e.value.first_name):"",p=e.value.middle_name?t(e.value.middle_name).charAt(0)+".":"",f=e.value.last_name?t(e.value.last_name):"";return{fullName:`${d} ${p?p+" ":""}${f}`.trim()||"Employee Name N/A",designationTimeIn:(o=e.value.designation)==null?void 0:o.time_in,designationTimeOut:(a=e.value.designation)==null?void 0:a.time_out,employmentTypeSalary:(n=e.value.employment_type)==null?void 0:n.salary}}return{fullName:"Loading Employee...",designationTimeIn:null,designationTimeOut:null,employmentTypeSalary:null}}),b(()=>{var o;const t=(o=e.value)==null?void 0:o.designation;return t&&t.time_in&&t.time_out?`${t.time_in} - ${t.time_out}`:"N/A"});const H=async()=>{_.value=!0;try{await P.fetchCertianEmployeeWithEmploymentTypeAndDesignation(m),e.value=l.value,console.log("Employee Designation Data Loaded:",e.value),e.value&&e.value.designation&&e.value.employment_type||(console.error("Employee designation or employment_type is missing from the fetched employee data!"),x.notify({type:"negative",message:"Employee's regular work hours or salary data not found. Calculations might be inaccurate."}))}catch(t){console.error("Error fetching employee details:",t),x.notify({type:"negative",message:"Error fetching employee details. Please try again."})}finally{_.value=!1}};Z(async()=>{await H()});const I=(t,o)=>{if(!t||!o)return null;const a=t.match(/(\d+):(\d+)\s*(AM|PM)?/i);if(!a)return null;let n=parseInt(a[1],10);const d=parseInt(a[2],10),p=a[3]?a[3].toUpperCase():"";p==="PM"&&n<12?n+=12:p==="AM"&&n===12&&(n=0);const f=new Date(o);return f.setHours(n,d,0,0),f},u=t=>{if(t<0)return"0h 0m";const o=Math.floor(t/60),a=t%60;return`${o}h ${a}m`},D=t=>{const o=t.match(/(\d+)h\s*(\d+)m/);if(o){const a=parseInt(o[1],10),n=parseInt(o[2],10);return a*60+n}return 0},c=b(()=>{let t=0;return!e.value||!e.value.designation?u(0):(g.forEach(o=>{if(!o.time_in||!o.time_out)return;const a=new Date(o.time_in),n=new Date(o.time_out);if(isNaN(a.getTime())||isNaN(n.getTime()))return;const d=e.value.designation.time_in,p=e.value.designation.time_out,f=I(d,a),M=I(p,n);if(!f||!M)return;const Q=a>f?a:f,q=n<M?n:M;if(q<=Q)return;const z=q.getTime()-Q.getTime()-1e3*60*60;z<0||(t+=Math.floor(z/(1e3*60)))}),u(t))}),C=b(()=>{let t=0;return!e.value||!e.value.designation?u(0):(g.forEach(o=>{if(!o.time_in||!o.time_out)return;const a=new Date(o.time_in),n=new Date(o.time_out);if(isNaN(a.getTime())||isNaN(n.getTime()))return;const d=e.value.designation.time_in,p=e.value.designation.time_out,f=I(d,a),M=I(p,n);if(!f||!M)return;const Q=M.getTime()-f.getTime(),q=Math.floor((Q-1e3*60*60)/(1e3*60)),A=a>f?a:f,z=n<M?n:M;let oe=0;if(z>A){const ie=z.getTime()-A.getTime();oe=Math.floor((ie-1e3*60*60)/(1e3*60))}const ae=q-oe;ae>0&&(t+=ae)}),u(t))}),S=b(()=>{let t=0;return g.forEach(o=>{if(o.ot_status==="approved"&&o.overtime_start&&o.overtime_end){const a=new Date(o.overtime_start),n=new Date(o.overtime_end);if(!isNaN(a.getTime())&&!isNaN(n.getTime())&&n>a){const d=n.getTime()-a.getTime();t+=Math.floor(d/(1e3*60))}}}),u(t)});b(()=>{if(!e.value||!e.value.employment_type||!e.value.employment_type.salary)return"\u20B1 0.00";const t=parseFloat(e.value.employment_type.salary);if(isNaN(t)||t<=0)return"\u20B1 0.00 (Invalid Salary)";const a=t/8,n=D(c.value);D(S.value);const p=n/60*a;return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(p)}),b(()=>{if(!e.value||!e.value.employment_type||!e.value.employment_type.salary)return"\u20B1 0.00";const t=parseFloat(e.value.employment_type.salary);if(isNaN(t)||t<=0)return"\u20B1 0.00 (Invalid Salary)";const a=t/8,n=D(c.value),d=D(S.value),p=n/60,f=d/60,M=p*a+f*a;return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(M)}),b(()=>{if(!e.value||!e.value.employment_type||!e.value.employment_type.salary)return"\u20B1 0.00";const t=parseFloat(e.value.employment_type.salary);if(isNaN(t)||t<=0)return"\u20B1 0.00 (Invalid Salary)";const a=t/8,d=D(S.value)/60,p=1,f=d*a*p;return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(f)}),b(()=>{if(!e.value||!e.value.employment_type||!e.value.employment_type.salary)return"\u20B1 0.00";const t=parseFloat(e.value.employment_type.salary);if(isNaN(t)||t<=0)return"\u20B1 0.00 (Invalid Salary)";const a=t/8,p=D(C.value)/60*a;return new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(p)}),b(()=>{const t=D(c.value);console.log("OTWHMinutes",t);const o=D(S.value);console.log("OTOMinutes",o);const a=t+o;return console.log("totalHours",a),u(a)});const F=t=>{const o=p=>p?p.charAt(0).toUpperCase()+p.slice(1).toLowerCase():"",a=t.firstname?o(t.firstname):"No Firstname",n=t.middlename?o(t.middlename).charAt(0)+".":"",d=t.lastname?o(t.lastname):"No Lastname";return`${a} ${n} ${d}`},U=t=>{if(typeof t!="number"&&typeof t!="string")return"\u20B1 0.00";const o=parseFloat(t);return isNaN(o)?"\u20B1 0.00":new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(o)};return b(()=>{var n,d,p,f,M,Q,q,A;console.log("employeesData?.value?.employment_type?.salary :",(d=(n=e==null?void 0:e.value)==null?void 0:n.employment_type)==null?void 0:d.salary),console.log("props?.dtrRecord?.records :",(f=(p=y==null?void 0:y.dtrRecord)==null?void 0:p.records)==null?void 0:f.length);const t=parseFloat(((Q=(M=e==null?void 0:e.value)==null?void 0:M.employment_type)==null?void 0:Q.salary)||"0"),o=((A=(q=y==null?void 0:y.dtrRecord)==null?void 0:q.records)==null?void 0:A.length)||0;if(isNaN(t)||t<=0||o===0)return"\u20B1 0.00";const a=t*o;return U(a)}),(t,o)=>(N(),R(ce,{ref_key:"dialogRef",ref:h,onHide:ne(v),maximized:T.value,"transition-show":"slide-up","transition-hide":"slide-down"},{default:s(()=>[i(re,null,{default:s(()=>[i(V,{class:"row items-center justify-between q-pb-md"},{default:s(()=>[E("div",Ie,[E("div",Pe," Name: "+k(F(e.value||"N/A")),1),E("div",we," From : "+k($.dtrRecord.from)+" \u2022 To: "+k($.dtrRecord.end),1)]),B((N(),R(W,{icon:"close",flat:"",dense:"",round:""},{default:s(()=>[i(ve,{class:"bg-blue-grey-6",delay:200},{default:s(()=>[O("Close")]),_:1})]),_:1})),[[j]])]),_:1}),i(V,{class:"q-pt-sm"},{default:s(()=>[Ee,i(be,{"dtr-rows":ne(g),"employee-data":e.value},null,8,["dtr-rows","employee-data"])]),_:1}),i(V,{class:"q-pt-sm q-pb-md"},{default:s(()=>[i(Ne),i(V,{align:"right"})]),_:1})]),_:1})]),_:1},8,["onHide","maximized"]))}},He={class:"q-pa-md bg-white rounded-borders"},Oe={class:"row items-center q-gutter-md q-mb-lg"},Re={key:0},ke={class:"row items-center no-wrap q-gutter-x-sm"},Ce={key:1,class:"text-center q-pa-xl text-grey-7"},Se=E("div",{class:"text-h6 q-mt-md"},"No Payroll Records",-1),$e=E("p",null," There is no Payroll Cut Off data for this employee in the selected period ",-1),Qe={key:1,class:"text-center q-pa-xl"},lt={__name:"EmployeePayroll",setup($){const h=te(),v=ee(),x=b(()=>v.employees),y=w(null),P=_e(),e=Y().params.employee_id||"",r=w(""),m=b(()=>P.dtrCutOffData),g=w(!0),T=u=>{h.dialog({component:xe,componentProps:{dtrRecord:u}})};Z(async()=>{if(!e){console.error("Employee ID is missing."),h.notify({type:"negative",message:"Could not load data: Employee ID not found."});return}try{await _(),await H()}catch(u){console.error("Error during initial data fetch:",u),h.notify({type:"negative",message:"Failed to load payroll data."})}});const _=async()=>{try{await v.fetchCertianEmployeeWithEmploymentTypeAndDesignation(e),y.value=x.value,console.log("Employee Designation Data Loaded:",y.value),y.value&&y.value.designation?(console.log("Employee's regular designation time_in:",y.value.designation.time_in),console.log("Employee's regular designation time_out:",y.value.designation.time_out)):(console.error("Employee designation or its time_in/time_out is missing from the fetched employee data!"),h.notify({type:"negative",message:"Employee's regular work hours not found. Cannot calculate total hours."}))}catch(u){throw console.error("Error fetching employee details:",u),u}},H=async()=>{g.value=!0;try{await P.fetchDTRPayrollPerCutOff(e),console.log("payrollData (DTR cut-off data):",m.value)}catch(u){throw console.error("Error fetching payroll data:",u),u}finally{g.value=!1}},I=[{name:"payRuns",label:"Pay Runs",field:u=>`${u.from} to ${u.end}`,align:"left",sortable:!0,icon:"description"},{name:"number_of_days",label:"Number Of Days",field:u=>u.records.length,align:"left",sortable:!0,icon:"receipt_long"},{name:"action",label:"Action",field:"status",align:"left",icon:"bolt"}];return(u,D)=>(N(),R(ge,{padding:"",class:"bg-grey-2"},{default:s(()=>[E("div",He,[E("div",Oe,[i(me,{outlined:"",dense:"",modelValue:r.value,"onUpdate:modelValue":D[0]||(D[0]=c=>r.value=c),placeholder:"Search Payroll",class:"col-12 col-md-3"},{prepend:s(()=>[i(J,{name:"search"})]),_:1},8,["modelValue"]),i(W,{unelevated:"",color:"grey-3","text-color":"black",label:"Payment Period",icon:"calendar_today","icon-right":"expand_more","no-caps":""}),i(W,{unelevated:"",color:"grey-3","text-color":"black",label:"Payroll Status",icon:"analytics","icon-right":"expand_more","no-caps":""}),i(W,{unelevated:"",color:"grey-3","text-color":"black",label:"Advance Filter",icon:"filter_list","icon-right":"expand_more","no-caps":""})]),g.value?(N(),K("div",Qe,[i(fe,{color:"primary",size:"2em"})])):(N(),K("div",Re,[m.value.length>0?(N(),R(se,{key:0,rows:m.value,columns:I,"row-key":"id",flat:"",separator:"horizontal","rows-per-page-options":[0],"hide-bottom":"",class:"payroll-table"},{"top-right":s(()=>[i(W,{round:"",unelevated:"",color:"primary",icon:"add","text-color":"white",size:"sm"})]),"header-cell":s(c=>[i(de,{props:c,class:"text-grey-7"},{default:s(()=>[i(J,{name:c.col.icon,size:"1.2em",class:"q-mr-sm"},null,8,["name"]),O(" "+k(c.col.label),1)]),_:2},1032,["props"])]),"body-cell-payRuns":s(c=>[i(L,{props:c},{default:s(()=>[O(k(c.row.from)+" to "+k(c.row.end),1)]),_:2},1032,["props"])]),"body-cell-total_regular_hours":s(c=>[i(L,{props:c},{default:s(()=>[O(k(u.calculateTotalHoursForCutoff(c.row)),1)]),_:2},1032,["props"])]),"body-cell-action":s(c=>[i(L,{props:c},{default:s(()=>[E("div",ke,[i(W,{dense:"",label:"View",color:"dark",unelevated:"","no-caps":"",padding:"xs md",class:"action-button",onClick:C=>T(c.row)},null,8,["onClick"]),i(W,{flat:"",round:"",dense:"",icon:"more_horiz",color:"grey-7",class:"q-ml-auto"},{default:s(()=>[i(ye,null,{default:s(()=>[i(pe,{dense:""},{default:s(()=>[B((N(),R(G,{clickable:""},{default:s(()=>[i(X,null,{default:s(()=>[O("View Details")]),_:1})]),_:1})),[[j]]),B((N(),R(G,{clickable:""},{default:s(()=>[i(X,null,{default:s(()=>[O("Edit")]),_:1})]),_:1})),[[j]]),B((N(),R(G,{clickable:""},{default:s(()=>[i(X,{class:"text-negative"},{default:s(()=>[O("Delete")]),_:1})]),_:1})),[[j]])]),_:1})]),_:1})]),_:1})])]),_:2},1032,["props"])]),_:1},8,["rows"])):(N(),K("div",Ce,[i(J,{name:"event_busy",size:"4em"}),Se,$e]))]))])]),_:1}))}};export{lt as default};
