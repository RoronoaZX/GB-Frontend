import{c as w,r as S,o as _,a2 as V,J as o,f as e,M as k,w as t,Q as G,I as q,_ as f,$ as n,a3 as D,a4 as J,be as de,e as Q,bc as oe,a1 as se,z as ce,u as me,L as W,K as E,d as pe,P as ae,N as le,t as _e,ad as fe,aI as ve,O as ge,R as ye}from"./index.396b8b2c.js";import{Q as ne}from"./QBadge.b7276359.js";import{Q as re,a as he}from"./QTable.336f2f6f.js";import{u as ee}from"./baker-report.6dbeba07.js";import{u as te}from"./premix.eb6b9286.js";import{q as xe}from"./date.b0cc1a6c.js";import{Q as c}from"./rtl.6efb106c.js";import{Q as X,a as $,b as m}from"./QList.7b68912e.js";import{Q as be,a as we}from"./QStepper.742db507.js";import{u as qe}from"./use-quasar.25daf951.js";import{Q as Pe}from"./QSpace.9c790d4b.js";import{C as ke}from"./ClosePopup.f6501674.js";import{api as Se}from"./axios.afda6b01.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.7dc2f0b7.js";import"./use-virtual-scroll.6634378e.js";import"./QSelect.8eb462f8.js";import"./QChip.f4116c04.js";import"./QMenu.d4811eb0.js";import"./selection.aff67700.js";import"./QSlideTransition.f62b04f4.js";import"./use-panel.0dd7c555.js";import"./touch.9135741d.js";const Qe={class:"row justify-between"},Ce={class:"text-h6"},Re=o("div",{class:"text-h6",align:"center"},"Premix",-1),Ve=o("div",{class:"text-h6",align:"center"},"Ingredients List",-1),$e={class:"text-grey-7 q-mt-xs"},Ie=o("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1),Ne={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(d,{emit:b}){var z,A,Y,H,j;const C=ee(),x=w(()=>C.user);console.log("userData in RawMaterialsTable:",x.value);const y=((A=(z=x.value)==null?void 0:z.data)==null?void 0:A.employee_id)||"",I=te();qe();const v=S(!1),N=S(!1),i=d,L=()=>{v.value=!0},g=l=>{const a=r=>r?r.charAt(0).toUpperCase()+r.slice(1).toLowerCase():"";return`${a(l.firstname||"No Firstname")} ${l.middlename?a(l.middlename).charAt(0)+".":""} ${a(l.lastname||"No Lastname")}`},P=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],T=w(()=>{var l;return(l=i.report.history)!=null&&l.length?P.filter(a=>i.report.history.some(r=>r.status===a.value)):[]}),U=l=>{const a=i.report.history.find(r=>r.status===l);return a?l==="received"?`Received by: ${g(a.employee)}`:l==="pending"?`Requested by: ${g(a.employee)}`:`Handled by: ${g(a.employee)}`:"No handler"},B=l=>{const a=Number(l);return isNaN(a)?"":(a%1===0,a.toString())},u=(l,a)=>{if(a==="Pcs")return`${l} pcs`;if(a==="Grams"){if(l>=1e3){let r=l/1e3;return`${r%1===0?r.toString():r.toString().replace(/^0+/,"")} kgs`}return`${l} g`}return`${l} ${a}`},R=((j=(H=(Y=i.report)==null?void 0:Y.branch_premix)==null?void 0:H.branch_recipe)==null?void 0:j.ingredient_groups)||"Undefined";console.log("ingrdientsData",R);const h=w(()=>R.map(l=>{const a=parseFloat(l.quantity)*parseFloat(i.report.quantity);return{...l,totalQuantity:a,formattedQuantity:u(a,l.ingredient.unit)}}));console.log("report to proceed",i.report);const F=w(()=>{var l,a;return((a=(l=i.report.history)==null?void 0:l[i.report.history.length-1])==null?void 0:a.status)||null});console.log("lastStatus",F.value);const s=w(()=>T.value.findIndex(l=>l.value===F.value)+1),K=l=>{var a;return(a=i.report.history)==null?void 0:a.some(r=>r.status===l)},M=l=>({pending:"warning",declined:"red-6",confirmed:"green",process:"primary",completed:"dark","to deliver":"brown-9","to receive":"amber-10",received:"secondary"})[l]||"grey",O=async()=>{const l={request_premix_id:i.report.id,branch_premix_id:i.report.branch_premix_id,branch_id:i.report.branch_premix.branch_id,employee_id:y,status:"receive",notes:"Received Premix",quantity:i.report.quantity,warehouse_id:i.report.warehouse_id,ingredients:h.value.map(a=>({ingredients_id:a.ingredient.id,total_quantity:a.totalQuantity,unit:a.ingredient.unit}))};console.log("payload",l),await I.receivePremix(l),v.value=!1};return(l,a)=>(_(),V(D,null,[o("div",null,[e(k,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:L})]),e(se,{modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=r=>v.value=r)},{default:t(()=>[e(G,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(q,null,{default:t(()=>[o("div",Qe,[o("div",Ce,f(d.report.name),1),e(k,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:a[0]||(a[0]=r=>v.value=!1)})])]),_:1}),e(q,null,{default:t(()=>[o("div",null,"Baker: "+f(g(d.report.employee)),1),o("div",null," Branch: "+f(d.report.branch_premix.branch_recipe.branch.name),1),o("div",null,[n(" Status: "),e(ne,{color:M(d.report.status),outlined:""},{default:t(()=>[n(f(d.report.status),1)]),_:1},8,["color"])])]),_:1}),e(q,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[Re,e(X,{dense:"",separator:"",class:"box"},{default:t(()=>[e($,null,{default:t(()=>[e(m,null,{default:t(()=>[e(c,{class:"text-overline"},{default:t(()=>[n("Premix Name")]),_:1})]),_:1}),e(m,{side:""},{default:t(()=>[e(c,{class:"text-overline"},{default:t(()=>[n("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e($,null,{default:t(()=>[e(m,null,{default:t(()=>[e(c,{class:"text-h6"},{default:t(()=>[n(f(d.report.name),1)]),_:1})]),_:1}),e(m,{side:""},{default:t(()=>[e(c,{class:"text-h6"},{default:t(()=>[n(f(B(d.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",null,[Ve,e(X,{dense:"",separator:"",class:"box"},{default:t(()=>[e($,null,{default:t(()=>[e(m,null,{default:t(()=>[e(c,{class:"text-overline"},{default:t(()=>[n(" Code")]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(c,{class:"text-overline"},{default:t(()=>[n(" Name")]),_:1})]),_:1}),e(m,{side:""},{default:t(()=>[e(c,{class:"text-overline"},{default:t(()=>[n("Quantity")]),_:1})]),_:1})]),_:1}),(_(!0),V(D,null,J(de(R),(r,p)=>(_(),Q($,{key:p},{default:t(()=>[e(m,null,{default:t(()=>[e(c,{class:"text-subtitle1"},{default:t(()=>[n(f(r.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(m,null,{default:t(()=>[e(c,{class:"text-subtitle1",align:"left"},{default:t(()=>[n(f(r.ingredient.name),1)]),_:2},1024)]),_:2},1024),e(m,{side:""},{default:t(()=>[e(c,{class:"text-subtitle1"},{default:t(()=>[n(f(u(r.quantity*d.report.quantity,r.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(be,{modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=r=>s.value=r),animated:"",class:"q-pa-lg"},{default:t(()=>[(_(!0),V(D,null,J(T.value,(r,p)=>(_(),Q(we,{key:p,name:p+1,title:r.label,color:M(r.value),done:K(r.value),icon:K(r.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[o("div",$e,f(U(r.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),F.value==="to receive"?(_(),Q(q,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[Ie,e(k,{color:"amber-10",label:"Yes",icon:"check",onClick:O,loading:N.value},null,8,["loading"])]),_:1})):oe("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}},Le={__name:"PremixTable",setup(d){var U,B;const b=ee(),C=w(()=>b.user);console.log("userData in RawMaterialsTable:",C.value);const x=((B=(U=C.value)==null?void 0:U.device)==null?void 0:B.reference_id)||"";console.log("branchId in PremixPage:",x);const y=te(),I=w(()=>y.branchPremix),v=S(""),N=S(!0);ce(async()=>{x&&await i(),console.log("premixdatas",I.value)});const i=async()=>{await y.fetchRequestBranchPremix(x)};me(v,()=>{N.value=!0,setTimeout(()=>{N.value=!1})});const L=u=>xe.formatDate(u,"MMMM D, YYYY - hh:mm A"),g=u=>u.charAt(0).toUpperCase()+u.slice(1).toLowerCase(),P=u=>{switch(u){case"pending":return"warning";case"declined":return"red-6";case"confirmed":return"green";case"process":return"primary";case"completed":return"dark";case"to deliver":return"brown-9";case"to receive":return"amber-10";case"received":return"secondary";default:return"grey"}},T=[{name:"name",label:"Transactions Name",align:"left",field:u=>u.name,format:u=>`${u}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:u=>L(u),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(u,R)=>(_(),V(D,null,[o("div",null,[e(E,{rounded:"",outlined:"",dense:"",debounce:"300",modelValue:v.value,"onUpdate:modelValue":R[0]||(R[0]=h=>v.value=h),placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[N.value?(_(),Q(W,{key:1,thickness:2,color:"teal",size:"1em"})):(_(),Q(W,{key:0,name:"search"}))]),_:1},8,["modelValue"])]),o("div",null,[e(he,{filter:v.value,flat:"",columns:T,rows:I.value,"row-key":"name"},{"body-cell-status":t(h=>[e(re,{props:h},{default:t(()=>[e(ne,{outlined:"",color:P(h.row.status)},{default:t(()=>[n(f(g(h.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(h=>[e(re,{props:h},{default:t(()=>[o("div",null,[e(Ne,{report:h.row,onUpdateHistory:u.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["filter","rows"])])],64))}},De=pe("request-premix",()=>{const d=S(null),b=S([]);return{requestPremix:d,requestPremixes:b,saveRequestPremix:async x=>{console.log("data request oremix",x),ae.show();try{const y=await Se.post("/api/request-premix",{requests:x});console.log("response",y.data),le.create({type:"positive",message:"Request Premix successfully"})}catch(y){console.error(y),le.create({type:"negative",message:"Request Premix Error"})}finally{ae.hide()}}}});const Z=d=>(ge("data-v-e2a7d75e"),d=d(),ye(),d),Te={align:"right"},Ue=Z(()=>o("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),Be={class:"q-ma-md"},Fe={key:0,class:"custom-list z-top"},Me={class:"q-mb-sm"},ze=Z(()=>o("div",null,"Premix Name",-1)),Ae={class:"q-mb-lg"},Ye=Z(()=>o("div",null,"Category",-1)),He=Z(()=>o("div",null,"Quantity",-1)),je={align:"right"},Ee={__name:"RequestPremix",setup(d){var M,O,z,A,Y,H,j;const b=S(!1),C=()=>{b.value=!0},x=ee(),y=w(()=>x.user);console.log("userData in RawMaterialsTable:",y.value);const I=((O=(M=y.value)==null?void 0:M.device)==null?void 0:O.reference_id)||"";console.log("branchId in PremixPage:",I);const v=((Y=(A=(z=y.value)==null?void 0:z.device)==null?void 0:A.reference)==null?void 0:Y.warehouse_id)||"";console.log("warehouseId in PremixPage:",v);const N=((j=(H=y.value)==null?void 0:H.data)==null?void 0:j.employee_id)||"";console.log("warehouseId in PremixPage:",v);const i=te(),L=w(()=>i.premixes);console.log("premixdatas",L.value),De();const g=S([]),P=S(""),T=async()=>{await i.searchPremix(P.value,I)},U=l=>{console.log("data",l),s.branch_premix_id=l.id,s.name=l.name,s.category=l.category,P.value=""},B=l=>l?l.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"",u=w(()=>g.value!==0),R=()=>{const l=g.value.push({branch_premix_id:s.branch_premix_id,warehouse_id:s.warehouse_id,employee_id:s.employee_id,name:s.name,category:s.category,quantity:s.quantity,status:s.status});console.log("premix",l),F()},h=l=>{g.value.splice(l,1)},F=()=>{s.branch_premix_id=0,s.name="",s.category="",s.quantity=0},s=_e({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:v,employee_id:N,status:"pending"}),K=async()=>{console.log("data send premix",g.value),await i.saveRequestPremix(g.value),F(),g.value=[],b.value=!1};return(l,a)=>(_(),V(D,null,[o("div",Te,[e(k,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:C})]),e(se,{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=r=>b.value=r),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(G,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(q,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[Ue,e(Pe),fe(e(k,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[ke]])]),_:1}),o("div",Be,[e(E,{modelValue:P.value,"onUpdate:modelValue":[a[0]||(a[0]=r=>P.value=r),T],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[o("div",null,[e(W,{name:"search"})]),P.value?(_(),V("div",Fe,[e(G,null,{default:t(()=>[e(X,{separator:""},{default:t(()=>{var r;return[(r=L.value)!=null&&r.length?(_(!0),V(D,{key:1},J(L.value,p=>(_(),Q($,{key:p.id,onClick:ue=>U(p),clickable:""},{default:t(()=>[e(m,null,{default:t(()=>[e(c,null,{default:t(()=>[n(f(B(p==null?void 0:p.name)),1)]),_:2},1024)]),_:2},1024),e(m,null,{default:t(()=>[e(c,{side:""},{default:t(()=>[n(f(p==null?void 0:p.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(_(),Q($,{key:0},{default:t(()=>[n(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):oe("",!0)]),_:1},8,["modelValue"])]),e(q,null,{default:t(()=>[o("div",Me,[ze,e(E,{modelValue:s.name,"onUpdate:modelValue":a[1]||(a[1]=r=>s.name=r),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Ae,[Ye,e(E,{modelValue:s.category,"onUpdate:modelValue":a[2]||(a[2]=r=>s.category=r),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(q,{class:"q-gutter-sm"},{default:t(()=>[o("div",null,[He,e(E,{modelValue:s.quantity,"onUpdate:modelValue":a[3]||(a[3]=r=>s.quantity=r),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),o("div",je,[e(k,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:R})])]),_:1}),e(q,null,{default:t(()=>[e(X,{dense:"",separator:"",class:"box"},{default:t(()=>[e($,null,{default:t(()=>[e(m,{align:"center"},{default:t(()=>[e(c,null,{default:t(()=>[n(" Premix Name ")]),_:1})]),_:1}),e(m,{align:"center"},{default:t(()=>[e(c,null,{default:t(()=>[n(" Quantity ")]),_:1})]),_:1}),e(m,{align:"center",side:""},{default:t(()=>[e(c,null,{default:t(()=>[n(" Action")]),_:1})]),_:1})]),_:1}),(_(!0),V(D,null,J(g.value,(r,p)=>(_(),Q($,{key:p},{default:t(()=>[e(m,{align:"center"},{default:t(()=>[e(c,null,{default:t(()=>[n(f(r.name),1)]),_:2},1024)]),_:2},1024),e(m,{align:"center"},{default:t(()=>[e(c,null,{default:t(()=>[n(f(r.quantity),1)]),_:2},1024)]),_:2},1024),e(m,{align:"center",side:""},{default:t(()=>[e(c,null,{default:t(()=>[e(k,{onClick:ue=>h(p),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(ve,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(k,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(k,{class:"glossy",color:"teal",label:"Create",onClick:K,disable:!u.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var Ke=ie(Ee,[["__scopeId","data-v-e2a7d75e"]]);const Oe={class:"text-h6 text-white"},Ge={__name:"PremixPage",setup(d){return(b,C)=>(_(),Q(G,{flat:""},{default:t(()=>[e(q,{style:{"background-color":"#ef4444"}},{default:t(()=>[o("div",Oe,[e(W,{name:"scale"}),n(" Premix ")])]),_:1}),e(q,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[e(Ke)]),o("div",null,[e(Le)])]),_:1})]),_:1}))}};var ht=ie(Ge,[["__scopeId","data-v-22a44c73"]]);export{ht as default};
