import{c as Y,r as h,t as fe,u as X,z as le,o as _,a3 as V,f as e,w as t,L as ee,Q as te,J as l,I as M,ae,M as A,a0 as s,e as B,K as oe,bc as j,a1 as ye,a4 as L,a5 as Z,$ as y,bd as Qe,aJ as De,a2 as ge,O as ue,R as de,be as Ve,N as ve,aK as _e,d as He}from"./index.4dee972f.js";import{Q as Ce}from"./QTab.14a905c7.js";import{Q as Ae}from"./QTabs.3c7abc4c.js";import{Q as Ge}from"./QTabPanel.ec931824.js";import{Q as Le}from"./QTabPanels.c2c54d58.js";import{Q as Oe}from"./QPage.57dd675b.js";import{Q as Ne}from"./QSkeleton.061d668b.js";import{a as E,b as u}from"./QMenu.cc28e3f5.js";import{Q as K,a as m}from"./QSelect.fa297e11.js";import{Q as ne}from"./QList.10eca19b.js";import{Q as We}from"./QPagination.4ab2f72b.js";import{Q as Ke}from"./QTooltip.df05cd23.js";import{u as be}from"./stock-delivery.86091251.js";import{C as re}from"./ClosePopup.4d75ceed.js";import{u as je}from"./warehouse.dd72124d.js";import{u as Ee}from"./branch.04678090.js";import{u as ze}from"./raw-material.a8a8da4e.js";import{u as ce}from"./use-quasar.156bcf27.js";import{u as Ye}from"./user.4d6a484a.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{u as $e}from"./use-dialog-plugin-component.fccb4480.js";import{q as Fe}from"./date.db82a6e6.js";import{Q as Je,a as Ze}from"./QTable.7b789916.js";import{Q as Xe}from"./QSpinnerIos.2a28d171.js";import{Q as et}from"./QInnerLoading.0296cff1.js";import{api as tt}from"./axios.b9b62565.js";import{Q as lt}from"./QSpace.786498fb.js";import"./QResizeObserver.44cda3bd.js";import"./rtl.276c3f1b.js";import"./use-panel.d667f054.js";import"./touch.9135741d.js";import"./selection.1daf8a21.js";import"./use-render-cache.3aae9b27.js";import"./position-engine.bd4e6659.js";import"./QChip.da6eaa54.js";import"./use-virtual-scroll.8edefa0b.js";import"./employee.e9e4cf60.js";import"./QVirtualScroll.f87b62ae.js";const he=v=>(ue("data-v-4fe356ec"),v=v(),de(),v),at=he(()=>l("div",{class:"text-h6 text-weight-bold text-white"}," Create Stocks Delivery ",-1)),ot={class:"row justify-between text-h6 text-white"},rt=he(()=>l("div",null,"\u{1F69A} Deliver Stocks",-1)),st={class:"row justify-between"},it={class:"q-mt-md"},nt={class:"q-mt-md"},ut={class:"q-my-md"},dt=he(()=>l("div",{class:"q-ma-sm"},"Raw Materials Name",-1)),ct={key:0,class:"row q-mt-md q-gutter-md"},mt={class:"q-mt-sm",align:"right"},pt={__name:"StocksDeliveryButton",emits:["reFetchDelivery"],setup(v,{emit:G}){var Pe,Se,qe;const $=Ye(),x=Y(()=>$.userData);console.log("producttable user data",x.value),(qe=(Se=(Pe=x.value)==null?void 0:Pe.data)==null?void 0:Se.employee)!=null&&qe.id;const T=be(),P=Ee(),r=h([]),f=h(r.value),w=je(),N=h([]),k=h(N.value),R=ze(),S=h([]),d=h([]),U=G,g=ce(),D=fe({name:"",quantity:"",unit:""}),p=[{label:"Supplier",value:"Supplier"},{label:"Warehouse",value:"Warehouse"},{label:"Branch",value:"Branch"}],Q=[{label:"Warehouse",value:"Warehouse"},{label:"Branch",value:"Branch"}];Y(()=>S.value.length>0);const b=h(""),z=[{label:"Sack",value:"sack"},{label:"Can",value:"can"},{label:"Bottle",value:"bottle"},{label:"Box",value:"box"},{label:"Margarine Tub",value:"baro"},{label:"Gallon",value:"gallon"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],a=h({quantity:0,kilo:0,gram:0,price:0,pricePerGram:0,pcs:0}),F={sack:{fields:[{model:"quantity",label:"Sack Quantity",type:"number"},{model:"kilo",label:"Kilo per Sack",type:"number"},{model:"gram",label:"Grams",type:"number",readonly:!0},{model:"price",label:"Price per Sack",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},can:{fields:[{model:"quantity",label:"Can Quantity",type:"number"},{model:"kilo",label:"Kilo per Can",type:"number"},{model:"gram",label:"Grams",type:"number"},{model:"price",label:"Price per Can",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},bottle:{fields:[{model:"quantity",label:"Bottle Quantity",type:"number"},{model:"kilo",label:"Kilo per Bottle",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Bottle",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},box:{fields:[{model:"quantity",label:"Box Quantity",type:"number"},{model:"pcs",label:"Pieces per Box",type:"number"},{model:"kilo",label:"Kilo per Piece",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Pcs",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},gallon:{fields:[{model:"quantity",label:"Gallon Quantity",type:"number"},{model:"kilo",label:"Kilo per Gallon",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Gallon",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]},baro:{fields:[{model:"quantity",label:"Tub Quantity",type:"number"},{model:"kilo",label:"Kilo per Tub",type:"number"},{model:"gram",label:"Grams",readonly:!0},{model:"price",label:"Price per Tub",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]}},q=Y(()=>F[b.value]||null);X(a,i=>{i.kilo&&!isNaN(i.kilo)&&(i.gram=i.kilo*1e3),i.price>0&&i.gram>0?i.pricePerGram=i.price/i.gram:i.pricePerGram=0},{deep:!0});const I=h(!1);h(!1);const me=()=>{!D.name||!b.value||(S.value.push({raw_materials_id:D.name.value,raw_materials_name:D.name.label,unit_type:D.name.suffix,category:b.value,quantity:a.value.quantity,kilo:a.value.kilo,gram:a.value.gram,pcs:a.value.pcs,price_per_unit:a.value.price,price_per_gram:a.value.pricePerGram}),console.log("\u{1F4E6} rawMaterialsGroups:",S.value),D.name="",b.value="",a.value={quantity:0,kilo:0,gram:0,price:0,pricePerGram:0,pcs:0})},H=h(!1),Te=()=>{H.value=!0},Ie=()=>{H.value=!1,Me()},O=h(""),W=h("");le(async()=>{await P.fetchBranches(),r.value=P.branches.map(i=>({label:i.name,value:i.id})),f.value=r.value});const xe=(i,c)=>{c(()=>{const o=i.toLowerCase();f.value=i===""?r.value:r.value.filter(C=>C.label.toLowerCase().includes(o))})};le(async()=>{await w.fetchWarehouses(),N.value=w.warehouses.map(i=>({label:i.name,value:i.id})),k.value=N.value});const we=(i,c)=>{c(()=>{const o=i.toLowerCase();k.value=i===""?N.value:N.value.filter(C=>C.label.toLowerCase().includes(o))})},ie=h(d.value),ke=async()=>{const i=W.value,c=n.to.value||null;try{I.value=!0,await R.fetchBranchWarehouseRawMaterials(i,c),d.value=R.rawMaterials.map(o=>({label:o.name,value:o.id,suffix:o.unit})),ie.value=d.value}catch(o){console.error("Error fetching raw materials: ",o)}finally{I.value=!1}};le(ke);const Me=()=>{D.name="",D.quantity="",D.unit="",b.value="",a.value={quantity:0,kilo:0,gram:0,price:0,pricePerGram:0,pcs:0},S.value=[],n.raw_material_id=0,n.from="",n.from_name="",n.from_designation="",n.to="",n.to_name="",n.to_designation="",n.supplier_name="",n.quantity=0,n.price_per_unit=0,n.remarks="",n.status="pending",O.value="",W.value=""},Re=(i,c)=>{c(()=>{if(i==="")ie.value=d.value;else{const o=i.toLowerCase();ie.value=d.value.filter(C=>C.label.toLowerCase().includes(o))}})},n=fe({raw_material_id:0,from:"",from_name:"",from_designation:"",to:"",to_name:"",to_designation:"",supplier_name:"",quantity:0,price_per_unit:0,remarks:"",status:"Pending"});X(O,i=>{n.from_designation=i,i==="Supplier"?(n.from="",n.from_name="",n.supplier_name=""):(i==="Warehouse"||i==="Branch")&&(n.from="",n.from_name="")}),X(W,i=>{n.to_designation=i,(i==="Warehouse"||i==="Branch")&&(n.to="")}),X([W,()=>n.to],async([i,c])=>{i&&c&&(console.log("\u{1F4E6} Fetching raw materials for:",i,c),await ke())});const Ue=async()=>{var c,o;const i={employee_id:((o=(c=x.value)==null?void 0:c.data)==null?void 0:o.employee_id)||"0",from_designation:O.value,from_id:n.from||null,from_name:O.value==="Supplier"?n.supplier_name:n.from_name,to_designation:W.value,to_id:n.to.value||null,remarks:n.remarks,status:"pending",raw_materials_groups:S.value||[]};console.log("Payloadssss : ",i),g.loading.show();try{console.log("Payload : ",i);const C=await T.createDeliveryStock(i);if(console.log("Response : ",C),C&&C.message==="Raw materials delivery created successfully")U("reFetchDelivery"),Ie();else{console.error("\u274C Failed to save delivery: ",C.message);return}}catch(C){console.error("\u274C Failed to save delivery:",C)}finally{g.loading.hide()}};return(i,c)=>(_(),V(L,null,[e(te,{flat:"",class:"bg-amber-4 q-pa-md rounded-borders-lg row items-center justify-center cursor-pointer custom-shadow-light",onClick:Te,style:{width:"300px"}},{default:t(()=>[e(ee,{name:"add_circle",size:"md",color:"white",class:"q-mr-sm"}),at]),_:1}),l("div",null,[e(ge,{modelValue:H.value,"onUpdate:modelValue":c[11]||(c[11]=o=>H.value=o)},{default:t(()=>[e(te,{style:{width:"820px","max-width":"80vw"}},{default:t(()=>[e(M,{class:"gradient-btn"},{default:t(()=>[l("div",ot,[rt,l("div",null,[ae(e(A,{icon:"close",flat:"",dense:"",round:""},null,512),[[re]])])])]),_:1}),e(M,null,{default:t(()=>[l("div",st,[l("div",null,[l("div",null,[s(" From: "),e(K,{modelValue:O.value,"onUpdate:modelValue":c[0]||(c[0]=o=>O.value=o),options:p,"emit-value":"","map-options":"",label:"Select Source",outlined:"",dense:"",style:{width:"200px"}},null,8,["modelValue"])]),l("div",it,[O.value==="Supplier"?(_(),B(oe,{key:0,modelValue:n.supplier_name,"onUpdate:modelValue":c[1]||(c[1]=o=>n.supplier_name=o),outlined:"",dense:"",label:"Enter Supplier Company Name",style:{width:"350px"}},null,8,["modelValue"])):j("",!0),O.value==="Warehouse"?(_(),B(K,{key:1,modelValue:n.from,"onUpdate:modelValue":[c[2]||(c[2]=o=>n.from=o),c[3]||(c[3]=o=>{const C=k.value.find(pe=>pe.value===o);n.from_name=(C==null?void 0:C.label)||""})],outlined:"",dense:"",flat:"","use-input":"",clearable:"","input-debounce":"0",options:k.value,"emit-value":"","map-options":"",label:"Search Warehouse",onFilter:we,behavior:"menu","hide-dropdown-icon":"",style:{width:"350px"}},null,8,["modelValue","options"])):j("",!0),O.value==="Branch"?(_(),B(K,{key:2,modelValue:n.from,"onUpdate:modelValue":[c[4]||(c[4]=o=>n.from=o),c[5]||(c[5]=o=>{const C=f.value.find(pe=>pe.value===o);n.from_name=(C==null?void 0:C.label)||""})],outlined:"",dense:"",flat:"","use-input":"",clearable:"","input-debounce":"0",options:f.value,"emit-value":"","map-options":"",label:"Search Branch",onFilter:xe,behavior:"menu","hide-dropdown-icon":"",style:{width:"350px"}},null,8,["modelValue","options"])):j("",!0)])]),l("div",null,[l("div",null,[s(" To: "),e(K,{modelValue:W.value,"onUpdate:modelValue":c[6]||(c[6]=o=>W.value=o),options:Q,"emit-value":"","map-options":"",label:"Select Destination",outlined:"",dense:"",style:{width:"200px"}},null,8,["modelValue"]),l("div",nt,[W.value==="Warehouse"?(_(),B(K,{key:0,modelValue:n.to,"onUpdate:modelValue":c[7]||(c[7]=o=>n.to=o),outlined:"",flat:"",dense:"","use-input":"",clearable:"","input-debounce":"0",options:k.value,label:"Search Warehouse",onFilter:we,"hide-dropdown-icon":"",behavior:"menu",style:{width:"350px"}},null,8,["modelValue","options"])):j("",!0),W.value==="Branch"?(_(),B(K,{key:1,modelValue:n.to,"onUpdate:modelValue":c[8]||(c[8]=o=>n.to=o),outlined:"",dense:"",flat:"","use-input":"",clearable:"","input-debounce":"0",options:f.value,label:"Search Branch",onFilter:xe,behavior:"menu","hide-dropdown-icon":"",style:{width:"350px"}},null,8,["modelValue","options"])):j("",!0)])])])])]),_:1}),e(ye,{class:"q-my-md"}),e(M,null,{default:t(()=>[l("div",null,[l("div",null,[e(ne,{dense:"",separator:"",class:"box"},{default:t(()=>[e(E,null,{default:t(()=>[e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Raw Materials Name ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Stocks Category ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Quantity ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Price per Unit ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Price per Gram ")]),_:1})]),_:1}),e(u,{side:""},{default:t(()=>[e(m,null,{default:t(()=>[s("Action")]),_:1})]),_:1})]),_:1}),(_(!0),V(L,null,Z(S.value,o=>(_(),B(E,{key:o.id},{default:t(()=>[e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(y(o.raw_materials_name),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(y(o.category),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(y(o.quantity),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" \u20B1 "+y(o.price_per_unit),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" \u20B1 "+y(o.price_per_gram),1)]),_:2},1024)]),_:2},1024),e(u,{side:""},{default:t(()=>[e(A,{dense:"",flat:"",round:"",icon:"delete",color:"red",onClick:C=>S.value.splice(S.value.indexOf(o),1)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1}),e(M,null,{default:t(()=>[l("div",ut,[dt,e(K,{modelValue:D.name,"onUpdate:modelValue":c[9]||(c[9]=o=>D.name=o),debounce:"100",outlined:"",clearable:"","chips-color":"primary",options:ie.value,dense:"",label:"Raw Materials",behavior:"menu","use-input":"","hide-dropdown-icon":"",onFilter:Re},{"no-option":t(()=>[e(E,null,{default:t(()=>[e(u,{class:"text-grey"},{default:t(()=>[s(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),l("div",null,[l("div",null,[e(K,{modelValue:b.value,"onUpdate:modelValue":c[10]||(c[10]=o=>b.value=o),options:z,"emit-value":"","map-options":"",outlined:"",behavior:"menu",dense:"",label:"Select Category"},null,8,["modelValue"])]),q.value?(_(),V("div",ct,[(_(!0),V(L,null,Z(q.value.fields,o=>(_(),V("div",{key:o.model},[e(oe,{modelValue:a.value[o.model],"onUpdate:modelValue":C=>a.value[o.model]=C,modelModifiers:{number:!0},label:o.label,type:o.type||"text",readonly:o.readonly||!1,prefix:o.prefix||"",outlined:"",flat:"",dense:"",style:Qe({width:o.width||"150px"})},null,8,["modelValue","onUpdate:modelValue","label","type","readonly","prefix","style"])]))),128))])):j("",!0)]),l("div",mt,[e(A,{padding:"sm lg",outline:"",dense:"",icon:"add",color:"purple",onClick:me})])]),_:1}),e(ye,{class:"q-my-md"}),e(De,{align:"right"},{default:t(()=>[ae((_(),B(A,{outline:""},{default:t(()=>[s("Cancel")]),_:1})),[[re]]),e(A,{onClick:Ue},{default:t(()=>[s("Proceed")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64))}};var _t=se(pt,[["__scopeId","data-v-4fe356ec"]]);const ft={class:"row justify-between text-h6 text-dark"},yt=l("div",null,"\u270F\uFE0F Edit Delivery",-1),vt={class:"q-mb-md"},gt={key:0,class:"row q-mt-md q-gutter-md"},bt={__name:"EditDialog",props:{item:{type:Object,required:!0},delivery:{type:Object,required:!0}},setup(v){const{dialogRef:G,onDialogHide:$,onDialogOK:x,onDialogCancel:T}=$e(),P=ce(),r=be();h(!1);const f=v,w=h(f.item.category||""),N=h({...f.item});X(N,p=>{Object.keys(p).forEach(Q=>{["gram","kilo","pcs","price_per_gram","price_per_unit"].includes(Q)&&(N.value[Q]=p[Q])})});const k=[{label:"Sack",value:"sack"},{label:"Can",value:"can"},{label:"Bottle",value:"bottle"},{label:"Box",value:"box"},{label:"Margarine Tub",value:"baro"},{label:"Gallon",value:"gallon"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],R={sack:{fields:[{model:"quantity",label:"Sack Quantity",type:"number"},{model:"kilo",label:"Kilo per Sack",type:"number"},{model:"gram",label:"Grams",type:"number",readonly:!0},{model:"price",label:"Price per Sack",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",type:"number",readonly:!0,prefix:"\u20B1"}]},can:{fields:[{model:"quantity",label:"Can Quantity",type:"number"},{model:"kilo",label:"Kilo per Can",type:"number"},{model:"gram",label:"Grams",type:"number"},{model:"price",label:"Price per Can",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",type:"number",readonly:!0,prefix:"\u20B1"}]},bottle:{fields:[{model:"quantity",label:"Bottle Quantity",type:"number"},{model:"kilo",label:"Kilo per Bottle",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Bottle",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},box:{fields:[{model:"quantity",label:"Box Quantity",type:"number"},{model:"pcs",label:"Pieces per Box",type:"number"},{model:"kilo",label:"Kilo per Piece",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Box",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},gallon:{fields:[{model:"quantity",label:"Gallon Quantity",type:"number"},{model:"kilo",label:"Kilo per Gallon",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Gallon",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]},baro:{fields:[{model:"quantity",label:"Tub Quantity",type:"number"},{model:"kilo",label:"Kilo per Tub",type:"number"},{model:"gram",label:"Grams",readonly:!0},{model:"price",label:"Price per Tub",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]}};console.log("props item",f.item),console.log("props delivery",f.delivery);const S=Y(()=>R[w.value]||null),d=p=>{if(p==null||p==="")return"";const Q=parseFloat(p);return Q===0?"0":Q%1===0?Q.toFixed(0):Q.toFixed(3).replace(/\.?0+$/,"")},U=p=>p==null||isNaN(p)?0:parseFloat(parseFloat(p).toString()),g=fe({quantity:d(f.item.quantity||0),kilo:d(f.item.kilo||0),gram:d(f.item.gram||0),pcs:d(f.item.pcs||0),price:U(f.item.price_per_unit||0),pricePerGram:U(f.item.price_per_gram||0)});X(g,p=>{(p.kilo&&p.quantity&&!isNaN(p.kilo)&&!isNaN(p.quantity)||p.kilo&&!isNaN(p.kilo))&&(p.gram=p.kilo*1e3),p.price>0&&p.gram>0?p.pricePerGram=p.price/p.gram:p.pricePerGram=0},{deep:!0});const D=async()=>{var b,z;const p={quantity:g.quantity,kilo:g.kilo,gram:g.gram,pcs:g.pcs,price:g.price,price_per_gram:g.pricePerGram,category:w.value,raw_material_id:f.item.raw_material.id,delivery_id:f.delivery.id};console.log("\u{1F7E1} Raw edited data (before cleanup):",p);const Q={to_designation:f.delivery.to_designation,quantity:parseFloat(g.quantity||0),kilo:parseFloat(g.kilo||0),gram:parseFloat(g.gram||0),total_grams:parseFloat(g.gram||0),pcs:parseFloat(g.pcs||0),price_per_unit:parseFloat(g.price||0),price_per_gram:parseFloat(g.pricePerGram||0),category:w.value,raw_material_id:f.item.raw_material.id,delivery_su_id:f.item.id,rm_delivery_id:f.delivery.id,item_id:f.item.id,unit_type:f.item.unit_type};P.loading.show();try{console.log("\u{1F7E2} Cleaned data (ready to save):",Q);const a=await r.updateDeliveryStocks(Q);console.log("Resonse data in componnet:",a),a.data&&a.data.message==="Delivery stock item updated successfully."?($(),ve.create({type:"positive",message:((b=a==null?void 0:a.data)==null?void 0:b.message)||"Delivery stock item updated successfully.",timeout:3e3})):ve.create({type:"negative",message:((z=a==null?void 0:a.data)==null?void 0:z.message)||"Failed to update delivery stock item.",timeout:3e3})}catch(a){console.log("error",a)}finally{P.loading.hide()}};return(p,Q)=>(_(),B(ge,{ref_key:"dialogRef",ref:G,onHide:Ve($),persistent:""},{default:t(()=>[e(te,{style:{width:"820px","max-width":"80vw"}},{default:t(()=>[e(M,{class:"gradient-btn"},{default:t(()=>[l("div",ft,[yt,l("div",null,[ae(e(A,{icon:"close",flat:"",dense:"",round:""},null,512),[[re]])])])]),_:1}),e(M,null,{default:t(()=>[l("div",null,"From: "+y(v.delivery.from_name||"N/A"),1),l("div",null,"To: "+y(v.delivery.to_data.name||"N/A"),1)]),_:1}),e(M,null,{default:t(()=>[l("div",vt," Raw Materials Name: "+y(v.item.raw_material.name||"N/A"),1),l("div",null,[e(K,{modelValue:w.value,"onUpdate:modelValue":Q[0]||(Q[0]=b=>w.value=b),options:k,"emit-value":"","map-options":"",outlined:"",behavior:"menu",dense:"",label:"Select Category"},null,8,["modelValue"])]),S.value?(_(),V("div",gt,[(_(!0),V(L,null,Z(S.value.fields,b=>(_(),V("div",{key:b.model},[e(oe,{modelValue:g[b.model],"onUpdate:modelValue":z=>g[b.model]=z,modelModifiers:{number:!0},label:b.label,type:b.type||"text",readonly:b.readonly||!1,prefix:b.prefix||"",outlined:"",flat:"",dense:"",style:Qe({width:b.width||"150px"})},null,8,["modelValue","onUpdate:modelValue","label","type","readonly","prefix","style"])]))),128))])):j("",!0)]),_:1}),e(ye,{class:"q-my-md"}),e(De,{align:"right"},{default:t(()=>[ae((_(),B(A,{outline:""},{default:t(()=>[s("Cancel")]),_:1})),[[re]]),e(A,{onClick:D},{default:t(()=>[s("Save")]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const J=v=>(ue("data-v-5065bb65"),v=v(),de(),v),ht={class:"q-mb-sm",align:"right"},xt={class:"row q-col-gutter-md"},wt={class:"col-xs-12 col-md-4"},kt=J(()=>l("div",{class:"text-h6 text-weight-bold q-mb-sm text-grey-8"}," Delivery Transaction List ",-1)),Pt={class:"row items-center text-caption"},St={key:0,class:"q-pt-md flex flex-center"},qt={class:"col-xs-12 col-md-8"},Ct=J(()=>l("div",{class:"row justify-between"},[l("div",{class:"text-h6 text-weight-bold q-mb-sm text-grey-8"}," Items / Raw materials Delivery Details ")],-1)),Gt={key:0},Nt={class:"row justify-between q-col-gutter-md q-mb-md"},Qt={class:"col-xs-12 col-sm-4"},Dt=J(()=>l("span",{class:"text-grey-7 text-caption"},"From:",-1)),Vt={class:"text-subtitle1 text-weight-bold"},$t={class:""},Ft=J(()=>l("span",{class:"text-grey-7 text-caption"},"To:",-1)),Bt={class:"text-subtitle1 text-weight-bold"},Tt={class:"row justify-between col-xs-12 col-sm-4 q-mb-md"},It={class:""},Mt=J(()=>l("span",{class:"text-grey-7 text-caption"},"Status:",-1)),Rt={class:"row items-center"},Ut={key:0},Ht=J(()=>l("span",{class:"text-grey-7 text-caption"},"Remarks:",-1)),At=J(()=>l("span",{class:"text-grey-7 text-caption"},"Items:",-1)),Lt=J(()=>l("span",null,"Edit",-1)),Ot={key:1,class:"text-caption text-grey-6 q-mt-md"},Wt={key:1,class:"text-h6 text-grey-6 q-my-xl text-center"},Kt={__name:"CreateDeliveryTab",setup(v){const G=be(),$=ce();h(!1);const x=Y(()=>G.deliveryStocks.data),T=Y(()=>G.loading),P=Y(()=>{var a;return((a=G.deliveryStocks)==null?void 0:a.pagination)||{current_page:1,last_page:1,per_page:5}}),r=h(null),f=h("");let w=null;const N=()=>{w&&clearTimeout(w),w=setTimeout(()=>{k(1)},500)},k=async(a=1)=>{$.loading.show();try{await G.fetchDeliveryStocks(a,P.value.per_page,f.value),!x.value.length&&r.value&&(r.value=null),r.value&&!x.value.some(F=>F.id===r.value.id)&&(r.value=null),!r.value&&x.value.length>0&&(r.value=x.value[0]),console.log("deliveryList",x.value),console.log("pagination",P.value)}catch(F){console.error("Error fetching delivery stocks in component:",F),$.notify({type:"negative",message:"Failed to load deliveries. Please try again."})}finally{$.loading.hide()}};le(()=>{k(P.value.current_page)});const R=(a,F)=>{console.log("Editing item:",a),console.log("Parent delivery:",F),$.dialog({component:bt,componentProps:{item:a,delivery:F}})},S=a=>Fe.formatDate(a,"MMM DD, YYYY || hh:mm A"),d=a=>a?a.toLowerCase().split(" ").map(F=>F.charAt(0).toUpperCase()+F.slice(1)).join(" "):"",U=a=>{r.value=a},g=a=>{k(a)},D=a=>a==null?"No Quantity":parseFloat(a),p=a=>a==null?"No Price":`\u20B1${Number(a).toFixed(2)}`,Q=a=>a==null?"No Price":`\u20B1${Number(a).toFixed(4)}`,b=a=>{switch((a||"").toLowerCase()){case"pending":return"warning";case"in progress":return"blue-7";case"confirmed":return"positive";case"declined":return"negative";default:return"grery-6"}},z=a=>{if(!r.value||a.id!==r.value.id)return"";switch(a.to_designation){case"Warehouse":return"selected-delivery-item";case"Branch":return"branch-selected-item";case"Supplier":return"default-selected-item";default:return""}};return(a,F)=>(_(),V(L,null,[l("div",ht,[e(_t,{onReFetchDelivery:k})]),l("div",xt,[l("div",wt,[e(te,{flat:"",class:"bg-white q-pa-md rounded-borders-lg custom-shadow-light"},{default:t(()=>[kt,e(oe,{outlined:"",dense:"",placeholder:"Search delivery",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:f.value,"onUpdate:modelValue":[F[0]||(F[0]=q=>f.value=q),N]},{append:t(()=>[e(ee,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"]),e(ne,{separator:""},{default:t(()=>[T.value?(_(!0),V(L,{key:0},Z(P.value.per_page,q=>(_(),B(E,{key:q},{default:t(()=>[e(u,null,{default:t(()=>[e(Ne,{type:"text",width:"80%"}),e(Ne,{type:"text",width:"40%"})]),_:1})]),_:2},1024))),128)):(_(!0),V(L,{key:1},Z(x.value.data,q=>(_(),B(E,{key:q.id,class:_e(["q-py-md",z(q)]),clickable:"",onClick:I=>U(q)},{default:t(()=>[e(u,null,{default:t(()=>[e(m,{class:"text-subtitle1 text-weight-bold text-grey-8"},{default:t(()=>{var I;return[s(y(d(((I=q.to_data)==null?void 0:I.name)||"N/A")),1)]}),_:2},1024),e(m,{caption:"",class:"text-grey-6"},{default:t(()=>[s(y(q.items.length||"N/A")+" items ",1)]),_:2},1024)]),_:2},1024),e(u,{side:""},{default:t(()=>[e(m,null,{default:t(()=>[s(y(S(q.created_at)||"N/A"),1)]),_:2},1024),l("div",Pt,[e(ee,{name:"fiber_manual_record",color:q.status?b(q.status):"grey-6",size:"8px",class:"q-mr-xs"},null,8,["color"]),l("span",{class:_e(q.status?`text-${b(q.status)}`:"text-grey-6")},y(d(q.status||"No Status")),3)])]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1}),P.value.last_page>1?(_(),V("div",St,[e(We,{modelValue:P.value.current_page,"onUpdate:modelValue":[F[1]||(F[1]=q=>P.value.current_page=q),g],max:P.value.last_page,"max-pages":5,"boundary-links":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):j("",!0)]),_:1})]),l("div",qt,[e(te,{flat:"",class:"bg-white q-pa-md rounded-borders-lg custom-shadow-light"},{default:t(()=>[e(M,null,{default:t(()=>[Ct]),_:1}),e(M,null,{default:t(()=>{var q;return[r.value?(_(),V("div",Gt,[l("div",Nt,[l("div",Qt,[Dt,l("div",Vt,y(d(r.value.from_name||"No Name")),1)]),l("div",$t,[Ft,l("div",Bt,y(d(((q=r.value.to_data)==null?void 0:q.name)||"No Name")),1)])]),l("div",Tt,[l("div",It,[Mt,l("div",Rt,[e(ee,{name:"fiber_manual_record",color:b(r.value.status),size:"10px",class:"q-mr-xs"},null,8,["color"]),l("span",{class:_e(r.value.status?`text-${b(r.value.status)}`:"text-grey-6")},y(d(r.value.status||"No Status")),3)])]),r.value.status==="declined"?(_(),V("div",Ut,[Ht,l("div",null,y(r.value.remarks||"No Remarks"),1)])):j("",!0)]),l("div",null,[At,r.value.items&&r.value.items.length?(_(),B(ne,{key:0,dense:"",separator:"",class:"box"},{default:t(()=>[e(E,{class:"bg-grey-1 text-weight-bold"},{default:t(()=>[e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" Raw Materials Name ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" Raw Materials Code ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" Stocks Category ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" Quantity ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" Price per Unit ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(" Price per Gram ")]),_:1})]),_:1}),e(u,{side:""},{default:t(()=>[e(m,null,{default:t(()=>[s(" Action ")]),_:1})]),_:1})]),_:1}),(_(!0),V(L,null,Z(r.value.items,(I,me)=>(_(),B(E,{key:me},{default:t(()=>[e(u,null,{default:t(()=>[e(m,null,{default:t(()=>{var H;return[s(y(((H=I.raw_material)==null?void 0:H.name)||"No Name"),1)]}),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>{var H;return[s(y(((H=I.raw_material)==null?void 0:H.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(y(I.category||"No Category"),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(y(D(I.quantity)),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(y(p(I.price_per_unit)),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,null,{default:t(()=>[s(y(Q(I.price_per_gram)),1)]),_:2},1024)]),_:2},1024),e(u,{side:""},{default:t(()=>[e(m,null,{default:t(()=>[e(A,{color:"dark",flat:"",round:"",dense:"",icon:"edit",onClick:H=>R(I,r.value)},null,8,["onClick"]),e(Ke,null,{default:t(()=>[Lt]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(_(),V("div",Ot," No items in this delivery "))])])):(_(),V("div",Wt," Select a delivery from the list to see details "))]}),_:1})]),_:1})])])],64))}};var jt=se(Kt,[["__scopeId","data-v-5065bb65"]]);const Et=He("supplier-history",()=>{const v=h(null),G=h([]);return{supplierHistory:v,supplierHistories:G,fetchSupplierHistory:async(x=1,T=3,P="")=>{console.log("store history");try{const r=await tt.get("/api/fetch-supplier-records",{params:{page:x,per_page:T,search:P}});console.log("responsess",r.data),G.value=r.data,console.log("supplierHistoriesssss",G.value)}catch(r){console.log("error",r)}}}});const Be=v=>(ue("data-v-0943efb8"),v=v(),de(),v),zt={class:"text-h6 text-white"},Yt=Be(()=>l("div",{class:"text-h6",align:"center"},"Ingredients List",-1)),Jt=Be(()=>l("strong",null,"Total Cost:",-1)),Zt={__name:"ViewIngredientItems",props:{row:{type:Object,required:!0}},setup(v){const{dialogRef:G,onDialogHide:$}=$e(),x=v;console.log("props",x.row);const T=w=>w?w.split(" ").map(N=>N.charAt(0).toUpperCase()+N.slice(1).toLowerCase()).join(" "):"",P=w=>{const N=parseFloat(w);return isNaN(N)?"\u20B10.00":`\u20B1${N.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}`},r=w=>{const N=parseFloat(w.quantity)||0,k=parseFloat(w.price_per_unit)||0;return N*k},f=w=>w.reduce((k,R)=>{const S=parseFloat(R.quantity)||0,d=parseFloat(R.price_per_unit)||0;return k+S*d},0);return(w,N)=>(_(),B(ge,{ref_key:"dialogRef",ref:G,onHide:Ve($),persistent:"","backdrop-filter":"blur(4px) saturate(150%)"},{default:t(()=>[e(te,{style:{width:"820px","max-width":"80vw"}},{default:t(()=>[e(M,{class:"row bg-background text-h6"},{default:t(()=>[l("div",zt,y(T(v.row.supplier_name||"N/A")),1),e(lt),l("div",null,[ae(e(A,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[re]])])]),_:1}),e(M,null,{default:t(()=>[l("div",null,"Status: "+y(v.row.status||"N/A"),1)]),_:1}),e(M,null,{default:t(()=>[Yt]),_:1}),e(M,null,{default:t(()=>[e(ne,{dense:"",separator:"",class:"box"},{default:t(()=>[e(E,null,{default:t(()=>[e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Raw Materials Name ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Code ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Quantity ")]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" TCPI ")]),_:1})]),_:1}),e(u,{side:""},{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[s(" Total Cost ")]),_:1})]),_:1})]),_:1}),(_(!0),V(L,null,Z(x.row.supplier_ingredients,(k,R)=>(_(),B(E,{key:R},{default:t(()=>[e(u,null,{default:t(()=>[e(m,{class:"text-caption"},{default:t(()=>{var S;return[s(y(((S=k.raw_materials)==null?void 0:S.name)||"N/A"),1)]}),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,{class:"text-caption"},{default:t(()=>{var S;return[s(y(((S=k.raw_materials)==null?void 0:S.code)||"N/A"),1)]}),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,{class:"text-caption"},{default:t(()=>[s(y(parseFloat(k.quantity||"N/A"))+" "+y(k.category||""),1)]),_:2},1024)]),_:2},1024),e(u,null,{default:t(()=>[e(m,{class:"text-caption"},{default:t(()=>[s(y(P(parseFloat(k.price_per_unit||"N/A"))),1)]),_:2},1024)]),_:2},1024),e(u,{side:""},{default:t(()=>[e(m,{class:"text-caption"},{default:t(()=>[s(y(P(r(k)||"N/A")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(M,{class:"q-mt-md text-right text-subtitle1"},{default:t(()=>[Jt,s(" "+y(P(f(x.row.supplier_ingredients)||"\u20B10.00")),1)]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Xt=se(Zt,[["__scopeId","data-v-0943efb8"]]);const el={__name:"SupplierHistoryTab",setup(v){const G=Et(),$=Y(()=>G.supplierHistories),x=h([]),T=ce(),P=h(!1),r=h({page:1,rowsPerPage:0,rowsNumber:0}),f=h(""),w=async(d=0,U=3,g="")=>{console.log("Fetching recipe costs in store...");try{P.value=!0,$.value=await G.fetchSupplierHistory(d,U,g),console.log("supplierHistories",$.value);const{data:D,current_page:p,per_page:Q,total:b}=$.value;x.value=D,console.log("supplierHistoriesData.value",x.value),r.value.page=p,console.log("pagination.value.page",r.value.page),r.value.rowsPerPage=Q,console.log("pagination.value.rowsPerPage",r.value.rowsPerPage),r.value.rowsNumber=b,console.log("pagination.value.rowsNumber",r.value.rowsNumber)}catch(D){console.log("Error fetching recipe costs:",D),ve.create({message:"Error fetching recipe costs",color:"negative",position:"top"})}finally{P.value=!1}};le(w);const N=d=>{console.log("props",d),w(d.pagination.page,d.pagination.rowsPerPage,d.filter)},k=d=>{console.log("Editing row:",d),T.dialog({component:Xt,componentProps:{row:d}})},R=d=>Fe.formatDate(d,"MMM DD, YYYY || hh:mm A"),S=[{name:"data",required:!0,label:"Date",align:"center",field:d=>d.created_at?R(d.created_at):"N/A"},{name:"supplier",required:!0,label:"Supplier",align:"center",field:d=>d.supplier_name},{name:"status",required:!0,label:"Status",align:"center",field:d=>d.status},{name:"number_of_items",required:!0,label:"Items",align:"center"}];return(d,U)=>(_(),V(L,null,[l("div",null,[e(oe,{class:"q-pb-lg q-pl-mb",outlined:"",placeholder:"Search",debounce:"1000",flat:"",dense:"",rounded:"",style:{width:"450px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[e(ee,{name:"search"})]),_:1})]),e(Ze,{class:"table-container sticky-header",flat:"","row-key":"id",columns:S,rows:x.value||[],loading:P.value,pagination:r.value,"onUpdate:pagination":U[0]||(U[0]=g=>r.value=g),"rows-per-page-options":[3,5,7,10,0],filter:f.value,onRequest:N},{"body-cell-number_of_items":t(g=>[e(Je,{props:g},{default:t(()=>[e(A,{flat:"",dense:"",color:"primary",label:`${g.row.supplier_ingredients.length} ${g.row.supplier_ingredients.length===1?"item":"items"}`,onClick:D=>k(g.row)},null,8,["label","onClick"])]),_:2},1032,["props"])]),loading:t(()=>[e(et,{showing:""},{default:t(()=>[e(Xe,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","loading","pagination","filter"])],64))}};var tl=se(el,[["__scopeId","data-v-93fd61a0"]]);const ll=v=>(ue("data-v-3184aad5"),v=v(),de(),v),al={class:"q-pa-md q-gutter-sm flex flex-column items-center"},ol=ll(()=>l("div",{class:"text-weight-bold"},"Create Delivery",-1)),rl={__name:"StocksPage",setup(v){const G=h("delivery");return($,x)=>(_(),B(Oe,{class:"q-pa-md bg-grey-2"},{default:t(()=>[l("div",null,[e(Ae,{modelValue:G.value,"onUpdate:modelValue":x[0]||(x[0]=T=>G.value=T),dense:"",outline:"",flat:"","no-caps":"","inline-label":"",class:"user-tab justify-center q-ma-md",align:"justify","active-color":"teal","indicator-color":"teal"},{default:t(()=>[e(Ce,{class:"text-grey-7",name:"delivery"},{default:t(()=>[l("div",al,[e(ee),ol])]),_:1}),e(Ce,{class:"text-grey-7",name:"supplier_history",label:"Supplier History"})]),_:1},8,["modelValue"])]),e(Le,{modelValue:G.value,"onUpdate:modelValue":x[1]||(x[1]=T=>G.value=T),animated:"",class:"bg-grey-2"},{default:t(()=>[e(Ge,{name:"delivery"},{default:t(()=>[e(jt)]),_:1}),e(Ge,{name:"supplier_history"},{default:t(()=>[e(tl)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};var Kl=se(rl,[["__scopeId","data-v-3184aad5"]]);export{Kl as default};
