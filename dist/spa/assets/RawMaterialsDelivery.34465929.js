import{r as x,o as m,e as Q,w as a,f as e,Q as B,I as b,a3 as q,bc as V,a1 as te,aJ as J,ae,M as S,be as le,a2 as W,O as G,R as X,J as d,K as oe,c as I,$ as k,a0 as y,a4 as E,a5 as _e,N as L,z as ve,L as se}from"./index.34f1c30e.js";import{Q as ye}from"./QChip.80192650.js";import{Q as K,a as he}from"./QTable.363486c5.js";import{Q as ne}from"./QBadge.77119e2d.js";import{Q as be}from"./QPagination.89fbf49a.js";import{q as re}from"./date.35056e0b.js";import{u as ie}from"./use-quasar.2b41859c.js";import{u as ce}from"./baker-report.b730e790.js";import{u as ue}from"./stock-delivery.e234e633.js";import{a as T}from"./QSelect.35f6f123.js";import{a as ee,b as A}from"./QMenu.63748e61.js";import{Q as De}from"./QList.98393124.js";import{C as de}from"./ClosePopup.1fc7f477.js";import{u as me}from"./use-dialog-plugin-component.272cda5c.js";import{_ as Z}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.ccdb79ef.js";import"./use-virtual-scroll.22e72c6a.js";import"./rtl.276c3f1b.js";import"./selection.15593a2c.js";import"./axios.07af794e.js";import"./position-engine.cf0283ea.js";const fe=s=>(G("data-v-318678d0"),s=s(),X(),s),ke=fe(()=>d("div",{class:"text-h5 q-mb-xs"},"Confirm Report",-1)),Ce={key:0},we=fe(()=>d("div",{class:"text-positive text-subtitle1"}," Please confirm again to finalize this report. ",-1)),xe={__name:"ConfirmDialog",setup(s){const{dialogRef:C,onDialogHide:D,onDialogOK:w,onDialogCancel:h}=me(),i=x(!1),c=()=>{i.value?w():i.value=!0};return(f,u)=>(m(),Q(W,{ref_key:"dialogRef",ref:C,onHide:le(D)},{default:a(()=>[e(B,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:a(()=>[e(b,{class:"q-pt-none q-pb-sm"},{default:a(()=>[ke,i.value?V("",!0):(m(),q("p",Ce," Are you sure you wanat to confirm this report? "))]),_:1}),i.value?(m(),Q(b,{key:0},{default:a(()=>[we]),_:1})):V("",!0),e(te,{class:"q-mb-sm"}),e(b,null,{default:a(()=>[e(J,{align:"right",class:"q-pt-none"},{default:a(()=>[ae(e(S,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),e(S,{dense:"",label:i.value?"Confirm":"Yes! Confirm",color:"positive",class:"q-btn-rounded q-px-lg",onClick:c},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var qe=Z(xe,[["__scopeId","data-v-318678d0"]]);const Se=s=>(G("data-v-5a3e7851"),s=s(),X(),s),Qe=Se(()=>d("div",{class:"text-h5 q-mb-xs"},"Decline Report",-1)),Re={key:0},$e={__name:"DeclinedDialog",setup(s){const{dialogRef:C,onDialogHide:D,onDialogOK:w,onDialogCancel:h}=me(),i=x(!1),c=x(""),f=x(null),u=x(!1),g=async()=>{i.value?(u.value=!0,f.value.validate()&&w({remarks:c.value})):i.value=!0};return(M,R)=>(m(),Q(W,{ref_key:"dialogRef",ref:C,onHide:le(D),persistent:""},{default:a(()=>[e(B,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:a(()=>[e(b,{class:"q-pt-none q-pb-sm"},{default:a(()=>[Qe,i.value?V("",!0):(m(),q("p",Re,"Are you sure you want to decline this report?"))]),_:1}),i.value?(m(),Q(b,{key:0},{default:a(()=>[e(oe,{modelValue:c.value,"onUpdate:modelValue":R[0]||(R[0]=$=>c.value=$),type:" textarea",label:"Reason  for declining",filled:"",autogrow:"",dense:"",ref_key:"remarksInput",ref:f,rules:[$=>!!$||"Remarks are required"]},null,8,["modelValue","rules"])]),_:1})):V("",!0),e(te,{class:"q-mb-md"}),e(b,null,{default:a(()=>[e(J,{align:"right",class:"q-pt-none"},{default:a(()=>[ae(e(S,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[de]]),e(S,{dense:"",label:i.value?"Submit Decline":"Yes! Decline",color:"negative",class:"q-btn-rounded q-px-lg",onClick:g},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Ie=Z($e,[["__scopeId","data-v-5a3e7851"]]);const Ve=s=>(G("data-v-63ad10d8"),s=s(),X(),s),Me={class:"row justify-between"},Ne={class:"text-h6"},Le={key:0},Te={class:"q-mt-md"},Ae=Ve(()=>d("span",{class:"text-grey-7 text-caption"},"Items: ",-1)),Fe={key:1,class:"text-caption text-grey-6 q-mt-md"},Ye={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["fetchAgain"],setup(s,{emit:C}){var Y,F;const D=ce(),w=I(()=>D.user);console.log("userData in RawMaterialsTable:",w.value);const h=((F=(Y=w.value)==null?void 0:Y.data)==null?void 0:F.employee_id)||"";console.log("employeeIdsssssssssssssss:",h);const i=ue();I(()=>i.loading),I(()=>i.declinedStocks);const c=s;console.log("props in Transaction view:",c.report);const f=C,u=x(!1),g=ie(),M=()=>{u.value=!0},R=n=>n?n.toLowerCase().split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):"",$=n=>re.formatDate(n,"MMMM D, YYYY - hh:mm A"),P=n=>n==null?"No Quantity":parseFloat(n),N=()=>{g.dialog({component:qe}).onOk(()=>{console.log("Data from child:",c.report),z(c.report)}).onCancel(()=>{console.log("Cancelled")})},U=()=>{g.dialog({component:Ie}).onOk(n=>{console.log("Decliene remark from child:",n),H(c.report.id,n)}).onCancel(()=>{console.log("Cancelled")})},z=async n=>{var t,l,r,v;console.log("Confirming report",n);try{g.loading.show();const _=n.items.map(j=>{const pe=parseFloat(j.quantity)||0,ge=parseFloat(j.gram)||0;return{...j,total_grams:pe*ge}});console.log("Per Item Totals:",_);const p={...n,employee_id:h||"0",status:"confirmed",items:_};console.log("Confirm Datasss:",p);const o=await i.confirmDeliveryStocks(p);console.log("responsesssssss",o),(o==null?void 0:o.data)||((t=o==null?void 0:o.data)==null?void 0:t.message)==="Delivery confirmed."?(L.create({type:"positive",message:o.data.message||"Delivery Confirmed Successfully"}),(o==null?void 0:o.status)===200&&(u.value=!1,f("fetchAgain"))):L.create({type:"negative",message:((l=o==null?void 0:o.data)==null?void 0:l.message)||"Failed to Confirm Delivery"}),console.log("responsesss",o)}catch(_){console.log(_),L.create({type:"negative",message:((v=(r=_==null?void 0:_.response)==null?void 0:r.data)==null?void 0:v.message)||"Failed to Confirm Delivery"})}finally{g.loading.hide()}},H=async(n,t)=>{var l,r,v,_;try{g.loading.show(),console.log("declining report",n,"with remarks:",t);const p={id:n,employee_id:h||"0",status:"declined",remarks:t.remarks};console.log("declineData",p);const o=await i.declineDeliveryStocks(p);(o==null?void 0:o.data)||((l=o==null?void 0:o.data)==null?void 0:l.message)==="Delivery declined successfully."?(L.create({type:"positive",message:o.data.message||"Delivery Declined Successfully"}),(o==null?void 0:o.status)===200&&(u.value=!1,f("fetchAgain"))):L.create({type:"negative",message:((r=o==null?void 0:o.data)==null?void 0:r.message)||"Failed to decline delivery"}),console.log("responsesssss",o)}catch(p){console.log(p),L.create({type:"negative",message:((_=(v=p==null?void 0:p.response)==null?void 0:v.data)==null?void 0:_.message)||"Failed to decline delivery. Please try again."})}finally{g.loading.hide()}},O=n=>{switch((n||"").toLowerCase()){case"pending":return"orange-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(n,t)=>(m(),q(E,null,[e(S,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:M}),e(W,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l)},{default:a(()=>[e(B,{style:{width:"700px","max-width":"80vw"}},{default:a(()=>[e(b,null,{default:a(()=>[d("div",Me,[d("div",Ne,k(R(s.report.from_name)),1),e(S,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:t[0]||(t[0]=l=>u.value=!1)})])]),_:1}),e(b,null,{default:a(()=>[d("div",null,[d("span",null,"Date: "+k($(s.report.created_at)),1)]),d("div",null,[d("span",null,[y(" Status: "),e(ne,{color:O(s.report.status)},{default:a(()=>[y(k(R(s.report.status)),1)]),_:1},8,["color"])])]),s.report.status==="declined"?(m(),q("div",Le,[d("span",null,"Remarks: "+k(s.report.remarks||"No Remarks"),1)])):V("",!0),d("div",Te,[Ae,s.report.items&&s.report.items.length?(m(),Q(De,{key:0,dense:"",separator:"",class:"box"},{default:a(()=>[e(ee,{class:"bg-grey-1 text-weight-bold"},{default:a(()=>[e(A,null,{default:a(()=>[e(T,null,{default:a(()=>[y(" Raw Materials Code ")]),_:1})]),_:1}),e(A,null,{default:a(()=>[e(T,null,{default:a(()=>[y("Stocks Category")]),_:1})]),_:1}),e(A,{side:""},{default:a(()=>[e(T,null,{default:a(()=>[y(" Quantity ")]),_:1})]),_:1})]),_:1}),(m(!0),q(E,null,_e(s.report.items,(l,r)=>(m(),Q(ee,{key:r},{default:a(()=>[e(A,null,{default:a(()=>[e(T,null,{default:a(()=>{var v;return[y(k(((v=l.raw_material)==null?void 0:v.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),e(A,null,{default:a(()=>[e(T,null,{default:a(()=>[y(k(l.category||"No Category"),1)]),_:2},1024)]),_:2},1024),e(A,{side:""},{default:a(()=>[e(T,null,{default:a(()=>[y(k(P(l.quantity||"No Quantity")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(m(),q("div",Fe," No items in this delivery "))])]),_:1}),s.report.status==="pending"?(m(),Q(J,{key:0,class:"report-actions q-ma-sm q-gutter-sm",align:"right"},{default:a(()=>[e(S,{color:"negative",label:"Decline",class:"action-btn",onClick:U}),e(S,{color:"positive",label:"Confirm",class:"action-btn",onClick:N})]),_:1})):V("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Be=Z(Ye,[["__scopeId","data-v-63ad10d8"]]);const Pe={class:"q-mb-md row items-center justify-between"},Ue={key:0,class:"q-pt-md flex flex-center"},ze={__name:"RawMaterialsDeliveryTable",setup(s){var F,n;const C=ce(),D=I(()=>C.user);console.log("userData in RawMaterialsTable:",D.value);const w=((n=(F=D.value)==null?void 0:F.device)==null?void 0:n.reference_id)||"",h=ue(),i=ie(),c=I(()=>h.deliveryStocks.data.data);I(()=>h.loading);const f=I(()=>{var t;return((t=h.deliveryStocks)==null?void 0:t.pagination)||{current_page:1,last_page:1,per_page:5}}),u=x(null),g=x("");let M=null;const R=t=>t?t.toLowerCase().split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" "):"",$=t=>{const l=p=>p?p.charAt(0).toUpperCase()+p.slice(1).toLowerCase():"",r=t.firstname?l(t.firstname):"No Firstname",v=t.middlename?l(t.middlename).charAt(0)+".":"",_=t.lastname?l(t.lastname):"No Lastname";return`${r} ${v} ${_}`},P=()=>{M&&clearTimeout(M),M=setTimeout(()=>{N(1)},500)},N=async(t=1)=>{i.loading.show();try{await h.fetchDeliveryStocksBranch(w,t,f.value.per_page,g.value),!c.value.length&&u.value&&(u.value=null),u.value&&!c.value.some(l=>l.id===u.value.id)&&(u.value=null),!u.value&&c.value,length>0&&(u.value=c.value[0]),console.log("deliveryListsss",c.value),console.log("pagination",f.value)}catch(l){console.log("Error fetching delivery stocks in component:",l)}finally{i.loading.hide()}};ve(()=>{N(f.value.current_page)});const U=t=>{N(t)},z=[{name:"created_at",label:"Date",align:"left",field:"created_at",format:t=>H(t),sortable:!0},{name:"process_by",label:"Process By",align:"left",field:t=>$((t==null?void 0:t.employee)||"undefined"),sortable:!0},{name:"from",label:"From",align:"left",field:t=>t.from_designation==="Supplier"?"Supplier":R(t.from_name),sortable:!0},{name:"items",label:"Items",field:"items",align:"center",sortable:!0},{name:"status",label:"Status",align:"left",field:"status"},{name:"view",align:"right",label:"View",field:"view",sortable:!0}],H=t=>re.formatDate(t,"MMMM D, YYYY - hh:mm A"),O=t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),Y=t=>{switch((t||"").toLowerCase()){case"pending":return"orange-7";case"in progress":return"blue-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(t,l)=>(m(),q(E,null,[d("div",Pe,[e(oe,{outlined:"",dense:"",placeholder:"Search delivery",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:g.value,"onUpdate:modelValue":[l[0]||(l[0]=r=>g.value=r),P]},{append:a(()=>[e(se,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]),e(he,{flat:"",columns:z,rows:c.value||[],"row-key":"id",bordered:"",dense:""},{"body-cell-items":a(r=>[e(K,{props:r},{default:a(()=>[e(ye,{outlined:"",color:"primary text-white",dense:""},{default:a(()=>[y(k(r.row.items.length),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":a(r=>[e(K,{props:r},{default:a(()=>[e(ne,{outlined:"",color:Y(r.row.status)},{default:a(()=>[y(k(O(r.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":a(r=>[e(K,{props:r},{default:a(()=>[d("div",null,[e(Be,{report:r.row,onFetchAgain:l[1]||(l[1]=v=>N(f.value.current_page))},null,8,["report"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),f.value.last_page>1?(m(),q("div",Ue,[e(be,{modelValue:f.value.current_page,"onUpdate:modelValue":[l[2]||(l[2]=r=>f.value.current_page=r),U],max:f.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):V("",!0)],64))}},He={class:"text-h6 text-white"},mt={__name:"RawMaterialsDelivery",setup(s){return(C,D)=>(m(),Q(B,{flat:""},{default:a(()=>[e(b,{style:{"background-color":"#ef4444"}},{default:a(()=>[d("div",He,[e(se,{name:"local_shipping"}),y(" Raw Materials Delivery ")])]),_:1}),e(b,{class:"q-gutter-y-md"},{default:a(()=>[d("div",null,[e(ze)])]),_:1})]),_:1}))}};export{mt as default};
