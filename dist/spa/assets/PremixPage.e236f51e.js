import{c as q,r as h,o as f,a2 as S,J as o,f as e,M as $,w as t,Q as G,I as V,_ as v,$ as i,a3 as H,a4 as J,be as de,e as z,bc as W,a1 as se,z as ce,bu as me,u as pe,bb as _e,d as fe,P as re,N as X,t as ve,ad as ge,K as O,L as ne,aI as ye,O as xe,R as he}from"./index.90e14ade.js";import{Q as ie}from"./QBadge.1cbfe3d6.js";import{Q as oe,a as be}from"./QTable.73a7d3d9.js";import{Q as we}from"./QPagination.052438f6.js";import{Q as Pe}from"./QBanner.4d5db82a.js";import{u as te}from"./baker-report.b5b29d05.js";import{u as ae}from"./premix.c39bf1bc.js";import{q as qe}from"./date.f39f9257.js";import{Q as m}from"./rtl.afc00592.js";import{Q as Z,a as D,b as p}from"./QList.f5d06b33.js";import{Q as ke,a as Qe}from"./QStepper.7b296ef6.js";import{u as Se}from"./use-quasar.64ed3a0d.js";import{_ as le}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Ve}from"./QSpace.df1b0d53.js";import{C as Ce}from"./ClosePopup.a7ee5f13.js";import{api as Re}from"./axios.5df481c6.js";import"./QVirtualScroll.fa89f4f2.js";import"./use-virtual-scroll.15feeafd.js";import"./QSelect.1159fbbe.js";import"./QChip.0c55697e.js";import"./QMenu.c7ee5ea4.js";import"./selection.197c480b.js";import"./QSlideTransition.72c94d5c.js";import"./use-panel.426de1d2.js";import"./touch.9135741d.js";const $e={class:"row justify-between"},Ie={class:"text-h6"},Ne=o("div",{class:"text-h6",align:"center"},"Premix",-1),Te=o("div",{class:"text-h6",align:"center"},"Ingredients List",-1),De={class:"text-grey-7 q-mt-xs"},Be=o("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1),Le={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(d,{emit:k}){var n,x,c,M,E;const C=te(),Q=q(()=>C.user);console.log("userData in RawMaterialsTable:",Q.value);const b=((x=(n=Q.value)==null?void 0:n.data)==null?void 0:x.employee_id)||"",B=ae();Se();const y=h(!1),A=h(!1),u=d;console.log("props in TransactionView:",u.report);const R=()=>{y.value=!0},g=a=>{const l=r=>r?r.charAt(0).toUpperCase()+r.slice(1).toLowerCase():"";return`${l(a.firstname||"No Firstname")} ${a.middlename?l(a.middlename).charAt(0)+".":""} ${l(a.lastname||"No Lastname")}`},w=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],I=q(()=>{var a;return(a=u.report.history)!=null&&a.length?w.filter(l=>u.report.history.some(r=>r.status===l.value)):[]}),P=a=>{const l=u.report.history.find(r=>r.status===a);return l?a==="received"?`Received by: ${g(l.employee)}`:a==="pending"?`Requested by: ${g(l.employee)}`:`Handled by: ${g(l.employee)}`:"No handler"},j=a=>{const l=Number(a);return isNaN(l)?"":(l%1===0,l.toString())},Y=(a,l)=>{if(l==="Pcs")return`${a} pcs`;if(l==="Grams"){if(a>=1e3){let r=a/1e3;return`${r%1===0?r.toString():r.toString().replace(/^0+/,"")} kgs`}return`${a} g`}return`${a} ${l}`},L=((E=(M=(c=u.report)==null?void 0:c.branch_premix)==null?void 0:M.branch_recipe)==null?void 0:E.ingredient_groups)||"Undefined";console.log("ingrdientsData",L);const K=q(()=>L.map(a=>{const l=parseFloat(a.quantity)*parseFloat(u.report.quantity);return{...a,totalQuantity:l,formattedQuantity:Y(l,a.ingredient.unit)}}));console.log("report to proceed",u.report);const N=q(()=>{var a,l;return((l=(a=u.report.history)==null?void 0:a[u.report.history.length-1])==null?void 0:l.status)||null});console.log("lastStatus",N.value);const s=q(()=>I.value.findIndex(a=>a.value===N.value)+1),U=a=>{var l;return(l=u.report.history)==null?void 0:l.some(r=>r.status===a)},T=a=>({pending:"warning",declined:"red-6",confirmed:"green",process:"primary",completed:"dark","to deliver":"brown-9","to receive":"amber-10",received:"secondary"})[a]||"grey",F=async()=>{const a={request_premix_id:u.report.id,branch_premix_id:u.report.branch_premix_id,branch_id:u.report.branch_premix.branch_id,employee_id:b,status:"received",notes:"Received Premix",quantity:u.report.quantity,warehouse_id:u.report.warehouse_id,ingredients:K.value.map(l=>({ingredients_id:l.ingredient.id,total_quantity:l.totalQuantity,unit:l.ingredient.unit}))};console.log("payload",a),await B.receivePremix(a),y.value=!1};return(a,l)=>(f(),S(H,null,[o("div",null,[e($,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:R})]),e(se,{modelValue:y.value,"onUpdate:modelValue":l[2]||(l[2]=r=>y.value=r)},{default:t(()=>[e(G,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(V,null,{default:t(()=>[o("div",$e,[o("div",Ie,v(d.report.name),1),e($,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:l[0]||(l[0]=r=>y.value=!1)})])]),_:1}),i(" "+v(d.report.id)+" ",1),e(V,null,{default:t(()=>[o("div",null,"Baker: "+v(g(d.report.employee)),1),o("div",null," Branch: "+v(d.report.branch_premix.branch_recipe.branch.name),1),o("div",null,[i(" Status: "),e(ie,{color:T(d.report.status),outlined:""},{default:t(()=>[i(v(d.report.status),1)]),_:1},8,["color"])])]),_:1}),e(V,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[Ne,e(Z,{dense:"",separator:"",class:"box"},{default:t(()=>[e(D,null,{default:t(()=>[e(p,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[i("Premix Name")]),_:1})]),_:1}),e(p,{side:""},{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[i("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(D,null,{default:t(()=>[e(p,null,{default:t(()=>[e(m,{class:"text-h6"},{default:t(()=>[i(v(d.report.name),1)]),_:1})]),_:1}),e(p,{side:""},{default:t(()=>[e(m,{class:"text-h6"},{default:t(()=>[i(v(j(d.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",null,[Te,e(Z,{dense:"",separator:"",class:"box"},{default:t(()=>[e(D,null,{default:t(()=>[e(p,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[i(" Code")]),_:1})]),_:1}),e(p,null,{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[i(" Name")]),_:1})]),_:1}),e(p,{side:""},{default:t(()=>[e(m,{class:"text-overline"},{default:t(()=>[i("Quantity")]),_:1})]),_:1})]),_:1}),(f(!0),S(H,null,J(de(L),(r,_)=>(f(),z(D,{key:_},{default:t(()=>[e(p,null,{default:t(()=>[e(m,{class:"text-subtitle1"},{default:t(()=>[i(v(r.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(p,null,{default:t(()=>[e(m,{class:"text-subtitle1",align:"left"},{default:t(()=>[i(v(r.ingredient.name),1)]),_:2},1024)]),_:2},1024),e(p,{side:""},{default:t(()=>[e(m,{class:"text-subtitle1"},{default:t(()=>[i(v(Y(r.quantity*d.report.quantity,r.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(ke,{modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=r=>s.value=r),animated:"",class:"q-pa-lg"},{default:t(()=>[(f(!0),S(H,null,J(I.value,(r,_)=>(f(),z(Qe,{key:_,name:_+1,title:r.label,color:T(r.value),done:U(r.value),icon:U(r.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[o("div",De,v(P(r.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),N.value==="to receive"?(f(),z(V,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[Be,e($,{color:"amber-10",label:"Yes",icon:"check",onClick:F,loading:A.value},null,8,["loading"])]),_:1})):W("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};const Ue={class:"q-pa-lg flex flex-center"},Fe={key:0,class:"loading-overlay row justify-center items-center"},Me={key:1,class:"q-pa-md q-gutter-md row justify-center"},Ee={__name:"PremixTable",setup(d){var s,U,T,F;const k=te(),C=q(()=>k.user);console.log("userData in RawMaterialsTable:",C.value);const Q=((U=(s=C.value)==null?void 0:s.device)==null?void 0:U.reference_id)||"";console.log("branchId in PremixPage:",Q);const b=ae(),B=q(()=>b.branchEmployeePremix),y=((F=(T=C.value)==null?void 0:T.data)==null?void 0:F.employee_id)||"";console.log("employeeId in PremixPagess:",y);const A=h(""),u=h(!0),R=h(!0),g=h(!1),w=h([]),I=h(1),P=h({page:1,rowsPerPage:10,rowsNumber:10,sortBy:"id",descending:!1});ce(async()=>{y&&await j(),console.log("premixdatas",B.value)});const j=async()=>{R.value=!0;try{const{page:n,rowsNumber:x,rowsPerPage:c,sortBy:M,descending:E}=P.value,a=await b.fetchRequestBranchEmployeePremix(Q,y,n,x,c,M,E);w.value=a.data,I.value=a.last_page,P.value.rowsPerPage=a.per_page||10,g.value=w.value.length===0}catch(n){console.error("Error fetching premix report:",n)}R.value=!1};me(()=>{y&&j()}),pe(A,()=>{u.value=!0,setTimeout(()=>{u.value=!1})});const Y=n=>qe.formatDate(n,"MMMM D, YYYY - hh:mm A"),L=n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),K=n=>{switch(n){case"pending":return"warning";case"declined":return"red-6";case"confirmed":return"green";case"process":return"primary";case"completed":return"dark";case"to deliver":return"brown-9";case"to receive":return"amber-10";case"received":return"secondary";default:return"grey"}},N=[{name:"name",label:"Transactions Name",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:n=>Y(n),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(n,x)=>(f(),S("div",null,[e(be,{flat:"",columns:N,rows:w.value,"row-key":"id",bordered:"",dense:"",modelValue:P.value,"onUpdate:modelValue":x[0]||(x[0]=c=>P.value=c),pagination:P.value.rowsPerPage,"rows-per-page-options":[10]},{"body-cell-status":t(c=>[e(oe,{props:c},{default:t(()=>[e(ie,{outlined:"",color:K(c.row.status)},{default:t(()=>[i(v(L(c.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(c=>[e(oe,{props:c},{default:t(()=>[o("div",null,[e(Le,{report:c.row,onUpdateHistory:n.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["rows","modelValue","pagination"]),o("div",Ue,[e(we,{modelValue:P.value.page,"onUpdate:modelValue":[x[1]||(x[1]=c=>P.value.page=c),x[2]||(x[2]=c=>n.reloadTableData(n.userId))],color:"purple",max:I.value,"max-pages":I.value,"boundary-numbers":""},null,8,["modelValue","max","max-pages"])]),R.value?(f(),S("div",Fe,[e(_e,{size:"50px"})])):W("",!0),g.value?(f(),S("div",Me,[e(Pe,{class:"bg-grey-1",dense:""},{default:t(()=>[i(" No data available ")]),_:1})])):W("",!0)]))}};var ze=le(Ee,[["__scopeId","data-v-a0f011b4"]]);const Ae=fe("request-premix",()=>{const d=h(null),k=h([]);return{requestPremix:d,requestPremixes:k,saveRequestPremix:async Q=>{console.log("data request oremix",Q),re.show();try{const b=await Re.post("/api/request-premix",{requests:Q});console.log("response",b.data),X.create({type:"positive",message:"Request Premix successfully"})}catch(b){console.error(b),X.create({type:"negative",message:"Request Premix Error"})}finally{re.hide()}}}});const ee=d=>(xe("data-v-dbb60f06"),d=d(),he(),d),je={align:"right"},Ye=ee(()=>o("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),He={class:"q-ma-md"},Ke={key:0,class:"custom-list z-top"},Oe={class:"q-mb-sm"},Ge=ee(()=>o("div",null,"Premix Name",-1)),Je={class:"q-mb-lg"},We=ee(()=>o("div",null,"Category",-1)),Xe=ee(()=>o("div",null,"Quantity",-1)),Ze={align:"right"},et={__name:"RequestPremix",setup(d){var T,F,n,x,c,M,E;const k=h(!1),C=()=>{k.value=!0},Q=te(),b=q(()=>Q.user);console.log("userData in RawMaterialsTable:",b.value);const B=((F=(T=b.value)==null?void 0:T.device)==null?void 0:F.reference_id)||"";console.log("branchId in PremixPage:",B);const y=((c=(x=(n=b.value)==null?void 0:n.device)==null?void 0:x.reference)==null?void 0:c.warehouse_id)||"";console.log("warehouseId in PremixPage:",y);const A=((E=(M=b.value)==null?void 0:M.data)==null?void 0:E.employee_id)||"";console.log("warehouseId in PremixPage:",y);const u=ae(),R=q(()=>u.premixes);q(()=>u.branchEmployeePremix),console.log("premixdatas",R.value),Ae();const g=h([]),w=h(""),I=async()=>{await u.searchPremix(w.value,B)},P=a=>{console.log("data",a),s.branch_premix_id=a.id,s.name=a.name,s.category=a.category,w.value=""},j=a=>a?a.split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "):"",Y=q(()=>g.value!==0),L=()=>{const a=g.value.push({branch_premix_id:s.branch_premix_id,warehouse_id:s.warehouse_id,employee_id:s.employee_id,name:s.name,category:s.category,quantity:s.quantity,status:s.status});console.log("premix",a),N()},K=a=>{g.value.splice(a,1)},N=()=>{s.branch_premix_id=0,s.name="",s.category="",s.quantity=0},s=ve({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:y,employee_id:A,status:"pending"}),U=async()=>{try{console.log("Data sent for premix request:",g.value),await u.saveRequestPremix(g.value,B,A),X.create({type:"positive",message:"Premix request saved successfully!"}),N(),g.value=[],k.value=!1}catch(a){console.error("Failed to save premix request:",a),X.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(a,l)=>(f(),S(H,null,[o("div",je,[e($,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:C})]),e(se,{modelValue:k.value,"onUpdate:modelValue":l[4]||(l[4]=r=>k.value=r),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(G,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(V,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[Ye,e(Ve),ge(e($,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Ce]])]),_:1}),o("div",He,[e(O,{modelValue:w.value,"onUpdate:modelValue":[l[0]||(l[0]=r=>w.value=r),I],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[o("div",null,[e(ne,{name:"search"})]),w.value?(f(),S("div",Ke,[e(G,null,{default:t(()=>[e(Z,{separator:""},{default:t(()=>{var r;return[(r=R.value)!=null&&r.length?(f(!0),S(H,{key:1},J(R.value,_=>(f(),z(D,{key:_.id,onClick:ue=>P(_),clickable:""},{default:t(()=>[e(p,null,{default:t(()=>[e(m,null,{default:t(()=>[i(v(j(_==null?void 0:_.name)),1)]),_:2},1024)]),_:2},1024),e(p,null,{default:t(()=>[e(m,{side:""},{default:t(()=>[i(v(_==null?void 0:_.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(f(),z(D,{key:0},{default:t(()=>[i(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):W("",!0)]),_:1},8,["modelValue"])]),e(V,null,{default:t(()=>[o("div",Oe,[Ge,e(O,{modelValue:s.name,"onUpdate:modelValue":l[1]||(l[1]=r=>s.name=r),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Je,[We,e(O,{modelValue:s.category,"onUpdate:modelValue":l[2]||(l[2]=r=>s.category=r),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(V,{class:"q-gutter-sm"},{default:t(()=>[o("div",null,[Xe,e(O,{modelValue:s.quantity,"onUpdate:modelValue":l[3]||(l[3]=r=>s.quantity=r),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),o("div",Ze,[e($,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:L})])]),_:1}),e(V,null,{default:t(()=>[e(Z,{dense:"",separator:"",class:"box"},{default:t(()=>[e(D,null,{default:t(()=>[e(p,{align:"center"},{default:t(()=>[e(m,null,{default:t(()=>[i(" Premix Name ")]),_:1})]),_:1}),e(p,{align:"center"},{default:t(()=>[e(m,null,{default:t(()=>[i(" Quantity ")]),_:1})]),_:1}),e(p,{align:"center",side:""},{default:t(()=>[e(m,null,{default:t(()=>[i(" Action")]),_:1})]),_:1})]),_:1}),(f(!0),S(H,null,J(g.value,(r,_)=>(f(),z(D,{key:_},{default:t(()=>[e(p,{align:"center"},{default:t(()=>[e(m,null,{default:t(()=>[i(v(r.name),1)]),_:2},1024)]),_:2},1024),e(p,{align:"center"},{default:t(()=>[e(m,null,{default:t(()=>[i(v(r.quantity),1)]),_:2},1024)]),_:2},1024),e(p,{align:"center",side:""},{default:t(()=>[e(m,null,{default:t(()=>[e($,{onClick:ue=>K(_),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(ye,{class:"row q-ma-md",align:"right"},{default:t(()=>[e($,{class:"glossy",color:"grey-9",label:"Dismiss"}),e($,{class:"glossy",color:"teal",label:"Create",onClick:U,disable:!Y.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var tt=le(et,[["__scopeId","data-v-dbb60f06"]]);const at={class:"text-h6 text-white"},lt={__name:"PremixPage",setup(d){return(k,C)=>(f(),z(G,{flat:""},{default:t(()=>[e(V,{style:{"background-color":"#ef4444"}},{default:t(()=>[o("div",at,[e(ne,{name:"scale"}),i(" Premix ")])]),_:1}),e(V,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[e(tt)]),o("div",null,[e(ze)])]),_:1})]),_:1}))}};var Ct=le(lt,[["__scopeId","data-v-22a44c73"]]);export{Ct as default};
