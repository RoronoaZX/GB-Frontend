import{bd as ce,c as C,r as w,t as Z,o as p,a2 as M,f as e,M as I,w as l,Q as le,I as S,ad as ee,a0 as U,J as r,K as F,$ as Q,a3 as G,a4 as me,e as T,_ as A,ba as pe,aH as _e,aI as ve,a1 as fe,O as se,R as oe,u as we,z as ye,L as K,aJ as he}from"./index.624b9ec7.js";import{Q as ge}from"./QSpace.439db3d5.js";import{Q as L}from"./rtl.df08cf02.js";import{Q as be,a as P,b as x}from"./QList.82f6108f.js";import{Q as ae}from"./QSelect.6f6341f5.js";import{C as te}from"./ClosePopup.b3fc46b1.js";import{u as ne}from"./warehouse-rawMaterials.e29e81df.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as ke}from"./QSpinnerDots.527e1fbf.js";import{Q as qe}from"./QChip.fd3511f6.js";import{Q as xe,a as Qe}from"./QTable.a71becb2.js";import"./use-virtual-scroll.c14c8ef7.js";import"./QMenu.91871d4d.js";import"./selection.af1f8f11.js";import"./axios.09143b80.js";import"./raw-material.acdb0a12.js";import"./QVirtualScroll.4da1e9c3.js";const R=_=>(se("data-v-6832a8e2"),_=_(),oe(),_),Ie=R(()=>r("div",{class:"text-h6"},"Add Supply",-1)),Me=R(()=>r("div",{class:"q-my-sm"},"Supplier's Company Name",-1)),Se=R(()=>r("div",{class:"q-my-sm"},"Supplier's Name",-1)),Ce={class:"q-mt-md q-gutter-y-sm"},Re={class:"q-my-md"},Ne=R(()=>r("div",{class:"q-my-sm"},"Raw Materials Name",-1)),Ve={class:"row q-gutter-y-lg justify-between"},$e=R(()=>r("div",{class:"q-my-sm",align:"center"},"Quantity",-1)),De=R(()=>r("div",{class:"q-my-sm",align:"center"},"Unit",-1)),We=["onKeyup"],Te={class:"q-mt-sm",align:"right"},Le={__name:"WarehouseIngredientsCreateSupply",setup(_){var E,J,H,X;ce();const d=ne(),N=C(()=>d.user);console.log("userData",N.value);const y=((J=(E=N.value)==null?void 0:E.employee)==null?void 0:J.warehouse_id)||"";console.log("warehouseId",y);const g=((X=(H=N.value)==null?void 0:H.employee)==null?void 0:X.employee_id)||"";console.log("employeeId",g);const v=w(!1),b=C(()=>d.warehouseRawMaterials),O=()=>{v.value=!0},V=w(!1),f=w([]),h=w([]),i=Z({name:"",quantity:"",unit:""}),z=C(()=>f.value.length>0),B=[{label:"Sack (25 kg each)",value:"sack"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],$=w(h.value);(async()=>{try{const n=y;console.log("warehouse_id",n);const a=await d.fetchWarehouseRawMaterials(n);V.value=!1,h.value=d.warehouseRawMaterials.map(t=>({label:t.raw_materials.name,value:t.raw_materials.id,suffix:t.raw_materials.unit})),console.log("rawMaterialsOptions",h.value)}catch(n){console.error("Error fetching warehouse raw materials:",n)}})();const D=()=>{i.name="",i.quantity="",i.unit=""},o=(n,a)=>{a(()=>{if(n==="")$.value=h.value;else{const t=n.toLowerCase();$.value=h.value.filter(W=>W.label.toLowerCase().includes(t))}})},s=()=>{console.log("clickckck");const n=f.value;function a(Y,ue){return Y.find(de=>de.raw_material_id==ue)}const t=i.name.value;a(n,t)||(f.value=[...n,{raw_material_id:i.name.value,label:i.name.label,quantity:i.quantity,unit:i.unit}],D())},u=n=>{f.value.splice(n,1)},c=n=>n?n.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"",m=Z({companyName:"",supplierName:""}),k=()=>{m.companyName="",m.supplierName="",f.value=[]},q=n=>n.map(a=>{let t=a.quantity;return a.unit.value==="sack"?t=a.quantity*25e3:a.unit.value==="kilo"?t=a.quantity*1e3:a.unit.value==="gram"&&(t=a.quantity),{...a,convertedQuantity:t,unit:{...a.unit,value:"gram"}}}),ie=async()=>{const n=q(f.value),a={employee_id:g,warehouse_id:y,supplier_company_name:m.companyName,supplier_name:m.supplierName,raw_materials:n.map(t=>({raw_material_id:t.raw_material_id,quantity:t.convertedQuantity,unit:t.unit.value}))};await d.warehouseAddSupply(a),b.value=await d.fetchWarehouseRawMaterials(y),D(),k(),v.value=!1};return(n,a)=>(p(),M(G,null,[e(I,{class:"q-pa-sm",color:"red",dense:"",elevated:"",icon:"add_circle",label:"Add Supply",onClick:O}),e(fe,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=t=>v.value=t)},{default:l(()=>[e(le,{class:"my-card",style:{width:"900px"}},{default:l(()=>[e(S,{class:"row items-center"},{default:l(()=>[Ie,e(ge),ee(e(I,{icon:"close",flat:"",dense:"",round:""},null,512),[[te]])]),_:1}),e(U),e(S,{class:"q-my-md q-mx-sm q-gutter-y-sm"},{default:l(()=>[r("div",null,[Me,e(F,{modelValue:m.companyName,"onUpdate:modelValue":a[0]||(a[0]=t=>m.companyName=t),outlined:"",dense:""},null,8,["modelValue"])]),r("div",null,[Se,e(F,{modelValue:m.supplierName,"onUpdate:modelValue":a[1]||(a[1]=t=>m.supplierName=t),outlined:"",dense:""},null,8,["modelValue"])])]),_:1}),e(U),e(S,null,{default:l(()=>[r("div",Ce,[r("div",null,[e(be,{dense:"",separator:"",class:"box"},{default:l(()=>[e(P,null,{default:l(()=>[e(x,null,{default:l(()=>[e(L,{class:"text-overline"},{default:l(()=>[Q("Raw Materials Name")]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(L,{class:"text-overline"},{default:l(()=>[Q("Quantity")]),_:1})]),_:1}),e(x,{side:""})]),_:1}),(p(!0),M(G,null,me(f.value,(t,W)=>(p(),T(P,{key:W},{default:l(()=>[e(x,null,{default:l(()=>[e(L,{class:"text-caption"},{default:l(()=>[Q(A(c(t.label)),1)]),_:2},1024)]),_:2},1024),e(x,null,{default:l(()=>[e(L,{class:"text-caption justify-between"},{default:l(()=>[Q(A(t.quantity)+" "+A(t.unit.value),1)]),_:2},1024)]),_:2},1024),e(x,{side:""},{default:l(()=>[e(I,{onClick:Y=>u(W),color:"grey-10",icon:"backspace",dense:"",flat:"",round:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1}),e(S,null,{default:l(()=>[r("div",Re,[Ne,e(ae,{modelValue:i.name,"onUpdate:modelValue":a[2]||(a[2]=t=>i.name=t),debounce:"3000",outlined:"","chips-color":"primary",options:$.value,dense:"",label:"Raw Materials",behavior:"menu","use-input":"","hide-dropdown-icon":"",onFilter:o},{"no-option":l(()=>[e(P,null,{default:l(()=>[e(x,{class:"text-grey"},{default:l(()=>[Q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),r("div",Ve,[r("div",null,[$e,e(F,{modelValue:i.quantity,"onUpdate:modelValue":a[3]||(a[3]=t=>i.quantity=t),type:"number",outlined:"",dense:"",style:{width:"300px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])]),r("div",null,[De,e(ae,{modelValue:i.unit,"onUpdate:modelValue":a[4]||(a[4]=t=>i.unit=t),options:B,outlined:"",behavior:"menu",dense:"",style:{width:"350px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])])]),r("form",{onKeyup:pe(_e(s,["prevent"]),["enter"])},[r("div",Te,[e(I,{padding:"sm lg",outline:"",dense:"",icon:"add",color:"purple",onClick:s})])],40,We)]),_:1}),e(U),e(ve,{class:"row q-ma-md q-mt-xl",align:"left"},{default:l(()=>[ee(e(I,{class:"glossy",color:"grey-9",label:"Cancel"},null,512),[[te]]),e(I,{class:"glossy",color:"teal",label:"Create",onClick:ie,disable:!z.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var Ue=re(Le,[["__scopeId","data-v-6832a8e2"]]);const Fe=_=>(se("data-v-fcadadc0"),_=_(),oe(),_),Ae={class:"q-mb-sm"},Oe={key:0,class:"spinner-wrapper"},ze={key:1},Be={key:0,class:"data-error"},je=Fe(()=>r("div",{class:"q-ml-sm text-h6"},"No data available",-1)),Ke={__name:"WarehouseIngredientsTable",setup(_){var j,D;const d=ne(),y=((D=(j=C(()=>d.user).value)==null?void 0:j.employee)==null?void 0:D.warehouse_id)||"",g=C(()=>d.warehouseRawMaterials),v=w(!0);console.log("warehouse id",y);const b=w(""),O=w(!1),V=w(!1),f=w({rowsPerPage:0}),h=C(()=>b.value?g.value.filter(o=>o.name.toLowerCase().includes(b.value.toLowerCase())):g.value);we(b,async o=>{v.value=!0,await new Promise(s=>setTimeout(s,1e3)),v.value=!1,V.value=h.value.length===0}),ye(async()=>{console.log("props.warehouseId in onMounted:",y),y&&await i(y)});const i=async o=>{console.log("Fetching raw materials for warehouse ID:",o);try{v.value=!0;const s=await d.fetchWarehouseRawMaterials(o);g.value=s,g.value.length||(V.value=!0),console.log("Warehouse Raw Materialsss",g.value)}catch(s){console.log("Error fetching warehouse product:",s),V.value=!0}finally{v.value=!1}},z=o=>{const s=o.total_quantity,u=o.raw_materials.unit;if(console.log("unit test",u),u==="Grams"&&s<1e3)return"bg-red";let c;return s>=1e3?c=s/1e3:c=s,c<5?c<=2?"bg-red":(c<=3,"bg-warning"):"bg-positive"},B=o=>{var m;const s=Number(o==null?void 0:o.total_quantity)||0,u=((m=o==null?void 0:o.raw_materials)==null?void 0:m.unit)||"units";console.log("totalQuantity:",s),console.log("unit:",u);const c=k=>{const q=Number(k);return Number.isInteger(q)?q:q.toFixed(2)};if(s>1e3){const k=s/1e3;if(k>=25){const q=k/25;return`${c(q)} sacks`}return`${c(k)} kilos`}return`${c(s)} ${u}`},$=[{name:"name",label:"Ingredients Name",align:"center",field:o=>{var s;return((s=o==null?void 0:o.raw_materials)==null?void 0:s.name)||"N/A"},format:o=>`${o}`,sortable:!0},{name:"availableStocks",align:"center",label:"Available Stocks",field:"total_quantity",sortable:!0}];return(o,s)=>(p(),M(G,null,[r("div",Ae,[e(F,{rounded:"",outlined:"",dense:"",debounce:"300",modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=u=>b.value=u),placeholder:"Searchsss",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:l(()=>[O.value?(p(),T(K,{key:1,thickness:2,color:"teal",size:"1em"})):(p(),T(K,{key:0,name:"search"}))]),_:1},8,["modelValue"])]),v.value?(p(),M("div",Oe,[e(ke,{size:"50px",color:"primary"})])):(p(),M("div",ze,[h.value.length===0?(p(),M("div",Be,[e(K,{name:"warning",color:"warning",size:"4em"}),je])):(p(),T(Qe,{key:1,class:"table-container sticky-header",filter:b.value,"virtual-scroll-sticky-size-start":48,flat:"",columns:$,rows:h.value,"row-key":"name","virtual-scroll":"",pagination:f.value,"onUpdate:pagination":s[1]||(s[1]=u=>f.value=u),"rows-per-page-options":[0],"hide-bottom":"",style:{height:"340px"}},{"body-cell-availableStocks":l(u=>[e(xe,{props:u},{default:l(()=>[e(qe,{square:"",class:he(["text-white",z(u.row)])},{default:l(()=>[Q(A(B(u.row)),1)]),_:2},1032,["class"])]),_:2},1032,["props"])]),_:1},8,["filter","rows","pagination"]))]))],64))}};var Pe=re(Ke,[["__scopeId","data-v-fcadadc0"]]);const Ge={align:"right"},ca={__name:"WarehouseIngredients",setup(_){return(d,N)=>(p(),T(le,{flat:""},{default:l(()=>[e(S,{class:"text-h6"},{default:l(()=>[Q(" Ingredients ")]),_:1}),e(U),e(S,{class:"q-gutter-md"},{default:l(()=>[r("div",Ge,[e(Ue)]),r("div",null,[e(Pe)])]),_:1})]),_:1}))}};export{ca as default};
