import{b as Z,Q as F,a as ee}from"./QTable.e1659363.js";import{Q as ae}from"./QTr.34d641f4.js";import{Q as R}from"./QTooltip.408a5e86.js";import{c as z,r as v,t as te,u as j,o as c,a3 as $,f as l,M as I,w as n,Q as oe,I as k,ae as le,J as r,e as b,a0 as S,be as T,a4 as J,a5 as M,$ as y,a1 as ne,K as g,aJ as se,a2 as re,O,R as H,L as de,bo as ie,z as me,bd as D,N as U}from"./index.4f8c3525.js";import{Q as L}from"./QPopupEdit.9ed06825.js";import{Q as ue}from"./QSpinnerIos.50c5bec8.js";import{Q as ce}from"./QInnerLoading.cb91a301.js";import{Q as pe}from"./QPage.c6d694e4.js";import{Q as _e}from"./QSpace.e8a39726.js";import{a as B,b as K}from"./QMenu.43508d5a.js";import{Q as fe}from"./QList.1c7a6cb4.js";import{C as ye}from"./ClosePopup.3f1701c0.js";import{u as ve}from"./employee.1a2738f6.js";import{u as G}from"./cash-advance.b8246335.js";import{_ as ge}from"./SearchComponent.598630d0.js";import{_ as W}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.59b09b16.js";import"./use-virtual-scroll.bd4d1fa2.js";import"./rtl.276c3f1b.js";import"./QSelect.3c4bd527.js";import"./QChip.98970a3d.js";import"./selection.41406168.js";import"./position-engine.38e1658f.js";import"./axios.d00d26dd.js";const E=u=>(O("data-v-30c8a708"),u=u(),H(),u),be=E(()=>r("div",{class:"text-h5 q-mr-md"},"\u{1F4B2} Add Cash Advance",-1)),he={style:{position:"relative"}},we={key:0,class:"dropdown-list"},xe={class:"row q-col-gutter-md q-mt-lg"},Ve={class:"col-12 col-sm-6"},Ae=E(()=>r("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"}," Employee Name: ",-1)),Ce={class:"text-body1 text-weight-medium"},Qe={class:"col-12 col-sm-6"},Se=E(()=>r("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Position:",-1)),Ne={class:"text-body1 text-weight-medium"},Ue={class:"q-gutter-y-md"},$e={__name:"CashAdvanceButton",emits:["created"],setup(u,{emit:f}){const h=f,_=ve(),d=z(()=>_.employees),i=G(),m=v(""),V=v(!1),A=v(!1),w=v(!1),x=()=>{w.value=!0},C=async()=>{m.value.trim()&&(A.value=!0,await _.searchEmployee(m.value),A.value=!1)},q=e=>{s.employee_id=e.id,s.employee_name=`${e.firstname} ${e.middlename?e.middlename.charAt(0)+".":""} ${e.lastname}`,s.employee_position=e.position,m.value=""},s=te({employee_id:"",employee_name:"",employee_position:"",amount:0,reason:"",number_of_payments:0,payment_per_payroll:0,remaining_payments:0});j(()=>[s.amount,s.number_of_payments],([e,t])=>{const a=parseFloat(e)||0,o=parseInt(t)||0;s.payment_per_payroll=o>0?(a/o).toFixed(2):0});const N=()=>{Object.assign(s,{employee_id:"",employee_name:"",employee_position:"",amount:0,reason:"",number_of_payments:0,payment_per_payroll:0,remaining_payments:0})},P=async()=>{s.remaining_payments=parseFloat(s.amount)||0,V.value=!0;try{await i.createCashAdvance(s),h("created"),w.value=!1,N()}catch(e){console.error(e)}finally{V.value=!1}};return(e,t)=>(c(),$("div",null,[l(I,{padding:"sm md",label:"Cash Advance",icon:"attach_money",size:"md",class:"gradient-btn text-white",onClick:x}),l(re,{modelValue:w.value,"onUpdate:modelValue":t[5]||(t[5]=a=>w.value=a),persistent:"",position:"right","backdrop-filter":"blur(4px) saturate(150%)"},{default:n(()=>[l(oe,{class:"cash-advance-dialog-card"},{default:n(()=>[l(k,{class:"dialog-header row items-center no-wrap"},{default:n(()=>[be,l(_e),le(l(I,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[ye]])]),_:1}),l(k,{class:"q-px-lg q-pt-md"},{default:n(()=>[r("div",he,[l(ge,{modelValue:m.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>m.value=a),C],"search-loading":A.value},null,8,["modelValue","search-loading"]),m.value?(c(),$("div",we,[l(fe,{separator:""},{default:n(()=>{var a;return[(a=d.value)!=null&&a.length?T("",!0):(c(),b(B,{key:0},{default:n(()=>[l(K,{class:"text-grey-7"},{default:n(()=>[S("No employee record")]),_:1})]),_:1})),(c(!0),$(J,null,M(d.value,o=>(c(),b(B,{key:o.id,clickable:"",onClick:p=>q(o)},{default:n(()=>[l(K,null,{default:n(()=>[S(y(`${o.firstname} ${o.middlename?o.middlename.charAt(0)+".":""} ${o.lastname}`),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})])):T("",!0)]),r("div",xe,[r("div",Ve,[Ae,r("div",Ce,y(s.employee_name||"----------"),1)]),r("div",Qe,[Se,r("div",Ne,y(s.employee_position||"----------"),1)])])]),_:1}),l(ne,{inset:"",class:"q-mx-lg q-my-md"}),l(k,null,{default:n(()=>[r("div",Ue,[l(g,{dense:"",modelValue:s.amount,"onUpdate:modelValue":t[1]||(t[1]=a=>s.amount=a),type:"number",outlined:"",label:"Amount"},null,8,["modelValue"]),l(g,{dense:"",modelValue:s.number_of_payments,"onUpdate:modelValue":t[2]||(t[2]=a=>s.number_of_payments=a),type:"number",outlined:"",label:"Number of Payments"},null,8,["modelValue"]),l(g,{modelValue:s.payment_per_payroll,"onUpdate:modelValue":t[3]||(t[3]=a=>s.payment_per_payroll=a),outlined:"",dense:"",readonly:"",label:"Per Payroll"},null,8,["modelValue"]),l(g,{dense:"",modelValue:s.reason,"onUpdate:modelValue":t[4]||(t[4]=a=>s.reason=a),filled:"",type:"textarea",outlined:"",label:"Reason"},null,8,["modelValue"])])]),_:1}),l(se,{align:"right",class:"q-px-lg q-pb-lg"},{default:n(()=>[l(I,{size:"md",padding:"xs md",label:"Save","icon-right":"send",class:"gradient-btn text-white",loading:V.value,onClick:P},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var qe=W($e,[["__scopeId","data-v-30c8a708"]]);const Pe={__name:"SearchCashAdvance",props:{modelValue:{type:String,default:""},searchLoading:{type:Boolean,default:!1}},emits:["update:model-value","clear"],setup(u,{emit:f}){const h=f;return(_,d)=>(c(),b(g,{modelValue:_.searchKeyword,"onUpdate:modelValue":[d[0]||(d[0]=i=>_.searchKeyword=i),d[1]||(d[1]=i=>h("update:model-value",i))],onClear:d[2]||(d[2]=i=>h("clear")),label:"Search Employeess",outlined:"",dense:"",flat:"",debounce:"500",style:{width:"300px"}},{append:n(()=>[u.searchLoading?(c(),b(ie,{key:1,color:"primary",size:"sm"})):(c(),b(de,{key:0,name:"search"}))]),_:1},8,["modelValue"]))}};const X=u=>(O("data-v-4997a2f2"),u=u(),H(),u),Ie={class:"row justify-between q-mb-md",align:"right"},ke={class:"row q-gutter-md"},Ee=X(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Amount ",-1)),Fe={class:"text-subtitle2 q-mb-sm"},Re=X(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Reason ",-1)),Te={class:"text-subtitle2 q-mb-sm"},De={__name:"CashAdvanceTable",setup(u){const f=G(),h=z(()=>f.cashAdvances),_=v([]),d=v({page:1,rowsPerPage:0,rowsNumber:0}),i=v(!0),m=v("");function V(e){if(e==null||e==="")return"";const t=parseFloat(e);return isNaN(t)?"":Number.isInteger(t)?String(parseInt(t)):String(t)}async function A(e,t){i.value=!0;try{await f.updateAmount(e,t),U.create({message:"Amount updated successfully",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),U.create({message:"Failed to update amount",color:"negative",position:"top",timeout:2e3})}finally{i.value=!1}}async function w(e,t){i.value=!0;try{await f.updateReason(e,t),U.create({message:"Cash Advance reason updated successfully!",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),U.create({message:"Cash Advance reasons updated successfully!",color:"negative",position:"top",timeout:2e3})}finally{i.value=!1}}me(async()=>{await x()});const x=async(e=1,t=7,a="")=>{try{i.value=!0,await f.fetchCashAdvance(e,t,a);const{data:o,current_page:p,per_page:Q,total:Y}=h.value;_.value=o,console.log("Cash Advance",_.value),d.value.page=p,d.value.rowsPerPage=Q,d.value.rowsNumber=Y}catch(o){console.log("===================================="),console.log(o),console.log("====================================")}finally{i.value=!1}},C=e=>{const t=Q=>Q?Q.charAt(0).toUpperCase()+Q.slice(1).toLowerCase():"",a=e.firstname?t(e.firstname):"No Firstname",o=e.middlename?t(e.middlename).charAt(0)+".":"",p=e.lastname?t(e.lastname):"No Lastname";return`${a} ${o} ${p}`.trim()},q=e=>{x(e.pagination.page,e.pagination.rowsPerPage,e.filter)};j(m,async e=>{await x(d.value.page,d.value.rowsPerPage,e)});const s=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(e),N=e=>{if(!e)return" - - ";const t=new Date(e);return isNaN(t.getTime())?" - - ":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},P=[{name:"date",label:"Date Created",align:"left",field:e=>N(e.created_at)},{name:"date",label:"Date Updated",align:"left",field:e=>N(e.updated_at)},{name:"name",label:"Employee Name",align:"left",field:e=>C(e.employee)},{name:"amount",label:"Total Amount",align:"center",field:e=>s(e.amount)},{name:"number_of_payments",label:"Number of Payments",align:"center",field:e=>e.number_of_payments?e.number_of_payments:0},{name:"payment_per_payroll",label:"Payment per Payroll",align:"center",field:e=>s(e.payment_per_payroll)},{name:"remaining_payments",label:"Remaining Payments",align:"center",field:e=>s(e.remaining_payments)},{name:"reason",label:"Reason",align:"center",field:"reason"}];return(e,t)=>(c(),b(pe,{class:"q-my-md"},{default:n(()=>[r("div",Ie,[r("div",ke,[l(qe,{onCreated:x})]),l(Pe,{modelValue:m.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>m.value=a),m.value]},null,8,["modelValue","onUpdate:modelValue"])]),l(ee,{rows:_.value,columns:P,"row-key":"name",pagination:d.value,"onUpdate:pagination":t[1]||(t[1]=a=>d.value=a),"rows-per-page-options":[5,7,10,0],loading:i.value,filter:m.value,onRequest:q},{header:n(a=>[l(ae,{props:a,class:"gradient-header text-white text-weight-bold"},{default:n(()=>[(c(!0),$(J,null,M(a.cols,o=>(c(),b(Z,{key:o.name,props:a,class:"text-center text-subtitle2"},{default:n(()=>[S(y(o.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-amount":n(a=>[l(F,{props:a,class:"cursor-pointer"},{default:n(()=>[r("span",null,y(a.row.amount?s(a.row.amount):" - - - "),1),l(R,{class:"bg-blue-grey-8"},{default:n(()=>[S("Edit Amount")]),_:1}),l(L,{"onUpdate:modelValue":[o=>A(a.row,o),o=>a.row.amount=o],modelValue:a.row.amount,buttons:"","label-set":"Save","label-cancel":"Close"},{default:n(o=>[Ee,r("div",Fe," Name: "+y(C(a.row.employee)),1),l(g,{modelValue:o.value,"onUpdate:modelValue":[p=>o.value=p,p=>o.value=p],"model-value":V(o.value),type:"text",autofocus:"",counter:"",onKeyup:D(o.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","model-value","onKeyup"])]),_:2},1032,["onUpdate:modelValue","modelValue"])]),_:2},1032,["props"])]),"body-cell-reason":n(a=>[l(F,{props:a,class:"cursor-pointer"},{default:n(()=>[r("span",null,y(a.row.reason||" - - - "),1),l(R,{class:"bg-blue-grey-8"},{default:n(()=>[S("Edit Reason")]),_:1}),l(L,{modelValue:a.row.reason,"onUpdate:modelValue":[o=>a.row.reason=o,o=>w(a.row,o)],buttons:"","label-set":"Save","label-cancel":"Close"},{default:n(o=>[Re,r("div",Te," Name: "+y(C(a.row.employee)),1),l(g,{modelValue:o.value,"onUpdate:modelValue":p=>o.value=p,type:"text",autofocus:"",counter:"",onKeyup:D(o.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),loading:n(()=>[l(ce,{showing:""},{default:n(()=>[l(ue,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","pagination","loading","filter"])]),_:1}))}};var ma=W(De,[["__scopeId","data-v-4997a2f2"]]);export{ma as default};
