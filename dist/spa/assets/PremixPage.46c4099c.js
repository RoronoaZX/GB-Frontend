import{c as Q,r as w,o as v,a3 as R,J as o,f as e,M as T,w as t,Q as X,I,$ as y,a0 as i,a4 as J,a5 as Z,bf as me,e as j,bd as ee,a2 as ue,z as pe,by as _e,u as fe,bc as ve,d as ge,P as ne,N as te,t as ye,ae as xe,K as W,L as de,aJ as he,O as be,R as we}from"./index.b718e17f.js";import{Q as ce}from"./QBadge.11817816.js";import{Q as ie,a as Pe}from"./QTable.01e4ce5e.js";import{Q as qe}from"./QPagination.08de3506.js";import{Q as ke}from"./QBanner.9f0c7d9d.js";import{u as re}from"./baker-report.a4efffea.js";import{u as oe}from"./premix.d661361d.js";import{q as Qe}from"./date.12aa7289.js";import{Q as _}from"./rtl.ed2ce8a5.js";import{Q as ae,a as U,b as f}from"./QList.c9b8ea56.js";import{Q as Se,a as Ve}from"./QStepper.4eca6ad5.js";import{u as Ce}from"./use-quasar.1a02ac9a.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Re}from"./QSpace.cc4fc83d.js";import{C as Ie}from"./ClosePopup.ec39b862.js";import{api as $e}from"./axios.ed722b83.js";import"./QVirtualScroll.63f2e1de.js";import"./use-virtual-scroll.4251f83e.js";import"./QSelect.3780ebbd.js";import"./QChip.8b70a936.js";import"./QMenu.cb7da94e.js";import"./selection.66078849.js";import"./QSlideTransition.55388eca.js";import"./use-panel.eeff19b7.js";import"./touch.9135741d.js";const Ne={class:"row justify-between"},Te={class:"text-h6"},Be=o("div",{class:"text-h6",align:"center"},"Premix",-1),De=o("div",{class:"text-h6",align:"center"},"Ingredients List",-1),Le={class:"text-grey-7 q-mt-xs"},Ue=o("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1),Fe={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(c,{emit:S}){var b,m,z,A,d,g,p;const $=re(),k=Q(()=>$.user);console.log("userData in RawMaterialsTable:",k.value);const x=((m=(b=k.value)==null?void 0:b.data)==null?void 0:m.employee_id)||"",B=((A=(z=k.value)==null?void 0:z.device)==null?void 0:A.reference_id)||"";console.log("employeeId in PremixPage:",x),console.log("branchId in PremixPage:",B);const V=oe();Ce();const C=w(!1),N=w(!1),u=c;console.log("props in TransactionView:",u.report);const P=()=>{C.value=!0},h=a=>{const l=r=>r?r.charAt(0).toUpperCase()+r.slice(1).toLowerCase():"";return`${l(a.firstname||"No Firstname")} ${a.middlename?l(a.middlename).charAt(0)+".":""} ${l(a.lastname||"No Lastname")}`},F=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],q=Q(()=>{var a;return(a=u.report.history)!=null&&a.length?F.filter(l=>u.report.history.some(r=>r.status===l.value)):[]}),Y=a=>{const l=u.report.history.find(r=>r.status===a);return l?a==="received"?`Received by: ${h(l.employee)}`:a==="pending"?`Requested by: ${h(l.employee)}`:`Handled by: ${h(l.employee)}`:"No handler"},O=a=>{const l=Number(a);return isNaN(l)?"":(l%1===0,l.toString())},H=(a,l)=>{if(l==="Pcs")return`${a} pcs`;if(l==="Grams"){if(a>=1e3){let r=a/1e3;return`${r%1===0?r.toString():r.toString().replace(/^0+/,"")} kgs`}return`${a} g`}return`${a} ${l}`},E=((p=(g=(d=u.report)==null?void 0:d.branch_premix)==null?void 0:g.branch_recipe)==null?void 0:p.ingredient_groups)||"Undefined";console.log("ingrdientsData",E);const K=Q(()=>E.map(a=>{const l=parseFloat(a.quantity)*parseFloat(u.report.quantity);return{...a,totalQuantity:l,formattedQuantity:H(l,a.ingredient.unit)}}));console.log("report to proceed",u.report);const s=Q(()=>{var a,l;return((l=(a=u.report.history)==null?void 0:a[u.report.history.length-1])==null?void 0:l.status)||null});console.log("lastStatus",s.value);const M=Q(()=>q.value.findIndex(a=>a.value===s.value)+1),D=a=>{var l;return(l=u.report.history)==null?void 0:l.some(r=>r.status===a)},L=a=>({pending:"warning",declined:"red-6",confirmed:"green",process:"primary",completed:"dark","to deliver":"brown-9","to receive":"amber-10",received:"secondary"})[a]||"grey",n=async()=>{const a={request_premix_id:u.report.id,branch_premix_id:u.report.branch_premix_id,branch_id:u.report.branch_premix.branch_id,employee_id:x,status:"received",notes:"Received Premix",quantity:u.report.quantity,warehouse_id:u.report.warehouse_id,ingredients:K.value.map(l=>({ingredients_id:l.ingredient.id,total_quantity:l.totalQuantity,unit:l.ingredient.unit}))};console.log("payload",a),await V.receivePremix(a),await fetchRequestBranchEmployeePremix(B,x),C.value=!1};return(a,l)=>(v(),R(J,null,[o("div",null,[e(T,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:P})]),e(ue,{modelValue:C.value,"onUpdate:modelValue":l[2]||(l[2]=r=>C.value=r)},{default:t(()=>[e(X,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(I,null,{default:t(()=>[o("div",Ne,[o("div",Te,y(c.report.name),1),e(T,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:l[0]||(l[0]=r=>C.value=!1)})])]),_:1}),i(" "+y(c.report.id)+" ",1),e(I,null,{default:t(()=>[o("div",null,"Baker: "+y(h(c.report.employee)),1),o("div",null," Branch: "+y(c.report.branch_premix.branch_recipe.branch.name),1),o("div",null,[i(" Status: "),e(ce,{color:L(c.report.status),outlined:""},{default:t(()=>[i(y(c.report.status),1)]),_:1},8,["color"])])]),_:1}),e(I,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[Be,e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(f,null,{default:t(()=>[e(_,{class:"text-overline"},{default:t(()=>[i("Premix Name")]),_:1})]),_:1}),e(f,{side:""},{default:t(()=>[e(_,{class:"text-overline"},{default:t(()=>[i("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(U,null,{default:t(()=>[e(f,null,{default:t(()=>[e(_,{class:"text-h6"},{default:t(()=>[i(y(c.report.name),1)]),_:1})]),_:1}),e(f,{side:""},{default:t(()=>[e(_,{class:"text-h6"},{default:t(()=>[i(y(O(c.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),o("div",null,[De,e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(f,null,{default:t(()=>[e(_,{class:"text-overline"},{default:t(()=>[i(" Code")]),_:1})]),_:1}),e(f,null,{default:t(()=>[e(_,{class:"text-overline"},{default:t(()=>[i(" Name")]),_:1})]),_:1}),e(f,{side:""},{default:t(()=>[e(_,{class:"text-overline"},{default:t(()=>[i("Quantity")]),_:1})]),_:1})]),_:1}),(v(!0),R(J,null,Z(me(E),(r,G)=>(v(),j(U,{key:G},{default:t(()=>[e(f,null,{default:t(()=>[e(_,{class:"text-subtitle1"},{default:t(()=>[i(y(r.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(f,null,{default:t(()=>[e(_,{class:"text-subtitle1",align:"left"},{default:t(()=>[i(y(r.ingredient.name),1)]),_:2},1024)]),_:2},1024),e(f,{side:""},{default:t(()=>[e(_,{class:"text-subtitle1"},{default:t(()=>[i(y(H(r.quantity*c.report.quantity,r.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(Se,{modelValue:M.value,"onUpdate:modelValue":l[1]||(l[1]=r=>M.value=r),animated:"",class:"q-pa-lg"},{default:t(()=>[(v(!0),R(J,null,Z(q.value,(r,G)=>(v(),j(Ve,{key:G,name:G+1,title:r.label,color:L(r.value),done:D(r.value),icon:D(r.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[o("div",Le,y(Y(r.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),s.value==="to receive"?(v(),j(I,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[Ue,e(T,{color:"amber-10",label:"Yes",icon:"check",onClick:n,loading:N.value},null,8,["loading"])]),_:1})):ee("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};const Ee={class:"q-pa-lg flex flex-center"},Me={key:0,class:"loading-overlay row justify-center items-center"},ze={key:1,class:"q-pa-md q-gutter-md row justify-center"},Ae={__name:"PremixTable",setup(c){var s,M,D,L;const S=re(),$=Q(()=>S.user);console.log("userData in RawMaterialsTable:",$.value);const k=((M=(s=$.value)==null?void 0:s.device)==null?void 0:M.reference_id)||"";console.log("branchId in PremixPage:",k);const x=oe(),B=Q(()=>x.branchEmployeePremix),V=((L=(D=$.value)==null?void 0:D.data)==null?void 0:L.employee_id)||"";console.log("employeeId in PremixPagess:",V);const C=w(""),N=w(!0),u=w(!0),P=w(!1),h=w([]),F=w(1),q=w({page:1,rowsPerPage:10,rowsNumber:10,sortBy:"id",descending:!1});pe(async()=>{V&&await Y(),console.log("premixdatas",B.value)});const Y=async()=>{u.value=!0;try{const{page:n,rowsNumber:b,rowsPerPage:m,sortBy:z,descending:A}=q.value,d=await x.fetchRequestBranchEmployeePremix(k,V,n,b,m,z,A);h.value=d.data,F.value=d.last_page,q.value.rowsPerPage=d.per_page||10,P.value=h.value.length===0}catch(n){console.error("Error fetching premix report:",n)}u.value=!1};_e(()=>{V&&Y()}),fe(C,()=>{N.value=!0,setTimeout(()=>{N.value=!1})});const O=n=>Qe.formatDate(n,"MMMM D, YYYY - hh:mm A"),H=n=>n.charAt(0).toUpperCase()+n.slice(1).toLowerCase(),E=n=>{switch(n){case"pending":return"warning";case"declined":return"red-6";case"confirmed":return"green";case"process":return"primary";case"completed":return"dark";case"to deliver":return"brown-9";case"to receive":return"amber-10";case"received":return"secondary";default:return"grey"}},K=[{name:"name",label:"Transactions Name",align:"left",field:n=>n.name,format:n=>`${n}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:n=>O(n),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(n,b)=>(v(),R("div",null,[e(Pe,{flat:"",columns:K,rows:h.value,"row-key":"id",bordered:"",dense:"",modelValue:q.value,"onUpdate:modelValue":b[0]||(b[0]=m=>q.value=m),pagination:q.value.rowsPerPage,"rows-per-page-options":[10]},{"body-cell-status":t(m=>[e(ie,{props:m},{default:t(()=>[e(ce,{outlined:"",color:E(m.row.status)},{default:t(()=>[i(y(H(m.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(m=>[e(ie,{props:m},{default:t(()=>[o("div",null,[e(Fe,{report:m.row,onUpdateHistory:n.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["rows","modelValue","pagination"]),o("div",Ee,[e(qe,{modelValue:q.value.page,"onUpdate:modelValue":[b[1]||(b[1]=m=>q.value.page=m),b[2]||(b[2]=m=>n.reloadTableData(n.userId))],color:"purple",max:F.value,"max-pages":F.value,"boundary-numbers":""},null,8,["modelValue","max","max-pages"])]),u.value?(v(),R("div",Me,[e(ve,{size:"50px"})])):ee("",!0),P.value?(v(),R("div",ze,[e(ke,{class:"bg-grey-1",dense:""},{default:t(()=>[i(" No data available ")]),_:1})])):ee("",!0)]))}};var je=se(Ae,[["__scopeId","data-v-2dd1d665"]]);const Ye=ge("request-premix",()=>{const c=w(null),S=w([]);return{requestPremix:c,requestPremixes:S,saveRequestPremix:async k=>{console.log("data request oremix",k),ne.show();try{const x=await $e.post("/api/request-premix",{requests:k});console.log("response",x.data),te.create({type:"positive",message:"Request Premix successfully"})}catch(x){console.error(x),te.create({type:"negative",message:"Request Premix Error"})}finally{ne.hide()}}}});const le=c=>(be("data-v-6a45aa0f"),c=c(),we(),c),He={align:"right"},Ke=le(()=>o("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),Je={class:"q-ma-md"},Oe={key:0,class:"custom-list z-top"},Ge={class:"q-mb-sm"},We=le(()=>o("div",null,"Premix Name",-1)),Xe={class:"q-mb-lg"},Ze=le(()=>o("div",null,"Category",-1)),et=le(()=>o("div",null,"Quantity",-1)),tt={align:"right"},at={__name:"RequestPremix",setup(c){var D,L,n,b,m,z,A;const S=w(!1),$=()=>{S.value=!0},k=re(),x=Q(()=>k.user);console.log("userData in RawMaterialsTable:",x.value);const B=((L=(D=x.value)==null?void 0:D.device)==null?void 0:L.reference_id)||"";console.log("branchId in PremixPage:",B);const V=((m=(b=(n=x.value)==null?void 0:n.device)==null?void 0:b.reference)==null?void 0:m.warehouse_id)||"";console.log("warehouseId in PremixPage:",V);const C=((A=(z=x.value)==null?void 0:z.data)==null?void 0:A.employee_id)||"";console.log("warehouseId in PremixPage:",V);const N=oe(),u=Q(()=>N.premixes);Q(()=>N.branchEmployeePremix),console.log("premixdatas",u.value),Ye();const P=w([]),h=w(""),F=async()=>{await N.searchPremix(h.value,B)},q=d=>{console.log("data",d),s.branch_premix_id=d.id,s.name=d.name,s.category=d.category,h.value=""},Y=d=>d?d.split(" ").map(g=>g.charAt(0).toUpperCase()+g.slice(1).toLowerCase()).join(" "):"",O=Q(()=>P.value!==0),H=()=>{const d=P.value.push({branch_premix_id:s.branch_premix_id,warehouse_id:s.warehouse_id,employee_id:s.employee_id,name:s.name,category:s.category,quantity:s.quantity,status:s.status});console.log("premix",d),K()},E=d=>{P.value.splice(d,1)},K=()=>{s.branch_premix_id=0,s.name="",s.category="",s.quantity=0},s=ye({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:V,employee_id:C,status:"pending"}),M=async()=>{try{console.log("Data sent for premix request:",P.value),await N.saveRequestPremix(P.value,B,C),te.create({type:"positive",message:"Premix request saved successfully!"}),K(),P.value=[],S.value=!1}catch(d){console.error("Failed to save premix request:",d),te.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(d,g)=>(v(),R(J,null,[o("div",He,[e(T,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:$})]),e(ue,{modelValue:S.value,"onUpdate:modelValue":g[4]||(g[4]=p=>S.value=p),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(X,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(I,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[Ke,e(Re),xe(e(T,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Ie]])]),_:1}),o("div",Je,[e(W,{modelValue:h.value,"onUpdate:modelValue":[g[0]||(g[0]=p=>h.value=p),F],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[o("div",null,[e(de,{name:"search"})])]),default:t(()=>[h.value?(v(),R("div",Oe,[e(X,null,{default:t(()=>[e(ae,{separator:""},{default:t(()=>{var p;return[(p=u.value)!=null&&p.length?(v(!0),R(J,{key:1},Z(u.value,a=>(v(),j(U,{key:a.id,onClick:l=>q(a),clickable:""},{default:t(()=>[e(f,null,{default:t(()=>[e(_,null,{default:t(()=>[i(y(Y(a==null?void 0:a.name)),1)]),_:2},1024)]),_:2},1024),e(f,null,{default:t(()=>[e(_,{side:""},{default:t(()=>[i(y(a==null?void 0:a.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(v(),j(U,{key:0},{default:t(()=>[i(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):ee("",!0)]),_:1},8,["modelValue"])]),e(I,null,{default:t(()=>[o("div",Ge,[We,e(W,{modelValue:s.name,"onUpdate:modelValue":g[1]||(g[1]=p=>s.name=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),o("div",Xe,[Ze,e(W,{modelValue:s.category,"onUpdate:modelValue":g[2]||(g[2]=p=>s.category=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(I,{class:"q-gutter-sm"},{default:t(()=>[o("div",null,[et,e(W,{modelValue:s.quantity,"onUpdate:modelValue":g[3]||(g[3]=p=>s.quantity=p),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),o("div",tt,[e(T,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:H})])]),_:1}),e(I,null,{default:t(()=>[e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(f,{align:"center"},{default:t(()=>[e(_,null,{default:t(()=>[i(" Premix Name ")]),_:1})]),_:1}),e(f,{align:"center"},{default:t(()=>[e(_,null,{default:t(()=>[i(" Quantity ")]),_:1})]),_:1}),e(f,{align:"center",side:""},{default:t(()=>[e(_,null,{default:t(()=>[i(" Action")]),_:1})]),_:1})]),_:1}),(v(!0),R(J,null,Z(P.value,(p,a)=>(v(),j(U,{key:a},{default:t(()=>[e(f,{align:"center"},{default:t(()=>[e(_,null,{default:t(()=>[i(y(p.name),1)]),_:2},1024)]),_:2},1024),e(f,{align:"center"},{default:t(()=>[e(_,null,{default:t(()=>[i(y(p.quantity),1)]),_:2},1024)]),_:2},1024),e(f,{align:"center",side:""},{default:t(()=>[e(_,null,{default:t(()=>[e(T,{onClick:l=>E(a),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(he,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(T,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(T,{class:"glossy",color:"teal",label:"Create",onClick:M,disable:!O.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var lt=se(at,[["__scopeId","data-v-6a45aa0f"]]);const rt={class:"text-h6 text-white"},ot={__name:"PremixPage",setup(c){return(S,$)=>(v(),j(X,{flat:""},{default:t(()=>[e(I,{style:{"background-color":"#ef4444"}},{default:t(()=>[o("div",rt,[e(de,{name:"scale"}),i(" Premix ")])]),_:1}),e(I,{class:"q-gutter-y-md"},{default:t(()=>[o("div",null,[e(lt)]),o("div",null,[e(je)])]),_:1})]),_:1}))}};var It=se(ot,[["__scopeId","data-v-22a44c73"]]);export{It as default};
