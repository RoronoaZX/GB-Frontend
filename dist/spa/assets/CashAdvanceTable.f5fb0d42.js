import{c as z,r as y,t as ee,u as j,o as u,a3 as q,f as l,M as I,w as n,Q as ae,I as k,ae as te,J as r,K as _,e as w,L as J,bc as oe,a0 as C,bd as F,a4 as M,a5 as O,$ as f,a1 as le,aJ as ne,a2 as se,O as H,R as G,z as re,bb as R,N}from"./index.94c77fd6.js";import{b as de,Q as D,a as ie}from"./QTable.c51a3968.js";import{Q as me}from"./QTr.8d6dd874.js";import{Q as T}from"./QTooltip.4dab85c8.js";import{Q as L}from"./QPopupEdit.7f5f33cc.js";import{Q as ue}from"./QSpinnerIos.50425f75.js";import{Q as ce}from"./QInnerLoading.91165b51.js";import{Q as pe}from"./QPage.3fc3d23e.js";import{Q as _e}from"./QSpace.65df66a4.js";import{Q as B,a as K}from"./QItem.8c9b5e82.js";import{Q as fe}from"./QList.efc29e9c.js";import{C as ye}from"./ClosePopup.f93b8122.js";import{u as ve}from"./employee.650041bf.js";import{u as W}from"./cash-advance.aede0cd0.js";/* empty css                                                                     */import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.4001b6e2.js";import"./use-virtual-scroll.01174c13.js";import"./QSelect.3d607b48.js";import"./QItemLabel.489c9a54.js";import"./QChip.f7beea7b.js";import"./QMenu.ede0aec6.js";import"./position-engine.27bd2550.js";import"./selection.a3acc90c.js";import"./axios.669ebcd4.js";const E=c=>(H("data-v-163132b5"),c=c(),G(),c),ge=E(()=>r("div",{class:"text-h5 q-mr-md"},"\u{1F4B2} Add Cash Advance",-1)),be={style:{position:"relative"}},he={key:0,class:"dropdown-list"},we={class:"row q-col-gutter-md q-mt-lg"},xe={class:"col-12 col-sm-6"},Ve=E(()=>r("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"}," Employee Name: ",-1)),Ae={class:"text-body1 text-weight-medium"},Qe={class:"col-12 col-sm-6"},Ce=E(()=>r("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Position:",-1)),Se={class:"text-body1 text-weight-medium"},Ne={class:"q-gutter-y-md"},qe={__name:"CashAdvanceButton",emits:["created"],setup(c,{emit:v}){const P=v,g=ve(),i=z(()=>g.employees),p=W(),d=y(""),x=y(!1),V=y(!1),b=y(!1),h=()=>{b.value=!0},A=async()=>{d.value.trim()&&(V.value=!0,await g.searchEmployee(d.value),V.value=!1)},U=e=>{s.employee_id=e.id,s.employee_name=`${e.firstname} ${e.middlename?e.middlename.charAt(0)+".":""} ${e.lastname}`,s.employee_position=e.position,d.value=""},s=ee({employee_id:"",employee_name:"",employee_position:"",amount:0,reason:"",number_of_payments:0,payment_per_payroll:0,remaining_payments:0});j(()=>[s.amount,s.number_of_payments],([e,t])=>{const a=parseFloat(e)||0,o=parseInt(t)||0;s.payment_per_payroll=o>0?(a/o).toFixed(2):0});const S=()=>{Object.assign(s,{employee_id:"",employee_name:"",employee_position:"",amount:0,reason:"",number_of_payments:0,payment_per_payroll:0,remaining_payments:0})},$=async()=>{s.remaining_payments=parseFloat(s.amount)||0,x.value=!0;try{await p.createCashAdvance(s),P("created"),b.value=!1,S()}catch(e){console.error(e)}finally{x.value=!1}};return(e,t)=>(u(),q("div",null,[l(I,{padding:"sm md",label:"Cash Advance",icon:"attach_money",size:"md",class:"gradient-btn text-white",onClick:h}),l(se,{modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=a=>b.value=a),persistent:"",position:"right","backdrop-filter":"blur(4px) saturate(150%)"},{default:n(()=>[l(ae,{class:"cash-advance-dialog-card"},{default:n(()=>[l(k,{class:"dialog-header row items-center no-wrap"},{default:n(()=>[ge,l(_e),te(l(I,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[ye]])]),_:1}),l(k,{class:"q-px-lg q-pt-md"},{default:n(()=>[r("div",be,[l(_,{modelValue:d.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>d.value=a),A],label:"Search Employee",outlined:"",rounded:"",dense:"",debounce:"500",placeholder:"Enter name"},{append:n(()=>[V.value?(u(),w(oe,{key:1,color:"grey",size:"sm"})):(u(),w(J,{key:0,name:"search"}))]),_:1},8,["modelValue"]),d.value?(u(),q("div",he,[l(fe,{separator:""},{default:n(()=>{var a;return[(a=i.value)!=null&&a.length?F("",!0):(u(),w(B,{key:0},{default:n(()=>[l(K,{class:"text-grey-7"},{default:n(()=>[C("No employee record")]),_:1})]),_:1})),(u(!0),q(M,null,O(i.value,o=>(u(),w(B,{key:o.id,clickable:"",onClick:m=>U(o)},{default:n(()=>[l(K,null,{default:n(()=>[C(f(`${o.firstname} ${o.middlename?o.middlename.charAt(0)+".":""} ${o.lastname}`),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})])):F("",!0)]),r("div",we,[r("div",xe,[Ve,r("div",Ae,f(s.employee_name||"----------"),1)]),r("div",Qe,[Ce,r("div",Se,f(s.employee_position||"----------"),1)])])]),_:1}),l(le,{inset:"",class:"q-mx-lg q-my-md"}),l(k,null,{default:n(()=>[r("div",Ne,[l(_,{dense:"",modelValue:s.amount,"onUpdate:modelValue":t[1]||(t[1]=a=>s.amount=a),type:"number",outlined:"",label:"Amount"},null,8,["modelValue"]),l(_,{dense:"",modelValue:s.number_of_payments,"onUpdate:modelValue":t[2]||(t[2]=a=>s.number_of_payments=a),type:"number",outlined:"",label:"Number of Payments"},null,8,["modelValue"]),l(_,{modelValue:s.payment_per_payroll,"onUpdate:modelValue":t[3]||(t[3]=a=>s.payment_per_payroll=a),outlined:"",dense:"",readonly:"",label:"Per Payroll"},null,8,["modelValue"]),l(_,{dense:"",modelValue:s.reason,"onUpdate:modelValue":t[4]||(t[4]=a=>s.reason=a),filled:"",type:"textarea",outlined:"",label:"Reason"},null,8,["modelValue"])])]),_:1}),l(ne,{align:"right",class:"q-px-lg q-pb-lg"},{default:n(()=>[l(I,{size:"md",padding:"xs md",label:"Save","icon-right":"send",class:"gradient-btn text-white",loading:x.value,onClick:$},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var Pe=X(qe,[["__scopeId","data-v-163132b5"]]);const Y=c=>(H("data-v-add450be"),c=c(),G(),c),Ue={class:"row justify-between q-mb-md",align:"right"},$e={class:"row q-gutter-md"},Ie=Y(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Amount ",-1)),ke={class:"text-subtitle2 q-mb-sm"},Ee=Y(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Reason ",-1)),Fe={class:"text-subtitle2 q-mb-sm"},Re={__name:"CashAdvanceTable",setup(c){const v=W(),P=z(()=>v.cashAdvances),g=y([]),i=y({page:1,rowsPerPage:0,rowsNumber:0}),p=y(!0),d=y("");function x(e){if(e==null||e==="")return"";const t=parseFloat(e);return isNaN(t)?"":Number.isInteger(t)?String(parseInt(t)):String(t)}async function V(e,t){p.value=!0;try{await v.updateAmount(e,t),N.create({message:"Amount updated successfully",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),N.create({message:"Failed to update amount",color:"negative",position:"top",timeout:2e3})}finally{p.value=!1}}async function b(e,t){p.value=!0;try{await v.updateReason(e,t),N.create({message:"Cash Advance reason updated successfully!",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),N.create({message:"Cash Advance reasons updated successfully!",color:"negative",position:"top",timeout:2e3})}finally{p.value=!1}}re(async()=>{await h()});const h=async(e=1,t=7,a="")=>{try{p.value=!0,await v.fetchCashAdvance(e,t,a);const{data:o,current_page:m,per_page:Q,total:Z}=P.value;g.value=o,console.log("Cash Advance",g.value),i.value.page=m,i.value.rowsPerPage=Q,i.value.rowsNumber=Z}catch(o){console.log("===================================="),console.log(o),console.log("====================================")}finally{p.value=!1}},A=e=>{const t=Q=>Q?Q.charAt(0).toUpperCase()+Q.slice(1).toLowerCase():"",a=e.firstname?t(e.firstname):"No Firstname",o=e.middlename?t(e.middlename).charAt(0)+".":"",m=e.lastname?t(e.lastname):"No Lastname";return`${a} ${o} ${m}`.trim()},U=e=>{h(e.pagination.page,e.pagination.rowsPerPage,e.filter)};j(d,async e=>{await h(i.value.page,i.value.rowsPerPage,e)});const s=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(e),S=e=>{if(!e)return" - - ";const t=new Date(e);return isNaN(t.getTime())?" - - ":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},$=[{name:"date",label:"Date Created",align:"left",field:e=>S(e.created_at)},{name:"date",label:"Date Updated",align:"left",field:e=>S(e.updated_at)},{name:"name",label:"Employee Name",align:"left",field:e=>A(e.employee)},{name:"amount",label:"Total Amount",align:"center",field:e=>s(e.amount)},{name:"number_of_payments",label:"Number of Payments",align:"center",field:e=>e.number_of_payments?e.number_of_payments:0},{name:"payment_per_payroll",label:"Payment per Payroll",align:"center",field:e=>s(e.payment_per_payroll)},{name:"remaining_payments",label:"Remaining Payments",align:"center",field:e=>s(e.remaining_payments)},{name:"reason",label:"Reason",align:"center",field:"reason"}];return(e,t)=>(u(),w(pe,{class:"q-my-md"},{default:n(()=>[r("div",Ue,[r("div",$e,[l(Pe,{onCreated:h})]),l(_,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),outlined:"",dense:"",debounce:"300",flat:"",label:"Search",style:{width:"300px"}},{append:n(()=>[r("div",null,[l(J,{name:"search"})])]),_:1},8,["modelValue"])]),l(ie,{rows:g.value,columns:$,"row-key":"name",pagination:i.value,"onUpdate:pagination":t[1]||(t[1]=a=>i.value=a),"rows-per-page-options":[5,7,10,0],loading:p.value,filter:d.value,onRequest:U},{header:n(a=>[l(me,{props:a,class:"gradient-header text-white text-weight-bold"},{default:n(()=>[(u(!0),q(M,null,O(a.cols,o=>(u(),w(de,{key:o.name,props:a,class:"text-center text-subtitle2"},{default:n(()=>[C(f(o.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-amount":n(a=>[l(D,{props:a,class:"cursor-pointer"},{default:n(()=>[r("span",null,f(a.row.amount?s(a.row.amount):" - - - "),1),l(T,{class:"bg-blue-grey-8"},{default:n(()=>[C("Edit Amount")]),_:1}),l(L,{"onUpdate:modelValue":[o=>V(a.row,o),o=>a.row.amount=o],modelValue:a.row.amount,buttons:"","label-set":"Save","label-cancel":"Close"},{default:n(o=>[Ie,r("div",ke," Name: "+f(A(a.row.employee)),1),l(_,{modelValue:o.value,"onUpdate:modelValue":[m=>o.value=m,m=>o.value=m],"model-value":x(o.value),type:"text",autofocus:"",counter:"",onKeyup:R(o.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","model-value","onKeyup"])]),_:2},1032,["onUpdate:modelValue","modelValue"])]),_:2},1032,["props"])]),"body-cell-reason":n(a=>[l(D,{props:a,class:"cursor-pointer"},{default:n(()=>[r("span",null,f(a.row.reason||" - - - "),1),l(T,{class:"bg-blue-grey-8"},{default:n(()=>[C("Edit Reason")]),_:1}),l(L,{modelValue:a.row.reason,"onUpdate:modelValue":[o=>a.row.reason=o,o=>b(a.row,o)],buttons:"","label-set":"Save","label-cancel":"Close"},{default:n(o=>[Ee,r("div",Fe," Name: "+f(A(a.row.employee)),1),l(_,{modelValue:o.value,"onUpdate:modelValue":m=>o.value=m,type:"text",autofocus:"",counter:"",onKeyup:R(o.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),loading:n(()=>[l(ce,{showing:""},{default:n(()=>[l(ue,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","pagination","loading","filter"])]),_:1}))}};var ia=X(Re,[["__scopeId","data-v-add450be"]]);export{ia as default};
