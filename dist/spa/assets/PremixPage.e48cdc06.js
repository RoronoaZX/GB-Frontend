import{c as Q,r as w,o as f,a3 as R,J as s,f as e,M as T,w as t,Q as X,I,$ as h,a0 as u,a4 as J,a5 as Z,be as me,e as j,bc as ee,a2 as ue,z as pe,bH as _e,u as ve,bo as fe,d as ge,P as ne,N as te,t as ye,ae as xe,K as W,L as de,aJ as he,O as be,R as we}from"./index.9dc8cc96.js";import{Q as ce}from"./QBadge.2ebc5504.js";import{Q as ie,a as Pe}from"./QTable.3eb90875.js";import{Q as qe}from"./QPagination.993b1954.js";import{Q as ke}from"./QBanner.8043b286.js";import{u as le}from"./baker-report.89914c19.js";import{u as oe}from"./premix.c535e72d.js";import{q as Qe}from"./date.5e952ae4.js";import{a as g}from"./QSelect.798cc745.js";import{a as U,b as y}from"./QMenu.b43f4494.js";import{Q as ae}from"./QList.de0e1a15.js";import{Q as Se,a as Ve}from"./QStepper.02251577.js";import{u as Ce}from"./use-quasar.3ce1137f.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Re}from"./QSpace.db4e567c.js";import{C as Ie}from"./ClosePopup.3546b783.js";import{api as $e}from"./axios.f4eed099.js";import"./QVirtualScroll.1fa8b828.js";import"./use-virtual-scroll.165d9211.js";import"./rtl.276c3f1b.js";import"./selection.98a221cb.js";import"./QChip.feab24e3.js";import"./position-engine.db16b124.js";import"./QSlideTransition.8e10a827.js";import"./use-panel.4dd85d67.js";import"./touch.9135741d.js";import"./use-render-cache.3aae9b27.js";const Ne={class:"row justify-between"},Te={class:"text-h6"},Be=s("div",{class:"text-h6",align:"center"},"Premix",-1),De=s("div",{class:"text-h6",align:"center"},"Ingredients List",-1),Le={class:"text-grey-7 q-mt-xs"},Ue=s("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1),Fe={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(c,{emit:S}){var l,v,m,A,p,d,_;const $=le(),k=Q(()=>$.user);console.log("userData in RawMaterialsTable:",k.value);const x=((v=(l=k.value)==null?void 0:l.data)==null?void 0:v.employee_id)||"",B=((A=(m=k.value)==null?void 0:m.device)==null?void 0:A.reference_id)||"";console.log("employeeId in PremixPage:",x),console.log("branchId in PremixPage:",B);const V=oe();Ce();const C=w(!1),N=w(!1),i=c;console.log("props in TransactionView:",i.report);const P=()=>{C.value=!0},b=a=>{const r=o=>o?o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():"";return`${r(a.firstname||"No Firstname")} ${a.middlename?r(a.middlename).charAt(0)+".":""} ${r(a.lastname||"No Lastname")}`},F=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],q=Q(()=>{var a;return(a=i.report.history)!=null&&a.length?F.filter(r=>i.report.history.some(o=>o.status===r.value)):[]}),H=a=>{const r=i.report.history.find(o=>o.status===a);return r?a==="received"?`Received by: ${b(r.employee)}`:a==="pending"?`Requested by: ${b(r.employee)}`:`Handled by: ${b(r.employee)}`:"No handler"},O=a=>{const r=Number(a);return isNaN(r)?"":(r%1===0,r.toString())},Y=(a,r)=>{if(r==="Pcs")return`${a} pcs`;if(r==="Grams"){if(a>=1e3){let o=a/1e3;return`${o%1===0?o.toString():o.toString().replace(/^0+/,"")} kgs`}return`${a} g`}return`${a} ${r}`},E=((_=(d=(p=i.report)==null?void 0:p.branch_premix)==null?void 0:d.branch_recipe)==null?void 0:_.ingredient_groups)||"Undefined";console.log("ingrdientsData",E);const K=Q(()=>E.map(a=>{const r=parseFloat(a.quantity)*parseFloat(i.report.quantity);return{...a,totalQuantity:r,formattedQuantity:Y(r,a.ingredient.unit)}}));console.log("report to proceed",i.report);const n=Q(()=>{var a,r;return((r=(a=i.report.history)==null?void 0:a[i.report.history.length-1])==null?void 0:r.status)||null});console.log("lastStatus",n.value);const M=Q(()=>q.value.findIndex(a=>a.value===n.value)+1),D=a=>{var r;return(r=i.report.history)==null?void 0:r.some(o=>o.status===a)},L=a=>({pending:"warning",declined:"red-6",confirmed:"green",process:"primary",completed:"dark","to deliver":"brown-9","to receive":"amber-10",received:"secondary"})[a]||"grey",z=async()=>{const a={request_premix_id:i.report.id,branch_premix_id:i.report.branch_premix_id,branch_id:i.report.branch_premix.branch_id,employee_id:x,status:"received",notes:"Received Premix",quantity:i.report.quantity,warehouse_id:i.report.warehouse_id,ingredients:K.value.map(r=>({ingredients_id:r.ingredient.id,total_quantity:r.totalQuantity,unit:r.ingredient.unit}))};console.log("payload",a),await V.receivePremix(a),await fetchRequestBranchEmployeePremix(B,x),C.value=!1};return(a,r)=>(f(),R(J,null,[s("div",null,[e(T,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:P})]),e(ue,{modelValue:C.value,"onUpdate:modelValue":r[2]||(r[2]=o=>C.value=o)},{default:t(()=>[e(X,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(I,null,{default:t(()=>[s("div",Ne,[s("div",Te,h(c.report.name),1),e(T,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:r[0]||(r[0]=o=>C.value=!1)})])]),_:1}),u(" "+h(c.report.id)+" ",1),e(I,null,{default:t(()=>[s("div",null,"Baker: "+h(b(c.report.employee)),1),s("div",null," Branch: "+h(c.report.branch_premix.branch_recipe.branch.name),1),s("div",null,[u(" Status: "),e(ce,{color:L(c.report.status),outlined:""},{default:t(()=>[u(h(c.report.status),1)]),_:1},8,["color"])])]),_:1}),e(I,{class:"q-gutter-y-md"},{default:t(()=>[s("div",null,[Be,e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[u("Premix Name")]),_:1})]),_:1}),e(y,{side:""},{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[u("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(U,null,{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-h6"},{default:t(()=>[u(h(c.report.name),1)]),_:1})]),_:1}),e(y,{side:""},{default:t(()=>[e(g,{class:"text-h6"},{default:t(()=>[u(h(O(c.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),s("div",null,[De,e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[u(" Code")]),_:1})]),_:1}),e(y,{side:""},{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[u("Quantity")]),_:1})]),_:1})]),_:1}),(f(!0),R(J,null,Z(me(E),(o,G)=>(f(),j(U,{key:G},{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-subtitle1"},{default:t(()=>[u(h(o.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(y,{side:""},{default:t(()=>[e(g,{class:"text-subtitle1"},{default:t(()=>[u(h(Y(o.quantity*c.report.quantity,o.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(Se,{modelValue:M.value,"onUpdate:modelValue":r[1]||(r[1]=o=>M.value=o),animated:"",class:"q-pa-lg"},{default:t(()=>[(f(!0),R(J,null,Z(q.value,(o,G)=>(f(),j(Ve,{key:G,name:G+1,title:o.label,color:L(o.value),done:D(o.value),icon:D(o.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[s("div",Le,h(H(o.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),n.value==="to receive"?(f(),j(I,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[Ue,e(T,{color:"amber-10",label:"Yes",icon:"check",onClick:z,loading:N.value},null,8,["loading"])]),_:1})):ee("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};const Ee={class:"q-pa-lg flex flex-center"},Me={key:0,class:"loading-overlay row justify-center items-center"},ze={key:1,class:"q-pa-md q-gutter-md row justify-center"},Ae={__name:"PremixTable",setup(c){var M,D,L,z;const S=le(),$=Q(()=>S.user);console.log("userData in RawMaterialsTable:",$.value);const k=((D=(M=$.value)==null?void 0:M.device)==null?void 0:D.reference_id)||"";console.log("branchId in PremixPage:",k);const x=oe(),B=Q(()=>x.branchEmployeePremix),V=((z=(L=$.value)==null?void 0:L.data)==null?void 0:z.employee_id)||"";console.log("employeeId in PremixPagess:",V);const C=w(""),N=w(!0),i=w(!0),P=w(!1),b=w([]),F=w(1),q=w({page:1,rowsPerPage:10,rowsNumber:10,sortBy:"id",descending:!1});pe(async()=>{V&&await H(),console.log("premixdatas",B.value)});const H=async()=>{i.value=!0;try{const{page:l,rowsNumber:v,rowsPerPage:m,sortBy:A,descending:p}=q.value,d=await x.fetchRequestBranchEmployeePremix(k,V,l,v,m,A,p);b.value=d.data,F.value=d.last_page,q.value.rowsPerPage=d.per_page||10,P.value=b.value.length===0}catch(l){console.error("Error fetching premix report:",l)}i.value=!1};_e(()=>{V&&H()}),ve(C,()=>{N.value=!0,setTimeout(()=>{N.value=!1})});const O=l=>Qe.formatDate(l,"MMMM D, YYYY - hh:mm A"),Y=l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase(),E=l=>l?l.toLowerCase().split(" ").map(v=>v.charAt(0).toUpperCase()+v.slice(1)).join(" "):"",K=l=>{switch(l){case"pending":return"warning";case"declined":return"red-6";case"confirmed":return"green";case"process":return"primary";case"completed":return"dark";case"to deliver":return"brown-9";case"to receive":return"amber-10";case"received":return"secondary";default:return"grey"}},n=[{name:"name",label:"Transactions Name",align:"left",field:l=>l.name?E(l.name):"N/A",format:l=>`${l}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:l=>O(l),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(l,v)=>(f(),R("div",null,[e(Pe,{flat:"",columns:n,rows:b.value,"row-key":"id",bordered:"",dense:"",modelValue:q.value,"onUpdate:modelValue":v[0]||(v[0]=m=>q.value=m),pagination:q.value.rowsPerPage,"rows-per-page-options":[10]},{"body-cell-status":t(m=>[e(ie,{props:m},{default:t(()=>[e(ce,{outlined:"",color:K(m.row.status)},{default:t(()=>[u(h(Y(m.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(m=>[e(ie,{props:m},{default:t(()=>[s("div",null,[e(Fe,{report:m.row,onUpdateHistory:l.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["rows","modelValue","pagination"]),s("div",Ee,[e(qe,{modelValue:q.value.page,"onUpdate:modelValue":[v[1]||(v[1]=m=>q.value.page=m),v[2]||(v[2]=m=>l.reloadTableData(l.userId))],color:"purple",max:F.value,"max-pages":F.value,"boundary-numbers":""},null,8,["modelValue","max","max-pages"])]),i.value?(f(),R("div",Me,[e(fe,{size:"50px"})])):ee("",!0),P.value?(f(),R("div",ze,[e(ke,{class:"bg-grey-1",dense:""},{default:t(()=>[u(" No data available ")]),_:1})])):ee("",!0)]))}};var je=se(Ae,[["__scopeId","data-v-3282fea5"]]);const He=ge("request-premix",()=>{const c=w(null),S=w([]);return{requestPremix:c,requestPremixes:S,saveRequestPremix:async k=>{console.log("data request oremix",k),ne.show();try{const x=await $e.post("/api/request-premix",{requests:k});console.log("response",x.data),te.create({type:"positive",message:"Request Premix successfully"})}catch(x){console.error(x),te.create({type:"negative",message:"Request Premix Error"})}finally{ne.hide()}}}});const re=c=>(be("data-v-de78a87a"),c=c(),we(),c),Ye={align:"right"},Ke=re(()=>s("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),Je={class:"q-ma-md"},Oe={key:0,class:"custom-list z-top"},Ge={class:"q-mb-sm"},We=re(()=>s("div",null,"Premix Name",-1)),Xe={class:"q-mb-lg"},Ze=re(()=>s("div",null,"Category",-1)),et=re(()=>s("div",null,"Quantity",-1)),tt={align:"right"},at={__name:"RequestPremix",setup(c){var D,L,z,l,v,m,A;const S=w(!1),$=()=>{S.value=!0},k=le(),x=Q(()=>k.user);console.log("userData in RawMaterialsTable:",x.value);const B=((L=(D=x.value)==null?void 0:D.device)==null?void 0:L.reference_id)||"";console.log("branchId in PremixPage:",B);const V=((v=(l=(z=x.value)==null?void 0:z.device)==null?void 0:l.reference)==null?void 0:v.warehouse_id)||"";console.log("warehouseId in PremixPage:",V);const C=((A=(m=x.value)==null?void 0:m.data)==null?void 0:A.employee_id)||"";console.log("warehouseId in PremixPage:",V);const N=oe(),i=Q(()=>N.premixes);Q(()=>N.branchEmployeePremix),console.log("premixdatas",i.value),He();const P=w([]),b=w(""),F=async()=>{await N.searchPremix(b.value,B)},q=p=>{console.log("data",p),n.branch_premix_id=p.id,n.name=p.name,n.category=p.category,b.value=""},H=p=>p?p.split(" ").map(d=>d.charAt(0).toUpperCase()+d.slice(1).toLowerCase()).join(" "):"",O=Q(()=>P.value!==0),Y=()=>{const p=P.value.push({branch_premix_id:n.branch_premix_id,warehouse_id:n.warehouse_id,employee_id:n.employee_id,name:n.name,category:n.category,quantity:n.quantity,status:n.status});console.log("premix",p),K()},E=p=>{P.value.splice(p,1)},K=()=>{n.branch_premix_id=0,n.name="",n.category="",n.quantity=0},n=ye({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:V,employee_id:C,status:"pending"}),M=async()=>{try{console.log("Data sent for premix request:",P.value),await N.saveRequestPremix(P.value,B,C),te.create({type:"positive",message:"Premix request saved successfully!"}),K(),P.value=[],S.value=!1}catch(p){console.error("Failed to save premix request:",p),te.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(p,d)=>(f(),R(J,null,[s("div",Ye,[e(T,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:$})]),e(ue,{modelValue:S.value,"onUpdate:modelValue":d[4]||(d[4]=_=>S.value=_),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(X,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(I,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[Ke,e(Re),xe(e(T,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Ie]])]),_:1}),s("div",Je,[e(W,{modelValue:b.value,"onUpdate:modelValue":[d[0]||(d[0]=_=>b.value=_),F],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[s("div",null,[e(de,{name:"search"})])]),default:t(()=>[b.value?(f(),R("div",Oe,[e(X,null,{default:t(()=>[e(ae,{separator:""},{default:t(()=>{var _;return[(_=i.value)!=null&&_.length?(f(!0),R(J,{key:1},Z(i.value,a=>(f(),j(U,{key:a.id,onClick:r=>q(a),clickable:""},{default:t(()=>[e(y,null,{default:t(()=>[e(g,null,{default:t(()=>[u(h(H(a==null?void 0:a.name)),1)]),_:2},1024)]),_:2},1024),e(y,null,{default:t(()=>[e(g,{side:""},{default:t(()=>[u(h(a==null?void 0:a.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(f(),j(U,{key:0},{default:t(()=>[u(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):ee("",!0)]),_:1},8,["modelValue"])]),e(I,null,{default:t(()=>[s("div",Ge,[We,e(W,{modelValue:n.name,"onUpdate:modelValue":d[1]||(d[1]=_=>n.name=_),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),s("div",Xe,[Ze,e(W,{modelValue:n.category,"onUpdate:modelValue":d[2]||(d[2]=_=>n.category=_),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(I,{class:"q-gutter-sm"},{default:t(()=>[s("div",null,[et,e(W,{modelValue:n.quantity,"onUpdate:modelValue":d[3]||(d[3]=_=>n.quantity=_),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),s("div",tt,[e(T,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:Y})])]),_:1}),e(I,null,{default:t(()=>[e(ae,{dense:"",separator:"",class:"box"},{default:t(()=>[e(U,null,{default:t(()=>[e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[u(" Premix Name ")]),_:1})]),_:1}),e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[u(" Quantity ")]),_:1})]),_:1}),e(y,{align:"center",side:""},{default:t(()=>[e(g,null,{default:t(()=>[u(" Action")]),_:1})]),_:1})]),_:1}),(f(!0),R(J,null,Z(P.value,(_,a)=>(f(),j(U,{key:a},{default:t(()=>[e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[u(h(_.name),1)]),_:2},1024)]),_:2},1024),e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[u(h(_.quantity),1)]),_:2},1024)]),_:2},1024),e(y,{align:"center",side:""},{default:t(()=>[e(g,null,{default:t(()=>[e(T,{onClick:r=>E(a),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(he,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(T,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(T,{class:"glossy",color:"teal",label:"Create",onClick:M,disable:!O.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var rt=se(at,[["__scopeId","data-v-de78a87a"]]);const lt={class:"text-h6 text-white"},ot={__name:"PremixPage",setup(c){return(S,$)=>(f(),j(X,{flat:""},{default:t(()=>[e(I,{style:{"background-color":"#ef4444"}},{default:t(()=>[s("div",lt,[e(de,{name:"scale"}),u(" Premix ")])]),_:1}),e(I,{class:"q-gutter-y-md"},{default:t(()=>[s("div",null,[e(rt)]),s("div",null,[e(je)])]),_:1})]),_:1}))}};var Nt=se(ot,[["__scopeId","data-v-626e0eca"]]);export{Nt as default};
