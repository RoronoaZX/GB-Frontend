import{c as K,r as i,o as g,a3 as Y,J as n,f as l,w as r,K as _e,Q,a2 as he,a4 as J,L as De,e as Z,a0 as q,a5 as be,$ as f,be as we,Z as Se,a1 as E,M as _,I as xe,ae as ye,O as $e,R as ke}from"./index.7086e46e.js";import{a as G,b as Te}from"./QMenu.4934e990.js";import{Q as Ce}from"./QList.0fe74f69.js";import{a as Re,Q as Ne}from"./QTable.cbefb423.js";import{C as Ie}from"./ClosePopup.269d3944.js";/* empty css                                                                      */import{_ as ze}from"./plugin-vue_export-helper.21dcd24c.js";import{u as Me}from"./employee.fb8b6017.js";import{u as Ye}from"./dtr.8c888adf.js";import{q as y}from"./date.ab2b4f42.js";import{p as X,v as Qe}from"./vfs_fontes.6ee410e6.js";import"./position-engine.18686754.js";import"./selection.0e5bcdb3.js";import"./QVirtualScroll.039cef80.js";import"./use-virtual-scroll.45c35380.js";import"./rtl.276c3f1b.js";import"./QSelect.cec6a237.js";import"./QChip.ec932d10.js";import"./axios.85c2a862.js";const ee=h=>($e("data-v-f104340c"),h=h(),ke(),h),qe={class:"q-my-md",align:"right"},Ee={key:0,class:"custom-list z-top"},Ue={class:"row"},Oe={class:"col-3 q-ma-lg",align:"center"},Ae={class:"q-pa-lg"},Le=["src"],Pe={class:"row q-mt-lg",align:"left"},Ve=ee(()=>n("div",{class:"col-3"},[n("div",null,"Name:"),n("div",null,"Position:"),n("div",null,"Age:")],-1)),Fe={class:"col-9"},He={class:"col-8 q-ml-lg"},We={class:"row justify-between"},Be={class:"row justify-between q-mt-md"},je={class:"row"},Ke={class:"q-my-md"},Je={class:"text-overline"},Ze={class:"row justify-between text-h6 text-white"},Ge=ee(()=>n("div",null,"\u{1F5D3}\uFE0F Daily Time Record",-1)),Xe=["src"],et={__name:"AttendanceSummary",setup(h){X.exports.vfs=Qe;const U=Me(),O=K(()=>U.employees),$=Ye(),A=i("https://cdn.quasar.dev/img/boy-avatar.png"),p=i("");i(null);const D=i(null),c=i(""),u=i(""),k=i(""),T=i(""),C=i(""),R=i(!1),L=i("");i(!1);const te=()=>{A.value="https://cdn.quasar.dev/img/boy-avatar.png"},P=i({rowsPerPage:0}),ae=async()=>{p.value.trim()&&await U.searchEmployee(p.value)},oe=async e=>{p.value="",k.value=V(e),T.value=e.position||"Unknown",C.value=ne(e.birthdate),D.value=e.id;const t=y.formatDate(new Date,"YYYY-MM-DD");if(t){const{startDate:a,endDate:o}=b(t);c.value=a,u.value=o;const s={employee_id:D.value,start_date:c.value,end_date:u.value};await $.fetchDTRRange(s),console.log("Request Data:",s)}else console.error("Failed to format the current date")},ne=e=>{if(!e)return"N/A";const t=new Date(e),a=new Date;let o=a.getFullYear()-t.getFullYear();const s=a.getMonth()-t.getMonth();return(s<0||s===0&&a.getDate()<t.getDate())&&o--,o},V=e=>{const t=d=>d?d.charAt(0).toUpperCase()+d.slice(1).toLowerCase():"",a=e.firstname?t(e.firstname):"No Firstname",o=e.middlename?t(e.middlename).charAt(0)+".":"",s=e.lastname?t(e.lastname):"No Lastname";return`${a} ${o} ${s}`},F=()=>{const e=y.formatDate(new Date,"YYYY-MM-DD"),{startDate:t,endDate:a}=b(e);c.value=t,u.value=a},b=e=>{if(!e)return console.error("Invalid formatted date:",e),{startDate:null,endDate:null};const t=parseInt(e.slice(8,10),10);let a,o;if(t>=11&&t<=25)a=`${e.slice(0,7)}-11`,o=`${e.slice(0,7)}-25`;else{const s=t>=26?e.slice(5,7):(parseInt(e.slice(5,7),10)-1).toString().padStart(2,"0"),d=t>=26?(parseInt(e.slice(5,7),10)+1).toString().padStart(2,"0"):e.slice(5,7);a=`${e.slice(0,4)}-${s}-26`,o=`${e.slice(0,4)}-${d}-10`}return console.log("Calculated Start Date:",a),console.log("Calculated End Date:",o),{startDate:a,endDate:o}},m=e=>{const t=new Date(e);if(isNaN(t.getTime()))return" - - - ";const a={month:"short",day:"2-digit",year:"numeric"},o=t.toLocaleDateString("en-US",a).replace(",",""),[s,d,v]=o.split(" ");return`${s}. ${d}, ${v}`},le=m(c.value);console.log("formattedStart",le),m(new Date(c)),m(new Date(u));const N=K(()=>{const e=$.dtrCutOffData;console.log("DTR Data",e);const t=o=>o?o.charAt(0).toUpperCase()+o.slice(1).toLowerCase():" - - - ",a=(o,s)=>{if(!o||!s)return" - - - ";const d=new Date(o),v=new Date(s);if(isNaN(d.getTime())||isNaN(v.getTime()))return" - - - ";const w=v-d;if(w<=0)return" - - - ";const S=Math.floor(w/(1e3*60)),z=String(Math.floor(S/60)).padStart(2,"0"),x=String(S%60).padStart(2,"0");return`${z} h : ${x} m`};return e.map((o,s)=>{const d=o.time_in,v=o.time_out,w=o.overtime_start,S=o.overtime_end,z=o.ot_status||" - - - ",x=t(z),M=a(d,v),me=x.toLowerCase()==="approved"?a(w,S):" - - - ";let H=" - - - ";const W=9;if(M!==" - - - "){const[fe,pe]=M.split(" h : "),B=parseInt(fe,10)+parseInt(pe,10)/60;if(B<W){const j=(W-B)*60,ve=String(Math.floor(j/60)).padStart(2,"0"),ge=String(Math.floor(j%60)).padStart(2,"0");H=`${ve} h : ${ge} m`}}return{entry:s+1,time_in:o.time_in,time_out:o.time_out,total_working_hours:M,undertime:H,overtime:me,ot_status:x}})}),I=async()=>{D.value&&c.value&&u.value&&await $.fetchDTRRange({employee_id:D.value,start_date:c.value,end_date:u.value})};console.log("DTR ROW",N.value);const se=()=>{const e=new Date(c.value);e.setDate(e.getDate()-15);const{startDate:t,endDate:a}=b(y.formatDate(e,"YYYY-MM-DD"));c.value=t,u.value=a,I()},re=()=>{const e=new Date(u.value);e.setDate(e.getDate()+1);const{startDate:t,endDate:a}=b(y.formatDate(e,"YYYY-MM-DD"));c.value=t,u.value=a,I()},ie=()=>{F(),I()};F();const ce=e=>{const t=de();X.exports.createPdf(t).getDataUrl(a=>{L.value=a,R.value=!0})},de=()=>({pageMargins:[40,40,-10,40],content:[{text:"Daily Time Record",style:"header"},{text:[{text:"From: ",bold:!1,fontSize:8},{text:` ${m(c.value)}`,bold:!0,decoration:"underline",fontSize:10}],margin:[0,0,0,3]},{text:[{text:"To: ",bold:!1,fontSize:8},{text:`     ${m(u.value)}`,bold:!0,decoration:"underline",fontSize:10}],margin:[0,0,0,10]},{columns:[{text:[{text:"Employee Name:",bold:!1,fontSize:8},{text:`  ${k.value}`,bold:!0,decoration:"underline",fontSize:10}]},{text:[{text:"Position:",bold:!1,fontSize:8},{text:`  ${T.value}`,bold:!0,decoration:"underline",fontSize:10}]},{text:[{text:"Age:",bold:!1,fontSize:8},{text:`  ${C.value}`,bold:!0,decoration:"underline",fontSize:10}]}],margin:[0,0,0,10]},{table:{headerRows:1,widths:["auto","auto","auto","auto","auto","auto"],body:[[{text:"Number of Days",bold:!0},{text:"Time In",bold:!0,alignment:"center"},{text:"Time Out",bold:!0,alignment:"center"},{text:"Total Working Hours",bold:!0},{text:"Undertime",bold:!0},{text:"Overtime",bold:!0}],...N.value.map(e=>[{text:e.entry,alignment:"center"},{text:e.time_in||" - - - ",alignment:"center"},{text:e.time_out||" - - - ",alignment:"center"},{text:e.total_working_hours||" - - - ",alignment:"center"},{text:e.undertime||" - - - ",alignment:"center"},{text:e.overtime||" - - - ",alignment:"center"}])]},layout:{hLineWidth:function(e,t){return e===0||e===t.table.body.length?1:.5},vLineWidth:function(e,t){return .5},hLineColor:function(e,t){return e===0||e===t.table.body.length?"black":"#ccc"},vLineColor:function(e,t){return"#ccc"}}}],styles:{header:{fontSize:14,bold:!0,alignment:"center",margin:[0,5,0,10]},tableHeader:{bold:!0,fontSize:13,color:"black"}},defaultStyle:{fontSize:9}}),ue=[{name:"number_of_days",required:!0,label:"NOD",align:"center",field:e=>e.entry,format:e=>`${e}`},{name:"in",align:"center",label:"IN",field:"time_in",format:e=>{if(!e)return"";const t=e.split(", ");return t.length<2?e:`${t[0]}, ${t[1]} || ${t[2]}`}},{name:"out",label:"OUT",align:"center",field:"time_out",format:e=>{if(!e)return"";const t=e.split(", ");return t.length<2?e:`${t[0]}, ${t[1]} || ${t[2]}`}},{name:"total_working_hours",label:"Total Hours",align:"center",field:"total_working_hours"},{name:"undertime",label:"Undertime",field:"undertime",align:"center"},{name:"overtime",label:"OT",field:"overtime",align:"center"},{name:"ot_status",label:"OT Stat",field:"ot_status",align:"center"}];return(e,t)=>(g(),Y(J,null,[n("div",qe,[l(_e,{modelValue:p.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>p.value=a),ae],debounce:"500",outlined:"",dense:"",flat:"",label:"Search",style:{width:"300px"}},{append:r(()=>[n("div",null,[l(De,{name:"search"})])]),default:r(()=>[p.value?(g(),Y("div",Ee,[l(Q,null,{default:r(()=>[l(Ce,{separator:""},{default:r(()=>{var a;return[(a=O.value)!=null&&a.length?(g(!0),Y(J,{key:1},be(O.value,o=>(g(),Z(G,{key:o.id,clickable:"",onClick:s=>oe(o)},{default:r(()=>[l(Te,null,{default:r(()=>[q(f(V(o)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(g(),Z(G,{key:0},{default:r(()=>[q(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):we("",!0)]),_:1},8,["modelValue"])]),n("div",null,[l(Q,{bordered:"",dense:"",flat:"",class:"q-pa-md"},{default:r(()=>[n("div",Ue,[n("div",Oe,[n("div",Ae,[l(Se,{size:"150px",color:"grey-2"},{default:r(()=>[n("img",{src:A.value,onError:te},null,40,Le)]),_:1})]),n("div",Pe,[Ve,n("div",Fe,[n("div",null,f(k.value),1),n("div",null,f(T.value),1),n("div",null,f(C.value),1)])])]),l(E,{vertical:""}),n("div",He,[n("div",We,[n("div",null,"From: "+f(m(c.value)),1),n("div",null,"To: "+f(m(u.value)),1)]),n("div",Be,[n("div",null,[n("div",je,[l(_,{padding:"sm md",size:"sm",dense:"",flat:"",label:"prev",icon:"arrow_back_ios_new",onClick:se}),l(E,{vertical:""}),l(_,{padding:"sm md",size:"sm",dense:"",flat:"",onClick:ie},{default:r(()=>[q("CURRENT")]),_:1}),l(E,{vertical:""}),l(_,{padding:"sm md",size:"sm",dense:"",flat:"",label:"next",icon:"arrow_forward_ios",onClick:re})])]),n("div",null,[l(_,{padding:"sm md",size:"sm",icon:"print",dense:"",label:"PRINT",class:"gradient-btn text-white",onClick:ce})])]),n("div",Ke,[l(Re,{flat:"",bordered:"",separator:"cell",rows:N.value,columns:ue,"row-key":"entry",class:"full-height-table",pagination:P.value,"onUpdate:pagination":t[1]||(t[1]=a=>P.value=a),"hide-bottom":""},{"body-cell":r(a=>[l(Ne,{props:a},{default:r(()=>[n("span",Je,f(a.value),1)]),_:2},1032,["props"])]),_:1},8,["rows","pagination"])])])])]),_:1})]),l(he,{modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=a=>R.value=a),"full-height":"",position:"right","backdrop-filter":"blur(4px) saturate(150%)"},{default:r(()=>[l(Q,{style:{width:"820px","max-width":"80vw"}},{default:r(()=>[l(xe,{class:"gradient-btn"},{default:r(()=>[n("div",Ze,[Ge,n("div",null,[ye(l(_,{rounded:"",flat:"",dense:"",icon:"arrow_forward_ios"},null,512),[[Ie]])])])]),_:1}),n("div",null,[n("iframe",{src:L.value,width:"100%",height:"700px"},null,8,Xe)])]),_:1})]),_:1},8,["modelValue"])],64))}};var bt=ze(et,[["__scopeId","data-v-f104340c"]]);export{bt as default};
