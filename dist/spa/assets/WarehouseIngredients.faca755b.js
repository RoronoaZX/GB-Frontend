import{bd as de,c as D,r as v,t as Z,o as m,a2 as I,f as e,M as Q,w as s,Q as se,I as M,ad as ee,a0 as z,J as r,K as A,$ as q,a3 as P,a4 as ce,e as W,_ as F,ba as me,aH as pe,aI as _e,a1 as ve,O as le,R as oe,u as fe,z as we,L as K,aJ as ye}from"./index.05f93853.js";import{Q as he}from"./QSpace.0aba2a93.js";import{Q as U}from"./rtl.224cb24e.js";import{Q as ge,a as j,b as k}from"./QList.646d4200.js";import{Q as ae}from"./QSelect.13436b4e.js";import{C as te}from"./ClosePopup.a767fcf6.js";import{u as ne}from"./warehouse-rawMaterials.4520a1fa.js";import{_ as re}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as be}from"./QSpinnerDots.ce61358f.js";import{Q as xe}from"./QChip.a0c0118b.js";import{Q as ke,a as qe}from"./QTable.9f9db3a0.js";import"./use-virtual-scroll.a59ec5d8.js";import"./QMenu.3636c5fa.js";import"./selection.4c477115.js";import"./axios.a8d41f8b.js";import"./raw-material.cbb5b2d7.js";import"./QVirtualScroll.5988253a.js";const S=p=>(le("data-v-b92bea88"),p=p(),oe(),p),Qe=S(()=>r("div",{class:"text-h6"},"Add Supply",-1)),Ie=S(()=>r("div",{class:"q-my-sm"},"Supplier's Company Name",-1)),Me=S(()=>r("div",{class:"q-my-sm"},"Supplier's Name",-1)),Se={class:"q-mt-md q-gutter-y-sm"},Ce={class:"q-my-md"},Re=S(()=>r("div",{class:"q-my-sm"},"Raw Materials Name",-1)),Ne={class:"row q-gutter-x-sm q-gutter-y-lg"},Ve=S(()=>r("div",{class:"q-my-sm",align:"center"},"Quantity",-1)),$e=S(()=>r("div",{class:"q-my-sm",align:"center"},"Unit",-1)),De=["onKeyup"],We={class:"q-mt-sm"},Te={__name:"WarehouseIngredientsCreateSupply",setup(p){var E,J,H,X;de();const c=ne(),C=D(()=>c.user);console.log("userData",C.value);const f=((J=(E=C.value)==null?void 0:E.employee)==null?void 0:J.warehouse_id)||"";console.log("warehouseId",f);const h=((X=(H=C.value)==null?void 0:H.employee)==null?void 0:X.employee_id)||"";console.log("employeeId",h);const _=v(!1),g=D(()=>c.warehouseRawMaterials),O=()=>{_.value=!0},R=v(!1),w=v([]),y=v([]),u=Z({name:"",quantity:"",unit:""}),B=[{label:"Sack (25 kg each)",value:"sack"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],N=v(y.value);(async()=>{try{const n=f;console.log("warehouse_id",n);const a=await c.fetchWarehouseRawMaterials(n);R.value=!1,y.value=c.warehouseRawMaterials.map(t=>({label:t.raw_materials.name,value:t.raw_materials.id,suffix:t.raw_materials.unit})),console.log("rawMaterialsOptions",y.value)}catch(n){console.error("Error fetching warehouse raw materials:",n)}})();const V=()=>{u.name="",u.quantity="",u.unit=""},T=(n,a)=>{a(()=>{if(n==="")N.value=y.value;else{const t=n.toLowerCase();N.value=y.value.filter($=>$.label.toLowerCase().includes(t)>-1)}})},l=()=>{console.log("clickckck");const n=w.value;function a(Y,ie){return Y.find(ue=>ue.raw_material_id==ie)}const t=u.name.value;a(n,t)||(w.value=[...n,{raw_material_id:u.name.value,label:u.name.label,quantity:u.quantity,unit:u.unit}],V())},o=n=>{w.value.splice(n,1)},d=n=>n?n.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"",i=Z({companyName:"",supplierName:""}),L=()=>{i.companyName="",i.supplierName="",w.value=[]},b=n=>n.map(a=>{let t=a.quantity;return a.unit.value==="sack"?t=a.quantity*25e3:a.unit.value==="kilo"?t=a.quantity*1e3:a.unit.value==="gram"&&(t=a.quantity),{...a,convertedQuantity:t,unit:{...a.unit,value:"gram"}}}),x=async()=>{const n=b(w.value),a={employee_id:h,warehouse_id:f,supplier_company_name:i.companyName,supplier_name:i.supplierName,raw_materials:n.map(t=>({raw_material_id:t.raw_material_id,quantity:t.convertedQuantity,unit:t.unit.value}))};await c.warehouseAddSupply(a),g.value=await c.fetchWarehouseRawMaterials(f),V(),L(),_.value=!1};return(n,a)=>(m(),I(P,null,[e(Q,{class:"q-pa-sm",color:"red",dense:"",elevated:"",icon:"add_circle",label:"Add Supply",onClick:O}),e(ve,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=t=>_.value=t)},{default:s(()=>[e(se,{class:"my-card",style:{width:"900px"}},{default:s(()=>[e(M,{class:"row items-center"},{default:s(()=>[Qe,e(he),ee(e(Q,{icon:"close",flat:"",dense:"",round:""},null,512),[[te]])]),_:1}),e(z),e(M,{class:"q-my-md q-mx-sm q-gutter-y-sm"},{default:s(()=>[r("div",null,[Ie,e(A,{modelValue:i.companyName,"onUpdate:modelValue":a[0]||(a[0]=t=>i.companyName=t),outlined:"",dense:""},null,8,["modelValue"])]),r("div",null,[Me,e(A,{modelValue:i.supplierName,"onUpdate:modelValue":a[1]||(a[1]=t=>i.supplierName=t),outlined:"",dense:""},null,8,["modelValue"])])]),_:1}),e(z),e(M,null,{default:s(()=>[r("div",Se,[r("div",null,[e(ge,{dense:"",separator:"",class:"box"},{default:s(()=>[e(j,null,{default:s(()=>[e(k,null,{default:s(()=>[e(U,{class:"text-overline"},{default:s(()=>[q("Raw Materials Name")]),_:1})]),_:1}),e(k,null,{default:s(()=>[e(U,{class:"text-overline"},{default:s(()=>[q("Quantity")]),_:1})]),_:1}),e(k,{side:""})]),_:1}),(m(!0),I(P,null,ce(w.value,(t,$)=>(m(),W(j,{key:$},{default:s(()=>[e(k,null,{default:s(()=>[e(U,{class:"text-caption"},{default:s(()=>[q(F(d(t.label)),1)]),_:2},1024)]),_:2},1024),e(k,null,{default:s(()=>[e(U,{class:"text-caption justify-between"},{default:s(()=>[q(F(t.quantity)+" "+F(t.unit.value),1)]),_:2},1024)]),_:2},1024),e(k,{side:""},{default:s(()=>[e(Q,{onClick:Y=>o($),color:"grey-10",icon:"backspace",dense:"",flat:"",round:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1}),e(M,null,{default:s(()=>[r("div",Ce,[Re,e(ae,{modelValue:u.name,"onUpdate:modelValue":a[2]||(a[2]=t=>u.name=t),debounce:"3000",outlined:"","chips-color":"primary",options:N.value,dense:"",label:"Raw Materials",behavior:"menu","use-input":"",suffix:u.suffix,"hide-dropdown-icon":"",onFilter:T},{"no-option":s(()=>[e(j,null,{default:s(()=>[e(k,{class:"text-grey"},{default:s(()=>[q(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","suffix"])]),r("div",Ne,[r("div",null,[Ve,e(A,{modelValue:u.quantity,"onUpdate:modelValue":a[3]||(a[3]=t=>u.quantity=t),type:"number",outlined:"",dense:"",style:{width:"300px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])]),r("div",null,[$e,e(ae,{modelValue:u.unit,"onUpdate:modelValue":a[4]||(a[4]=t=>u.unit=t),options:B,outlined:"",behavior:"menu",dense:"",style:{width:"300px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])])]),r("form",{onKeyup:me(pe(l,["prevent"]),["enter"])},[r("div",We,[e(Q,{size:"sm",outline:"",dense:"",icon:"add",color:"purple",onClick:l})])],40,De)]),_:1}),e(z),e(_e,{class:"row q-ma-md",align:"right"},{default:s(()=>[ee(e(Q,{class:"glossy",color:"grey-9",label:"Cancel"},null,512),[[te]]),e(Q,{class:"glossy",color:"teal",label:"Create",onClick:x})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var Le=re(Te,[["__scopeId","data-v-b92bea88"]]);const Ue=p=>(le("data-v-fcadadc0"),p=p(),oe(),p),ze={class:"q-mb-sm"},Ae={key:0,class:"spinner-wrapper"},Fe={key:1},Oe={key:0,class:"data-error"},Be=Ue(()=>r("div",{class:"q-ml-sm text-h6"},"No data available",-1)),Ke={__name:"WarehouseIngredientsTable",setup(p){var V,T;const c=ne(),f=((T=(V=D(()=>c.user).value)==null?void 0:V.employee)==null?void 0:T.warehouse_id)||"",h=D(()=>c.warehouseRawMaterials),_=v(!0);console.log("warehouse id",f);const g=v(""),O=v(!1),R=v(!1),w=v({rowsPerPage:0}),y=D(()=>g.value?h.value.filter(l=>l.name.toLowerCase().includes(g.value.toLowerCase())):h.value);fe(g,async l=>{_.value=!0,await new Promise(o=>setTimeout(o,1e3)),_.value=!1,R.value=y.value.length===0}),we(async()=>{console.log("props.warehouseId in onMounted:",f),f&&await u(f)});const u=async l=>{console.log("Fetching raw materials for warehouse ID:",l);try{_.value=!0;const o=await c.fetchWarehouseRawMaterials(l);h.value=o,h.value.length||(R.value=!0),console.log("Warehouse Raw Materialsss",h.value)}catch(o){console.log("Error fetching warehouse product:",o),R.value=!0}finally{_.value=!1}},B=l=>{const o=l.total_quantity,d=l.raw_materials.unit;if(console.log("unit test",d),d==="Grams"&&o<1e3)return"bg-red";let i;return o>=1e3?i=o/1e3:i=o,i<5?i<=2?"bg-red":(i<=3,"bg-warning"):"bg-positive"},N=l=>{var L;const o=Number(l==null?void 0:l.total_quantity)||0,d=((L=l==null?void 0:l.raw_materials)==null?void 0:L.unit)||"units";console.log("totalQuantity:",o),console.log("unit:",d);const i=b=>{const x=Number(b);return Number.isInteger(x)?x:x.toFixed(2)};if(o>1e3){const b=o/1e3;if(b>=25){const x=b/25;return`${i(x)} sacks`}return`${i(b)} kilos`}return`${i(o)} ${d}`},G=[{name:"name",label:"Ingredients Name",align:"center",field:l=>{var o;return((o=l==null?void 0:l.raw_materials)==null?void 0:o.name)||"N/A"},format:l=>`${l}`,sortable:!0},{name:"availableStocks",align:"center",label:"Available Stocks",field:"total_quantity",sortable:!0}];return(l,o)=>(m(),I(P,null,[r("div",ze,[e(A,{rounded:"",outlined:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=d=>g.value=d),placeholder:"Searchsss",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:s(()=>[O.value?(m(),W(K,{key:1,thickness:2,color:"teal",size:"1em"})):(m(),W(K,{key:0,name:"search"}))]),_:1},8,["modelValue"])]),_.value?(m(),I("div",Ae,[e(be,{size:"50px",color:"primary"})])):(m(),I("div",Fe,[y.value.length===0?(m(),I("div",Oe,[e(K,{name:"warning",color:"warning",size:"4em"}),Be])):(m(),W(qe,{key:1,class:"table-container sticky-header",filter:g.value,"virtual-scroll-sticky-size-start":48,flat:"",columns:G,rows:y.value,"row-key":"name","virtual-scroll":"",pagination:w.value,"onUpdate:pagination":o[1]||(o[1]=d=>w.value=d),"rows-per-page-options":[0],"hide-bottom":"",style:{height:"340px"}},{"body-cell-availableStocks":s(d=>[e(ke,{props:d},{default:s(()=>[e(xe,{square:"",class:ye(["text-white",B(d.row)])},{default:s(()=>[q(F(N(d.row)),1)]),_:2},1032,["class"])]),_:2},1032,["props"])]),_:1},8,["filter","rows","pagination"]))]))],64))}};var je=re(Ke,[["__scopeId","data-v-fcadadc0"]]);const Pe={align:"right"},da={__name:"WarehouseIngredients",setup(p){return(c,C)=>(m(),W(se,{flat:""},{default:s(()=>[e(M,{class:"text-h6"},{default:s(()=>[q(" Ingredients ")]),_:1}),e(z),e(M,{class:"q-gutter-md"},{default:s(()=>[r("div",Pe,[e(Le)]),r("div",null,[e(je)])]),_:1})]),_:1}))}};export{da as default};
