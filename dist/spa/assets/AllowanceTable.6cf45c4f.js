import{b as H,Q as O,a as G}from"./QTable.335376ee.js";import{Q as W}from"./QTr.dab49a34.js";import{Q as X}from"./QTooltip.01d6d92e.js";import{d as Y,r as p,N as $,c as L,t as Z,o as v,a3 as C,f as l,M as Q,w as n,Q as ee,I,ae,J as i,e as k,a0 as V,bd as U,a4 as z,a5 as B,$ as b,K as D,aJ as te,a2 as oe,O as K,R,z as le,u as se,bb as ne}from"./index.a869b4d1.js";import{Q as re}from"./QPopupEdit.72043d99.js";import{Q as ie}from"./QSpinnerIos.0c7abd92.js";import{Q as ce}from"./QInnerLoading.3e4f8a58.js";import{Q as de}from"./QPage.3f585602.js";import{api as q}from"./axios.94e0e8d0.js";import{Q as ue}from"./QSpace.d27d5975.js";import{a as T,b as F}from"./QMenu.f650c63e.js";import{Q as me}from"./QList.f3cf69f8.js";import{C as pe}from"./ClosePopup.48b2f901.js";import{u as _e}from"./employee.76d37896.js";import{_ as ge,a as fe}from"./TableFilter.0d21ff36.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.cf196a82.js";import"./use-virtual-scroll.941d311a.js";import"./rtl.276c3f1b.js";import"./QSelect.62a98240.js";import"./QChip.fb758c64.js";import"./selection.e433e16c.js";import"./position-engine.f25d83be.js";const j=Y("employee-allowance",()=>{const _=p(null),y=p({data:[],total:0,per_page:7,current_page:1,last_page:1});return{allowance:_,allowances:y,createEmployeeAllowance:async r=>{var s,m;try{const c=await q.post("/api/employee-allowance",r);return $.create({type:"positive",message:"Allowance successfully created",timeout:1e3}),c.data}catch(c){let f="An error occurred. Please try again.";throw((s=c.response)==null?void 0:s.status)===409?f="Allowance for this employee already exists.":((m=c.response)==null?void 0:m.status)===422&&(f="Invalid data. Please check the inputs."),$.create({type:"negative",message:f,timeout:1e3}),c}},fetchEmployeeAllowance:async(r,s,m)=>{try{const c=await q.get("/api/employee-allowance",{params:{page:r,per_page:s,search:m}});y.value=c.data}catch(c){console.error("Error fetching allowance",c)}},searchAllowance:async r=>{try{console.log("Searching for employee with keyword:",r);const s=await q.post(`/api/search-allowance?keyword=${r}`);console.log("Allowance response:",s),y.value=s.data}catch(s){console.error("Error searching employee:",s)}},updateAmount:async(r,s)=>{console.log("updateAmount store",r,s);try{return await q.put("/api/update-employee-allowance/"+r.id,{amount:s})}catch(m){console.log(m)}}}});const P=_=>(K("data-v-3a598213"),_=_(),R(),_),ye=P(()=>i("div",{class:"text-h6 text-weight-bold"},"\u{1F4BC} Add Employee Allowance",-1)),we={style:{position:"relative"}},ve={key:0,class:"dropdown-list"},he={class:"row q-col-gutter-md q-mt-lg"},Ae={class:"col-12 col-sm-6"},be=P(()=>i("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"}," Employee Name: ",-1)),xe={class:"text-body1 text-weight-medium"},Qe={class:"col-12 col-sm-6"},Ve=P(()=>i("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Position:",-1)),Ee={class:"text-body1 text-weight-medium"},qe={__name:"AddAllowance",emits:["created"],setup(_,{emit:y}){const x=y,g=_e(),h=L(()=>g.employees),w=j(),r=p(""),s=p(!1),m=p(!1),c=p(!1),f=()=>{s.value=!0},S=async()=>{r.value.trim()&&(c.value=!0,await g.searchEmployee(r.value),c.value=!1)},E=t=>{d.employee_id=t.id,d.employee_name=`${t.firstname} ${t.middlename?t.middlename.charAt(0)+".":""} ${t.lastname}`,d.employee_position=t.position,r.value=""},d=Z({employee_id:"",employee_name:"",employee_position:"",amount:""}),N=()=>{d.employee_id="",d.employee_name="",d.employee_position="",d.amount=""},e=async()=>{m.value=!0;try{await w.createEmployeeAllowance(d),x("created"),s.value=!1,N()}catch(t){console.error(t)}finally{m.value=!1}};return(t,o)=>(v(),C("div",null,[l(Q,{padding:"sm md",label:"Add Allowance",icon:"add_circle",size:"md",class:"gradient-btn text-white",onClick:f}),l(oe,{modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=a=>s.value=a),persistent:"",position:"right","backdrop-filter":"blur(4px) saturate(150%)"},{default:n(()=>[l(ee,{class:"compact-dialog-card"},{default:n(()=>[l(I,{class:"dialog-header row items-center no-wrap"},{default:n(()=>[ye,l(ue),ae(l(Q,{icon:"close",flat:"",dense:"",round:"",class:"text-white"},null,512),[[pe]])]),_:1}),l(I,{class:"q-px-lg q-pt-md"},{default:n(()=>[i("div",we,[l(ge,{modelValue:r.value,"onUpdate:modelValue":[o[0]||(o[0]=a=>r.value=a),S],"search-loading":c.value},null,8,["modelValue","search-loading"]),r.value?(v(),C("div",ve,[l(me,{separator:""},{default:n(()=>{var a;return[(a=h.value)!=null&&a.length?U("",!0):(v(),k(T,{key:0},{default:n(()=>[l(F,{class:"text-grey-7"},{default:n(()=>[V("No employee found.")]),_:1})]),_:1})),(v(!0),C(z,null,B(h.value,u=>(v(),k(T,{key:u.id,clickable:"",onClick:A=>E(u)},{default:n(()=>[l(F,null,{default:n(()=>[V(b(`${u.firstname} ${u.middlename?u.middlename.charAt(0)+".":""} ${u.lastname}`),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})])):U("",!0)]),i("div",he,[i("div",Ae,[be,i("div",xe,b(d.employee_name||"----------"),1)]),i("div",Qe,[Ve,i("div",Ee,b(d.employee_position||"----------"),1)])])]),_:1}),l(I,{class:"q-px-lg q-pt-md"},{default:n(()=>[l(D,{modelValue:d.amount,"onUpdate:modelValue":o[1]||(o[1]=a=>d.amount=a),outlined:"",dense:"",label:"Allowance Amount",prefix:"\u20B1",type:"number",clearable:""},null,8,["modelValue"])]),_:1}),l(te,{align:"right",class:"q-px-lg q-pb-md"},{default:n(()=>[l(Q,{size:"md",padding:"sm lg",label:"Save","icon-right":"send",class:"gradient-btn text-white",onClick:e,loading:m.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var Ce=M(qe,[["__scopeId","data-v-3a598213"]]);const $e=_=>(K("data-v-0a4a1371"),_=_(),R(),_),ke={class:"row justify-between q-mb-md",align:"right"},Se={class:"q-pa-md",style:{"min-width":"300px","max-width":"400px"}},Ne=$e(()=>i("div",{class:"text-h6 text-primary text-center q-mb-sm"}," Edit Amount ",-1)),Ie={class:"text-subtitle2 q-mb-md"},Pe={class:"row justify-end q-mt-md"},Ue={__name:"AllowanceTable",setup(_){const y=j(),x=L(()=>y.allowances),g=p({page:1,rowsPerPage:0,rowsNumber:0}),h=p([]),w=p(!1),r=p(!1),s=p("");p(!1);function m(e){if(e==null||e==="")return"";const t=parseFloat(e);return isNaN(t)?"":Number.isInteger(t)?String(parseInt(t)):String(t)}async function c(e,t){console.log("updateteAmount",e,t),w.value=!0;try{await y.updateAmount(e,t),$.create({message:"Amount updated successfully",color:"positive",position:"top",timeout:2e3})}catch(o){console.error("Error updating amount:",o),$.create({message:"Failed to update amount",color:"negative",position:"top",timeout:2e3})}finally{w.value=!1}}le(async()=>{await f()});const f=async(e=1,t=7,o="")=>{try{w.value=!0,await y.fetchEmployeeAllowance(e,t,o),console.log("allowance",x.value);const{data:a,current_page:u,per_page:A,total:J}=x.value;h.value=a,console.log("employeeAllowance",h.value),g.value.page=u,g.value.rowsPerPage=A,g.value.rowsNumber=J}catch(a){console.log("Error fetching allowance",a)}finally{w.value=!1}},S=e=>{console.log("handle request",e),f(e.pagination.page,e.pagination.rowsPerPage,e.filter)};se(s,async e=>{r.value=!0,await f(g.value.page,g.value.rowsPerPage,e),r.value=!1});const E=e=>{const t=A=>A?A.charAt(0).toUpperCase()+A.slice(1).toLowerCase():"",o=e.firstname?t(e.firstname):"No Firstname",a=e.middlename?t(e.middlename).charAt(0)+".":"",u=e.lastname?t(e.lastname):"No Lastname";return`${o} ${a} ${u}`.trim()},d=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(e),N=[{name:"name",required:!0,label:"Name",align:"center",field:e=>E(e.employee)},{name:"amount",required:!0,label:"Amount",align:"center",field:e=>d(e.amount)}];return(e,t)=>(v(),k(de,{class:"q-my-md"},{default:n(()=>[i("div",ke,[i("div",null,[l(Ce,{onCreated:f})]),l(fe,{modelValue:s.value,"onUpdate:modelValue":[t[0]||(t[0]=o=>s.value=o),s.value]},null,8,["modelValue","onUpdate:modelValue"])]),l(G,{flat:"",bordered:"",rows:h.value,columns:N,"row-key":"name",pagination:g.value,"onUpdate:pagination":t[1]||(t[1]=o=>g.value=o),"rows-per-page-options":[5,7,10,0],onRequest:S,loading:w.value},{header:n(o=>[l(W,{props:o,class:"gradient-header text-white text-weight-bold"},{default:n(()=>[(v(!0),C(z,null,B(o.cols,a=>(v(),k(H,{key:a.name,props:o,class:"text-center text-subtitle2"},{default:n(()=>[V(b(a.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-amount":n(o=>[l(O,{props:o,class:"cursor-pointer"},{default:n(()=>[i("span",null,[V(b(o.row.amount?d(o.row.amount):" - - ")+" ",1),l(X,{class:"bg-blue-grey-8"},{default:n(()=>[V("Edit Amount")]),_:1})]),l(re,{modelValue:o.row.amount,"onUpdate:modelValue":[a=>o.row.amount=a,a=>c(o.row,a)]},{default:n(a=>[i("div",Se,[Ne,i("div",Ie," Name: "+b(E(o.row.employee)),1),l(D,{modelValue:a.value,"onUpdate:modelValue":[u=>a.value=u,u=>a.value=u],type:"text",outlined:"",dense:"",autofocus:"",counter:"","model-value":m(a.value),onKeyup:ne(a.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","model-value","onKeyup"]),i("div",Pe,[l(Q,{flat:"",label:"Close",color:"primary",onClick:a.cancel},null,8,["onClick"]),l(Q,{flat:"",label:"Save",color:"primary",onClick:a.set},null,8,["onClick"])])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),loading:n(()=>[l(ce,{showing:""},{default:n(()=>[l(ie,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","pagination","loading"])]),_:1}))}};var sa=M(Ue,[["__scopeId","data-v-0a4a1371"]]);export{sa as default};
