import{c as S,r as w,o as _,a3 as $,J as a,f as e,M as L,w as t,Q as te,I as T,aK as be,$ as h,be as C,a0 as c,a4 as W,a5 as ae,e as K,bc as re,a2 as _e,O as fe,R as ge,z as we,bH as Pe,u as qe,bo as ke,d as Qe,P as pe,N as le,t as Ve,ae as Se,K as ee,L as ye,aJ as Ie}from"./index.5a162820.js";import{Q as he}from"./QBadge.b71b5624.js";import{Q as ve,a as Re}from"./QTable.c006a11c.js";import{Q as Ce}from"./QPagination.9bd7d64b.js";import{Q as $e}from"./QBanner.45dc9cf9.js";import{u as ie}from"./baker-report.12493f6b.js";import{u as ue}from"./premix.71816ba4.js";import{a as g}from"./QSelect.687b4581.js";import{a as H,b as y}from"./QMenu.282f9a5b.js";import{Q as oe}from"./QList.39b26f6f.js";import{Q as Te,a as Be}from"./QStepper.f569ba94.js";import{u as Ne}from"./use-quasar.6c782d29.js";import{t as xe}from"./typography-format.be4059c7.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as De}from"./QSpace.286cd555.js";import{C as Le}from"./ClosePopup.6a2ba672.js";import{api as Ue}from"./axios.9ecc35b0.js";import"./QVirtualScroll.a457ef5c.js";import"./use-virtual-scroll.29848ab5.js";import"./rtl.276c3f1b.js";import"./selection.1a09d2ec.js";import"./QChip.5e6d1bc8.js";import"./position-engine.67ff3bd3.js";import"./QSlideTransition.fc2815f9.js";import"./use-panel.d8c3da1a.js";import"./touch.9135741d.js";import"./use-render-cache.3aae9b27.js";import"./date.8a1a5ccd.js";const de=s=>(fe("data-v-59122551"),s=s(),ge(),s),Fe={class:"row justify-between"},Ee={class:"text-h6"},ze=de(()=>a("div",{class:"text-h6",align:"center"},"Premix",-1)),He=de(()=>a("div",{class:"text-h6",align:"center"},"Ingredients List",-1)),Me={class:"text-grey-7 q-mt-xs"},je=de(()=>a("div",{class:"text-h6 text-weight-regular"}," Do you want to receive the premix? ",-1)),Ae={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["update-history"],setup(s,{emit:k}){var A,d,f,p,b,Z,ce;const{capitalizeFirstLetter:I,formatTimestamp:U,formatFullname:v,formatRequestQuantity:F,formatQuantity:B}=xe(),O=ie(),P=S(()=>O.user);console.log("userData in RawMaterialsTable:",P.value);const N=((d=(A=P.value)==null?void 0:A.data)==null?void 0:d.employee_id)||"",q=((p=(f=P.value)==null?void 0:f.device)==null?void 0:p.reference_id)||"";console.log("employeeId in PremixPage:",N),console.log("branchId in PremixPage:",q);const Q=ue();Ne();const R=w(!1),E=w(!1),u=s;console.log("props in TransactionViewss:",u.report);const V=()=>{R.value=!0},Y=o=>{switch(o){case"pending":return"pending-header";case"confirmed":return"confirm-header";case"declined":return"decline-header";case"process":return"process-header";case"completed":return"completed-header";case"to deliver":return"to-deliver-header";case"to receive":return"to-receive-header";case"received":return"receive-header";default:return""}},X=[{label:"Pending",value:"pending"},{label:"Declined",value:"declined"},{label:"Confirmed",value:"confirmed"},{label:"Process",value:"process"},{label:"Completed",value:"completed"},{label:"To Deliver",value:"to deliver"},{label:"To Receive",value:"to receive"},{label:"Received",value:"received"}],M=S(()=>{var o;return(o=u.report.history)!=null&&o.length?X.filter(r=>u.report.history.some(n=>n.status===r.value)):[]}),l=o=>{const r=u.report.history.find(n=>n.status===o);return r?o==="received"?`Received by: ${v(r.employee)}`:o==="pending"?`Requested by: ${v(r.employee)}`:`Handled by: ${v(r.employee)}`:"No handler"},z=((ce=(Z=(b=u.report)==null?void 0:b.branch_premix)==null?void 0:Z.branch_recipe)==null?void 0:ce.ingredient_groups)||"Undefined";console.log("ingrdientsData",z);const j=S(()=>z.map(o=>{const r=parseFloat(o.quantity)*parseFloat(u.report.quantity);return{...o,totalQuantity:r,formattedQuantity:B(r,o.ingredient.unit)}}));console.log("report to proceed",u.report);const D=S(()=>{var o,r;return((r=(o=u.report.history)==null?void 0:o[u.report.history.length-1])==null?void 0:r.status)||null});console.log("lastStatus",D.value);const i=S(()=>M.value.findIndex(o=>o.value===D.value)+1),x=o=>{var r;return(r=u.report.history)==null?void 0:r.some(n=>n.status===o)},m=o=>({pending:"warning",declined:"negative",confirmed:"green",process:"primary",completed:"dark","to deliver":"brown-9","to receive":"amber-10",received:"secondary"})[o]||"grey",G=async()=>{const o={request_premix_id:u.report.id,branch_premix_id:u.report.branch_premix_id,branch_id:u.report.branch_premix.branch_id,employee_id:N,status:"received",notes:"Received Premix",quantity:u.report.quantity,warehouse_id:u.report.warehouse_id,ingredients:j.value.map(r=>({ingredients_id:r.ingredient.id,total_quantity:r.totalQuantity,unit:r.ingredient.unit}))};console.log("payload",o),await Q.receivePremix(o),await fetchRequestBranchEmployeePremix(q,N),R.value=!1};return(o,r)=>(_(),$(W,null,[a("div",null,[e(L,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:V})]),e(_e,{modelValue:R.value,"onUpdate:modelValue":r[2]||(r[2]=n=>R.value=n)},{default:t(()=>[e(te,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(T,{class:be(Y(s.report.status))},{default:t(()=>[a("div",Fe,[a("div",Ee,h(C(I)(s.report.name)||"-"),1),e(L,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:r[0]||(r[0]=n=>R.value=!1)})])]),_:1},8,["class"]),e(T,null,{default:t(()=>{var n,J,me;return[a("div",null,"Date: "+h(C(U)(s.report.created_at)||"-"),1),a("div",null,"Baker: "+h(C(v)(s.report.employee)||"-"),1),a("div",null," Branch: "+h(C(I)((me=(J=(n=s.report)==null?void 0:n.branch_premix)==null?void 0:J.branch_recipe)==null?void 0:me.branch.name)||"-"),1),a("div",null,[c(" Status: "),e(he,{color:m(s.report.status),outlined:""},{default:t(()=>[c(h(C(I)(s.report.status)||"-"),1)]),_:1},8,["color"])])]}),_:1}),e(T,{class:"q-gutter-y-md"},{default:t(()=>[a("div",null,[ze,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(H,null,{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[c("Premix Name")]),_:1})]),_:1}),e(y,{side:""},{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[c("Request Quantity / kgs")]),_:1})]),_:1})]),_:1}),e(H,null,{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-h6"},{default:t(()=>[c(h(C(I)(s.report.name)||"-"),1)]),_:1})]),_:1}),e(y,{side:""},{default:t(()=>[e(g,{class:"text-h6"},{default:t(()=>[c(h(C(F)(s.report.quantity)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),a("div",null,[He,e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(H,null,{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[c(" Code")]),_:1})]),_:1}),e(y,{side:""},{default:t(()=>[e(g,{class:"text-overline"},{default:t(()=>[c("Quantity")]),_:1})]),_:1})]),_:1}),(_(!0),$(W,null,ae(C(z),(n,J)=>(_(),K(H,{key:J},{default:t(()=>[e(y,null,{default:t(()=>[e(g,{class:"text-subtitle1"},{default:t(()=>[c(h(n.ingredient.code),1)]),_:2},1024)]),_:2},1024),e(y,{side:""},{default:t(()=>[e(g,{class:"text-subtitle1"},{default:t(()=>[c(h(C(B)(n.quantity*s.report.quantity,n.ingredient.unit)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])]),_:1}),e(Te,{modelValue:i.value,"onUpdate:modelValue":r[1]||(r[1]=n=>i.value=n),animated:"",class:"q-pa-lg"},{default:t(()=>[(_(!0),$(W,null,ae(M.value,(n,J)=>(_(),K(Be,{key:J,name:J+1,title:n.label,color:m(n.value),done:x(n.value),icon:x(n.value)?"check":"radio_button_unchecked",class:"custom-step"},{default:t(()=>[a("div",Me,h(l(n.value)),1)]),_:2},1032,["name","title","color","done","icon"]))),128))]),_:1},8,["modelValue"]),D.value==="to receive"?(_(),K(T,{key:0,class:"text-center q-gutter-md"},{default:t(()=>[je,e(L,{color:"amber-10",label:"Yes",icon:"check",onClick:G,loading:E.value},null,8,["loading"])]),_:1})):re("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Je=se(Ae,[["__scopeId","data-v-59122551"]]);const Ke={class:"q-pa-lg flex flex-center"},Oe={key:0,class:"loading-overlay row justify-center items-center"},Ye={key:1,class:"q-pa-md q-gutter-md row justify-center"},Ge={__name:"PremixTable",setup(s){var l,z,j,D;const{capitalizeFirstLetter:k,formatTimestamp:I}=xe(),U=ie(),v=S(()=>U.user);console.log("userData in RawMaterialsTable:",v.value);const F=((z=(l=v.value)==null?void 0:l.device)==null?void 0:z.reference_id)||"";console.log("branchId in PremixPage:",F);const B=ue(),O=S(()=>B.branchEmployeePremix),P=((D=(j=v.value)==null?void 0:j.data)==null?void 0:D.employee_id)||"";console.log("employeeId in PremixPagess:",P);const N=w(""),q=w(!0),Q=w(!0),R=w(!1),E=w([]),u=w(1),V=w({page:1,rowsPerPage:10,rowsNumber:10,sortBy:"id",descending:!1});we(async()=>{P&&await Y(),console.log("premixdatas",O.value)});const Y=async()=>{Q.value=!0;try{const{page:i,rowsNumber:x,rowsPerPage:m,sortBy:G,descending:A}=V.value,d=await B.fetchRequestBranchEmployeePremix(F,P,i,x,m,G,A);E.value=d.data,console.log("rows.value",E.value),u.value=d.last_page,V.value.rowsPerPage=d.per_page||10,R.value=E.value.length===0}catch(i){console.error("Error fetching premix report:",i)}Q.value=!1};Pe(()=>{P&&Y()}),qe(N,()=>{q.value=!0,setTimeout(()=>{q.value=!1})});const X=i=>{switch(i){case"pending":return"warning";case"declined":return"negative";case"confirmed":return"green";case"process":return"primary";case"completed":return"dark";case"to deliver":return"brown-9";case"to receive":return"amber-10";case"received":return"secondary";default:return"grey"}},M=[{name:"name",label:"Transactions Name",align:"left",field:i=>i.name?k(i.name):"N/A",format:i=>`${i}`,sortable:!0},{name:"date",align:"center",label:"Date",field:"created_at",format:i=>I(i),sortable:!0},{name:"status",align:"center",label:"Status",field:"status",sortable:!0},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(i,x)=>(_(),$("div",null,[e(Re,{flat:"",columns:M,rows:E.value,"row-key":"id",bordered:"",dense:"",modelValue:V.value,"onUpdate:modelValue":x[0]||(x[0]=m=>V.value=m),pagination:V.value.rowsPerPage,"rows-per-page-options":[10]},{"body-cell-status":t(m=>[e(ve,{props:m},{default:t(()=>[e(he,{outlined:"",color:X(m.row.status)},{default:t(()=>[c(h(C(k)(m.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(m=>[e(ve,{props:m},{default:t(()=>[a("div",null,[e(Je,{report:m.row,onUpdateHistory:i.updateReportHistory},null,8,["report","onUpdateHistory"])])]),_:2},1032,["props"])]),_:1},8,["rows","modelValue","pagination"]),a("div",Ke,[e(Ce,{modelValue:V.value.page,"onUpdate:modelValue":[x[1]||(x[1]=m=>V.value.page=m),x[2]||(x[2]=m=>i.reloadTableData(i.userId))],color:"purple",max:u.value,"max-pages":u.value,"boundary-numbers":""},null,8,["modelValue","max","max-pages"])]),Q.value?(_(),$("div",Oe,[e(ke,{size:"50px"})])):re("",!0),R.value?(_(),$("div",Ye,[e($e,{class:"bg-grey-1",dense:""},{default:t(()=>[c(" No data available ")]),_:1})])):re("",!0)]))}};var We=se(Ge,[["__scopeId","data-v-4e04b7f3"]]);const Xe=Qe("request-premix",()=>{const s=w(null),k=w([]);return{requestPremix:s,requestPremixes:k,saveRequestPremix:async U=>{console.log("data request oremix",U),pe.show();try{const v=await Ue.post("/api/request-premix",{requests:U});console.log("response",v.data),le.create({type:"positive",message:"Request Premix successfully"})}catch(v){console.error(v),le.create({type:"negative",message:"Request Premix Error"})}finally{pe.hide()}}}});const ne=s=>(fe("data-v-de78a87a"),s=s(),ge(),s),Ze={align:"right"},et=ne(()=>a("div",{class:"text-h5 q-mr-md"},"\u{1F6D2} Request Premixss",-1)),tt={class:"q-ma-md"},at={key:0,class:"custom-list z-top"},rt={class:"q-mb-sm"},lt=ne(()=>a("div",null,"Premix Name",-1)),ot={class:"q-mb-lg"},st=ne(()=>a("div",null,"Category",-1)),nt=ne(()=>a("div",null,"Quantity",-1)),it={align:"right"},ut={__name:"RequestPremix",setup(s){var j,D,i,x,m,G,A;const k=w(!1),I=()=>{k.value=!0},U=ie(),v=S(()=>U.user);console.log("userData in RawMaterialsTable:",v.value);const F=((D=(j=v.value)==null?void 0:j.device)==null?void 0:D.reference_id)||"";console.log("branchId in PremixPage:",F);const B=((m=(x=(i=v.value)==null?void 0:i.device)==null?void 0:x.reference)==null?void 0:m.warehouse_id)||"";console.log("warehouseId in PremixPage:",B);const O=((A=(G=v.value)==null?void 0:G.data)==null?void 0:A.employee_id)||"";console.log("warehouseId in PremixPage:",B);const P=ue(),N=S(()=>P.premixes);S(()=>P.branchEmployeePremix),console.log("premixdatas",N.value),Xe();const q=w([]),Q=w(""),R=async()=>{await P.searchPremix(Q.value,F)},E=d=>{console.log("data",d),l.branch_premix_id=d.id,l.name=d.name,l.category=d.category,Q.value=""},u=d=>d?d.split(" ").map(f=>f.charAt(0).toUpperCase()+f.slice(1).toLowerCase()).join(" "):"",V=S(()=>q.value!==0),Y=()=>{const d=q.value.push({branch_premix_id:l.branch_premix_id,warehouse_id:l.warehouse_id,employee_id:l.employee_id,name:l.name,category:l.category,quantity:l.quantity,status:l.status});console.log("premix",d),M()},X=d=>{q.value.splice(d,1)},M=()=>{l.branch_premix_id=0,l.name="",l.category="",l.quantity=0},l=Ve({branch_premix_id:0,name:"",category:"",quantity:0,warehouse_id:B,employee_id:O,status:"pending"}),z=async()=>{try{console.log("Data sent for premix request:",q.value),await P.saveRequestPremix(q.value,F,O),le.create({type:"positive",message:"Premix request saved successfully!"}),M(),q.value=[],k.value=!1}catch(d){console.error("Failed to save premix request:",d),le.create({type:"negative",message:"Failed to save premix request. Please try again."})}};return(d,f)=>(_(),$(W,null,[a("div",Ze,[e(L,{class:"bg-gradient q-pa-sm text-white",dense:"",elevated:"",icon:"shopping_cart",label:"Request Premix",onClick:I})]),e(_e,{modelValue:k.value,"onUpdate:modelValue":f[4]||(f[4]=p=>k.value=p),"backdrop-filter":"blur(4px) saturate(150%)",position:"right"},{default:t(()=>[e(te,{style:{width:"800px","max-width":"100vw"}},{default:t(()=>[e(T,{class:"row items-center q-px-md q-py-sm bg-gradient text-white"},{default:t(()=>[et,e(De),Se(e(L,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[Le]])]),_:1}),a("div",tt,[e(ee,{modelValue:Q.value,"onUpdate:modelValue":[f[0]||(f[0]=p=>Q.value=p),R],rounded:"",outlined:"",dense:"",debounce:"300",placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:t(()=>[a("div",null,[e(ye,{name:"search"})])]),default:t(()=>[Q.value?(_(),$("div",at,[e(te,null,{default:t(()=>[e(oe,{separator:""},{default:t(()=>{var p;return[(p=N.value)!=null&&p.length?(_(!0),$(W,{key:1},ae(N.value,b=>(_(),K(H,{key:b.id,onClick:Z=>E(b),clickable:""},{default:t(()=>[e(y,null,{default:t(()=>[e(g,null,{default:t(()=>[c(h(u(b==null?void 0:b.name)),1)]),_:2},1024)]),_:2},1024),e(y,null,{default:t(()=>[e(g,{side:""},{default:t(()=>[c(h(b==null?void 0:b.category),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(_(),K(H,{key:0},{default:t(()=>[c(" No record found. ")]),_:1}))]}),_:1})]),_:1})])):re("",!0)]),_:1},8,["modelValue"])]),e(T,null,{default:t(()=>[a("div",rt,[lt,e(ee,{modelValue:l.name,"onUpdate:modelValue":f[1]||(f[1]=p=>l.name=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])]),a("div",ot,[st,e(ee,{modelValue:l.category,"onUpdate:modelValue":f[2]||(f[2]=p=>l.category=p),readonly:"",dense:"",outlined:""},null,8,["modelValue"])])]),_:1}),e(T,{class:"q-gutter-sm"},{default:t(()=>[a("div",null,[nt,e(ee,{modelValue:l.quantity,"onUpdate:modelValue":f[3]||(f[3]=p=>l.quantity=p),dense:"",outlined:"",type:"number",suffix:"kg/s"},null,8,["modelValue"])]),a("div",it,[e(L,{padding:"sm md",size:"xm",icon:"add",dense:"",outline:"",onClick:Y})])]),_:1}),e(T,null,{default:t(()=>[e(oe,{dense:"",separator:"",class:"box"},{default:t(()=>[e(H,null,{default:t(()=>[e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[c(" Premix Name ")]),_:1})]),_:1}),e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[c(" Quantity ")]),_:1})]),_:1}),e(y,{align:"center",side:""},{default:t(()=>[e(g,null,{default:t(()=>[c(" Action")]),_:1})]),_:1})]),_:1}),(_(!0),$(W,null,ae(q.value,(p,b)=>(_(),K(H,{key:b},{default:t(()=>[e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[c(h(p.name),1)]),_:2},1024)]),_:2},1024),e(y,{align:"center"},{default:t(()=>[e(g,null,{default:t(()=>[c(h(p.quantity),1)]),_:2},1024)]),_:2},1024),e(y,{align:"center",side:""},{default:t(()=>[e(g,null,{default:t(()=>[e(L,{onClick:Z=>X(b),color:"negative",icon:"clear",dense:"",flat:"",round:"",class:"text-red"},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(Ie,{class:"row q-ma-md",align:"right"},{default:t(()=>[e(L,{class:"glossy",color:"grey-9",label:"Dismiss"}),e(L,{class:"glossy",color:"teal",label:"Create",onClick:z,disable:!V.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var dt=se(ut,[["__scopeId","data-v-de78a87a"]]);const ct={class:"text-h6 text-white"},mt={__name:"PremixPage",setup(s){return(k,I)=>(_(),K(te,{flat:""},{default:t(()=>[e(T,{style:{"background-color":"#ef4444"}},{default:t(()=>[a("div",ct,[e(ye,{name:"scale"}),c(" Premix ")])]),_:1}),e(T,{class:"q-gutter-y-md"},{default:t(()=>[a("div",null,[e(dt)]),a("div",null,[e(We)])]),_:1})]),_:1}))}};var zt=se(mt,[["__scopeId","data-v-626e0eca"]]);export{zt as default};
