import{be as pe,c as N,r as y,t as Z,o as p,a3 as M,f as e,M as S,w as l,Q as oe,I as C,ae as ee,a1 as U,J as r,K as F,a0 as I,a4 as E,a5 as _e,e as T,$ as A,bb as ve,aI as fe,aJ as ye,a2 as we,P as ae,N as te,O as ne,R as re,u as he,z as ge,L as P,aK as be}from"./index.9c7fef80.js";import{Q as ke}from"./QSpace.5e0f82af.js";import{Q as L}from"./rtl.a71fd64d.js";import{Q as qe,a as j,b as Q}from"./QList.0a39e9a5.js";import{Q as le}from"./QSelect.2edaa7be.js";import{C as se}from"./ClosePopup.28e9e2ae.js";import{u as ie}from"./warehouse-rawMaterials.71dc154e.js";import{_ as ue}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as xe}from"./QSpinnerDots.a6d4b279.js";import{Q as Qe}from"./QChip.cc31c827.js";import{Q as Ie,a as Se}from"./QTable.52f4bc8c.js";import"./use-virtual-scroll.ee030319.js";import"./QMenu.70ab79ec.js";import"./selection.76d4fdac.js";import"./axios.9dd9cab2.js";import"./raw-material.3d11494c.js";import"./QVirtualScroll.03b5f035.js";const R=_=>(ne("data-v-12103966"),_=_(),re(),_),Me=R(()=>r("div",{class:"text-h6"},"Add Supply",-1)),Ce=R(()=>r("div",{class:"q-my-sm"},"Supplier's Company Name",-1)),Ne=R(()=>r("div",{class:"q-my-sm"},"Supplier's Name",-1)),Re={class:"q-mt-md q-gutter-y-sm"},Ve={class:"q-my-md"},$e=R(()=>r("div",{class:"q-my-sm"},"Raw Materials Name",-1)),De={class:"row q-gutter-y-lg justify-between"},We=R(()=>r("div",{class:"q-my-sm",align:"center"},"Quantity",-1)),Te=R(()=>r("div",{class:"q-my-sm",align:"center"},"Unit",-1)),Le=["onKeyup"],Ue={class:"q-mt-sm",align:"right"},Fe={__name:"WarehouseIngredientsCreateSupply",setup(_){var G,J,H,X;pe();const d=ie(),k=N(()=>d.user);console.log("userData",k.value);const w=((J=(G=k.value)==null?void 0:G.employee)==null?void 0:J.warehouse_id)||"";console.log("warehouseId",w);const g=((X=(H=k.value)==null?void 0:H.employee)==null?void 0:X.employee_id)||"";console.log("employeeId",g);const v=y(!1),b=N(()=>d.warehouseRawMaterials),O=()=>{v.value=!0},V=y(!1),f=y([]),h=y([]),i=Z({name:"",quantity:"",unit:""}),z=N(()=>f.value.length>0),B=[{label:"Sack (25 kg each)",value:"sack"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],$=y(h.value);(async()=>{try{const n=w;console.log("warehouse_id",n);const a=await d.fetchWarehouseRawMaterials(n);V.value=!1,h.value=d.warehouseRawMaterials.map(t=>({label:t.raw_materials.name,value:t.raw_materials.id,suffix:t.raw_materials.unit})),console.log("rawMaterialsOptions",h.value)}catch(n){console.error("Error fetching warehouse raw materials:",n)}})();const D=()=>{i.name="",i.quantity="",i.unit=""},o=(n,a)=>{a(()=>{if(n==="")$.value=h.value;else{const t=n.toLowerCase();$.value=h.value.filter(W=>W.label.toLowerCase().includes(t))}})},s=()=>{console.log("clickckck");const n=f.value;function a(Y,ce){return Y.find(me=>me.raw_material_id==ce)}const t=i.name.value;a(n,t)||(f.value=[...n,{raw_material_id:i.name.value,label:i.name.label,quantity:i.quantity,unit:i.unit}],D())},u=n=>{f.value.splice(n,1)},c=n=>n?n.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"",m=Z({companyName:"",supplierName:""}),q=()=>{m.companyName="",m.supplierName="",f.value=[]},x=n=>n.map(a=>{let t=a.quantity;return a.unit.value==="sack"?t=a.quantity*25e3:a.unit.value==="kilo"?t=a.quantity*1e3:a.unit.value==="gram"&&(t=a.quantity),{...a,convertedQuantity:t,unit:{...a.unit,value:"gram"}}}),de=async()=>{const n=x(f.value);try{ae.show();const a={employee_id:g,warehouse_id:w,supplier_company_name:m.companyName,supplier_name:m.supplierName,raw_materials:n.map(t=>({raw_material_id:t.raw_material_id,quantity:t.convertedQuantity,unit:t.unit.value}))};await d.warehouseAddSupply(a),b.value=await d.fetchWarehouseRawMaterials(w),D(),q(),v.value=!1,te.create({message:"Supply added successfully",color:"positive"})}catch(a){te.create({message:"Error adding supply",color:"negative"}),console.error("Error adding supply:",a)}finally{ae.hide()}};return(n,a)=>(p(),M(E,null,[e(S,{class:"q-pa-sm",color:"red",dense:"",elevated:"",icon:"add_circle",label:"Add Supply",onClick:O}),e(we,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=t=>v.value=t)},{default:l(()=>[e(oe,{class:"my-card",style:{width:"900px"}},{default:l(()=>[e(C,{class:"row items-center"},{default:l(()=>[Me,e(ke),ee(e(S,{icon:"close",flat:"",dense:"",round:""},null,512),[[se]])]),_:1}),e(U),e(C,{class:"q-my-md q-mx-sm q-gutter-y-sm"},{default:l(()=>[r("div",null,[Ce,e(F,{modelValue:m.companyName,"onUpdate:modelValue":a[0]||(a[0]=t=>m.companyName=t),outlined:"",dense:""},null,8,["modelValue"])]),r("div",null,[Ne,e(F,{modelValue:m.supplierName,"onUpdate:modelValue":a[1]||(a[1]=t=>m.supplierName=t),outlined:"",dense:""},null,8,["modelValue"])])]),_:1}),e(U),e(C,null,{default:l(()=>[r("div",Re,[r("div",null,[e(qe,{dense:"",separator:"",class:"box"},{default:l(()=>[e(j,null,{default:l(()=>[e(Q,null,{default:l(()=>[e(L,{class:"text-overline"},{default:l(()=>[I("Raw Materials Name")]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(L,{class:"text-overline"},{default:l(()=>[I("Quantity")]),_:1})]),_:1}),e(Q,{side:""})]),_:1}),(p(!0),M(E,null,_e(f.value,(t,W)=>(p(),T(j,{key:W},{default:l(()=>[e(Q,null,{default:l(()=>[e(L,{class:"text-caption"},{default:l(()=>[I(A(c(t.label)),1)]),_:2},1024)]),_:2},1024),e(Q,null,{default:l(()=>[e(L,{class:"text-caption justify-between"},{default:l(()=>[I(A(t.quantity)+" "+A(t.unit.value),1)]),_:2},1024)]),_:2},1024),e(Q,{side:""},{default:l(()=>[e(S,{onClick:Y=>u(W),color:"grey-10",icon:"backspace",dense:"",flat:"",round:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1}),e(C,null,{default:l(()=>[r("div",Ve,[$e,e(le,{modelValue:i.name,"onUpdate:modelValue":a[2]||(a[2]=t=>i.name=t),debounce:"3000",outlined:"","chips-color":"primary",options:$.value,dense:"",label:"Raw Materials",behavior:"menu","use-input":"","hide-dropdown-icon":"",onFilter:o},{"no-option":l(()=>[e(j,null,{default:l(()=>[e(Q,{class:"text-grey"},{default:l(()=>[I(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),r("div",De,[r("div",null,[We,e(F,{modelValue:i.quantity,"onUpdate:modelValue":a[3]||(a[3]=t=>i.quantity=t),type:"number",outlined:"",dense:"",style:{width:"300px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])]),r("div",null,[Te,e(le,{modelValue:i.unit,"onUpdate:modelValue":a[4]||(a[4]=t=>i.unit=t),options:B,outlined:"",behavior:"menu",dense:"",style:{width:"350px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])])]),r("form",{onKeyup:ve(fe(s,["prevent"]),["enter"])},[r("div",Ue,[e(S,{padding:"sm lg",outline:"",dense:"",icon:"add",color:"purple",onClick:s})])],40,Le)]),_:1}),e(U),e(ye,{class:"row q-ma-md q-mt-xl",align:"left"},{default:l(()=>[ee(e(S,{class:"glossy",color:"grey-9",label:"Cancel"},null,512),[[se]]),e(S,{class:"glossy",color:"teal",label:"Create",onClick:de,disable:!z.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var Ae=ue(Fe,[["__scopeId","data-v-12103966"]]);const Oe=_=>(ne("data-v-13e0f847"),_=_(),re(),_),ze={class:"q-mb-sm"},Be={key:0,class:"spinner-wrapper"},Ke={key:1},Pe={key:0,class:"data-error"},je=Oe(()=>r("div",{class:"q-ml-sm text-h6"},"No data available",-1)),Ee={__name:"WarehouseIngredientsTable",setup(_){var K,D;const d=ie(),k=N(()=>d.user);console.log("userData",k.value);const w=((D=(K=k.value)==null?void 0:K.device)==null?void 0:D.reference_id)||"",g=N(()=>d.warehouseRawMaterials),v=y(!0);console.log("warehouse id",w);const b=y(""),O=y(!1),V=y(!1),f=y({rowsPerPage:0}),h=N(()=>b.value?g.value.filter(o=>o.name.toLowerCase().includes(b.value.toLowerCase())):g.value);he(b,async o=>{v.value=!0,await new Promise(s=>setTimeout(s,1e3)),v.value=!1,V.value=h.value.length===0}),ge(async()=>{console.log("props.warehouseId in onMounted:",w),w&&await i(w)});const i=async o=>{console.log("Fetching raw materials for warehouse ID:",o);try{v.value=!0;const s=await d.fetchWarehouseRawMaterials(o);g.value=s,g.value.length||(V.value=!0),console.log("Warehouse Raw Materialsss",g.value)}catch(s){console.log("Error fetching warehouse product:",s),V.value=!0}finally{v.value=!1}},z=o=>{const s=o.total_quantity,u=o.raw_materials.unit;if(console.log("unit test",u),u==="Grams"&&s<1e3)return"bg-red";let c;return s>=1e3?c=s/1e3:c=s,c<5?c<=2?"bg-red":(c<=3,"bg-warning"):"bg-positive"},B=o=>{var m;const s=Number(o==null?void 0:o.total_quantity)||0,u=((m=o==null?void 0:o.raw_materials)==null?void 0:m.unit)||"units";console.log("totalQuantity:",s),console.log("unit:",u);const c=q=>{const x=Number(q);return Number.isInteger(x)?x:x.toFixed(2)};if(s>1e3){const q=s/1e3;if(q>=25){const x=q/25;return`${c(x)} sacks`}return`${c(q)} kilos`}return`${c(s)} ${u}`},$=[{name:"name",label:"Ingredients Name",align:"center",field:o=>{var s;return((s=o==null?void 0:o.raw_materials)==null?void 0:s.name)||"N/A"},format:o=>`${o}`,sortable:!0},{name:"availableStocks",align:"center",label:"Available Stocks",field:"total_quantity",sortable:!0}];return(o,s)=>(p(),M(E,null,[r("div",ze,[e(F,{rounded:"",outlined:"",dense:"",debounce:"300",modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=u=>b.value=u),placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:l(()=>[O.value?(p(),T(P,{key:1,thickness:2,color:"teal",size:"1em"})):(p(),T(P,{key:0,name:"search"}))]),_:1},8,["modelValue"])]),v.value?(p(),M("div",Be,[e(xe,{size:"50px",color:"primary"})])):(p(),M("div",Ke,[h.value.length===0?(p(),M("div",Pe,[e(P,{name:"warning",color:"warning",size:"4em"}),je])):(p(),T(Se,{key:1,class:"table-container sticky-header",filter:b.value,"virtual-scroll-sticky-size-start":48,flat:"",columns:$,rows:h.value,"row-key":"name","virtual-scroll":"",pagination:f.value,"onUpdate:pagination":s[1]||(s[1]=u=>f.value=u),"rows-per-page-options":[0],"hide-bottom":"",style:{height:"340px"}},{"body-cell-availableStocks":l(u=>[e(Ie,{props:u},{default:l(()=>[e(Qe,{square:"",class:be(["text-white",z(u.row)])},{default:l(()=>[I(A(B(u.row)),1)]),_:2},1032,["class"])]),_:2},1032,["props"])]),_:1},8,["filter","rows","pagination"]))]))],64))}};var Ge=ue(Ee,[["__scopeId","data-v-13e0f847"]]);const Je={align:"right"},pa={__name:"WarehouseIngredients",setup(_){return(d,k)=>(p(),T(oe,{flat:""},{default:l(()=>[e(C,{class:"text-h6"},{default:l(()=>[I(" Ingredients ")]),_:1}),e(U),e(C,{class:"q-gutter-md"},{default:l(()=>[r("div",Je,[e(Ae)]),r("div",null,[e(Ge)])]),_:1})]),_:1}))}};export{pa as default};
