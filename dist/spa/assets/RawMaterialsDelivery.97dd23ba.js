import{r as I,o as i,e as T,w as t,f as e,Q as K,I as k,a3 as V,be as B,a1 as oe,aJ as X,ae as se,M as $,aK as q,a2 as Z,O as ee,R as te,J as n,K as re,c as F,bg as be,$ as D,a0 as _,a4 as G,a5 as he,N as L,z as De,L as ne}from"./index.86555a02.js";import{Q as ke}from"./QChip.772b8c1a.js";import{Q as W,a as Ce}from"./QTable.3e0b8829.js";import{Q as ie}from"./QBadge.f396bb9d.js";import{Q as we}from"./QPagination.866f62d0.js";import{u as ce}from"./use-quasar.315d0740.js";import{u as ue}from"./baker-report.62ffce03.js";import{u as de}from"./stock-delivery.cd58c9a9.js";import{a as P}from"./QSelect.4a5afec3.js";import{a as le,b as M}from"./QMenu.a7e76834.js";import{Q as xe}from"./QList.ed241797.js";import{C as me}from"./ClosePopup.36ab3faf.js";import{u as pe}from"./use-dialog-plugin-component.1a494174.js";import{_ as ae}from"./plugin-vue_export-helper.21dcd24c.js";import{t as fe}from"./typography-format.03b576dc.js";import{b as ge}from"./badge-color.ec6e37fe.js";import"./QVirtualScroll.db2b41de.js";import"./use-virtual-scroll.398b16aa.js";import"./rtl.276c3f1b.js";import"./selection.9de241bc.js";import"./axios.b83de87b.js";import"./position-engine.d27e24be.js";import"./date.e8db5187.js";const _e=l=>(ee("data-v-318678d0"),l=l(),te(),l),qe=_e(()=>n("div",{class:"text-h5 q-mb-xs"},"Confirm Report",-1)),Se={key:0},Qe=_e(()=>n("div",{class:"text-positive text-subtitle1"}," Please confirm again to finalize this report. ",-1)),Re={__name:"ConfirmDialog",setup(l){const{dialogRef:C,onDialogHide:w,onDialogOK:S,onDialogCancel:H}=pe(),c=I(!1),v=()=>{c.value?S():c.value=!0};return(Q,f)=>(i(),T(Z,{ref_key:"dialogRef",ref:C,onHide:q(w)},{default:t(()=>[e(K,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(k,{class:"q-pt-none q-pb-sm"},{default:t(()=>[qe,c.value?B("",!0):(i(),V("p",Se," Are you sure you wanat to confirm this report? "))]),_:1}),c.value?(i(),T(k,{key:0},{default:t(()=>[Qe]),_:1})):B("",!0),e(oe,{class:"q-mb-sm"}),e(k,null,{default:t(()=>[e(X,{align:"right",class:"q-pt-none"},{default:t(()=>[se(e($,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[me]]),e($,{dense:"",label:c.value?"Confirm":"Yes! Confirm",color:"positive",class:"q-btn-rounded q-px-lg",onClick:v},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Ie=ae(Re,[["__scopeId","data-v-318678d0"]]);const Ve=l=>(ee("data-v-5a3e7851"),l=l(),te(),l),$e=Ve(()=>n("div",{class:"text-h5 q-mb-xs"},"Decline Report",-1)),Te={key:0},Ne={__name:"DeclinedDialog",setup(l){const{dialogRef:C,onDialogHide:w,onDialogOK:S,onDialogCancel:H}=pe(),c=I(!1),v=I(""),Q=I(null),f=I(!1),x=async()=>{c.value?(f.value=!0,Q.value.validate()&&S({remarks:v.value})):c.value=!0};return(m,u)=>(i(),T(Z,{ref_key:"dialogRef",ref:C,onHide:q(w),persistent:""},{default:t(()=>[e(K,{class:"q-pa-md q-rounded q-elevate-2 bg-white text-grey-9"},{default:t(()=>[e(k,{class:"q-pt-none q-pb-sm"},{default:t(()=>[$e,c.value?B("",!0):(i(),V("p",Te,"Are you sure you want to decline this report?"))]),_:1}),c.value?(i(),T(k,{key:0},{default:t(()=>[e(re,{modelValue:v.value,"onUpdate:modelValue":u[0]||(u[0]=r=>v.value=r),type:" textarea",label:"Reason  for declining",filled:"",autogrow:"",dense:"",ref_key:"remarksInput",ref:Q,rules:[r=>!!r||"Remarks are required"]},null,8,["modelValue","rules"])]),_:1})):B("",!0),e(oe,{class:"q-mb-md"}),e(k,null,{default:t(()=>[e(X,{align:"right",class:"q-pt-none"},{default:t(()=>[se(e($,{flat:"",dense:"",label:"No",color:"primary",class:"q-mr-sm"},null,512),[[me]]),e($,{dense:"",label:c.value?"Submit Decline":"Yes! Decline",color:"negative",class:"q-btn-rounded q-px-lg",onClick:x},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Fe=ae(Ne,[["__scopeId","data-v-5a3e7851"]]);const Be=l=>(ee("data-v-1ccabf78"),l=l(),te(),l),Ae={class:"row justify-between"},Le={class:"text-h6"},Pe={key:0},Me={class:"q-mt-md"},He=Be(()=>n("span",{class:"text-grey-7 text-caption"},"Items: ",-1)),ze={key:1,class:"text-caption text-grey-6 q-mt-md"},Oe={__name:"TransactionView",props:{report:{type:Object,required:!0}},emits:["fetchAgain"],setup(l,{emit:C}){var s,d;const{capitalizeFirstLetter:w,formatTimestamp:S,formatFullname:H}=fe(),{getHeaderClass:c}=ge(),v=ue(),Q=F(()=>v.user);console.log("userData in RawMaterialsTable:",Q.value);const f=((d=(s=Q.value)==null?void 0:s.data)==null?void 0:d.employee_id)||"";console.log("employeeIdsssssssssssssss:",f);const x=de();F(()=>x.loading),F(()=>x.declinedStocks);const m=l;console.log("props in Transaction view:",m.report);const u=C,r=I(!1),y=ce(),z=()=>{r.value=!0},j=o=>o==null?"No Quantity":parseFloat(o),A=()=>{y.dialog({component:Ie}).onOk(()=>{console.log("Data from child:",m.report),J(m.report)}).onCancel(()=>{console.log("Cancelled")})},E=()=>{y.dialog({component:Fe}).onOk(o=>{console.log("Decliene remark from child:",o),O(m.report.id,o)}).onCancel(()=>{console.log("Cancelled")})},J=async o=>{var g,p,N,R;console.log("Confirming report",o);try{y.loading.show();const b=o.items.map(Y=>{const ve=parseFloat(Y.quantity)||0,ye=parseFloat(Y.gram)||0;return{...Y,total_grams:ve*ye}});console.log("Per Item Totals:",b);const h={...o,employee_id:f||"0",status:"confirmed",items:b};console.log("Confirm Datasss:",h);const a=await x.confirmDeliveryStocks(h);console.log("responsesssssss",a),(a==null?void 0:a.data)||((g=a==null?void 0:a.data)==null?void 0:g.message)==="Delivery confirmed."?(L.create({type:"positive",message:a.data.message||"Delivery Confirmed Successfully"}),(a==null?void 0:a.status)===200&&(r.value=!1,u("fetchAgain"))):L.create({type:"negative",message:((p=a==null?void 0:a.data)==null?void 0:p.message)||"Failed to Confirm Delivery"}),console.log("responsesss",a)}catch(b){console.log(b),L.create({type:"negative",message:((R=(N=b==null?void 0:b.response)==null?void 0:N.data)==null?void 0:R.message)||"Failed to Confirm Delivery"})}finally{y.loading.hide()}},O=async(o,g)=>{var p,N,R,b;try{y.loading.show(),console.log("declining report",o,"with remarks:",g);const h={id:o,employee_id:f||"0",status:"declined",remarks:g.remarks};console.log("declineData",h);const a=await x.declineDeliveryStocks(h);(a==null?void 0:a.data)||((p=a==null?void 0:a.data)==null?void 0:p.message)==="Delivery declined successfully."?(L.create({type:"positive",message:a.data.message||"Delivery Declined Successfully"}),(a==null?void 0:a.status)===200&&(r.value=!1,u("fetchAgain"))):L.create({type:"negative",message:((N=a==null?void 0:a.data)==null?void 0:N.message)||"Failed to decline delivery"}),console.log("responsesssss",a)}catch(h){console.log(h),L.create({type:"negative",message:((b=(R=h==null?void 0:h.response)==null?void 0:R.data)==null?void 0:b.message)||"Failed to decline delivery. Please try again."})}finally{y.loading.hide()}},U=o=>{switch((o||"").toLowerCase()){case"pending":return"orange-7";case"confirmed":return"green-7";case"declined":return"red-6";default:return"grey-6"}};return(o,g)=>(i(),V(G,null,[e($,{color:"accent",icon:"visibility",size:"md",flat:"",round:"",dense:"",onClick:z}),e(Z,{modelValue:r.value,"onUpdate:modelValue":g[1]||(g[1]=p=>r.value=p)},{default:t(()=>[e(K,{style:{width:"700px","max-width":"80vw"}},{default:t(()=>[e(k,{class:be(q(c)(l.report.status))},{default:t(()=>[n("div",Ae,[n("div",Le,D(q(w)(l.report.from_name)||"-"),1),e($,{class:"close-btn",color:"grey-8",flat:"",round:"",dense:"",icon:"close",onClick:g[0]||(g[0]=p=>r.value=!1)})])]),_:1},8,["class"]),e(k,null,{default:t(()=>[n("div",null,[n("span",null,"Date: "+D(q(S)(l.report.created_at)||"-"),1)]),n("div",null,[n("span",null,"Created By: "+D(q(H)(l.report.employee)||"-"),1)]),n("div",null,[n("span",null,[_(" Status: "),e(ie,{color:U(l.report.status)},{default:t(()=>[_(D(q(w)(l.report.status)||"-"),1)]),_:1},8,["color"])])]),l.report.status==="declined"?(i(),V("div",Pe,[n("span",null,"Remarks: "+D(l.report.remarks||"No Remarks"),1)])):B("",!0),n("div",Me,[He,l.report.items&&l.report.items.length?(i(),T(xe,{key:0,dense:"",separator:"",class:"box"},{default:t(()=>[e(le,{class:"bg-grey-1 text-weight-bold"},{default:t(()=>[e(M,null,{default:t(()=>[e(P,null,{default:t(()=>[_(" Raw Materials Code ")]),_:1})]),_:1}),e(M,null,{default:t(()=>[e(P,null,{default:t(()=>[_("Stocks Category")]),_:1})]),_:1}),e(M,{side:""},{default:t(()=>[e(P,null,{default:t(()=>[_(" Quantity ")]),_:1})]),_:1})]),_:1}),(i(!0),V(G,null,he(l.report.items,(p,N)=>(i(),T(le,{key:N},{default:t(()=>[e(M,null,{default:t(()=>[e(P,null,{default:t(()=>{var R;return[_(D(((R=p.raw_material)==null?void 0:R.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),e(M,null,{default:t(()=>[e(P,null,{default:t(()=>[_(D(p.category||"No Category"),1)]),_:2},1024)]),_:2},1024),e(M,{side:""},{default:t(()=>[e(P,null,{default:t(()=>[_(D(j(p.quantity||"No Quantity")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(i(),V("div",ze," No items in this delivery "))])]),_:1}),l.report.status==="pending"?(i(),T(X,{key:0,class:"report-actions q-ma-sm q-gutter-sm",align:"right"},{default:t(()=>[e($,{color:"negative",label:"Decline",class:"action-btn",onClick:E}),e($,{color:"positive",label:"Confirm",class:"action-btn",onClick:A})]),_:1})):B("",!0)]),_:1})]),_:1},8,["modelValue"])],64))}};var Ue=ae(Oe,[["__scopeId","data-v-1ccabf78"]]);const Ke={class:"q-mb-md row items-center justify-between"},je={key:0,class:"q-pt-md flex flex-center"},Ee={__name:"RawMaterialsDeliveryTable",setup(l){var O,U;const{capitalizeFirstLetter:C,formatTimestamp:w,formatFullname:S}=fe(),{getStatusColor:H}=ge(),c=ue(),v=F(()=>c.user);console.log("userData in RawMaterialsTable:",v.value);const Q=((U=(O=v.value)==null?void 0:O.device)==null?void 0:U.reference_id)||"",f=de(),x=ce(),m=F(()=>f.deliveryStocks.data.data);F(()=>f.loading);const u=F(()=>{var s;return((s=f.deliveryStocks)==null?void 0:s.pagination)||{total:0,current_page:1,last_page:1,per_page:5}}),r=I(null),y=I("");let z=null;const j=()=>{z&&clearTimeout(z),z=setTimeout(()=>{A(1)},500)},A=async(s=1)=>{x.loading.show();try{await f.fetchDeliveryStocksBranch(Q,s,u.value.per_page,y.value),!m.value.length&&r.value&&(r.value=null),r.value&&!m.value.some(d=>d.id===r.value.id)&&(r.value=null),!r.value&&m.value,length>0&&(r.value=m.value[0]),console.log("deliveryListsss",m.value),console.log("pagination",u.value)}catch(d){console.log("Error fetching delivery stocks in component:",d)}finally{x.loading.hide()}};De(()=>{A(u.value.current_page)});const E=s=>{A(s)},J=[{name:"created_at",label:"Date",align:"left",field:"created_at",format:s=>w(s),sortable:!0},{name:"from",label:"From",align:"left",field:s=>s.from_designation==="Supplier"?"Supplier":C(s.from_name),sortable:!0},{name:"process_by",label:"Process By",align:"left",field:s=>S((s==null?void 0:s.employee)||"undefined"),sortable:!0},{name:"approved_by",label:"Approved By",align:"left",field:s=>s.status==="pending"?"N/A":S((s==null?void 0:s.approved_by)||"N/A"),sortable:!0},{name:"items",label:"Items",field:"items",align:"center",sortable:!0},{name:"status",label:"Status",align:"center",field:"status"},{name:"view",align:"right",label:"View",field:"view",sortable:!0}];return(s,d)=>(i(),V(G,null,[n("div",Ke,[e(re,{outlined:"",dense:"",placeholder:"Search Supplier or Status",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:y.value,"onUpdate:modelValue":[d[0]||(d[0]=o=>y.value=o),j]},{append:t(()=>[e(ne,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"])]),e(Ce,{flat:"",columns:J,rows:m.value||[],"rows-per-page-options":[5],"row-key":"id",bordered:"",dense:""},{"body-cell-items":t(o=>[e(W,{props:o},{default:t(()=>[e(ke,{outlined:"",color:"primary text-white",dense:""},{default:t(()=>[_(D(o.row.items.length),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":t(o=>[e(W,{props:o},{default:t(()=>[e(ie,{outlined:"",color:q(H)(o.row.status)},{default:t(()=>[_(D(q(C)(o.row.status)),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-view":t(o=>[e(W,{props:o},{default:t(()=>[n("div",null,[e(Ue,{report:o.row,onFetchAgain:d[1]||(d[1]=g=>A(u.value.current_page))},null,8,["report"])])]),_:2},1032,["props"])]),_:1},8,["rows"]),u.value.last_page>1?(i(),V("div",je,[e(we,{modelValue:u.value.current_page,"onUpdate:modelValue":[d[2]||(d[2]=o=>u.value.current_page=o),E],max:u.value.last_page,"max-pages":5,"boundary-numbers":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):B("",!0)],64))}},Je={class:"text-h6 text-white"},yt={__name:"RawMaterialsDelivery",setup(l){return(C,w)=>(i(),T(K,{flat:""},{default:t(()=>[e(k,{style:{"background-color":"#ef4444"}},{default:t(()=>[n("div",Je,[e(ne,{name:"local_shipping"}),_(" Raw Materials Delivery ")])]),_:1}),e(k,{class:"q-gutter-y-md"},{default:t(()=>[n("div",null,[e(Ee)])]),_:1})]),_:1}))}};export{yt as default};
