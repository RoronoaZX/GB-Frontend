import{bp as _e,c as V,r as y,t as ee,o as p,a3 as C,f as e,M as R,w as l,Q as ne,I as N,ae,a1 as U,J as n,K as F,a0 as I,a4 as E,a5 as ve,e as T,$ as A,bb as fe,aI as ye,aJ as we,a2 as he,P as te,N as le,O as re,R as ie,u as ge,z as be,L as j,aK as ke}from"./index.4dee972f.js";import{Q as qe}from"./QSpace.786498fb.js";import{a as L,Q as se}from"./QSelect.fa297e11.js";import{a as z,b as Q}from"./QMenu.cc28e3f5.js";import{Q as xe}from"./QList.10eca19b.js";import{C as oe}from"./ClosePopup.4d75ceed.js";import{u as ue}from"./warehouse-rawMaterials.21539e93.js";import{_ as de}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as Qe}from"./QSpinnerDots.946b71b6.js";import{Q as Ie}from"./QChip.da6eaa54.js";import{Q as Se,a as Me}from"./QTable.7b789916.js";import"./use-virtual-scroll.8edefa0b.js";import"./rtl.276c3f1b.js";import"./selection.1daf8a21.js";import"./position-engine.bd4e6659.js";import"./axios.b9b62565.js";import"./raw-material.a8a8da4e.js";import"./QVirtualScroll.f87b62ae.js";const $=_=>(re("data-v-b53dccbc"),_=_(),ie(),_),Re=$(()=>n("div",{class:"text-h6"},"Add Supply",-1)),Ce=$(()=>n("div",{class:"q-my-sm"},"Supplier's Company Name",-1)),Ne=$(()=>n("div",{class:"q-my-sm"},"Supplier's Name",-1)),Ve={class:"q-mt-md q-gutter-y-sm"},$e={class:"q-my-md"},De=$(()=>n("div",{class:"q-my-sm"},"Raw Materials Name",-1)),We={class:"row q-gutter-y-lg justify-between"},Te=$(()=>n("div",{class:"q-my-sm",align:"center"},"Quantity",-1)),Le=$(()=>n("div",{class:"q-my-sm",align:"center"},"Unit",-1)),Ue=["onKeyup"],Fe={class:"q-mt-sm",align:"right"},Ae={__name:"WarehouseIngredientsCreateSupply",setup(_){var G,J,H,X,Y;_e();const d=ue(),k=V(()=>d.user);console.log("userData",k.value);const w=((J=(G=k.value)==null?void 0:G.device)==null?void 0:J.reference_id)||"";console.log("warehouseId",w);const g=((Y=(X=(H=k.value)==null?void 0:H.data)==null?void 0:X.employee)==null?void 0:Y.id)||"";console.log("employeeId",g);const v=y(!1),b=V(()=>d.warehouseRawMaterials),B=()=>{v.value=!0},S=y(!1),f=y([]),h=y([]),i=ee({name:"",quantity:"",unit:""}),K=V(()=>f.value.length>0),O=[{label:"Sack (25 kg each)",value:"sack"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],M=y(h.value);(async()=>{try{S.value=!0;const r=w,a=await d.fetchWarehouseRawMaterials(r);console.log("warehouseRawMaterials",a),h.value=d.warehouseRawMaterials.map(t=>({label:t.raw_materials.name,value:t.raw_materials.id,suffix:t.raw_materials.unit})),M.value=h.value}catch(r){console.error("Error fetching warehouse raw materials:",r)}finally{S.value=!1}})();const D=()=>{i.name="",i.quantity="",i.unit=""},o=(r,a)=>{a(()=>{if(r==="")M.value=h.value;else{const t=r.toLowerCase();M.value=h.value.filter(W=>W.label.toLowerCase().includes(t))}})},s=()=>{console.log("clickckck");const r=f.value;function a(Z,me){return Z.find(pe=>pe.raw_material_id==me)}const t=i.name.value;a(r,t)||(f.value=[...r,{raw_material_id:i.name.value,label:i.name.label,quantity:i.quantity,unit:i.unit}],D())},u=r=>{f.value.splice(r,1)},c=r=>r?r.split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()).join(" "):"",m=ee({companyName:"",supplierName:""}),q=()=>{m.companyName="",m.supplierName="",f.value=[]},x=r=>r.map(a=>{let t=a.quantity;return a.unit.value==="sack"?t=a.quantity*25e3:a.unit.value==="kilo"?t=a.quantity*1e3:a.unit.value==="gram"&&(t=a.quantity),{...a,convertedQuantity:t,unit:{...a.unit,value:"gram"}}}),ce=async()=>{const r=x(f.value);try{te.show();const a={employee_id:g,warehouse_id:w,supplier_company_name:m.companyName,supplier_name:m.supplierName,raw_materials:r.map(t=>({raw_material_id:t.raw_material_id,quantity:t.convertedQuantity,unit:t.unit.value}))};console.log("new data",a),await d.warehouseAddSupply(a),b.value=await d.fetchWarehouseRawMaterials(w),D(),q(),v.value=!1,le.create({message:"Supply added successfully",color:"positive"})}catch(a){le.create({message:"Error adding supply",color:"negative"}),console.error("Error adding supply:",a)}finally{te.hide()}};return(r,a)=>(p(),C(E,null,[e(R,{class:"q-pa-sm",color:"red",dense:"",elevated:"",icon:"add_circle",label:"Add Supply",onClick:B}),e(he,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=t=>v.value=t)},{default:l(()=>[e(ne,{class:"my-card",style:{width:"900px"}},{default:l(()=>[e(N,{class:"row items-center"},{default:l(()=>[Re,e(qe),ae(e(R,{icon:"close",flat:"",dense:"",round:""},null,512),[[oe]])]),_:1}),e(U),e(N,{class:"q-my-md q-mx-sm q-gutter-y-sm"},{default:l(()=>[n("div",null,[Ce,e(F,{modelValue:m.companyName,"onUpdate:modelValue":a[0]||(a[0]=t=>m.companyName=t),outlined:"",dense:""},null,8,["modelValue"])]),n("div",null,[Ne,e(F,{modelValue:m.supplierName,"onUpdate:modelValue":a[1]||(a[1]=t=>m.supplierName=t),outlined:"",dense:""},null,8,["modelValue"])])]),_:1}),e(U),e(N,null,{default:l(()=>[n("div",Ve,[n("div",null,[e(xe,{dense:"",separator:"",class:"box"},{default:l(()=>[e(z,null,{default:l(()=>[e(Q,null,{default:l(()=>[e(L,{class:"text-overline"},{default:l(()=>[I("Raw Materials Name")]),_:1})]),_:1}),e(Q,null,{default:l(()=>[e(L,{class:"text-overline"},{default:l(()=>[I("Quantity")]),_:1})]),_:1}),e(Q,{side:""})]),_:1}),(p(!0),C(E,null,ve(f.value,(t,W)=>(p(),T(z,{key:W},{default:l(()=>[e(Q,null,{default:l(()=>[e(L,{class:"text-caption"},{default:l(()=>[I(A(c(t.label)),1)]),_:2},1024)]),_:2},1024),e(Q,null,{default:l(()=>[e(L,{class:"text-caption justify-between"},{default:l(()=>[I(A(t.quantity)+" "+A(t.unit.value),1)]),_:2},1024)]),_:2},1024),e(Q,{side:""},{default:l(()=>[e(R,{onClick:Z=>u(W),color:"grey-10",icon:"backspace",dense:"",flat:"",round:""},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1}),e(N,null,{default:l(()=>[n("div",$e,[De,e(se,{modelValue:i.name,"onUpdate:modelValue":a[2]||(a[2]=t=>i.name=t),debounce:"100",outlined:"","chips-color":"primary",options:M.value,dense:"",label:"Raw Materials",behavior:"menu","use-input":"","hide-dropdown-icon":"",onFilter:o},{"no-option":l(()=>[e(z,null,{default:l(()=>[e(Q,{class:"text-grey"},{default:l(()=>[I(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),n("div",We,[n("div",null,[Te,e(F,{modelValue:i.quantity,"onUpdate:modelValue":a[3]||(a[3]=t=>i.quantity=t),type:"number",outlined:"",dense:"",style:{width:"300px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])]),n("div",null,[Le,e(se,{modelValue:i.unit,"onUpdate:modelValue":a[4]||(a[4]=t=>i.unit=t),options:O,outlined:"",behavior:"menu",dense:"",style:{width:"350px","max-width":"250px","min-width":"none"}},null,8,["modelValue"])])]),n("form",{onKeyup:fe(ye(s,["prevent"]),["enter"])},[n("div",Fe,[e(R,{padding:"sm lg",outline:"",dense:"",icon:"add",color:"purple",onClick:s})])],40,Ue)]),_:1}),e(U),e(we,{class:"row q-ma-md q-mt-xl",align:"left"},{default:l(()=>[ae(e(R,{class:"glossy",color:"grey-9",label:"Cancel"},null,512),[[oe]]),e(R,{class:"glossy",color:"teal",label:"Create",onClick:ce,disable:!K.value},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};var Be=de(Ae,[["__scopeId","data-v-b53dccbc"]]);const Ke=_=>(re("data-v-7a051a40"),_=_(),ie(),_),Oe={class:"q-mb-sm"},Pe={key:0,class:"spinner-wrapper"},je={key:1},ze={key:0,class:"data-error"},Ee=Ke(()=>n("div",{class:"q-ml-sm text-h6"},"No data available",-1)),Ge={__name:"WarehouseIngredientsTable",setup(_){var P,D;const d=ue(),k=V(()=>d.user);console.log("userData",k.value);const w=((D=(P=k.value)==null?void 0:P.device)==null?void 0:D.reference_id)||"",g=V(()=>d.warehouseRawMaterials),v=y(!0);console.log("warehouse id",w);const b=y(""),B=y(!1),S=y(!1),f=y({rowsPerPage:0}),h=V(()=>b.value?g.value.filter(o=>o.name.toLowerCase().includes(b.value.toLowerCase())):g.value);ge(b,async o=>{v.value=!0,await new Promise(s=>setTimeout(s,1e3)),v.value=!1,S.value=h.value.length===0}),be(async()=>{console.log("props.warehouseId in onMounted:",w),w&&await i(w)});const i=async o=>{console.log("Fetching raw materials for warehouse ID:",o);try{v.value=!0;const s=await d.fetchWarehouseRawMaterials(o);g.value=s,g.value.length||(S.value=!0),console.log("Warehouse Raw Materialsss",g.value)}catch(s){console.log("Error fetching warehouse product:",s),S.value=!0}finally{v.value=!1}},K=o=>{const s=o.total_quantity,u=o.raw_materials.unit;if(console.log("unit test",u),u==="Grams"&&s<1e3)return"bg-red";let c;return s>=1e3?c=s/1e3:c=s,c<5?c<=2?"bg-red":(c<=3,"bg-warning"):"bg-positive"},O=o=>{var m;const s=Number(o==null?void 0:o.total_quantity)||0,u=((m=o==null?void 0:o.raw_materials)==null?void 0:m.unit)||"units";console.log("totalQuantity:",s),console.log("unit:",u);const c=q=>{const x=Number(q);return Number.isInteger(x)?x:x.toFixed(2)};if(s>1e3){const q=s/1e3;if(q>=25){const x=q/25;return`${c(x)} sacks`}return`${c(q)} kilos`}return`${c(s)} ${u}`},M=[{name:"name",label:"Ingredients Name",align:"center",field:o=>{var s;return((s=o==null?void 0:o.raw_materials)==null?void 0:s.name)||"N/A"},format:o=>`${o}`,sortable:!0},{name:"availableStocks",align:"center",label:"Available Stocks",field:"total_quantity",sortable:!0}];return(o,s)=>(p(),C(E,null,[n("div",Oe,[e(F,{rounded:"",outlined:"",dense:"",debounce:"300",modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=u=>b.value=u),placeholder:"Search",style:{width:"500px","max-width":"1500px","min-width":"100px"}},{append:l(()=>[B.value?(p(),T(j,{key:1,thickness:2,color:"teal",size:"1em"})):(p(),T(j,{key:0,name:"search"}))]),_:1},8,["modelValue"])]),v.value?(p(),C("div",Pe,[e(Qe,{size:"50px",color:"primary"})])):(p(),C("div",je,[h.value.length===0?(p(),C("div",ze,[e(j,{name:"warning",color:"warning",size:"4em"}),Ee])):(p(),T(Me,{key:1,class:"table-container sticky-header",filter:b.value,flat:"",columns:M,rows:h.value,"row-key":"name",pagination:f.value,"onUpdate:pagination":s[1]||(s[1]=u=>f.value=u),"rows-per-page-options":[0],"hide-bottom":"",style:{height:"340px"}},{"body-cell-availableStocks":l(u=>[e(Se,{props:u},{default:l(()=>[e(Ie,{square:"",class:ke(["text-white",K(u.row)])},{default:l(()=>[I(A(O(u.row)),1)]),_:2},1032,["class"])]),_:2},1032,["props"])]),_:1},8,["filter","rows","pagination"]))]))],64))}};var Je=de(Ge,[["__scopeId","data-v-7a051a40"]]);const He={align:"right"},va={__name:"WarehouseIngredients",setup(_){return(d,k)=>(p(),T(ne,{flat:""},{default:l(()=>[e(N,{class:"text-h6"},{default:l(()=>[I(" Ingredients ")]),_:1}),e(U),e(N,{class:"q-gutter-md"},{default:l(()=>[n("div",He,[e(Be)]),n("div",null,[e(Je)])]),_:1})]),_:1}))}};export{va as default};
