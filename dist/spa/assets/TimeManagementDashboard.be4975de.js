import{g as ne,c as T,j as W,k as le,aP as re,bF as ie,M as j,x as de,bz as ce,o as D,e as U,w as G,J as n,$ as S,a3 as C,a4 as H,a5 as J,bx as ae,aK as ue,f as E,a0 as me,bd as ge,Q as ve,O as fe,R as _e,be as he,r as Y,u as pe,z as ye,L as be}from"./index.0b21b79d.js";import{Q as De}from"./QSpinnerDots.3ceb7492.js";import{Q as ke}from"./QPage.6513d288.js";import{q as A}from"./date.506eb01c.js";import{u as we}from"./dtr.44dd0e2c.js";import{Q as xe}from"./QTooltip.27569476.js";import{_ as Se}from"./plugin-vue_export-helper.21dcd24c.js";import"./selection.1e4d44c9.js";import"./axios.6077a844.js";import"./position-engine.541b2607.js";var Be=ne({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(t,{slots:h}){const f=T(()=>{const k=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(i=>t[i]===!0).map(i=>`q-btn-group--${i}`).join(" ");return`q-btn-group row no-wrap${k.length!==0?" "+k:""}`+(t.spread===!0?" q-btn-group--spread":" inline")});return()=>W("div",{class:f.value},le(h.default))}}),Te=ne({name:"QBtnToggle",props:{...re,modelValue:{required:!0},options:{type:Array,required:!0,validator:t=>t.every(h=>("label"in h||"icon"in h||"slot"in h)&&"value"in h)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(t,{slots:h,emit:f}){const k=T(()=>t.options.find(g=>g.value===t.modelValue)!==void 0),i=T(()=>({type:"hidden",name:t.name,value:t.modelValue})),u=ce(i),d=T(()=>ie(t)),w=T(()=>({rounded:t.rounded,dense:t.dense,...d.value})),s=T(()=>t.options.map((g,_)=>{const{attrs:P,value:M,slot:z,...v}=g;return{slot:z,props:{key:_,"aria-pressed":M===t.modelValue?"true":"false",...P,...v,...w.value,disable:t.disable===!0||v.disable===!0,color:M===t.modelValue?m(v,"toggleColor"):m(v,"color"),textColor:M===t.modelValue?m(v,"toggleTextColor"):m(v,"textColor"),noCaps:m(v,"noCaps")===!0,noWrap:m(v,"noWrap")===!0,size:m(v,"size"),padding:m(v,"padding"),ripple:m(v,"ripple"),stack:m(v,"stack")===!0,stretch:m(v,"stretch")===!0,onClick(R){p(M,g,R)}}}}));function p(g,_,P){t.readonly!==!0&&(t.modelValue===g?t.clearable===!0&&(f("update:modelValue",null,null),f("clear")):f("update:modelValue",g,_),f("click",P))}function m(g,_){return g[_]===void 0?t[_]:g[_]}function F(){const g=s.value.map(_=>W(j,_.props,_.slot!==void 0?h[_.slot]:void 0));return t.name!==void 0&&t.disable!==!0&&k.value===!0&&u(g,"push"),de(h.default,g)}return()=>W(Be,{class:"q-btn-toggle",...d.value,rounded:t.rounded,stretch:t.stretch,glossy:t.glossy,spread:t.spread},F)}});const K=t=>(fe("data-v-3f95a2ea"),t=t(),_e(),t),Le={class:"row items-center no-wrap"},Ce={class:"col-auto"},Pe={class:"text-weight-bold"},qe=K(()=>n("div",{class:"text-grey-7 text-caption"},"Clock-in",-1)),Me={class:"text-subtitle1 text-weight-regular"},Oe={class:"col q-px-xl"},$e={class:"timeline-container"},Ie={class:"timeline-bar"},Ve={key:0,class:"activity-label"},Ae={class:"col-auto"},Ee={class:"row items-center no-wrap q-gutter-x-lg"},Qe={class:"text-right"},Ye={class:"text-weight-bold"},Fe=K(()=>n("div",{class:"text-grey-7 text-caption"},"Clock-out",-1)),ze={class:"text-subtitle1 text-weight-regular"},Re={class:"text-right"},Ne=K(()=>n("div",{class:"text-grey-7 text-caption"},"Duration",-1)),We={class:"text-subtitle1 text-weight-regular"},je={__name:"DailyAttendanceLog",props:{log:{type:Object,required:!0,default:()=>({dayLabelIn:"10 Tuesday",clockIn:"04:08 PM",dayLabelOut:"11 Wednesday",clockOut:"08:25 AM",duration:"16h 17m",activities:[{type:"working",label:"Working time",start:"16:08",end:"24:00"},{type:"working",label:"Working time",start:"00:00",end:"08:25"},{type:"break",label:"",start:"03:30",end:"04:00"}],otStatus:"approved"})}},setup(t){const h=t;T(()=>{switch(h.log.otStatus){case"approved":return{label:"Approved",color:"positive",icon:"check_circle"};case"declined":return{label:"Declined",color:"negative",icon:"cancel"};case"pending":return{label:"Pending",color:"orange",icon:"hourglass_empty"};default:return{label:"Unknown",color:"grey",icon:"help"}}});const f=["02","04","06","08","10","12","14","16","18","20","22","24"],k=d=>{if(!d)return 0;const[w,s]=d.split(":").map(Number),p=w*60+s,m=24*60;return p/m*100},i=d=>{if(!d.start||!d.end)return{};const w=k(d.start);let p=k(d.end)-w;return p<0&&(p=100+p),{left:`${w}%`,width:`${p}%`}},u=d=>{if(!d.label)return"activity-marker";switch(d.type){case"working":return"bg-primary";case"break":return"bg-orange-4";case"overtime":return"bg-deep-orange";case"day_off":return"bg-amber";default:return"bg-grey-5"}};return(d,w)=>(D(),U(ve,{flat:"",class:"log-card q-mb-sm"},{default:G(()=>[n("div",Le,[n("div",Ce,[n("div",Pe,S(t.log.dayLabelIn),1),qe,n("div",Me,S(t.log.clockIn),1)]),n("div",Oe,[n("div",$e,[(D(),C(H,null,J(f,s=>n("div",{key:s,class:"time-marker",style:ae({left:k(`${s}:00`)+"%"})},S(s)+":00 ",5)),64)),n("div",Ie,[(D(!0),C(H,null,J(t.log.activities,(s,p)=>(D(),C("div",{key:p,class:ue(["activity-block",u(s)]),style:ae(i(s))},[E(xe,{anchor:"top middle",self:"bottom middle"},{default:G(()=>[me(S(s.label)+": "+S(s.start)+" - "+S(s.end),1)]),_:2},1024),s.label?(D(),C("span",Ve,S(s.label),1)):ge("",!0)],6))),128))])])]),n("div",Ae,[n("div",Ee,[n("div",Qe,[n("div",Ye,S(t.log.dayLabelOut),1),Fe,n("div",ze,S(t.log.clockOut),1)]),n("div",Re,[Ne,n("div",We,S(t.log.duration),1)])])])])]),_:1}))}};var Ue=Se(je,[["__scopeId","data-v-3f95a2ea"]]);const Ge={key:0},He={class:"row items-center justify-between q-mb-md"},Je={class:"row items-center q-gutter-x-sm"},Ke={class:"text-h6 text-weight-medium"},Xe=n("span",null,null,-1),Ze={key:0,class:"q-mt-md"},et={key:1,class:"text-center q-pa-xl text-grey-7"},tt=n("div",{class:"text-h6 q-mt-md"},"No Attendance Records",-1),at=n("p",null," There is no attendance data for this employee in the selected period. ",-1),nt={key:1,class:"text-center q-pa-xl"},vt={__name:"TimeManagementDashboard",setup(t){const f=he().params.employee_id;console.log("Time Management Employee ID :",f);const k=we(),i=Y(""),u=Y(""),d=Y("attendance"),w=Y(!0),s=Y([]),p=T(()=>{switch(d.value){case"overtime":return s.value.filter(l=>l.otStatus);case"time_off":return s.value.filter(l=>l.isDayOff);case"attendance":default:return s.value}}),m=l=>{if(!l||l.length===0)return[];const r=e=>{if(!e)return"-";const a=new Date(e),c=new Date,y=new Date;y.setDate(y.getDate()-1);let b=a.toLocaleDateString("en-US",{weekday:"long",day:"numeric"});return A.isSameDate(a,c,"day")&&(b="Today"),A.isSameDate(a,y,"day")&&(b="Yesterday"),b};return l.map(e=>{const a=e.time_in?new Date(e.time_in):null,c=e.time_out?new Date(e.time_out):null,y=r(a||e.created_at),b=r(c||a||e.created_at),x=!a&&e.ot_status==="approved",B=e.break_start?new Date(e.break_start):null,L=e.break_end?new Date(e.break_end):null,q=e.lunch_break_start?new Date(e.lunch_break_start):null,$=e.lunch_break_end?new Date(e.lunch_break_end):null,Q=e.overtime_start?new Date(e.overtime_start):null,N=e.overtime_end?new Date(e.overtime_end):null,O=[];if(a){let o=a;const I=B||q;I&&I>o&&(O.push({type:"working",label:"Working time",start:o,end:I}),o=I),B&&L&&L>o&&(O.push({type:"break",label:"Break",start:B,end:L}),o=L),q&&$&&$>o&&(O.push({type:"break",label:"Break",start:q,end:$}),o=$);const V=Q||c;V&&V>o&&(O.push({type:"working",label:"Working time",start:o,end:V}),o=V),Q&&N&&N>o&&O.push({type:"overtime",label:"Over time",start:Q,end:N})}else x&&O.push({type:"day_off",label:"Requested day off",start:null,end:null});const Z=o=>o?o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}):"-",ee=o=>o?o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}):null,oe=a||new Date(e.created_at||Date.now());let se=r(oe),te="-";if(a&&c){const o=c-a,I=Math.floor(o/36e5),V=Math.round(o%36e5/6e4);te=`${I}h ${V}m`}return{dayLabel:se,dayLabelIn:y,dayLabelOut:b,clockIn:Z(a),clockOut:Z(c),duration:te,otStatus:e.ot_status,isDayOff:x,activities:O.map(o=>({...o,start:ee(o.start),end:ee(o.end)}))}})},F=async()=>{if(!(!i.value||!u.value||!f)){w.value=!0;try{await k.fetchEmployeeDTRRange({employee_id:f,start_date:i.value,end_date:u.value}),s.value=m(k.dtrCutOffData)}catch(l){console.error("Error fetching or transforming attendance data:",l),s.value=[]}finally{w.value=!1}}},g=(l,r)=>{if(!l||!r)return"Loading...";const e=new Date(l),a=new Date(r),c={day:"2-digit",month:"short"},y={day:"2-digit",month:"short",year:"numeric"},b=e.toLocaleDateString("en-US",c).replace(",",""),x=a.toLocaleDateString("en-US",y).replace(",","");return`${b} - ${x}`},_=T(()=>g(i.value,u.value)),P=l=>{const r=new Date(l),e=r.getDate(),a=r.getFullYear();let c=r.getMonth()+1,y,b,x,B,L,q;e>=11&&e<=25?(y=11,b=25,x=c,B=c,L=a,q=a):e>=26?(y=26,b=10,x=c,B=c+1,L=a,q=c===12?a+1:a):(y=26,b=10,x=c-1,B=c,L=c===1?a-1:a,q=a),x===0&&(x=12),B===13&&(B=1);const $=A.formatDate(new Date(L,x-1,y),"YYYY-MM-DD"),Q=A.formatDate(new Date(q,B-1,b),"YYYY-MM-DD");return{startDate:$,endDate:Q}},M=T(()=>{if(!i.value||!u.value)return!0;const l=new Date,{startDate:r,endDate:e}=P(l);return new Date(u.value)>=new Date(e)}),z=()=>{const l=new Date(i.value),r=A.subtractFromDate(l,{days:1}),{startDate:e,endDate:a}=P(r);(i.value!==e||u.value!==a)&&(i.value=e,u.value=a)},v=()=>{if(M.value)return;const l=new Date(u.value),r=A.addToDate(l,{days:1}),{startDate:e,endDate:a}=P(r);(i.value!==e||u.value!==a)&&(i.value=e,u.value=a)},R=()=>{const l=new Date,{startDate:r,endDate:e}=P(l);i.value=r,u.value=e};let X;return pe([()=>i.value,()=>f],()=>{clearTimeout(X),X=setTimeout(()=>{F()},200)},{immediate:!0}),ye(()=>{R()}),(l,r)=>(D(),U(ke,{class:"q-py-md"},{default:G(()=>[w.value?(D(),C("div",nt,[E(De,{color:"primary",size:"2em"})])):(D(),C("div",Ge,[n("div",He,[n("div",null,[E(Te,{modelValue:d.value,"onUpdate:modelValue":r[0]||(r[0]=e=>d.value=e),"no-caps":"",rounded:"",unelevated:"","toggle-color":"primary",color:"white","text-color":"primary",options:[{label:"Attendance",value:"attendance"},{label:"Time Off",value:"time_off"},{label:"Overtime",value:"overtime"}]},null,8,["modelValue"])]),n("div",Je,[n("div",Ke,S(_.value),1),E(j,{flat:"",dense:"",round:"",icon:"chevron_left",onClick:z}),E(j,{flat:"",dense:"",round:"",icon:"chevron_right",disable:M.value,onClick:v},null,8,["disable"])]),Xe]),s.value.length>0?(D(),C("div",Ze,[(D(!0),C(H,null,J(p.value,(e,a)=>(D(),U(Ue,{key:a,log:e},null,8,["log"]))),128))])):(D(),C("div",et,[E(be,{name:"event_busy",size:"4em"}),tt,at]))]))]),_:1}))}};export{vt as default};
