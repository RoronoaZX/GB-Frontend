import{c as E,r as y,t as Z,u as K,o as c,a3 as U,f as n,M as q,w as s,Q as D,I as S,ae as ee,K as _,e as w,L as J,bc as ae,a0 as Q,a4 as M,a5 as j,$ as f,bd as te,J as r,aJ as oe,a2 as le,O as H,R as O,z as ne,bb as R,N as P}from"./index.4d4f3ecb.js";import{b as se,Q as T,a as re}from"./QTable.369eb731.js";import{Q as de}from"./QTr.c010c3f7.js";import{Q as L}from"./QTooltip.a8cdb6f3.js";import{Q as z}from"./QPopupEdit.aab798b9.js";import{Q as ie}from"./QSpinnerIos.b6356b48.js";import{Q as ue}from"./QInnerLoading.0bd2c209.js";import{Q as me}from"./QPage.8462bf79.js";import{Q as ce}from"./QSpace.0c1431bb.js";import{Q as B,a as pe}from"./QItem.8d77583a.js";import{Q as _e}from"./QList.e416c58d.js";import{C as fe}from"./ClosePopup.b07fe58c.js";import{u as ye}from"./employee.078c0620.js";import{u as G}from"./cash-advance.a2dc7db8.js";/* empty css                                                                     */import{_ as W}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.c9bd7b6e.js";import"./use-virtual-scroll.c1f0c884.js";import"./QSelect.680051d8.js";import"./QItemLabel.8a37f99f.js";import"./QChip.fb33ffda.js";import"./QMenu.0a85cb0a.js";import"./position-engine.4770ad56.js";import"./selection.0b6f0b1a.js";import"./axios.80bae863.js";const F=p=>(H("data-v-c2dd57f2"),p=p(),O(),p),ve=F(()=>r("div",{class:"text-h5 q-mr-md"},"\u{1F4B2} Add Cash Advance",-1)),ge={key:0,class:"custom-list z-top"},be={class:"row q-gutter-md text-subtitle1"},he=F(()=>r("div",null,"Name:",-1)),we={class:"text-weight-meduim"},Ve={class:"row q-gutter-md text-subtitle1"},xe=F(()=>r("div",null,"Position:",-1)),Ae={class:"text-weight-meduim"},Ce={class:"q-gutter-y-md"},Qe={__name:"CashAdvanceButton",emits:["created"],setup(p,{emit:v}){const $=v,g=ye(),i=E(()=>g.employees),u=G();E(()=>u.cashAdvances);const d=y(""),V=y(!1),x=y(!1),b=y(!1),h=()=>{b.value=!0},A=async()=>{d.value.trim()&&(x.value=!0,await g.searchEmployee(d.value),x.value=!1)},k=e=>{console.log("Selected Employee:",e),o.employee_id=e.id,o.employee_name=`${e.firstname} ${e.middlename?e.middlename.charAt(0)+".":""} ${e.lastname} `,o.employee_position=e.position,d.value="",console.log("Filled Designation Data:",o)},o=Z({employee_id:"",employee_name:"",employee_position:"",amount:0,reason:"",number_of_payments:0,payment_per_payroll:0,remaining_payments:0});K(()=>[o.amount,o.number_of_payments],([e,t])=>{const a=parseFloat(e)||0,l=parseInt(t)||0;o.payment_per_payroll=(l>0?a/l:0).toFixed(2)});const N=()=>{o.employee_id="",o.employee_name="",o.employee_position="",o.amount=0,o.number_of_payments=0,o.payment_per_payroll=0,o.remaining_payments=0,o.reason=""},I=async()=>{o.remaining_payments=parseFloat(o.amount)||0,V.value=!0;try{console.log("save cash advance",o),await u.createCashAdvance(o),$("created"),b.value=!1,N()}catch(e){console.log(e)}finally{V.value=!1}};return(e,t)=>(c(),U("div",null,[n(q,{padding:"sm md",label:"Cash Advance",icon:"attach_money",size:"md",class:"gradient-btn text-white",onClick:h}),n(le,{modelValue:b.value,"onUpdate:modelValue":t[5]||(t[5]=a=>b.value=a),persistent:"",position:"right","backdrop-filter":"blur(4px) saturate(150%)"},{default:s(()=>[n(D,{style:{width:"400px","max-width":"80vw"}},{default:s(()=>[n(S,{class:"row items-center q-px-md q-py-sm gradient-btn text-white"},{default:s(()=>[ve,n(ce),ee(n(q,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[fe]])]),_:1}),n(S,null,{default:s(()=>[n(_,{modelValue:d.value,"onUpdate:modelValue":[t[0]||(t[0]=a=>d.value=a),A],label:"Search Employee",outlined:"",rounded:"",dense:"",debounce:"500",placeholder:"Enter name"},{append:s(()=>[x.value?(c(),w(ae,{key:1,color:"grey",size:"sm"})):(c(),w(J,{key:0,name:"search"}))]),default:s(()=>[d.value?(c(),U("div",ge,[n(D,null,{default:s(()=>[n(_e,{separator:""},{default:s(()=>{var a;return[(a=i.value)!=null&&a.length?(c(!0),U(M,{key:1},j(i.value,l=>(c(),w(B,{onClick:m=>k(l),key:l.id,clickable:""},{default:s(()=>[n(pe,null,{default:s(()=>[Q(f(`${l.firstname} ${l.middlename?l.middlename.charAt(0)+".":""} ${l.lastname}`),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128)):(c(),w(B,{key:0},{default:s(()=>[Q(" No Employee record ")]),_:1}))]}),_:1})]),_:1})])):te("",!0)]),_:1},8,["modelValue"])]),_:1}),n(S,null,{default:s(()=>[r("div",be,[he,r("div",we,f(o.employee_name?o.employee_name:"-------"),1)]),r("div",Ve,[xe,r("div",Ae,f(o.employee_position?o.employee_position:"-------"),1)])]),_:1}),n(S,null,{default:s(()=>[r("div",Ce,[r("div",null,[n(_,{modelValue:o.amount,"onUpdate:modelValue":t[1]||(t[1]=a=>o.amount=a),type:"number",outlined:"",label:"Amount"},null,8,["modelValue"])]),r("div",null,[n(_,{modelValue:o.number_of_payments,"onUpdate:modelValue":t[2]||(t[2]=a=>o.number_of_payments=a),type:"number",outlined:"",label:"Number of Payments"},null,8,["modelValue"])]),r("div",null,[n(_,{modelValue:o.payment_per_payroll,"onUpdate:modelValue":t[3]||(t[3]=a=>o.payment_per_payroll=a),outlined:"",hint:"Number of Payments",dense:"",readonly:"",label:"Number of Payments"},null,8,["modelValue"])]),r("div",null,[n(_,{modelValue:o.reason,"onUpdate:modelValue":t[4]||(t[4]=a=>o.reason=a),filled:"",type:"textarea",outlined:"",label:"Reason"},null,8,["modelValue"])])])]),_:1}),n(oe,null,{default:s(()=>[n(q,{size:"md",padding:"xs md",label:"save","icon-right":"send",class:"gradient-btn text-white",loading:V.value,onClick:I},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var Ne=W(Qe,[["__scopeId","data-v-c2dd57f2"]]);const X=p=>(H("data-v-9d976a60"),p=p(),O(),p),Se={class:"row justify-between q-mb-md",align:"right"},Pe={class:"row q-gutter-md"},Ue=X(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Amount ",-1)),$e={class:"text-subtitle2 q-mb-sm"},ke=X(()=>r("div",{class:"text-h6 text-primary text-center q-mb-xs"}," Edit Reason ",-1)),Ie={class:"text-subtitle2 q-mb-sm"},qe={__name:"CashAdvanceTable",setup(p){const v=G(),$=E(()=>v.cashAdvances),g=y([]),i=y({page:1,rowsPerPage:0,rowsNumber:0}),u=y(!0),d=y("");function V(e){if(e==null||e==="")return"";const t=parseFloat(e);return isNaN(t)?"":Number.isInteger(t)?String(parseInt(t)):String(t)}async function x(e,t){u.value=!0;try{await v.updateAmount(e,t),P.create({message:"Amount updated successfully",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),P.create({message:"Failed to update amount",color:"negative",position:"top",timeout:2e3})}finally{u.value=!1}}async function b(e,t){u.value=!0;try{await v.updateReason(e,t),P.create({message:"Cash Advance reason updated successfully!",color:"positive",position:"top",timeout:2e3})}catch(a){console.log(a),P.create({message:"Cash Advance reasons updated successfully!",color:"negative",position:"top",timeout:2e3})}finally{u.value=!1}}ne(async()=>{await h()});const h=async(e=1,t=7,a="")=>{try{u.value=!0,await v.fetchCashAdvance(e,t,a);const{data:l,current_page:m,per_page:C,total:Y}=$.value;g.value=l,console.log("Cash Advance",g.value),i.value.page=m,i.value.rowsPerPage=C,i.value.rowsNumber=Y}catch(l){console.log("===================================="),console.log(l),console.log("====================================")}finally{u.value=!1}},A=e=>{const t=C=>C?C.charAt(0).toUpperCase()+C.slice(1).toLowerCase():"",a=e.firstname?t(e.firstname):"No Firstname",l=e.middlename?t(e.middlename).charAt(0)+".":"",m=e.lastname?t(e.lastname):"No Lastname";return`${a} ${l} ${m}`.trim()},k=e=>{h(e.pagination.page,e.pagination.rowsPerPage,e.filter)};K(d,async e=>{await h(i.value.page,i.value.rowsPerPage,e)});const o=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(e),N=e=>{if(!e)return" - - ";const t=new Date(e);return isNaN(t.getTime())?" - - ":t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})},I=[{name:"date",label:"Date Created",align:"left",field:e=>N(e.created_at)},{name:"date",label:"Date Updated",align:"left",field:e=>N(e.updated_at)},{name:"name",label:"Employee Name",align:"left",field:e=>A(e.employee)},{name:"amount",label:"Total Amount",align:"center",field:e=>o(e.amount)},{name:"number_of_payments",label:"Number of Payments",align:"center",field:e=>e.number_of_payments?e.number_of_payments:0},{name:"payment_per_payroll",label:"Payment per Payroll",align:"center",field:e=>o(e.payment_per_payroll)},{name:"remaining_payments",label:"Remaining Payments",align:"center",field:e=>o(e.remaining_payments)},{name:"reason",label:"Reason",align:"center",field:"reason"}];return(e,t)=>(c(),w(me,{class:"q-my-md"},{default:s(()=>[r("div",Se,[r("div",Pe,[n(Ne,{onCreated:h})]),n(_,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=a=>d.value=a),outlined:"",dense:"",debounce:"300",flat:"",label:"Search",style:{width:"300px"}},{append:s(()=>[r("div",null,[n(J,{name:"search"})])]),_:1},8,["modelValue"])]),n(re,{rows:g.value,columns:I,"row-key":"name",pagination:i.value,"onUpdate:pagination":t[1]||(t[1]=a=>i.value=a),"rows-per-page-options":[5,7,10,0],loading:u.value,filter:d.value,onRequest:k},{header:s(a=>[n(de,{props:a,class:"gradient-header text-white text-weight-bold"},{default:s(()=>[(c(!0),U(M,null,j(a.cols,l=>(c(),w(se,{key:l.name,props:a,class:"text-center text-subtitle2"},{default:s(()=>[Q(f(l.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-amount":s(a=>[n(T,{props:a,class:"cursor-pointer"},{default:s(()=>[r("span",null,f(a.row.amount?o(a.row.amount):" - - - "),1),n(L,{class:"bg-blue-grey-8"},{default:s(()=>[Q("Edit Amount")]),_:1}),n(z,{"onUpdate:modelValue":[l=>x(a.row,l),l=>a.row.amount=l],modelValue:a.row.amount,buttons:"","label-set":"Save","label-cancel":"Close"},{default:s(l=>[Ue,r("div",$e," Name: "+f(A(a.row.employee)),1),n(_,{modelValue:l.value,"onUpdate:modelValue":[m=>l.value=m,m=>l.value=m],"model-value":V(l.value),type:"text",autofocus:"",counter:"",onKeyup:R(l.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","model-value","onKeyup"])]),_:2},1032,["onUpdate:modelValue","modelValue"])]),_:2},1032,["props"])]),"body-cell-reason":s(a=>[n(T,{props:a,class:"cursor-pointer"},{default:s(()=>[r("span",null,f(a.row.reason||" - - - "),1),n(L,{class:"bg-blue-grey-8"},{default:s(()=>[Q("Edit Reason")]),_:1}),n(z,{modelValue:a.row.reason,"onUpdate:modelValue":[l=>a.row.reason=l,l=>b(a.row,l)],buttons:"","label-set":"Save","label-cancel":"Close"},{default:s(l=>[ke,r("div",Ie," Name: "+f(A(a.row.employee)),1),n(_,{modelValue:l.value,"onUpdate:modelValue":m=>l.value=m,type:"text",autofocus:"",counter:"",onKeyup:R(l.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),loading:s(()=>[n(ue,{showing:""},{default:s(()=>[n(ie,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","pagination","loading","filter"])]),_:1}))}};var sa=W(qe,[["__scopeId","data-v-9d976a60"]]);export{sa as default};
