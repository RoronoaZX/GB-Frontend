import{b as H,Q as O,a as G}from"./QTable.729f39d9.js";import{Q as W}from"./QTr.a06007d5.js";import{Q as X}from"./QTooltip.b8a12064.js";import{d as Y,r as _,N as $,c as K,t as Z,o as v,a3 as C,f as l,M as V,w as s,Q as ee,I,ae,J as i,e as A,a0 as S,bc as L,a4 as z,a5 as B,$ as Q,K as P,aJ as te,a2 as oe,O as D,R,L as le,bo as ne,z as se,u as re,bb as ie}from"./index.b39596b9.js";import{Q as ce}from"./QPopupEdit.d8d4206c.js";import{Q as de}from"./QSpinnerIos.33f05051.js";import{Q as ue}from"./QInnerLoading.9ebb1be0.js";import{Q as me}from"./QPage.53632818.js";import{api as k}from"./axios.0bf0fc4c.js";import{Q as pe}from"./QSpace.9ac2135a.js";import{a as T,b as F}from"./QMenu.e2333d24.js";import{Q as fe}from"./QList.d462a758.js";import{C as ye}from"./ClosePopup.5eef47a5.js";import{u as ge}from"./employee.9cdeba8f.js";import{_ as _e}from"./SearchComponent.6bef954b.js";import{_ as M}from"./plugin-vue_export-helper.21dcd24c.js";import"./QVirtualScroll.ed0286c4.js";import"./use-virtual-scroll.bc228582.js";import"./rtl.276c3f1b.js";import"./QSelect.85b5ca2b.js";import"./QChip.9a85866b.js";import"./selection.4513372c.js";import"./position-engine.e8d3d59d.js";const j=Y("employee-allowance",()=>{const f=_(null),w=_({data:[],total:0,per_page:7,current_page:1,last_page:1});return{allowance:f,allowances:w,createEmployeeAllowance:async r=>{var n,g;try{const c=await k.post("/api/employee-allowance",r);return $.create({type:"positive",message:"Allowance successfully created",timeout:1e3}),c.data}catch(c){let h="An error occurred. Please try again.";throw((n=c.response)==null?void 0:n.status)===409?h="Allowance for this employee already exists.":((g=c.response)==null?void 0:g.status)===422&&(h="Invalid data. Please check the inputs."),$.create({type:"negative",message:h,timeout:1e3}),c}},fetchEmployeeAllowance:async(r,n,g)=>{try{const c=await k.get("/api/employee-allowance",{params:{page:r,per_page:n,search:g}});w.value=c.data}catch(c){console.error("Error fetching allowance",c)}},searchAllowance:async r=>{try{console.log("Searching for employee with keyword:",r);const n=await k.post(`/api/search-allowance?keyword=${r}`);console.log("Allowance response:",n),w.value=n.data}catch(n){console.error("Error searching employee:",n)}},updateAmount:async(r,n)=>{console.log("updateAmount store",r,n);try{return await k.put("/api/update-employee-allowance/"+r.id,{amount:n})}catch(g){console.log(g)}}}});const U=f=>(D("data-v-3a598213"),f=f(),R(),f),we=U(()=>i("div",{class:"text-h6 text-weight-bold"},"\u{1F4BC} Add Employee Allowance",-1)),ve={style:{position:"relative"}},he={key:0,class:"dropdown-list"},be={class:"row q-col-gutter-md q-mt-lg"},Ae={class:"col-12 col-sm-6"},xe=U(()=>i("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"}," Employee Name: ",-1)),Qe={class:"text-body1 text-weight-medium"},Ve={class:"col-12 col-sm-6"},Se=U(()=>i("div",{class:"text-subtitle2 text-grey-7 q-mb-xs"},"Position:",-1)),Ee={class:"text-body1 text-weight-medium"},ke={__name:"AddAllowance",emits:["created"],setup(f,{emit:w}){const b=w,u=ge(),m=K(()=>u.employees),y=j(),r=_(""),n=_(!1),g=_(!1),c=_(!1),h=()=>{n.value=!0},q=async()=>{r.value.trim()&&(c.value=!0,await u.searchEmployee(r.value),c.value=!1)},E=t=>{d.employee_id=t.id,d.employee_name=`${t.firstname} ${t.middlename?t.middlename.charAt(0)+".":""} ${t.lastname}`,d.employee_position=t.position,r.value=""},d=Z({employee_id:"",employee_name:"",employee_position:"",amount:""}),N=()=>{d.employee_id="",d.employee_name="",d.employee_position="",d.amount=""},e=async()=>{g.value=!0;try{await y.createEmployeeAllowance(d),b("created"),n.value=!1,N()}catch(t){console.error(t)}finally{g.value=!1}};return(t,o)=>(v(),C("div",null,[l(V,{padding:"sm md",label:"Add Allowance",icon:"add_circle",size:"md",class:"gradient-btn text-white",onClick:h}),l(oe,{modelValue:n.value,"onUpdate:modelValue":o[2]||(o[2]=a=>n.value=a),persistent:"",position:"right","backdrop-filter":"blur(4px) saturate(150%)"},{default:s(()=>[l(ee,{class:"compact-dialog-card"},{default:s(()=>[l(I,{class:"dialog-header row items-center no-wrap"},{default:s(()=>[we,l(pe),ae(l(V,{icon:"close",flat:"",dense:"",round:"",class:"text-white"},null,512),[[ye]])]),_:1}),l(I,{class:"q-px-lg q-pt-md"},{default:s(()=>[i("div",ve,[l(_e,{modelValue:r.value,"onUpdate:modelValue":[o[0]||(o[0]=a=>r.value=a),q],"search-loading":c.value},null,8,["modelValue","search-loading"]),r.value?(v(),C("div",he,[l(fe,{separator:""},{default:s(()=>{var a;return[(a=m.value)!=null&&a.length?L("",!0):(v(),A(T,{key:0},{default:s(()=>[l(F,{class:"text-grey-7"},{default:s(()=>[S("No employee found.")]),_:1})]),_:1})),(v(!0),C(z,null,B(m.value,p=>(v(),A(T,{key:p.id,clickable:"",onClick:x=>E(p)},{default:s(()=>[l(F,null,{default:s(()=>[S(Q(`${p.firstname} ${p.middlename?p.middlename.charAt(0)+".":""} ${p.lastname}`),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]}),_:1})])):L("",!0)]),i("div",be,[i("div",Ae,[xe,i("div",Qe,Q(d.employee_name||"----------"),1)]),i("div",Ve,[Se,i("div",Ee,Q(d.employee_position||"----------"),1)])])]),_:1}),l(I,{class:"q-px-lg q-pt-md"},{default:s(()=>[l(P,{modelValue:d.amount,"onUpdate:modelValue":o[1]||(o[1]=a=>d.amount=a),outlined:"",dense:"",label:"Allowance Amount",prefix:"\u20B1",type:"number",clearable:""},null,8,["modelValue"])]),_:1}),l(te,{align:"right",class:"q-px-lg q-pb-md"},{default:s(()=>[l(V,{size:"md",padding:"sm lg",label:"Save","icon-right":"send",class:"gradient-btn text-white",onClick:e,loading:g.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};var Ce=M(ke,[["__scopeId","data-v-3a598213"]]);const $e={__name:"SearchAllowance",props:{modelValue:{type:String,default:""},searchLoading:{type:Boolean,default:!1}},emits:["update:model-value","clear"],setup(f,{emit:w}){const b=w;return(u,m)=>(v(),A(P,{modelValue:u.searchKeyword,"onUpdate:modelValue":[m[0]||(m[0]=y=>u.searchKeyword=y),m[1]||(m[1]=y=>b("update:model-value",y))],onClear:m[2]||(m[2]=y=>b("clear")),label:"Search Employeess",outlined:"",dense:"",flat:"",debounce:"500",style:{width:"300px"}},{append:s(()=>[f.searchLoading?(v(),A(ne,{key:1,color:"primary",size:"sm"})):(v(),A(le,{key:0,name:"search"}))]),_:1},8,["modelValue"]))}};const qe=f=>(D("data-v-f5679fea"),f=f(),R(),f),Ne={class:"row justify-between q-mb-md",align:"right"},Ie={class:"q-pa-md",style:{"min-width":"300px","max-width":"400px"}},Pe=qe(()=>i("div",{class:"text-h6 text-primary text-center q-mb-sm"}," Edit Amount ",-1)),Ue={class:"text-subtitle2 q-mb-md"},Le={class:"row justify-end q-mt-md"},Te={__name:"AllowanceTable",setup(f){const w=j(),b=K(()=>w.allowances),u=_({page:1,rowsPerPage:0,rowsNumber:0}),m=_([]),y=_(!1),r=_(!1),n=_("");_(!1);function g(e){if(e==null||e==="")return"";const t=parseFloat(e);return isNaN(t)?"":Number.isInteger(t)?String(parseInt(t)):String(t)}async function c(e,t){console.log("updateteAmount",e,t),y.value=!0;try{await w.updateAmount(e,t),$.create({message:"Amount updated successfully",color:"positive",position:"top",timeout:2e3})}catch(o){console.error("Error updating amount:",o),$.create({message:"Failed to update amount",color:"negative",position:"top",timeout:2e3})}finally{y.value=!1}}se(async()=>{await h()});const h=async(e=1,t=7,o="")=>{try{y.value=!0,await w.fetchEmployeeAllowance(e,t,o),console.log("allowance",b.value);const{data:a,current_page:p,per_page:x,total:J}=b.value;m.value=a,console.log("employeeAllowance",m.value),u.value.page=p,u.value.rowsPerPage=x,u.value.rowsNumber=J}catch(a){console.log("Error fetching allowance",a)}finally{y.value=!1}},q=e=>{console.log("handle request",e),h(e.pagination.page,e.pagination.rowsPerPage,e.filter)};re(n,async e=>{r.value=!0,await h(u.value.page,u.value.rowsPerPage,e),r.value=!1});const E=e=>{const t=x=>x?x.charAt(0).toUpperCase()+x.slice(1).toLowerCase():"",o=e.firstname?t(e.firstname):"No Firstname",a=e.middlename?t(e.middlename).charAt(0)+".":"",p=e.lastname?t(e.lastname):"No Lastname";return`${o} ${a} ${p}`.trim()},d=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format(e),N=[{name:"name",required:!0,label:"Name",align:"center",field:e=>E(e.employee)},{name:"amount",required:!0,label:"Amount",align:"center",field:e=>d(e.amount)}];return(e,t)=>(v(),A(me,{class:"q-my-md"},{default:s(()=>[i("div",Ne,[i("div",null,[l(Ce,{onCreated:h})]),l($e,{modelValue:n.value,"onUpdate:modelValue":[t[0]||(t[0]=o=>n.value=o),n.value]},null,8,["modelValue","onUpdate:modelValue"])]),l(G,{flat:"",bordered:"",rows:m.value,columns:N,"row-key":"name",pagination:u.value,"onUpdate:pagination":t[1]||(t[1]=o=>u.value=o),"rows-per-page-options":[5,7,10,0],onRequest:q,loading:y.value},{header:s(o=>[l(W,{props:o,class:"gradient-header text-white text-weight-bold"},{default:s(()=>[(v(!0),C(z,null,B(o.cols,a=>(v(),A(H,{key:a.name,props:o,class:"text-center text-subtitle2"},{default:s(()=>[S(Q(a.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-amount":s(o=>[l(O,{props:o,class:"cursor-pointer"},{default:s(()=>[i("span",null,[S(Q(o.row.amount?d(o.row.amount):" - - ")+" ",1),l(X,{class:"bg-blue-grey-8"},{default:s(()=>[S("Edit Amount")]),_:1})]),l(ce,{modelValue:o.row.amount,"onUpdate:modelValue":[a=>o.row.amount=a,a=>c(o.row,a)]},{default:s(a=>[i("div",Ie,[Pe,i("div",Ue," Name: "+Q(E(o.row.employee)),1),l(P,{modelValue:a.value,"onUpdate:modelValue":[p=>a.value=p,p=>a.value=p],type:"text",outlined:"",dense:"",autofocus:"",counter:"","model-value":g(a.value),onKeyup:ie(a.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","model-value","onKeyup"]),i("div",Le,[l(V,{flat:"",label:"Close",color:"primary",onClick:a.cancel},null,8,["onClick"]),l(V,{flat:"",label:"Save",color:"primary",onClick:a.set},null,8,["onClick"])])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"])]),loading:s(()=>[l(ue,{showing:""},{default:s(()=>[l(de,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","pagination","loading"])]),_:1}))}};var ra=M(Te,[["__scopeId","data-v-f5679fea"]]);export{ra as default};
