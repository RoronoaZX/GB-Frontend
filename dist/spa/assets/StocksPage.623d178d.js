import{r as k,t as fe,c as Y,u as le,z as te,o as _,a3 as D,f as e,w as l,L as X,Q as ee,J as t,I as R,ae,M as H,a0 as o,e as M,K as re,bc as E,a1 as ye,a4 as A,a5 as J,$ as g,bd as qe,aJ as Ce,a2 as ge,O as ue,R as de,be as Ge,N as ve,aK as _e,d as Be}from"./index.7a29e9bf.js";import{Q as ke}from"./QTab.a4b1cfae.js";import{Q as Te}from"./QTabs.26d33d35.js";import{Q as Pe}from"./QTabPanel.683e002e.js";import{Q as Ie}from"./QTabPanels.e99ce667.js";import{Q as Me}from"./QPage.e3b72f32.js";import{Q as Se}from"./QSkeleton.6df9e389.js";import{a as K,b as d}from"./QMenu.fe638539.js";import{Q as O,a as c}from"./QSelect.22f1c7ed.js";import{Q as ne}from"./QList.3da0d50e.js";import{Q as Re}from"./QPagination.3149fc83.js";import{Q as He}from"./QTooltip.3a55fbff.js";import{u as be}from"./stock-delivery.b2d893e9.js";import{C as oe}from"./ClosePopup.88e1d2bd.js";import{u as Ue}from"./warehouse.73e2402b.js";import{u as Ae}from"./branch.58ac9eb3.js";import{u as Le}from"./raw-material.b43d7c7a.js";import{u as ce}from"./use-quasar.d82f5843.js";import{_ as se}from"./plugin-vue_export-helper.21dcd24c.js";import{u as Ne}from"./use-dialog-plugin-component.73b8488f.js";import{q as Qe}from"./date.49c97647.js";import{Q as Oe,a as Ke}from"./QTable.a4c37cd6.js";import{Q as We}from"./QSpinnerIos.37567f8e.js";import{Q as je}from"./QInnerLoading.7f447b94.js";import{api as Ee}from"./axios.a37aa032.js";import{Q as ze}from"./QSpace.a7dd123e.js";import"./QResizeObserver.ae81e3bd.js";import"./rtl.276c3f1b.js";import"./use-panel.16321dd2.js";import"./touch.9135741d.js";import"./selection.34495968.js";import"./use-render-cache.3aae9b27.js";import"./position-engine.d0144731.js";import"./QChip.6f8e5828.js";import"./use-virtual-scroll.1d61b81c.js";import"./employee.c112e418.js";import"./QVirtualScroll.c6926a1f.js";const he=v=>(ue("data-v-56c8d2da"),v=v(),de(),v),Ye=he(()=>t("div",{class:"text-h6 text-weight-bold text-white"}," Create Stocks Delivery ",-1)),Je={class:"row justify-between text-h6 text-white"},Ze=he(()=>t("div",null,"\u{1F69A} Deliver Stocks",-1)),Xe={class:"row justify-between"},el={class:"q-mt-md"},ll={class:"q-mt-md"},tl={class:"q-my-md"},al=he(()=>t("div",{class:"q-ma-sm"},"Raw Materials Name",-1)),rl={key:0,class:"row q-mt-md q-gutter-md"},ol={class:"q-mt-sm",align:"right"},sl={__name:"StocksDeliveryButton",emits:["reFetchDelivery"],setup(v,{emit:S}){const V=be(),P=Ae(),Q=k([]),w=k(Q.value),i=Ue(),f=k([]),b=k(f.value),N=Le(),x=k([]),F=k([]),B=S,p=ce(),C=fe({name:"",quantity:"",unit:""}),h=[{label:"Supplier",value:"Supplier"},{label:"Warehouse",value:"Warehouse"},{label:"Branch",value:"Branch"}],U=[{label:"Warehouse",value:"Warehouse"},{label:"Branch",value:"Branch"}];Y(()=>x.value.length>0);const n=k(""),G=[{label:"Sack",value:"sack"},{label:"Can",value:"can"},{label:"Bottle",value:"bottle"},{label:"Box",value:"box"},{label:"Margarine Tub",value:"baro"},{label:"Gallon",value:"gallon"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],y=k({quantity:0,kilo:0,gram:0,price:0,pricePerGram:0,pcs:0}),W={sack:{fields:[{model:"quantity",label:"Sack Quantity",type:"number"},{model:"kilo",label:"Kilo per Sack",type:"number"},{model:"gram",label:"Grams",type:"number",readonly:!0},{model:"price",label:"Price per Sack",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},can:{fields:[{model:"quantity",label:"Can Quantity",type:"number"},{model:"kilo",label:"Kilo per Can",type:"number"},{model:"gram",label:"Grams",type:"number"},{model:"price",label:"Price per Can",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},bottle:{fields:[{model:"quantity",label:"Bottle Quantity",type:"number"},{model:"kilo",label:"Kilo per Bottle",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Bottle",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},box:{fields:[{model:"quantity",label:"Box Quantity",type:"number"},{model:"pcs",label:"Pieces per Box",type:"number"},{model:"kilo",label:"Kilo per Piece",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Pcs",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},gallon:{fields:[{model:"quantity",label:"Gallon Quantity",type:"number"},{model:"kilo",label:"Kilo per Gallon",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Gallon",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]},baro:{fields:[{model:"quantity",label:"Tub Quantity",type:"number"},{model:"kilo",label:"Kilo per Tub",type:"number"},{model:"gram",label:"Grams",readonly:!0},{model:"price",label:"Price per Tub",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]}},a=Y(()=>W[n.value]||null);le(y,s=>{s.kilo&&!isNaN(s.kilo)&&(s.gram=s.kilo*1e3),s.price>0&&s.gram>0?s.pricePerGram=s.price/s.gram:s.pricePerGram=0},{deep:!0});const $=k(!1);k(!1);const q=()=>{!C.name||!n.value||(x.value.push({raw_materials_id:C.name.value,raw_materials_name:C.name.label,unit_type:C.name.suffix,category:n.value,quantity:y.value.quantity,kilo:y.value.kilo,gram:y.value.gram,pcs:y.value.pcs,price_per_unit:y.value.price,price_per_gram:y.value.pricePerGram}),console.log("\u{1F4E6} rawMaterialsGroups:",x.value),C.name="",n.value="",y.value={quantity:0,kilo:0,gram:0,price:0,pricePerGram:0,pcs:0})},T=k(!1),me=()=>{T.value=!0},j=()=>{T.value=!1,Ve()},L=k(""),z=k("");te(async()=>{await P.fetchBranches(),Q.value=P.branches.map(s=>({label:s.name,value:s.id})),w.value=Q.value});const xe=(s,m)=>{m(()=>{const r=s.toLowerCase();w.value=s===""?Q.value:Q.value.filter(I=>I.label.toLowerCase().includes(r))})};te(async()=>{await i.fetchWarehouses(),f.value=i.warehouses.map(s=>({label:s.name,value:s.id})),b.value=f.value});const we=(s,m)=>{m(()=>{const r=s.toLowerCase();b.value=s===""?f.value:f.value.filter(I=>I.label.toLowerCase().includes(r))})},ie=k(F.value);te(async()=>{try{$.value=!0,await N.fetchRawMaterials(),F.value=N.rawMaterials.map(s=>({label:s.name,value:s.id,suffix:s.unit})),ie.value=F.value}catch(s){console.error("Error fetching raw materials: ",s)}finally{$.value=!1}});const Ve=()=>{C.name="",C.quantity="",C.unit="",n.value="",y.value={quantity:0,kilo:0,gram:0,price:0,pricePerGram:0,pcs:0},x.value=[],u.raw_material_id=0,u.from="",u.from_name="",u.from_designation="",u.to="",u.to_name="",u.to_designation="",u.supplier_name="",u.quantity=0,u.price_per_unit=0,u.remarks="",u.status="pending",L.value="",z.value=""},$e=(s,m)=>{m(()=>{if(s==="")ie.value=F.value;else{const r=s.toLowerCase();ie.value=F.value.filter(I=>I.label.toLowerCase().includes(r))}})},u=fe({raw_material_id:0,from:"",from_name:"",from_designation:"",to:"",to_name:"",to_designation:"",supplier_name:"",quantity:0,price_per_unit:0,remarks:"",status:"Pending"});le(L,s=>{u.from_designation=s,s==="Supplier"?(u.from="",u.from_name="",u.supplier_name=""):(s==="Warehouse"||s==="Branch")&&(u.from="",u.from_name="")}),le(z,s=>{u.to_designation=s,(s==="Warehouse"||s==="Branch")&&(u.to="")});const Fe=async()=>{const s={from_designation:L.value,from_id:u.from||null,from_name:L.value==="Supplier"?u.supplier_name:u.from_name,to_designation:z.value,to_id:u.to.value||null,remarks:u.remarks,status:"pending",raw_materials_groups:x.value||[]};p.loading.show();try{console.log("Payload : ",s);const m=await V.createDeliveryStock(s);if(console.log("Response : ",m),m&&m.message==="Raw materials delivery created successfully")B("reFetchDelivery"),j();else{console.error("\u274C Failed to save delivery: ",m.message);return}}catch(m){console.error("\u274C Failed to save delivery:",m)}finally{p.loading.hide()}};return(s,m)=>(_(),D(A,null,[e(ee,{flat:"",class:"bg-amber-4 q-pa-md rounded-borders-lg row items-center justify-center cursor-pointer custom-shadow-light",onClick:me,style:{width:"300px"}},{default:l(()=>[e(X,{name:"add_circle",size:"md",color:"white",class:"q-mr-sm"}),Ye]),_:1}),t("div",null,[e(ge,{modelValue:T.value,"onUpdate:modelValue":m[11]||(m[11]=r=>T.value=r)},{default:l(()=>[e(ee,{style:{width:"820px","max-width":"80vw"}},{default:l(()=>[e(R,{class:"gradient-btn"},{default:l(()=>[t("div",Je,[Ze,t("div",null,[ae(e(H,{icon:"close",flat:"",dense:"",round:""},null,512),[[oe]])])])]),_:1}),e(R,null,{default:l(()=>[t("div",Xe,[t("div",null,[t("div",null,[o(" From: "),e(O,{modelValue:L.value,"onUpdate:modelValue":m[0]||(m[0]=r=>L.value=r),options:h,"emit-value":"","map-options":"",label:"Select Source",outlined:"",dense:"",style:{width:"200px"}},null,8,["modelValue"])]),t("div",el,[L.value==="Supplier"?(_(),M(re,{key:0,modelValue:u.supplier_name,"onUpdate:modelValue":m[1]||(m[1]=r=>u.supplier_name=r),outlined:"",dense:"",label:"Enter Supplier Company Name",style:{width:"350px"}},null,8,["modelValue"])):E("",!0),L.value==="Warehouse"?(_(),M(O,{key:1,modelValue:u.from,"onUpdate:modelValue":[m[2]||(m[2]=r=>u.from=r),m[3]||(m[3]=r=>{const I=b.value.find(pe=>pe.value===r);u.from_name=(I==null?void 0:I.label)||""})],outlined:"",dense:"",flat:"","use-input":"",clearable:"","input-debounce":"0",options:b.value,"emit-value":"","map-options":"",label:"Search Warehouse",onFilter:we,behavior:"menu","hide-dropdown-icon":"",style:{width:"350px"}},null,8,["modelValue","options"])):E("",!0),L.value==="Branch"?(_(),M(O,{key:2,modelValue:u.from,"onUpdate:modelValue":[m[4]||(m[4]=r=>u.from=r),m[5]||(m[5]=r=>{const I=w.value.find(pe=>pe.value===r);u.from_name=(I==null?void 0:I.label)||""})],outlined:"",dense:"",flat:"","use-input":"",clearable:"","input-debounce":"0",options:w.value,"emit-value":"","map-options":"",label:"Search Branch",onFilter:xe,behavior:"menu","hide-dropdown-icon":"",style:{width:"350px"}},null,8,["modelValue","options"])):E("",!0)])]),t("div",null,[t("div",null,[o(" To: "),e(O,{modelValue:z.value,"onUpdate:modelValue":m[6]||(m[6]=r=>z.value=r),options:U,"emit-value":"","map-options":"",label:"Select Destination",outlined:"",dense:"",style:{width:"200px"}},null,8,["modelValue"]),t("div",ll,[z.value==="Warehouse"?(_(),M(O,{key:0,modelValue:u.to,"onUpdate:modelValue":m[7]||(m[7]=r=>u.to=r),outlined:"",flat:"",dense:"","use-input":"",clearable:"","input-debounce":"0",options:b.value,label:"Search Warehouse",onFilter:we,"hide-dropdown-icon":"",behavior:"menu",style:{width:"350px"}},null,8,["modelValue","options"])):E("",!0),z.value==="Branch"?(_(),M(O,{key:1,modelValue:u.to,"onUpdate:modelValue":m[8]||(m[8]=r=>u.to=r),outlined:"",dense:"",flat:"","use-input":"",clearable:"","input-debounce":"0",options:w.value,label:"Search Branch",onFilter:xe,behavior:"menu","hide-dropdown-icon":"",style:{width:"350px"}},null,8,["modelValue","options"])):E("",!0)])])])])]),_:1}),e(ye,{class:"q-my-md"}),e(R,null,{default:l(()=>[t("div",null,[t("div",null,[e(ne,{dense:"",separator:"",class:"box"},{default:l(()=>[e(K,null,{default:l(()=>[e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Raw Materials Name ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Stocks Category ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Quantity ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Price per Unit ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Price per Gram ")]),_:1})]),_:1}),e(d,{side:""},{default:l(()=>[e(c,null,{default:l(()=>[o("Action")]),_:1})]),_:1})]),_:1}),(_(!0),D(A,null,J(x.value,r=>(_(),M(K,{key:r.id},{default:l(()=>[e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(g(r.raw_materials_name),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(g(r.category),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(g(r.quantity),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" \u20B1 "+g(r.price_per_unit),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" \u20B1 "+g(r.price_per_gram),1)]),_:2},1024)]),_:2},1024),e(d,{side:""},{default:l(()=>[e(H,{dense:"",flat:"",round:"",icon:"delete",color:"red",onClick:I=>x.value.splice(x.value.indexOf(r),1)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})])])]),_:1}),e(R,null,{default:l(()=>[t("div",tl,[al,e(O,{modelValue:C.name,"onUpdate:modelValue":m[9]||(m[9]=r=>C.name=r),debounce:"100",outlined:"",clearable:"","chips-color":"primary",options:ie.value,dense:"",label:"Raw Materials",behavior:"menu","use-input":"","hide-dropdown-icon":"",onFilter:$e},{"no-option":l(()=>[e(K,null,{default:l(()=>[e(d,{class:"text-grey"},{default:l(()=>[o(" No results ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),t("div",null,[t("div",null,[e(O,{modelValue:n.value,"onUpdate:modelValue":m[10]||(m[10]=r=>n.value=r),options:G,"emit-value":"","map-options":"",outlined:"",behavior:"menu",dense:"",label:"Select Category"},null,8,["modelValue"])]),a.value?(_(),D("div",rl,[(_(!0),D(A,null,J(a.value.fields,r=>(_(),D("div",{key:r.model},[e(re,{modelValue:y.value[r.model],"onUpdate:modelValue":I=>y.value[r.model]=I,modelModifiers:{number:!0},label:r.label,type:r.type||"text",readonly:r.readonly||!1,prefix:r.prefix||"",outlined:"",flat:"",dense:"",style:qe({width:r.width||"150px"})},null,8,["modelValue","onUpdate:modelValue","label","type","readonly","prefix","style"])]))),128))])):E("",!0)]),t("div",ol,[e(H,{padding:"sm lg",outline:"",dense:"",icon:"add",color:"purple",onClick:q})])]),_:1}),e(ye,{class:"q-my-md"}),e(Ce,{align:"right"},{default:l(()=>[ae((_(),M(H,{outline:""},{default:l(()=>[o("Cancel")]),_:1})),[[oe]]),e(H,{onClick:Fe},{default:l(()=>[o("Proceed")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64))}};var il=se(sl,[["__scopeId","data-v-56c8d2da"]]);const nl={class:"row justify-between text-h6 text-dark"},ul=t("div",null,"\u270F\uFE0F Edit Delivery",-1),dl={class:"q-mb-md"},cl={key:0,class:"row q-mt-md q-gutter-md"},ml={__name:"EditDialog",props:{item:{type:Object,required:!0},delivery:{type:Object,required:!0}},setup(v){const{dialogRef:S,onDialogHide:V,onDialogOK:P,onDialogCancel:Q}=Ne(),w=ce(),i=be();k(!1);const f=v,b=k(f.item.category||""),N=k({...f.item});le(N,n=>{Object.keys(n).forEach(G=>{["gram","kilo","pcs","price_per_gram","price_per_unit"].includes(G)&&(N.value[G]=n[G])})});const x=[{label:"Sack",value:"sack"},{label:"Can",value:"can"},{label:"Bottle",value:"bottle"},{label:"Box",value:"box"},{label:"Margarine Tub",value:"baro"},{label:"Gallon",value:"gallon"},{label:"Kilo",value:"kilo"},{label:"Gram",value:"gram"},{label:"Pieces",value:"pcs"}],F={sack:{fields:[{model:"quantity",label:"Sack Quantity",type:"number"},{model:"kilo",label:"Kilo per Sack",type:"number"},{model:"gram",label:"Grams",type:"number",readonly:!0},{model:"price",label:"Price per Sack",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",type:"number",readonly:!0,prefix:"\u20B1"}]},can:{fields:[{model:"quantity",label:"Can Quantity",type:"number"},{model:"kilo",label:"Kilo per Can",type:"number"},{model:"gram",label:"Grams",type:"number"},{model:"price",label:"Price per Can",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",type:"number",readonly:!0,prefix:"\u20B1"}]},bottle:{fields:[{model:"quantity",label:"Bottle Quantity",type:"number"},{model:"kilo",label:"Kilo per Bottle",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Bottle",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},box:{fields:[{model:"quantity",label:"Box Quantity",type:"number"},{model:"pcs",label:"Pieces per Box",type:"number"},{model:"kilo",label:"Kilo per Piece",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Box",type:"number",prefix:"\u20B1"},{model:"pricePerGram",label:"Price per Gram",readonly:!0,prefix:"\u20B1"}]},gallon:{fields:[{model:"quantity",label:"Gallon Quantity",type:"number"},{model:"kilo",label:"Kilo per Gallon",type:"number"},{model:"gram",label:"Grams"},{model:"price",label:"Price per Gallon",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]},baro:{fields:[{model:"quantity",label:"Tub Quantity",type:"number"},{model:"kilo",label:"Kilo per Tub",type:"number"},{model:"gram",label:"Grams",readonly:!0},{model:"price",label:"Price per Tub",type:"number"},{model:"pricePerGram",label:"Price per Gram",readonly:!0}]}};console.log("props item",f.item),console.log("props delivery",f.delivery);const B=Y(()=>F[b.value]||null),p=n=>{if(n==null||n==="")return"";const G=parseFloat(n);return G===0?"0":G%1===0?G.toFixed(0):G.toFixed(3).replace(/\.?0+$/,"")},C=n=>n==null||isNaN(n)?0:parseFloat(parseFloat(n).toString()),h=fe({quantity:p(f.item.quantity||0),kilo:p(f.item.kilo||0),gram:p(f.item.gram||0),pcs:p(f.item.pcs||0),price:C(f.item.price_per_unit||0),pricePerGram:C(f.item.price_per_gram||0)});le(h,n=>{(n.kilo&&n.quantity&&!isNaN(n.kilo)&&!isNaN(n.quantity)||n.kilo&&!isNaN(n.kilo))&&(n.gram=n.kilo*1e3),n.price>0&&n.gram>0?n.pricePerGram=n.price/n.gram:n.pricePerGram=0},{deep:!0});const U=async()=>{var y,W;const n={quantity:h.quantity,kilo:h.kilo,gram:h.gram,pcs:h.pcs,price:h.price,price_per_gram:h.pricePerGram,category:b.value,raw_material_id:f.item.raw_material.id,delivery_id:f.delivery.id};console.log("\u{1F7E1} Raw edited data (before cleanup):",n);const G={to_designation:f.delivery.to_designation,quantity:parseFloat(h.quantity||0),kilo:parseFloat(h.kilo||0),gram:parseFloat(h.gram||0),total_grams:parseFloat(h.gram||0),pcs:parseFloat(h.pcs||0),price_per_unit:parseFloat(h.price||0),price_per_gram:parseFloat(h.pricePerGram||0),category:b.value,raw_material_id:f.item.raw_material.id,delivery_su_id:f.item.id,rm_delivery_id:f.delivery.id,item_id:f.item.id,unit_type:f.item.unit_type};w.loading.show();try{console.log("\u{1F7E2} Cleaned data (ready to save):",G);const a=await i.updateDeliveryStocks(G);console.log("Resonse data in componnet:",a),a.data&&a.data.message==="Delivery stock item updated successfully."?(V(),ve.create({type:"positive",message:((y=a==null?void 0:a.data)==null?void 0:y.message)||"Delivery stock item updated successfully.",timeout:3e3})):ve.create({type:"negative",message:((W=a==null?void 0:a.data)==null?void 0:W.message)||"Failed to update delivery stock item.",timeout:3e3})}catch(a){console.log("error",a)}finally{w.loading.hide()}};return(n,G)=>(_(),M(ge,{ref_key:"dialogRef",ref:S,onHide:Ge(V),persistent:""},{default:l(()=>[e(ee,{style:{width:"820px","max-width":"80vw"}},{default:l(()=>[e(R,{class:"gradient-btn"},{default:l(()=>[t("div",nl,[ul,t("div",null,[ae(e(H,{icon:"close",flat:"",dense:"",round:""},null,512),[[oe]])])])]),_:1}),e(R,null,{default:l(()=>[t("div",null,"From: "+g(v.delivery.from_name||"N/A"),1),t("div",null,"To: "+g(v.delivery.to_data.name||"N/A"),1)]),_:1}),e(R,null,{default:l(()=>[t("div",dl," Raw Materials Name: "+g(v.item.raw_material.name||"N/A"),1),t("div",null,[e(O,{modelValue:b.value,"onUpdate:modelValue":G[0]||(G[0]=y=>b.value=y),options:x,"emit-value":"","map-options":"",outlined:"",behavior:"menu",dense:"",label:"Select Category"},null,8,["modelValue"])]),B.value?(_(),D("div",cl,[(_(!0),D(A,null,J(B.value.fields,y=>(_(),D("div",{key:y.model},[e(re,{modelValue:h[y.model],"onUpdate:modelValue":W=>h[y.model]=W,modelModifiers:{number:!0},label:y.label,type:y.type||"text",readonly:y.readonly||!1,prefix:y.prefix||"",outlined:"",flat:"",dense:"",style:qe({width:y.width||"150px"})},null,8,["modelValue","onUpdate:modelValue","label","type","readonly","prefix","style"])]))),128))])):E("",!0)]),_:1}),e(ye,{class:"q-my-md"}),e(Ce,{align:"right"},{default:l(()=>[ae((_(),M(H,{outline:""},{default:l(()=>[o("Cancel")]),_:1})),[[oe]]),e(H,{onClick:U},{default:l(()=>[o("Save")]),_:1})]),_:1})]),_:1})]),_:1},8,["onHide"]))}};const Z=v=>(ue("data-v-f3001bb0"),v=v(),de(),v),pl={class:"q-mb-sm",align:"right"},_l={class:"row q-col-gutter-md"},fl={class:"col-xs-12 col-md-4"},yl=Z(()=>t("div",{class:"text-h6 text-weight-bold q-mb-sm text-grey-8"}," Delivery Transaction List ",-1)),vl={class:"row items-center text-caption"},gl={key:0,class:"q-pt-md flex flex-center"},bl={class:"col-xs-12 col-md-8"},hl=Z(()=>t("div",{class:"row justify-between"},[t("div",{class:"text-h6 text-weight-bold q-mb-sm text-grey-8"}," Items / Raw materials Delivery Details ")],-1)),xl={key:0},wl={class:"row q-col-gutter-md q-mb-md"},kl={class:"col-xs-12 col-sm-4"},Pl=Z(()=>t("span",{class:"text-grey-7 text-caption"},"From:",-1)),Sl={class:"text-subtitle1 text-weight-bold"},ql={class:"col-xs-12 col-sm-4"},Cl=Z(()=>t("span",{class:"text-grey-7 text-caption"},"To:",-1)),Gl={class:"text-subtitle1 text-weight-bold"},Nl={class:"col-xs-12 col-sm-4 q-mb-md"},Ql=Z(()=>t("span",{class:"text-grey-7 text-caption"},"Status:",-1)),Dl={class:"row items-center"},Vl=Z(()=>t("span",{class:"text-grey-7 text-caption"},"Items:",-1)),$l=Z(()=>t("span",null,"Edit",-1)),Fl={key:1,class:"text-caption text-grey-6 q-mt-md"},Bl={key:1,class:"text-h6 text-grey-6 q-my-xl text-center"},Tl={__name:"CreateDeliveryTab",setup(v){const S=be(),V=ce();k(!1);const P=Y(()=>S.deliveryStocks.data),Q=Y(()=>S.loading),w=Y(()=>{var a;return((a=S.deliveryStocks)==null?void 0:a.pagination)||{current_page:1,last_page:1,per_page:5}}),i=k(null),f=k("");let b=null;const N=()=>{b&&clearTimeout(b),b=setTimeout(()=>{x(1)},500)},x=async(a=1)=>{V.loading.show();try{await S.fetchDeliveryStocks(a,w.value.per_page,f.value),!P.value.length&&i.value&&(i.value=null),i.value&&!P.value.some($=>$.id===i.value.id)&&(i.value=null),!i.value&&P.value.length>0&&(i.value=P.value[0]),console.log("deliveryList",P.value),console.log("pagination",w.value)}catch($){console.error("Error fetching delivery stocks in component:",$),V.notify({type:"negative",message:"Failed to load deliveries. Please try again."})}finally{V.loading.hide()}};te(()=>{x(w.value.current_page)});const F=(a,$)=>{console.log("Editing item:",a),console.log("Parent delivery:",$),V.dialog({component:ml,componentProps:{item:a,delivery:$}})},B=a=>Qe.formatDate(a,"MMM DD, YYYY || hh:mm A"),p=a=>a?a.toLowerCase().split(" ").map($=>$.charAt(0).toUpperCase()+$.slice(1)).join(" "):"",C=a=>{i.value=a},h=a=>{x(a)},U=a=>a==null?"No Quantity":parseFloat(a),n=a=>a==null?"No Price":`\u20B1${Number(a).toFixed(2)}`,G=a=>a==null?"No Price":`\u20B1${Number(a).toFixed(4)}`,y=a=>{switch((a||"").toLowerCase()){case"pending":return"warning";case"in progress":return"blue-7";case"confirmed":return"positive";case"declined":return"negative";default:return"grery-6"}},W=a=>{if(!i.value||a.id!==i.value.id)return"";switch(a.to_designation){case"Warehouse":return"selected-delivery-item";case"Branch":return"branch-selected-item";case"Supplier":return"default-selected-item";default:return""}};return(a,$)=>(_(),D(A,null,[t("div",pl,[e(il,{onReFetchDelivery:x})]),t("div",_l,[t("div",fl,[e(ee,{flat:"",class:"bg-white q-pa-md rounded- borders-lg custom-shadow-light"},{default:l(()=>[yl,e(re,{outlined:"",dense:"",placeholder:"Search delivery",class:"q-mb-sm","bg-color":"grey-1","input-class":"text-grey-8","label-color":"grey-6",modelValue:f.value,"onUpdate:modelValue":[$[0]||($[0]=q=>f.value=q),N]},{append:l(()=>[e(X,{name:"search",color:"grey-6"})]),_:1},8,["modelValue"]),e(ne,{separator:""},{default:l(()=>[Q.value?(_(!0),D(A,{key:0},J(w.value.per_page,q=>(_(),M(K,{key:q},{default:l(()=>[e(d,null,{default:l(()=>[e(Se,{type:"text",width:"80%"}),e(Se,{type:"text",width:"40%"})]),_:1})]),_:2},1024))),128)):(_(!0),D(A,{key:1},J(P.value.data,q=>(_(),M(K,{key:q.id,class:_e(["q-py-md",W(q)]),clickable:"",onClick:T=>C(q)},{default:l(()=>[e(d,null,{default:l(()=>[e(c,{class:"text-subtitle1 text-weight-bold text-grey-8"},{default:l(()=>{var T;return[o(g(p(((T=q.to_data)==null?void 0:T.name)||"N/A")),1)]}),_:2},1024),e(c,{caption:"",class:"text-grey-6"},{default:l(()=>[o(g(q.items.length||"N/A")+" items ",1)]),_:2},1024)]),_:2},1024),e(d,{side:""},{default:l(()=>[e(c,null,{default:l(()=>[o(g(B(q.created_at)||"N/A"),1)]),_:2},1024),t("div",vl,[e(X,{name:"fiber_manual_record",color:q.status?y(q.status):"grey-6",size:"8px",class:"q-mr-xs"},null,8,["color"]),t("span",{class:_e(q.status?`text-${y(q.status)}`:"text-grey-6")},g(p(q.status||"No Status")),3)])]),_:2},1024)]),_:2},1032,["onClick","class"]))),128))]),_:1}),w.value.last_page>1?(_(),D("div",gl,[e(Re,{modelValue:w.value.current_page,"onUpdate:modelValue":[$[1]||($[1]=q=>w.value.current_page=q),h],max:w.value.last_page,"max-pages":5,"boundary-links":"","direction-links":"","icon-first":"skip_previous","icon-last":"skip_next","icon-prev":"fast_rewind","icon-next":"fast_forward"},null,8,["modelValue","max"])])):E("",!0)]),_:1})]),t("div",bl,[e(ee,{flat:"",class:"bg-white q-pa-md rounded-borders-lg custom-shadow-light"},{default:l(()=>[e(R,null,{default:l(()=>[hl]),_:1}),e(R,null,{default:l(()=>{var q;return[i.value?(_(),D("div",xl,[t("div",wl,[t("div",kl,[Pl,t("div",Sl,g(p(i.value.from_name||"No Name")),1)]),t("div",ql,[Cl,t("div",Gl,g(p(((q=i.value.to_data)==null?void 0:q.name)||"No Name")),1)])]),t("div",Nl,[Ql,t("div",Dl,[e(X,{name:"fiber_manual_record",color:y(i.value.status),size:"10px",class:"q-mr-xs"},null,8,["color"]),t("span",{class:_e(i.value.status?`text-${y(i.value.status)}`:"text-grey-6")},g(p(i.value.status||"No Status")),3)])]),t("div",null,[Vl,i.value.items&&i.value.items.length?(_(),M(ne,{key:0,dense:"",separator:"",class:"box"},{default:l(()=>[e(K,{class:"bg-grey-1 text-weight-bold"},{default:l(()=>[e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" Raw Materials Name ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" Raw Materials Code ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" Stocks Category ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" Quantity ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" Price per Unit ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(" Price per Gram ")]),_:1})]),_:1}),e(d,{side:""},{default:l(()=>[e(c,null,{default:l(()=>[o(" Action ")]),_:1})]),_:1})]),_:1}),(_(!0),D(A,null,J(i.value.items,(T,me)=>(_(),M(K,{key:me},{default:l(()=>[e(d,null,{default:l(()=>[e(c,null,{default:l(()=>{var j;return[o(g(((j=T.raw_material)==null?void 0:j.name)||"No Name"),1)]}),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>{var j;return[o(g(((j=T.raw_material)==null?void 0:j.code)||"No Code"),1)]}),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(g(T.category||"No Category"),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(g(U(T.quantity)),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(g(n(T.price_per_unit)),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,null,{default:l(()=>[o(g(G(T.price_per_gram)),1)]),_:2},1024)]),_:2},1024),e(d,{side:""},{default:l(()=>[e(c,null,{default:l(()=>[e(H,{color:"dark",flat:"",round:"",dense:"",icon:"edit",onClick:j=>F(T,i.value)},null,8,["onClick"]),e(He,null,{default:l(()=>[$l]),_:1})]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(_(),D("div",Fl," No items in this delivery "))])])):(_(),D("div",Bl," Select a delivery from the list to see details "))]}),_:1})]),_:1})])])],64))}};var Il=se(Tl,[["__scopeId","data-v-f3001bb0"]]);const Ml=Be("supplier-history",()=>{const v=k(null),S=k([]);return{supplierHistory:v,supplierHistories:S,fetchSupplierHistory:async(P=1,Q=3,w="")=>{console.log("store history");try{const i=await Ee.get("/api/fetch-supplier-records",{params:{page:P,per_page:Q,search:w}});console.log("responsess",i.data),S.value=i.data,console.log("supplierHistoriesssss",S.value)}catch(i){console.log("error",i)}}}});const De=v=>(ue("data-v-0943efb8"),v=v(),de(),v),Rl={class:"text-h6 text-white"},Hl=De(()=>t("div",{class:"text-h6",align:"center"},"Ingredients List",-1)),Ul=De(()=>t("strong",null,"Total Cost:",-1)),Al={__name:"ViewIngredientItems",props:{row:{type:Object,required:!0}},setup(v){const{dialogRef:S,onDialogHide:V}=Ne(),P=v;console.log("props",P.row);const Q=b=>b?b.split(" ").map(N=>N.charAt(0).toUpperCase()+N.slice(1).toLowerCase()).join(" "):"",w=b=>{const N=parseFloat(b);return isNaN(N)?"\u20B10.00":`\u20B1${N.toLocaleString("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2})}`},i=b=>{const N=parseFloat(b.quantity)||0,x=parseFloat(b.price_per_unit)||0;return N*x},f=b=>b.reduce((x,F)=>{const B=parseFloat(F.quantity)||0,p=parseFloat(F.price_per_unit)||0;return x+B*p},0);return(b,N)=>(_(),M(ge,{ref_key:"dialogRef",ref:S,onHide:Ge(V),persistent:"","backdrop-filter":"blur(4px) saturate(150%)"},{default:l(()=>[e(ee,{style:{width:"820px","max-width":"80vw"}},{default:l(()=>[e(R,{class:"row bg-background text-h6"},{default:l(()=>[t("div",Rl,g(Q(v.row.supplier_name||"N/A")),1),e(ze),t("div",null,[ae(e(H,{icon:"arrow_forward_ios",flat:"",dense:"",round:""},null,512),[[oe]])])]),_:1}),e(R,null,{default:l(()=>[t("div",null,"Status: "+g(v.row.status||"N/A"),1)]),_:1}),e(R,null,{default:l(()=>[Hl]),_:1}),e(R,null,{default:l(()=>[e(ne,{dense:"",separator:"",class:"box"},{default:l(()=>[e(K,null,{default:l(()=>[e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Raw Materials Name ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Code ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Quantity ")]),_:1})]),_:1}),e(d,null,{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" TCPI ")]),_:1})]),_:1}),e(d,{side:""},{default:l(()=>[e(c,{class:"text-overline"},{default:l(()=>[o(" Total Cost ")]),_:1})]),_:1})]),_:1}),(_(!0),D(A,null,J(P.row.supplier_ingredients,(x,F)=>(_(),M(K,{key:F},{default:l(()=>[e(d,null,{default:l(()=>[e(c,{class:"text-caption"},{default:l(()=>{var B;return[o(g(((B=x.raw_materials)==null?void 0:B.name)||"N/A"),1)]}),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,{class:"text-caption"},{default:l(()=>{var B;return[o(g(((B=x.raw_materials)==null?void 0:B.code)||"N/A"),1)]}),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,{class:"text-caption"},{default:l(()=>[o(g(parseFloat(x.quantity||"N/A"))+" "+g(x.category||""),1)]),_:2},1024)]),_:2},1024),e(d,null,{default:l(()=>[e(c,{class:"text-caption"},{default:l(()=>[o(g(w(parseFloat(x.price_per_unit||"N/A"))),1)]),_:2},1024)]),_:2},1024),e(d,{side:""},{default:l(()=>[e(c,{class:"text-caption"},{default:l(()=>[o(g(w(i(x)||"N/A")),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(R,{class:"q-mt-md text-right text-subtitle1"},{default:l(()=>[Ul,o(" "+g(w(f(P.row.supplier_ingredients)||"\u20B10.00")),1)]),_:1})]),_:1})]),_:1},8,["onHide"]))}};var Ll=se(Al,[["__scopeId","data-v-0943efb8"]]);const Ol={__name:"SupplierHistoryTab",setup(v){const S=Ml(),V=Y(()=>S.supplierHistories),P=k([]),Q=ce(),w=k(!1),i=k({page:1,rowsPerPage:0,rowsNumber:0}),f=k(""),b=async(p=0,C=3,h="")=>{console.log("Fetching recipe costs in store...");try{w.value=!0,V.value=await S.fetchSupplierHistory(p,C,h),console.log("supplierHistories",V.value);const{data:U,current_page:n,per_page:G,total:y}=V.value;P.value=U,console.log("supplierHistoriesData.value",P.value),i.value.page=n,console.log("pagination.value.page",i.value.page),i.value.rowsPerPage=G,console.log("pagination.value.rowsPerPage",i.value.rowsPerPage),i.value.rowsNumber=y,console.log("pagination.value.rowsNumber",i.value.rowsNumber)}catch(U){console.log("Error fetching recipe costs:",U),ve.create({message:"Error fetching recipe costs",color:"negative",position:"top"})}finally{w.value=!1}};te(b);const N=p=>{console.log("props",p),b(p.pagination.page,p.pagination.rowsPerPage,p.filter)},x=p=>{console.log("Editing row:",p),Q.dialog({component:Ll,componentProps:{row:p}})},F=p=>Qe.formatDate(p,"MMM DD, YYYY || hh:mm A"),B=[{name:"data",required:!0,label:"Date",align:"center",field:p=>p.created_at?F(p.created_at):"N/A"},{name:"supplier",required:!0,label:"Supplier",align:"center",field:p=>p.supplier_name},{name:"status",required:!0,label:"Status",align:"center",field:p=>p.status},{name:"number_of_items",required:!0,label:"Items",align:"center"}];return(p,C)=>(_(),D(A,null,[t("div",null,[e(re,{class:"q-pb-lg q-pl-mb",outlined:"",placeholder:"Search",debounce:"1000",flat:"",dense:"",rounded:"",style:{width:"450px","max-width":"1500px","min-width":"100px"}},{append:l(()=>[e(X,{name:"search"})]),_:1})]),e(Ke,{class:"table-container sticky-header",flat:"","row-key":"id",columns:B,rows:P.value||[],loading:w.value,pagination:i.value,"onUpdate:pagination":C[0]||(C[0]=h=>i.value=h),"rows-per-page-options":[3,5,7,10,0],filter:f.value,onRequest:N},{"body-cell-number_of_items":l(h=>[e(Oe,{props:h},{default:l(()=>[e(H,{flat:"",dense:"",color:"primary",label:`${h.row.supplier_ingredients.length} ${h.row.supplier_ingredients.length===1?"item":"items"}`,onClick:U=>x(h.row)},null,8,["label","onClick"])]),_:2},1032,["props"])]),loading:l(()=>[e(je,{showing:""},{default:l(()=>[e(We,{size:"50px",color:"grey-10"})]),_:1})]),_:1},8,["rows","loading","pagination","filter"])],64))}};var Kl=se(Ol,[["__scopeId","data-v-93fd61a0"]]);const Wl=v=>(ue("data-v-b8d9ed82"),v=v(),de(),v),jl={class:"q-pa-md q-gutter-sm flex flex-column items-center"},El=Wl(()=>t("div",{class:"text-weight-bold"},"Create Delivery",-1)),zl={__name:"StocksPage",setup(v){const S=k("supplier_history");return(V,P)=>(_(),M(Me,{class:"q-pa-md bg-grey-2"},{default:l(()=>[t("div",null,[e(Te,{modelValue:S.value,"onUpdate:modelValue":P[0]||(P[0]=Q=>S.value=Q),dense:"",outline:"",flat:"","no-caps":"","inline-label":"",class:"user-tab justify-center q-ma-md",align:"justify","active-color":"teal","indicator-color":"teal"},{default:l(()=>[e(ke,{class:"text-grey-7",name:"delivery"},{default:l(()=>[t("div",jl,[e(X),El])]),_:1}),e(ke,{class:"text-grey-7",name:"supplier_history",label:"Supplier History"})]),_:1},8,["modelValue"]),e(Ie,{modelValue:S.value,"onUpdate:modelValue":P[1]||(P[1]=Q=>S.value=Q),animated:""},{default:l(()=>[e(Pe,{name:"delivery"},{default:l(()=>[e(Il)]),_:1}),e(Pe,{name:"supplier_history"},{default:l(()=>[e(Kl)]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};var Tt=se(zl,[["__scopeId","data-v-b8d9ed82"]]);export{Tt as default};
